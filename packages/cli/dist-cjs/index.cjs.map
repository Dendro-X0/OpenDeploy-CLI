{"version":3,"sources":["../src/utils/fs.ts","../src/core/detectors/package-manager.ts","../src/core/detectors/monorepo.ts","../src/core/detectors/env-files.ts","../src/core/detectors/next.ts","../src/core/detectors/astro.ts","../src/core/detectors/sveltekit.ts","../src/core/detectors/remix.ts","../src/core/detectors/react-router.ts","../src/core/detectors/nuxt.ts","../src/core/detectors/expo.ts","../src/core/detectors/auto.ts","../src/utils/colors.ts","../src/utils/logger.ts","../src/utils/process.ts","../src/core/provider-system/providers/virtual.ts","../src/utils/hints.ts","../src/core/provider-system/providers/vercel.ts","../src/core/provider-system/providers/cloudflare-pages.ts","../src/core/provider-system/providers/github-pages.ts","../src/utils/workflows.ts","../src/index.ts","../src/commands/detect.ts","../src/schemas/detect-summary.schema.ts","../src/commands/doctor.ts","../src/utils/errors.ts","../src/utils/summarize.ts","../src/schemas/doctor-summary.schema.ts","../src/core/detectors/apps.ts","../src/commands/generate.ts","../src/core/provider-system/provider.ts","../src/commands/deploy.ts","../src/utils/progress.ts","../src/utils/ui.ts","../src/commands/env.ts","../src/core/secrets/env.ts","../src/utils/format.ts","../src/utils/prompt.ts","../src/utils/cache.ts","../src/schemas/env-summary.schema.ts","../src/utils/redaction.ts","../src/commands/seed.ts","../src/core/seed/postgres.ts","../src/core/seed/prisma.ts","../src/core/seed/script.ts","../src/commands/run.ts","../src/schemas/run-summary.schema.ts","../src/utils/concurrency.ts","../src/commands/init.ts","../src/commands/completion.ts","../src/commands/promote.ts","../src/schemas/promote-summary.schema.ts","../src/commands/explain.ts","../src/commands/rollback.ts","../src/schemas/rollback-summary.schema.ts","../src/commands/providers.ts","../src/commands/plan.ts","../src/commands/up.ts","../src/utils/inspect.ts","../src/commands/start.ts","../src/utils/process-pref.ts","../src/utils/process-go.ts","../src/schemas/up-summary.schema.ts","../src/schemas/provider-build-result.schema.ts","../src/schemas/provider-deploy-result.schema.ts","../src/commands/test-matrix.ts","../src/commands/ci-logs.ts"],"sourcesContent":["import { readFile, stat, writeFile, mkdir } from 'node:fs/promises'\r\nimport { dirname } from 'node:path'\r\n\r\ninterface FSX {\r\n  readonly exists: (path: string) => Promise<boolean>\r\n  readonly readJson: <T>(path: string) => Promise<T | null>\r\n  readonly writeJson: (path: string, data: unknown) => Promise<void>\r\n}\r\n\r\nasync function exists(path: string): Promise<boolean> {\r\n  try { const s = await stat(path); return s.isFile() || s.isDirectory() } catch { return false }\r\n}\r\n\r\nasync function readJson<T>(path: string): Promise<T | null> {\r\n  try { const buf = await readFile(path, 'utf8'); return JSON.parse(buf) as T } catch { return null }\r\n}\r\n\r\nasync function writeJson(path: string, data: unknown): Promise<void> {\r\n  try {\r\n    await mkdir(dirname(path), { recursive: true })\r\n  } catch { /* ignore */ }\r\n  const s = JSON.stringify(data, null, 2)\r\n  await writeFile(path, s + \"\\n\", 'utf8')\r\n}\r\n\r\nexport const fsx: FSX = { exists, readJson, writeJson }\r\n","import { join } from 'node:path'\r\nimport { fsx } from '../../utils/fs'\r\nimport type { PackageManager } from '../../types/package-manager'\r\n\r\n/**\r\n * Detect the package manager based on lockfiles.\r\n */\r\nexport async function detectPackageManager(args: { readonly cwd: string }): Promise<PackageManager> {\r\n  const lockBun1: string = join(args.cwd, 'bun.lockb')\r\n  const lockBun2: string = join(args.cwd, 'bun.lock')\r\n  const lockPnpm: string = join(args.cwd, 'pnpm-lock.yaml')\r\n  const lockYarn: string = join(args.cwd, 'yarn.lock')\r\n  const lockNpm: string = join(args.cwd, 'package-lock.json')\r\n  if (await fsx.exists(lockBun1) || await fsx.exists(lockBun2)) return 'bun'\r\n  if (await fsx.exists(lockPnpm)) return 'pnpm'\r\n  if (await fsx.exists(lockYarn)) return 'yarn'\r\n  if (await fsx.exists(lockNpm)) return 'npm'\r\n  return 'pnpm'\r\n}\r\n","import { join } from 'node:path'\r\nimport { fsx } from '../../utils/fs'\r\nimport type { MonorepoTool } from '../../types/monorepo-tool'\r\nimport type { PackageJson } from '../../types/package-json'\r\n\r\n/**\r\n * Detect monorepo tooling presence.\r\n */\r\nexport async function detectMonorepo(args: { readonly cwd: string }): Promise<MonorepoTool> {\r\n  const turbo: string = join(args.cwd, 'turbo.json')\r\n  const nx: string = join(args.cwd, 'nx.json')\r\n  const pnpmWs: string = join(args.cwd, 'pnpm-workspace.yaml')\r\n  if (await fsx.exists(turbo)) return 'turborepo'\r\n  if (await fsx.exists(nx)) return 'nx'\r\n  if (await fsx.exists(pnpmWs)) return 'workspaces'\r\n  const pkgPath: string = join(args.cwd, 'package.json')\r\n  const pkg: PackageJson | null = await fsx.readJson<PackageJson>(pkgPath)\r\n  if (pkg !== null && pkg.workspaces !== undefined) return 'workspaces'\r\n  return 'none'\r\n}\r\n","import { join } from 'node:path'\r\nimport { fsx } from '../../utils/fs'\r\n\r\n/**\r\n * Detect environment files present in the project root.\r\n */\r\nexport async function detectEnvFiles(args: { readonly cwd: string }): Promise<readonly string[]> {\r\n  const candidates: readonly string[] = ['.env', '.env.local', '.env.production', '.env.development']\r\n  const found: string[] = []\r\n  for (const f of candidates) {\r\n    const p: string = join(args.cwd, f)\r\n    if (await fsx.exists(p)) found.push(f)\r\n  }\r\n  return found\r\n}\r\n","import { join } from 'node:path'\r\nimport { fsx } from '../../utils/fs'\r\nimport { detectPackageManager } from './package-manager'\r\nimport { detectMonorepo } from './monorepo'\r\nimport { detectEnvFiles } from './env-files'\r\nimport type { DetectionResult } from '../../types/detection-result'\r\nimport type { PackageJson } from '../../types/package-json'\r\n\r\nfunction hasNextDependency(pkg: PackageJson | null): boolean {\r\n  if (pkg === null) return false\r\n  const deps = { ...(pkg.dependencies ?? {}), ...(pkg.devDependencies ?? {}) }\r\n  return Object.prototype.hasOwnProperty.call(deps, 'next')\r\n}\r\n\r\n/**\r\n * Detect a Next.js app in the provided cwd.\r\n */\r\nexport async function detectNextApp(args: { readonly cwd: string }): Promise<DetectionResult> {\r\n  const pkgPath: string = join(args.cwd, 'package.json')\r\n  const pkg: PackageJson | null = await fsx.readJson<PackageJson>(pkgPath)\r\n  if (!hasNextDependency(pkg)) throw new Error('No Next.js dependency detected in package.json')\r\n  const hasApp: boolean = await fsx.exists(join(args.cwd, 'app'))\r\n  const hasPages: boolean = await fsx.exists(join(args.cwd, 'pages'))\r\n  const build: string = pkg?.scripts?.build ?? 'next build'\r\n  const detection: DetectionResult = {\r\n    framework: 'next',\r\n    rootDir: args.cwd,\r\n    appDir: args.cwd,\r\n    hasAppRouter: hasApp && !hasPages ? true : hasApp,\r\n    packageManager: await detectPackageManager({ cwd: args.cwd }),\r\n    monorepo: await detectMonorepo({ cwd: args.cwd }),\r\n    buildCommand: build,\r\n    outputDir: '.next',\r\n    // Next on Netlify uses a runtime/plugin; publishDir is not strictly required for SSR/hybrid.\r\n    publishDir: undefined,\r\n    renderMode: 'hybrid',\r\n    confidence: 0.95,\r\n    environmentFiles: await detectEnvFiles({ cwd: args.cwd })\r\n  }\r\n  return detection\r\n}\r\n","import { join } from 'node:path'\r\nimport { fsx } from '../../utils/fs'\r\nimport { detectPackageManager } from './package-manager'\r\nimport { detectMonorepo } from './monorepo'\r\nimport { detectEnvFiles } from './env-files'\r\nimport type { DetectionResult } from '../../types/detection-result'\r\nimport type { PackageJson } from '../../types/package-json'\r\n\r\nfunction hasAstroDependency(pkg: PackageJson | null): boolean {\r\n  if (pkg === null) return false\r\n  const deps = { ...(pkg.dependencies ?? {}), ...(pkg.devDependencies ?? {}) }\r\n  return Object.prototype.hasOwnProperty.call(deps, 'astro')\r\n}\r\n\r\n/** Detect an Astro app in the provided cwd. */\r\nexport async function detectAstroApp(args: { readonly cwd: string }): Promise<DetectionResult> {\r\n  const pkgPath: string = join(args.cwd, 'package.json')\r\n  const pkg: PackageJson | null = await fsx.readJson<PackageJson>(pkgPath)\r\n  if (!hasAstroDependency(pkg)) throw new Error('No Astro dependency detected in package.json')\r\n  const build: string = pkg?.scripts?.build ?? 'astro build'\r\n  const detection: DetectionResult = {\r\n    framework: 'astro',\r\n    rootDir: args.cwd,\r\n    appDir: args.cwd,\r\n    hasAppRouter: false,\r\n    packageManager: await detectPackageManager({ cwd: args.cwd }),\r\n    monorepo: await detectMonorepo({ cwd: args.cwd }),\r\n    buildCommand: build,\r\n    outputDir: 'dist',\r\n    publishDir: 'dist',\r\n    renderMode: 'static',\r\n    confidence: 0.9,\r\n    environmentFiles: await detectEnvFiles({ cwd: args.cwd })\r\n  }\r\n  return detection\r\n}\r\n","import { join } from 'node:path'\r\nimport { fsx } from '../../utils/fs'\r\nimport { detectPackageManager } from './package-manager'\r\nimport { detectMonorepo } from './monorepo'\r\nimport { detectEnvFiles } from './env-files'\r\nimport type { DetectionResult } from '../../types/detection-result'\r\nimport type { PackageJson } from '../../types/package-json'\r\n\r\nfunction hasSvelteKitDependency(pkg: PackageJson | null): boolean {\r\n  if (pkg === null) return false\r\n  const deps = { ...(pkg.dependencies ?? {}), ...(pkg.devDependencies ?? {}) }\r\n  // Primary indicator\r\n  if (Object.prototype.hasOwnProperty.call(deps, '@sveltejs/kit')) return true\r\n  // Secondary: some templates include \"svelte\" and infer kit via scripts (best-effort)\r\n  if (Object.prototype.hasOwnProperty.call(deps, 'svelte')) {\r\n    const scripts = pkg.scripts ?? {}\r\n    const hasKitScript = Object.values(scripts).some((s) => typeof s === 'string' && /svelte-?kit|vite\\s+build/i.test(s))\r\n    if (hasKitScript) return true\r\n  }\r\n  return false\r\n}\r\n\r\n/** Detect a SvelteKit app in the provided cwd (best-effort). */\r\nexport async function detectSvelteKitApp(args: { readonly cwd: string }): Promise<DetectionResult> {\r\n  const pkgPath: string = join(args.cwd, 'package.json')\r\n  const pkg: PackageJson | null = await fsx.readJson<PackageJson>(pkgPath)\r\n  if (!hasSvelteKitDependency(pkg)) throw new Error('No SvelteKit dependency detected in package.json')\r\n  const build: string = pkg?.scripts?.build ?? 'vite build'\r\n  const detection: DetectionResult = {\r\n    framework: 'sveltekit',\r\n    rootDir: args.cwd,\r\n    appDir: args.cwd,\r\n    hasAppRouter: false,\r\n    packageManager: await detectPackageManager({ cwd: args.cwd }),\r\n    monorepo: await detectMonorepo({ cwd: args.cwd }),\r\n    buildCommand: build,\r\n    // Output varies by adapter; use a conventional folder for reference\r\n    outputDir: 'build',\r\n    publishDir: 'build',\r\n    renderMode: 'hybrid',\r\n    confidence: 0.85,\r\n    environmentFiles: await detectEnvFiles({ cwd: args.cwd })\r\n  }\r\n  return detection\r\n}\r\n","import { join } from 'node:path'\r\nimport { fsx } from '../../utils/fs'\r\nimport { detectPackageManager } from './package-manager'\r\nimport { detectMonorepo } from './monorepo'\r\nimport { detectEnvFiles } from './env-files'\r\nimport type { DetectionResult } from '../../types/detection-result'\r\nimport type { PackageJson } from '../../types/package-json'\r\n\r\nfunction hasRemixDependency(pkg: PackageJson | null): boolean {\r\n  if (pkg === null) return false\r\n  const deps = { ...(pkg.dependencies ?? {}), ...(pkg.devDependencies ?? {}) }\r\n  if (Object.prototype.hasOwnProperty.call(deps, 'remix')) return true\r\n  if (Object.prototype.hasOwnProperty.call(deps, '@remix-run/node')) return true\r\n  if (Object.prototype.hasOwnProperty.call(deps, '@remix-run/react')) return true\r\n  // Script heuristic\r\n  const scripts = pkg.scripts ?? {}\r\n  const looksLike = Object.values(scripts).some((s) => typeof s === 'string' && /remix\\s+build|remix\\s+dev/i.test(s))\r\n  return looksLike\r\n}\r\n\r\n/** Detect a Remix app in the provided cwd (best-effort). */\r\nexport async function detectRemixApp(args: { readonly cwd: string }): Promise<DetectionResult> {\r\n  const pkgPath: string = join(args.cwd, 'package.json')\r\n  const pkg: PackageJson | null = await fsx.readJson<PackageJson>(pkgPath)\r\n  if (!hasRemixDependency(pkg)) throw new Error('No Remix dependency detected in package.json')\r\n  const build: string = pkg?.scripts?.build ?? 'remix build'\r\n  const detection: DetectionResult = {\r\n    framework: 'remix',\r\n    rootDir: args.cwd,\r\n    appDir: args.cwd,\r\n    hasAppRouter: false,\r\n    packageManager: await detectPackageManager({ cwd: args.cwd }),\r\n    monorepo: await detectMonorepo({ cwd: args.cwd }),\r\n    buildCommand: build,\r\n    outputDir: 'build',\r\n    publishDir: 'build/client',\r\n    renderMode: 'hybrid',\r\n    confidence: 0.88,\r\n    environmentFiles: await detectEnvFiles({ cwd: args.cwd })\r\n  }\r\n  return detection\r\n}\r\n","import { readFile } from 'node:fs/promises'\r\nimport { join } from 'node:path'\r\nimport type { DetectionResult } from '../../types/detection-result'\r\nimport type { PackageManager } from '../../types/package-manager'\r\nimport type { MonorepoTool } from '../../types/monorepo-tool'\r\n\r\nasync function readJson<T>(path: string): Promise<T | null> {\r\n  try { const s = await readFile(path, 'utf8'); return JSON.parse(s) as T } catch { return null }\r\n}\r\n\r\nfunction detectPm(_pkg: any): PackageManager {\r\n  const ua = typeof process.env.npm_config_user_agent === 'string' ? process.env.npm_config_user_agent : ''\r\n  if (ua.includes('pnpm')) return 'pnpm'\r\n  if (ua.includes('yarn')) return 'yarn'\r\n  if (ua.includes('bun')) return 'bun'\r\n  return 'npm'\r\n}\r\n\r\nfunction detectMonorepo(): MonorepoTool {\r\n  return 'none'\r\n}\r\n\r\nexport async function detectReactRouterApp(args: { readonly cwd: string }): Promise<DetectionResult> {\r\n  const cwd: string = args.cwd\r\n  const pkg = await readJson<Record<string, any>>(join(cwd, 'package.json'))\r\n  if (!pkg) throw new Error('not a react-router app')\r\n  const deps = { ...(pkg.dependencies ?? {}), ...(pkg.devDependencies ?? {}) } as Record<string, string>\r\n  const scripts = (pkg.scripts ?? {}) as Record<string, string>\r\n  const hasRRDeps = typeof deps['@react-router/dev'] === 'string' || typeof deps['@react-router/node'] === 'string' || typeof deps['@react-router/serve'] === 'string'\r\n  const hasRRBuild = Object.values(scripts).some((s) => /react-router\\s+build/i.test(String(s)))\r\n  if (!hasRRDeps && !hasRRBuild) throw new Error('not a react-router app')\r\n  const buildCommand: string = hasRRBuild ? (Object.entries(scripts).find(([, cmd]) => /react-router\\s+build/i.test(String(cmd)))?.[1] ?? 'react-router build') : 'react-router build'\r\n  const result: DetectionResult = {\r\n    framework: 'remix',\r\n    rootDir: cwd,\r\n    appDir: cwd,\r\n    hasAppRouter: false,\r\n    packageManager: detectPm(pkg),\r\n    monorepo: detectMonorepo(),\r\n    buildCommand,\r\n    outputDir: 'build',\r\n    publishDir: 'build/client',\r\n    renderMode: 'static',\r\n    confidence: 0.75,\r\n    environmentFiles: ['.env', '.env.local', '.env.production.local']\r\n  }\r\n  return result\r\n}\r\n","import { join } from 'node:path'\r\nimport { fsx } from '../../utils/fs'\r\nimport { detectPackageManager } from './package-manager'\r\nimport { detectMonorepo } from './monorepo'\r\nimport { detectEnvFiles } from './env-files'\r\nimport type { DetectionResult } from '../../types/detection-result'\r\nimport type { PackageJson } from '../../types/package-json'\r\n\r\nfunction hasNuxtDependency(pkg: PackageJson | null): boolean {\r\n  if (pkg === null) return false\r\n  const deps = { ...(pkg.dependencies ?? {}), ...(pkg.devDependencies ?? {}) }\r\n  return Object.prototype.hasOwnProperty.call(deps, 'nuxt')\r\n}\r\n\r\n/** Detect a Nuxt app in the provided cwd (Nuxt 3/4). */\r\nexport async function detectNuxtApp(args: { readonly cwd: string }): Promise<DetectionResult> {\r\n  const pkgPath: string = join(args.cwd, 'package.json')\r\n  const pkg: PackageJson | null = await fsx.readJson<PackageJson>(pkgPath)\r\n  if (!hasNuxtDependency(pkg)) throw new Error('No Nuxt dependency detected in package.json')\r\n  const scripts = pkg?.scripts ?? {}\r\n  const build: string = scripts.build ?? 'nuxt build'\r\n  const usesGenerate: boolean = /nuxt\\s+generate|nuxi\\s+generate/i.test(build)\r\n  const detection: DetectionResult = {\r\n    framework: 'nuxt',\r\n    rootDir: args.cwd,\r\n    appDir: args.cwd,\r\n    hasAppRouter: false,\r\n    packageManager: await detectPackageManager({ cwd: args.cwd }),\r\n    monorepo: await detectMonorepo({ cwd: args.cwd }),\r\n    buildCommand: build,\r\n    // Nuxt outputs to .output by default (Nitro). Static generate -> .output/public\r\n    outputDir: '.output',\r\n    publishDir: usesGenerate ? '.output/public' : undefined,\r\n    renderMode: usesGenerate ? 'static' : 'hybrid',\r\n    confidence: 0.9,\r\n    environmentFiles: await detectEnvFiles({ cwd: args.cwd })\r\n  }\r\n  return detection\r\n}\r\n","import { join } from 'node:path'\r\nimport { fsx } from '../../utils/fs'\r\nimport { detectPackageManager } from './package-manager'\r\nimport { detectMonorepo } from './monorepo'\r\nimport { detectEnvFiles } from './env-files'\r\nimport type { DetectionResult } from '../../types/detection-result'\r\nimport type { PackageJson } from '../../types/package-json'\r\n\r\nfunction hasExpoDependency(pkg: PackageJson | null): boolean {\r\n  if (pkg === null) return false\r\n  const deps = { ...(pkg.dependencies ?? {}), ...(pkg.devDependencies ?? {}) }\r\n  if (Object.prototype.hasOwnProperty.call(deps, 'expo')) return true\r\n  // Typical Expo apps include expo package and expo scripts\r\n  const scripts = pkg.scripts ?? {}\r\n  const looksLike = Object.values(scripts).some((s) => typeof s === 'string' && /expo\\s+(start|build|run|prebuild)/i.test(s))\r\n  return looksLike\r\n}\r\n\r\n/** Detect an Expo app in the provided cwd (best-effort). */\r\nexport async function detectExpoApp(args: { readonly cwd: string }): Promise<DetectionResult> {\r\n  const pkgPath: string = join(args.cwd, 'package.json')\r\n  const pkg: PackageJson | null = await fsx.readJson<PackageJson>(pkgPath)\r\n  if (!hasExpoDependency(pkg)) throw new Error('No Expo dependency detected in package.json')\r\n  const build: string = pkg?.scripts?.build ?? 'expo build'\r\n  const detection: DetectionResult = {\r\n    framework: 'expo',\r\n    rootDir: args.cwd,\r\n    appDir: args.cwd,\r\n    hasAppRouter: false,\r\n    packageManager: await detectPackageManager({ cwd: args.cwd }),\r\n    monorepo: await detectMonorepo({ cwd: args.cwd }),\r\n    buildCommand: build,\r\n    outputDir: 'dist',\r\n    publishDir: 'dist',\r\n    renderMode: 'static',\r\n    confidence: 0.6,\r\n    environmentFiles: await detectEnvFiles({ cwd: args.cwd })\r\n  }\r\n  return detection\r\n}\r\n","/**\r\n * Detection aggregator: try supported framework detectors and return the best match.\r\n * Expo is gated behind OPD_EXPERIMENTAL=1.\r\n */\r\nimport type { DetectionResult } from '../../types/detection-result'\r\nimport type { Framework } from '../../types/framework'\r\nimport { detectNextApp } from './next'\r\nimport { detectAstroApp } from './astro'\r\nimport { detectSvelteKitApp } from './sveltekit'\r\nimport { detectRemixApp } from './remix'\r\nimport { detectReactRouterApp } from './react-router'\r\nimport { detectNuxtApp } from './nuxt'\r\nimport { detectExpoApp } from './expo'\r\n\r\n/** Try a detector and return undefined on non-match */\r\nasync function tryDetect(fn: (args: { readonly cwd: string }) => Promise<DetectionResult>, cwd: string): Promise<DetectionResult | undefined> {\r\n  try { return await fn({ cwd }) } catch { return undefined }\r\n}\r\n\r\n/**\r\n * Detect the current app. Returns the highest-confidence detection.\r\n */\r\nexport async function detectApp(args: { readonly cwd: string }): Promise<DetectionResult> {\r\n  const cwd: string = args.cwd\r\n  const candidates: DetectionResult[] = []\r\n  // Order matters for confidence tie-breaks (web-first)\r\n  const next = await tryDetect(detectNextApp, cwd); if (next) candidates.push(next)\r\n  const astro = await tryDetect(detectAstroApp, cwd); if (astro) candidates.push(astro)\r\n  const svelte = await tryDetect(detectSvelteKitApp, cwd); if (svelte) candidates.push(svelte)\r\n  // Try React Router (Remix family) before classic Remix to capture v7 apps\r\n  const rr = await tryDetect(detectReactRouterApp, cwd); if (rr) candidates.push(rr)\r\n  const remix = await tryDetect(detectRemixApp, cwd); if (remix) candidates.push(remix)\r\n  const nuxt = await tryDetect(detectNuxtApp, cwd); if (nuxt) candidates.push(nuxt)\r\n  if (process.env.OPD_EXPERIMENTAL === '1') {\r\n    const expo = await tryDetect(detectExpoApp, cwd); if (expo) candidates.push(expo)\r\n  }\r\n  if (candidates.length === 0) throw new Error('No supported framework detected')\r\n  // Pick highest confidence; tie-break by earlier order\r\n  candidates.sort((a, b) => b.confidence - a.confidence)\r\n  return candidates[0]\r\n}\r\n\r\n/**\r\n * Detect candidates only (used by UI to annotate choices).\r\n */\r\nexport async function detectCandidates(args: { readonly cwd: string }): Promise<ReadonlySet<Framework>> {\r\n  const cwd: string = args.cwd\r\n  const set = new Set<Framework>()\r\n  if (await tryDetect(detectNextApp, cwd)) set.add('next')\r\n  if (await tryDetect(detectAstroApp, cwd)) set.add('astro')\r\n  if (await tryDetect(detectSvelteKitApp, cwd)) set.add('sveltekit')\r\n  if (await tryDetect(detectReactRouterApp, cwd)) set.add('remix')\r\n  else if (await tryDetect(detectRemixApp, cwd)) set.add('remix')\r\n  if (await tryDetect(detectNuxtApp, cwd)) set.add('nuxt')\r\n  if (process.env.OPD_EXPERIMENTAL === '1' && await tryDetect(detectExpoApp, cwd)) set.add('expo')\r\n  return set\r\n}\r\n","export type ColorMode = 'auto' | 'always' | 'never'\r\n\r\nlet mode: ColorMode = 'auto'\r\n\r\nfunction supportsColor(): boolean {\r\n  if (mode === 'always') return true\r\n  if (mode === 'never') return false\r\n  return Boolean(process.stdout && process.stdout.isTTY)\r\n}\r\n\r\nexport function setColorMode(m: ColorMode): void { mode = m }\r\n\r\nfunction wrap(codeOpen: string, codeClose: string, text: string): string {\r\n  if (!supportsColor()) return text\r\n  return `\\u001b[${codeOpen}m${text}\\u001b[${codeClose}m`\r\n}\r\n\r\nexport const colors = {\r\n  green: (s: string): string => wrap('32', '39', s),\r\n  yellow: (s: string): string => wrap('33', '39', s),\r\n  // Use bright cyan to render as light blue in most terminals\r\n  cyan: (s: string): string => wrap('96', '39', s),\r\n  blue: (s: string): string => wrap('34', '39', s),\r\n  red: (s: string): string => wrap('31', '39', s),\r\n  dim: (s: string): string => wrap('2', '22', s),\r\n  bold: (s: string): string => wrap('1', '22', s)\r\n}\r\n\r\nexport function colorize(kind: 'green' | 'yellow' | 'cyan' | 'blue' | 'red' | 'dim' | 'bold', s: string): string {\r\n  return colors[kind](s)\r\n}\r\n","type LogLevel = 'error' | 'warn' | 'info' | 'debug'\r\n\r\ninterface Logger {\r\n  readonly info: (msg: string) => void\r\n  readonly warn: (msg: string) => void\r\n  readonly error: (msg: string) => void\r\n  readonly success: (msg: string) => void\r\n  readonly note: (msg: string) => void\r\n  readonly section: (title: string) => void\r\n  readonly highlight: (msg: string, color: 'red' | 'green' | 'blue' | 'cyan' | 'yellow' | 'dim' | 'bold') => string\r\n  readonly json: (val: unknown) => void\r\n  readonly jsonPrint: (val: unknown) => void\r\n  readonly setLevel: (lvl: LogLevel) => void\r\n  readonly setJsonOnly: (on: boolean) => void\r\n  readonly setNoEmoji: (on: boolean) => void\r\n  readonly setJsonCompact: (on: boolean) => void\r\n  readonly setNdjson: (on: boolean) => void\r\n  readonly setTimestamps: (on: boolean) => void\r\n  readonly setSummaryOnly: (on: boolean) => void\r\n  readonly setJsonFile: (path: string) => void\r\n  readonly setNdjsonFile: (path: string) => void\r\n  readonly setRedactors: (patterns: readonly (string | RegExp)[]) => void\r\n}\r\n\r\nlet level: LogLevel = 'info'\r\nlet jsonOnly = false\r\nlet noEmoji = false\r\nlet jsonCompact = false\r\nlet ndjson = false\r\nlet timestampsOn = false\r\nlet summaryOnly = false\r\nlet jsonFilePath: string | undefined\r\nlet ndjsonFilePath: string | undefined\r\nlet redactors: RegExp[] = []\r\nimport { dirname } from 'node:path'\r\nimport { mkdir, appendFile } from 'node:fs/promises'\r\nimport { colorize } from './colors'\r\n\r\nasync function safeAppend(path: string, line: string): Promise<void> {\r\n  try {\r\n    await mkdir(dirname(path), { recursive: true })\r\n    await appendFile(path, line, 'utf8')\r\n  } catch { /* ignore file sink errors */ }\r\n}\r\n\r\nfunction applyRedaction(msg: string): string {\r\n  if (redactors.length === 0) return msg\r\n  let out = msg\r\n  for (const r of redactors) {\r\n    try { out = out.replace(r, '******') } catch { /* ignore */ }\r\n  }\r\n  return out\r\n}\r\n\r\nfunction write(kind: LogLevel, msg: string): void {\r\n  if (jsonOnly) return\r\n  const prefix: string = noEmoji\r\n    ? (kind === 'error' ? '[error]' : kind === 'warn' ? '[warn]' : kind === 'info' ? '[info]' : '[debug]')\r\n    : (kind === 'error' ? '✖' : kind === 'warn' ? '⚠' : kind === 'info' ? 'ℹ' : '•')\r\n  const ts: string = timestampsOn ? `${new Date().toISOString()} ` : ''\r\n  // Redact secrets in human logs only\r\n  const redacted: string = applyRedaction(msg)\r\n  // Colorize message content by level for readability, unless msg is already colored\r\n  const hasAnsi: boolean = redacted.includes('\\u001b[')\r\n  const colored: string = hasAnsi ? redacted : (kind === 'error'\r\n    ? colorize('red', redacted)\r\n    : kind === 'warn'\r\n      ? colorize('yellow', redacted)\r\n      : kind === 'info'\r\n        ? colorize('cyan', redacted)\r\n        : redacted)\r\n  // eslint-disable-next-line no-console\r\n  console[kind === 'error' ? 'error' : 'log'](`${ts}${prefix} ${colored}`)\r\n}\r\n\r\nfunction enrichJson(val: unknown): unknown {\r\n  if (!timestampsOn && !ndjson) return val\r\n  if (val !== null && typeof val === 'object') {\r\n    // Shallow clone and add ts when missing\r\n    const obj = { ...(val as Record<string, unknown>) }\r\n    if (timestampsOn && obj.ts === undefined) obj.ts = new Date().toISOString()\r\n    return obj\r\n  }\r\n  return val\r\n}\r\n\r\nexport const logger: Logger = {\r\n  info: (msg: string): void => { if (jsonOnly) return; if (level === 'info' || level === 'debug') write('info', msg) },\r\n  warn: (msg: string): void => { if (jsonOnly) return; write('warn', msg) },\r\n  error: (msg: string): void => { if (jsonOnly) return; write('error', msg) },\r\n  success: (msg: string): void => { if (jsonOnly) return; const text = `${noEmoji ? '[ok]' : '✓'} ${msg}`; const colored = colorize('green', text); write('info', colored) },\r\n  note: (msg: string): void => { if (jsonOnly) return; const text = `${noEmoji ? '[start]' : '◇'} ${msg}`; const colored = colorize('cyan', text); write('info', colored) },\r\n  section: (title: string): void => {\r\n    if (jsonOnly) return\r\n    const bar = '─'.repeat(Math.max(12, Math.min(60, title.length + 10)))\r\n    const head = `${colorize('cyan', bar)}\\n${colorize('bold', title)}\\n${colorize('cyan', bar)}`\r\n    // eslint-disable-next-line no-console\r\n    console.log(head)\r\n  },\r\n  highlight: (msg: string, color: 'red' | 'green' | 'blue' | 'cyan' | 'yellow' | 'dim' | 'bold'): string => colorize(color, msg),\r\n  json: (val: unknown): void => { // eslint-disable-next-line no-console\r\n    const v = enrichJson(val)\r\n    if (summaryOnly) {\r\n      // Only print summary objects marked explicitly\r\n      const isSummary: boolean = typeof v === 'object' && v !== null && (v as Record<string, unknown>).final === true\r\n      if (!isSummary) return\r\n    }\r\n    // Stringify and then apply redaction to avoid leaking secrets in machine-readable logs\r\n    const rawLine: string = ndjson || jsonCompact ? JSON.stringify(v) : JSON.stringify(v, null, 2)\r\n    const line: string = applyRedaction(rawLine)\r\n    // console output\r\n    // eslint-disable-next-line no-console\r\n    console.log(line)\r\n    // file sinks\r\n    if (ndjsonFilePath) void safeAppend(ndjsonFilePath, line + \"\\n\")\r\n    if (jsonFilePath) {\r\n      // For json-file, write pretty when not ndjson/compact\r\n      const jlRaw: string = ndjson ? JSON.stringify(v) : (jsonCompact ? JSON.stringify(v) : JSON.stringify(v, null, 2))\r\n      const jl: string = applyRedaction(jlRaw)\r\n      void safeAppend(jsonFilePath, jl + \"\\n\")\r\n    }\r\n  },\r\n  jsonPrint: (val: unknown): void => {\r\n    // First, go through logger.json to honor sinks, redaction, and flags\r\n    logger.json(val)\r\n    // Then, emit a raw compact JSON line to stdout for robustness\r\n    try {\r\n      // eslint-disable-next-line no-console\r\n      console.log(JSON.stringify(val))\r\n    } catch { /* ignore */ }\r\n  },\r\n  setLevel: (lvl: LogLevel): void => { level = lvl },\r\n  setJsonOnly: (on: boolean): void => { jsonOnly = on },\r\n  setNoEmoji: (on: boolean): void => { noEmoji = on },\r\n  setJsonCompact: (on: boolean): void => { jsonCompact = on },\r\n  setNdjson: (on: boolean): void => { ndjson = on; if (on) { jsonOnly = true; jsonCompact = true } },\r\n  setTimestamps: (on: boolean): void => { timestampsOn = on },\r\n  setSummaryOnly: (on: boolean): void => { summaryOnly = on },\r\n  setJsonFile: (path: string): void => { jsonFilePath = path },\r\n  setNdjsonFile: (path: string): void => { ndjsonFilePath = path }\r\n  ,\r\n  setRedactors: (patterns: readonly (string | RegExp)[]): void => {\r\n    redactors = patterns.map((p) => p instanceof RegExp ? p : new RegExp(escapeRegExp(p), 'g'))\r\n  }\r\n}\r\n\r\nfunction escapeRegExp(s: string): string {\r\n  return s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\r\n}\r\n\r\nexport function isJsonMode(flag?: boolean): boolean {\r\n  return flag === true || process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1'\r\n}\r\n","import { spawn } from 'node:child_process'\r\nimport { dirname } from 'node:path'\r\nimport { appendFile, mkdir, readFile } from 'node:fs/promises'\r\n\r\nexport interface RunArgs { readonly cmd: string; readonly cwd?: string; readonly stdin?: string; readonly env?: Readonly<Record<string, string>> }\r\n\r\n// ------- Minimal NDJSON record/replay (Phase 1) -------\r\nconst recordFile: string | undefined = process.env.OPD_RECORD_FIXTURES\r\nconst replayFile: string | undefined = process.env.OPD_REPLAY_FIXTURES\r\ntype ReplayEvent = { readonly t: 'run' | 'stream'; readonly cmd: string; readonly cwd?: string; readonly ok: boolean; readonly exitCode: number; readonly stdout?: string; readonly stderr?: string; readonly chunks?: ReadonlyArray<{ readonly fd: 'out' | 'err'; readonly data: string }> }\r\nlet replayEvents: ReplayEvent[] = []\r\nlet replayIdx = 0\r\n\r\nasync function ensureDir(path: string): Promise<void> { try { await mkdir(dirname(path), { recursive: true }) } catch { /* ignore */ } }\r\nasync function recordAppend(obj: unknown): Promise<void> { if (!recordFile) return; try { await ensureDir(recordFile); await appendFile(recordFile, JSON.stringify(obj) + '\\n', 'utf8') } catch { /* ignore */ } }\r\nasync function loadReplay(): Promise<void> {\r\n  if (!replayFile || replayEvents.length > 0) return\r\n  try {\r\n    const buf = await readFile(replayFile, 'utf8')\r\n    const lines = buf.split(/\\r?\\n/).map(l => l.trim()).filter(Boolean)\r\n    replayEvents = lines.map((l) => JSON.parse(l) as ReplayEvent)\r\n  } catch { replayEvents = [] }\r\n}\r\nfunction nextReplay(type: 'run' | 'stream', fallbackCmd: string): ReplayEvent | undefined {\r\n  if (replayEvents.length === 0 || replayIdx >= replayEvents.length) return undefined\r\n  const ev = replayEvents[replayIdx++]\r\n  if (ev.t !== type) return ev // tolerate minor drift; Phase 1\r\n  return ev\r\n}\r\n\r\nfunction spawnStream(args: RunStreamArgs): StreamController {\r\n  // Replay first\r\n  if (replayFile) {\r\n    void loadReplay()\r\n    const ev = nextReplay('stream', args.cmd)\r\n    const chunks = ev?.chunks ?? []\r\n    let closed = false\r\n    // Emit chunks async to simulate streaming\r\n    setImmediate(() => {\r\n      for (const c of chunks) {\r\n        if (c.fd === 'out') args.onStdout?.(c.data)\r\n        else args.onStderr?.(c.data)\r\n      }\r\n      closed = true\r\n    })\r\n    const done = new Promise<{ readonly ok: boolean; readonly exitCode: number }>((resolve) => {\r\n      setTimeout(() => resolve({ ok: ev?.ok ?? true, exitCode: ev?.exitCode ?? 0 }), 0)\r\n    })\r\n    const stop = (): void => { /* noop in replay */ }\r\n    return { stop, done }\r\n  }\r\n  if (!args.cmd || args.cmd.trim().length === 0) return { stop: () => {}, done: Promise.resolve({ ok: false, exitCode: 1 }) }\r\n  const isWin: boolean = process.platform === 'win32'\r\n  // Inject CI-friendly env to suppress interactive prompts in provider CLIs when requested\r\n  const mergedEnv: NodeJS.ProcessEnv = args.env !== undefined ? { ...process.env, ...args.env } : { ...process.env }\r\n  const wantCI: boolean = process.env.OPD_FORCE_CI === '1' || process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1' || process.env.CI === 'true' || process.env.CI === '1' || process.env.GITHUB_ACTIONS === 'true'\r\n  if (wantCI) {\r\n    mergedEnv.CI = '1'\r\n    if (!mergedEnv.FORCE_COLOR) mergedEnv.FORCE_COLOR = '0'\r\n    if (!mergedEnv.TERM) mergedEnv.TERM = 'dumb'\r\n  }\r\n  const shellFile: string = isWin ? (process.env.ComSpec ?? 'cmd.exe') : (process.env.SHELL ?? '/bin/sh')\r\n  const shellArgs: readonly string[] = isWin ? ['/d', '/s', '/c', args.cmd] : ['-c', args.cmd]\r\n  const cp = spawn(shellFile, [...shellArgs], { cwd: args.cwd, windowsHide: true, env: mergedEnv })\r\n  const t0 = Date.now()\r\n  if (process.env.OPD_DEBUG_PROCESS === '1') {\r\n    const info = `[proc] spawnStream pid=? cmd=\"${args.cmd}\" cwd=\"${args.cwd ?? ''}\" timeoutMs=${Number(args.timeoutMs) || 0}`\r\n    try { process.stderr.write(info + '\\n') } catch { /* ignore */ }\r\n  }\r\n  cp.stdout?.setEncoding('utf8')\r\n  cp.stderr?.setEncoding('utf8')\r\n  const recChunks: Array<{ readonly fd: 'out' | 'err'; readonly data: string }> = []\r\n  const onOut = (d: string): void => { recChunks.push({ fd: 'out', data: d }); args.onStdout?.(d) }\r\n  const onErr = (d: string): void => { recChunks.push({ fd: 'err', data: d }); args.onStderr?.(d) }\r\n  cp.stdout?.on('data', onOut)\r\n  cp.stderr?.on('data', onErr)\r\n  let timeout: NodeJS.Timeout | undefined\r\n  const done: Promise<{ readonly ok: boolean; readonly exitCode: number }> = new Promise((resolve) => {\r\n    cp.on('error', () => {\r\n      if (process.env.OPD_DEBUG_PROCESS === '1') {\r\n        try { process.stderr.write(`[proc] spawnStream error after ${Date.now() - t0}ms\\n`) } catch { /* ignore */ }\r\n      }\r\n      const res = { ok: false, exitCode: 1 }\r\n      void recordAppend({ t: 'stream', cmd: args.cmd, cwd: args.cwd, ...res, chunks: recChunks })\r\n      resolve(res)\r\n    })\r\n    cp.on('close', (code: number | null) => {\r\n      if (process.env.OPD_DEBUG_PROCESS === '1') {\r\n        const info = `[proc] spawnStream exit code=${code ?? 'null'} after ${Date.now() - t0}ms`\r\n        try { process.stderr.write(info + '\\n') } catch { /* ignore */ }\r\n      }\r\n      const res = { ok: (code ?? 1) === 0, exitCode: code ?? 1 }\r\n      void recordAppend({ t: 'stream', cmd: args.cmd, cwd: args.cwd, ...res, chunks: recChunks })\r\n      resolve(res)\r\n    })\r\n  })\r\n  // Optional timeout watchdog\r\n  if (Number.isFinite(Number(args.timeoutMs)) && Number(args.timeoutMs) > 0) {\r\n    timeout = setTimeout(() => {\r\n      try { cp.kill() } catch { /* ignore */ }\r\n      try { if (isWin) spawn('taskkill', ['/T', '/F', '/PID', String(cp.pid)], { stdio: 'ignore', windowsHide: true }) } catch { /* ignore */ }\r\n    }, Number(args.timeoutMs))\r\n    cp.on('close', () => { if (timeout) clearTimeout(timeout) })\r\n    cp.on('error', () => { if (timeout) clearTimeout(timeout) })\r\n  }\r\n  const stop = (): void => {\r\n    try {\r\n      if (process.platform === 'win32') {\r\n        try { cp.kill() } catch { /* ignore */ }\r\n        try { spawn('taskkill', ['/T', '/F', '/PID', String(cp.pid)], { stdio: 'ignore', windowsHide: true }) } catch { /* ignore */ }\r\n      } else {\r\n        try { cp.kill('SIGTERM') } catch { /* ignore */ }\r\n        setTimeout(() => { try { cp.kill('SIGKILL' as any) } catch { /* ignore */ } }, 500)\r\n      }\r\n    } catch { /* ignore */ }\r\n  }\r\n  return { stop, done }\r\n}\r\nexport interface RunStreamArgs { readonly cmd: string; readonly cwd?: string; readonly env?: Readonly<Record<string, string>>; readonly onStdout?: (chunk: string) => void; readonly onStderr?: (chunk: string) => void; readonly timeoutMs?: number }\r\nexport interface StreamController { readonly stop: () => void; readonly done: Promise<{ readonly ok: boolean; readonly exitCode: number }> }\r\n\r\nexport interface RunResult { readonly ok: boolean; readonly exitCode: number; readonly stdout: string; readonly stderr: string }\r\n\r\nexport interface ProcUtil {\r\n  readonly run: (args: RunArgs) => Promise<RunResult>\r\n  readonly runStream: (args: RunStreamArgs) => Promise<{ readonly ok: boolean; readonly exitCode: number }>\r\n  readonly spawnStream: (args: RunStreamArgs) => StreamController\r\n  readonly has: (cmd: string) => Promise<boolean>\r\n}\r\n\r\nfunction splitCmd(cmdline: string): readonly string[] {\r\n  const matches: RegExpMatchArray | null = cmdline.match(/(?:[^\\s\"']+|\"[^\"]*\"|'[^']*')+/g)\r\n  if (matches === null) return []\r\n  return matches.map((p: string): string => {\r\n    if ((p.startsWith('\"') && p.endsWith('\"')) || (p.startsWith(\"'\") && p.endsWith(\"'\"))) return p.slice(1, -1)\r\n    return p\r\n  })\r\n}\r\n\r\nasync function run(args: RunArgs): Promise<RunResult> {\r\n  if (replayFile) {\r\n    await loadReplay()\r\n    const ev = nextReplay('run', args.cmd)\r\n    const stdout = ev?.stdout ?? ''\r\n    const stderr = ev?.stderr ?? ''\r\n    const exitCode = ev?.exitCode ?? 0\r\n    return { ok: (ev?.ok ?? true), exitCode, stdout, stderr }\r\n  }\r\n  return await new Promise<RunResult>((resolve) => {\r\n    if (!args.cmd || args.cmd.trim().length === 0) return resolve({ ok: false, exitCode: 1, stdout: '', stderr: 'empty command' })\r\n    const isWin: boolean = process.platform === 'win32'\r\n    const mergedEnv: NodeJS.ProcessEnv = args.env !== undefined ? { ...process.env, ...args.env } : { ...process.env }\r\n    const wantCI: boolean = process.env.OPD_FORCE_CI === '1' || process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1' || process.env.CI === 'true' || process.env.CI === '1' || process.env.GITHUB_ACTIONS === 'true'\r\n    if (wantCI) {\r\n      mergedEnv.CI = '1'\r\n      if (!mergedEnv.FORCE_COLOR) mergedEnv.FORCE_COLOR = '0'\r\n      if (!mergedEnv.TERM) mergedEnv.TERM = 'dumb'\r\n    }\r\n    const shellFile: string = isWin ? (process.env.ComSpec ?? 'cmd.exe') : (process.env.SHELL ?? '/bin/sh')\r\n    const shellArgs: readonly string[] = isWin ? ['/d', '/s', '/c', args.cmd] : ['-c', args.cmd]\r\n    const cp = spawn(shellFile, [...shellArgs], { cwd: args.cwd, windowsHide: true, env: mergedEnv })\r\n    const t0 = Date.now()\r\n    if (process.env.OPD_DEBUG_PROCESS === '1') {\r\n      const info = `[proc] run pid=? cmd=\"${args.cmd}\" cwd=\"${args.cwd ?? ''}\"`\r\n      try { process.stderr.write(info + '\\n') } catch { /* ignore */ }\r\n    }\r\n    const outChunks: Buffer[] = []\r\n    const errChunks: Buffer[] = []\r\n    cp.stdout?.on('data', (d: Buffer) => { outChunks.push(Buffer.from(d)) })\r\n    cp.stderr?.on('data', (d: Buffer) => { errChunks.push(Buffer.from(d)) })\r\n    if (typeof args.stdin === 'string' && cp.stdin) {\r\n      cp.stdin.write(args.stdin)\r\n      cp.stdin.end()\r\n    }\r\n    cp.on('error', (_err: Error) => {\r\n      const res = { ok: false, exitCode: 1, stdout: Buffer.concat(outChunks).toString(), stderr: Buffer.concat(errChunks).toString() }\r\n      void recordAppend({ t: 'run', cmd: args.cmd, cwd: args.cwd, ...res })\r\n      resolve(res)\r\n    })\r\n    cp.on('close', (code: number | null) => {\r\n      const exit: number = code === null ? 1 : code\r\n      const res = { ok: exit === 0, exitCode: exit, stdout: Buffer.concat(outChunks).toString(), stderr: Buffer.concat(errChunks).toString() }\r\n      void recordAppend({ t: 'run', cmd: args.cmd, cwd: args.cwd, ...res })\r\n      resolve(res)\r\n    })\r\n  })\r\n}\r\n\r\nasync function has(cmd: string): Promise<boolean> {\r\n  const res: RunResult = await run({ cmd: `${cmd} --version` })\r\n  return res.ok\r\n}\r\n\r\nasync function runStream(args: RunStreamArgs): Promise<{ readonly ok: boolean; readonly exitCode: number }> {\r\n  if (replayFile) {\r\n    await loadReplay()\r\n    const ev = nextReplay('stream', args.cmd)\r\n    for (const c of ev?.chunks ?? []) { if (c.fd === 'out') args.onStdout?.(c.data); else args.onStderr?.(c.data) }\r\n    return { ok: ev?.ok ?? true, exitCode: ev?.exitCode ?? 0 }\r\n  }\r\n  return await new Promise((resolve) => {\r\n    if (!args.cmd || args.cmd.trim().length === 0) return resolve({ ok: false, exitCode: 1 })\r\n    const isWin: boolean = process.platform === 'win32'\r\n    const mergedEnv: NodeJS.ProcessEnv = args.env !== undefined ? { ...process.env, ...args.env } : { ...process.env }\r\n    const wantCI: boolean = process.env.OPD_FORCE_CI === '1' || process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1' || process.env.CI === 'true' || process.env.CI === '1' || process.env.GITHUB_ACTIONS === 'true'\r\n    if (wantCI) {\r\n      mergedEnv.CI = '1'\r\n      if (!mergedEnv.FORCE_COLOR) mergedEnv.FORCE_COLOR = '0'\r\n      if (!mergedEnv.TERM) mergedEnv.TERM = 'dumb'\r\n    }\r\n    const shellFile: string = isWin ? (process.env.ComSpec ?? 'cmd.exe') : (process.env.SHELL ?? '/bin/sh')\r\n    const shellArgs: readonly string[] = isWin ? ['/d', '/s', '/c', args.cmd] : ['-c', args.cmd]\r\n    const cp = spawn(shellFile, [...shellArgs], { cwd: args.cwd, windowsHide: true, env: mergedEnv })\r\n    const t0 = Date.now()\r\n    cp.stdout?.setEncoding('utf8')\r\n    cp.stderr?.setEncoding('utf8')\r\n    if (args.onStdout) cp.stdout?.on('data', (d: string) => { args.onStdout?.(d) })\r\n    if (args.onStderr) cp.stderr?.on('data', (d: string) => { args.onStderr?.(d) })\r\n    let timeout: NodeJS.Timeout | undefined\r\n    cp.on('error', () => {\r\n      if (timeout) clearTimeout(timeout)\r\n      if (process.env.OPD_DEBUG_PROCESS === '1') {\r\n        try { process.stderr.write(`[proc] runStream error after ${Date.now() - t0}ms\\n`) } catch { /* ignore */ }\r\n      }\r\n      const res = { ok: false, exitCode: 1 }\r\n      void recordAppend({ t: 'stream', cmd: args.cmd, cwd: args.cwd, ...res })\r\n      resolve(res)\r\n    })\r\n    cp.on('close', (code: number | null) => {\r\n      if (timeout) clearTimeout(timeout)\r\n      if (process.env.OPD_DEBUG_PROCESS === '1') {\r\n        const info = `[proc] runStream exit code=${code ?? 'null'} after ${Date.now() - t0}ms`\r\n        try { process.stderr.write(info + '\\n') } catch { /* ignore */ }\r\n      }\r\n      resolve({ ok: (code ?? 1) === 0, exitCode: code ?? 1 })\r\n    })\r\n    if (Number.isFinite(Number(args.timeoutMs)) && Number(args.timeoutMs) > 0) {\r\n      timeout = setTimeout(() => {\r\n        try { cp.kill() } catch { /* ignore */ }\r\n        try { if (isWin) spawn('taskkill', ['/T', '/F', '/PID', String(cp.pid)], { stdio: 'ignore', windowsHide: true }) } catch { /* ignore */ }\r\n      }, Number(args.timeoutMs))\r\n    }\r\n  })\r\n}\r\n\r\nexport const proc: ProcUtil = { run, runStream, spawnStream, has }\r\n\r\n// -------- General-purpose helpers (timeouts/retries) --------\r\n\r\nexport async function withTimeout<T>(promise: Promise<T>, ms: number): Promise<T> {\r\n  if (!Number.isFinite(ms) || ms <= 0) return await promise\r\n  return await new Promise<T>((resolve, reject) => {\r\n    const timer = setTimeout(() => reject(new Error(`timeout after ${ms}ms`)), ms)\r\n    promise.then((v) => { clearTimeout(timer); resolve(v) }, (e) => { clearTimeout(timer); reject(e) })\r\n  })\r\n}\r\n\r\nfunction sleep(ms: number): Promise<void> { return new Promise(r => setTimeout(r, ms)) }\r\n\r\nexport async function runWithTimeout(args: RunArgs, timeoutMs = 120_000): Promise<RunResult> {\r\n  return await withTimeout(run(args), timeoutMs)\r\n}\r\n\r\nexport async function runWithRetry(args: RunArgs, opts?: { readonly retries?: number; readonly baseDelayMs?: number; readonly timeoutMs?: number }): Promise<RunResult> {\r\n  const envRetries = Number.isFinite(Number(process.env.OPD_RETRIES)) ? Number(process.env.OPD_RETRIES) : undefined\r\n  const envBase = Number.isFinite(Number(process.env.OPD_BASE_DELAY_MS)) ? Number(process.env.OPD_BASE_DELAY_MS) : undefined\r\n  const envTimeout = Number.isFinite(Number(process.env.OPD_TIMEOUT_MS)) ? Number(process.env.OPD_TIMEOUT_MS) : undefined\r\n  const retries = Math.max(0, opts?.retries ?? (envRetries ?? 2))\r\n  const base = Math.max(10, opts?.baseDelayMs ?? (envBase ?? 300))\r\n  const to = opts?.timeoutMs ?? (envTimeout ?? 120_000)\r\n  let attempt = 0\r\n  // eslint-disable-next-line no-constant-condition\r\n  while (true) {\r\n    try {\r\n      const res = await runWithTimeout(args, to)\r\n      if (res.ok || attempt >= retries) return res\r\n      // fallthrough to retry on non-ok\r\n    } catch (e) {\r\n      if (attempt >= retries) throw e\r\n    }\r\n    const jitter = Math.floor(Math.random() * base)\r\n    const wait = base * Math.pow(2, attempt) + jitter\r\n    await sleep(wait)\r\n    attempt++\r\n  }\r\n}\r\n","import type { Provider } from '../provider-interface'\r\nimport type { ProviderCapabilities } from '../provider-capabilities'\r\nimport type { BuildInputs, BuildResult, DeployInputs, DeployResult, ProjectRef } from '../provider-types'\r\nimport { fsx } from '../../../utils/fs'\r\nimport { join } from 'node:path'\r\n\r\n/**\r\n * VirtualProvider: hermetic, deterministic provider used for tests and local parity.\r\n * It performs no real network or CLI work and returns stable, typed results.\r\n */\r\nexport class VirtualProvider implements Provider {\r\n  public readonly id: string\r\n\r\n  public constructor(baseId: string) {\r\n    this.id = `${baseId}-virtual`\r\n  }\r\n\r\n  /**\r\n   * Minimal capabilities advertised for docs/UX; can be extended.\r\n   */\r\n  public getCapabilities(): ProviderCapabilities {\r\n    return {\r\n      name: 'Virtual Provider',\r\n      supportsLocalBuild: true,\r\n      supportsRemoteBuild: false,\r\n      supportsStaticDeploy: true,\r\n      supportsServerless: false,\r\n      supportsEdgeFunctions: false,\r\n      supportsSsr: false,\r\n      hasProjectLinking: false,\r\n      envContexts: ['preview', 'production'],\r\n      supportsLogsFollow: true,\r\n      supportsAliasDomains: false,\r\n      supportsRollback: false\r\n    }\r\n  }\r\n\r\n  public async detect(_cwd: string): Promise<{ readonly framework?: string; readonly publishDir?: string }> {\r\n    return { framework: 'static', publishDir: 'dist' }\r\n  }\r\n\r\n  public async validateAuth(_cwd: string): Promise<void> { return }\r\n\r\n  public async link(_cwd: string, project: ProjectRef): Promise<ProjectRef> { return project }\r\n\r\n  public async build(args: BuildInputs): Promise<BuildResult> {\r\n    const artifactDir: string = args.publishDirHint ?? 'dist'\r\n    return { ok: true, artifactDir }\r\n  }\r\n\r\n  public async deploy(args: DeployInputs): Promise<DeployResult> {\r\n    const env: 'preview' | 'production' = args.envTarget\r\n    const url: string = env === 'production' ? 'https://example-prod.virtual.app' : 'https://example-preview.virtual.app'\r\n    const logsUrl: string = 'https://virtual.dev/provider/logs/abc123'\r\n    return { ok: true, url, logsUrl }\r\n  }\r\n\r\n  public async open(_project: ProjectRef): Promise<void> { return }\r\n\r\n  public async envList(_project: ProjectRef): Promise<Record<string, string[]>> { return {} }\r\n\r\n  public async envSet(_project: ProjectRef, _kv: Record<string, string>): Promise<void> { return }\r\n\r\n  public async logs(_project: ProjectRef, _options?: { readonly follow?: boolean }): Promise<void> { return }\r\n\r\n  public async generateConfig(args: { readonly detection: { readonly framework?: string; readonly publishDir?: string }; readonly cwd: string; readonly overwrite: boolean }): Promise<string> {\r\n    const filename: string = 'virtual.config.json'\r\n    const path: string = join(args.cwd, filename)\r\n    const exists: boolean = await fsx.exists(path)\r\n    if (!exists || args.overwrite) {\r\n      await fsx.writeJson(path, {\r\n        provider: 'virtual',\r\n        framework: args.detection.framework ?? 'static',\r\n        publishDir: args.detection.publishDir ?? 'dist'\r\n      })\r\n    }\r\n    return filename\r\n  }\r\n}\r\n","/**\n * Hint detection and emission for provider logs.\n * Single-export module per project style guidelines.\n */\nimport { logger } from './logger'\n\ntype ProviderName = 'vercel' | 'cloudflare' | 'github'\n\ninterface Rule {\n  readonly id: string\n  readonly provider?: ProviderName\n  readonly pattern: RegExp\n  readonly kind: 'config' | 'env' | 'dependency' | 'platform' | 'build' | 'runtime'\n  readonly message: string\n  readonly docsUrl?: string\n}\n\nconst EMITTED: Set<string> = new Set()\n\nconst RULES: readonly Rule[] = [\n  {\n    id: 'pnpm-approve-builds',\n    pattern: /Ignored build scripts:/i,\n    kind: 'dependency',\n    message: 'pnpm v9 blocked postinstall scripts (e.g., @tailwindcss/oxide, esbuild). Run \"pnpm approve-builds\" or add { \"pnpm\": { \"trustedDependencies\": [\"@tailwindcss/oxide\",\"esbuild\"] } } to package.json.'\n  },\n  {\n    id: 'env-missing',\n    pattern: /(Missing required (environment )?variables?|not found in process\\.env|Environment variable .+ is required|ReferenceError: process is not defined)/i,\n    kind: 'env',\n    message: 'Missing environment variables. Consider: opd env pull <provider> --env preview; or opd env sync <provider> --file .env.local.'\n  },\n  {\n    id: 'fs-watch-limit',\n    pattern: /ENOSPC: System limit for number of file watchers reached|inotify watch limits reached/i,\n    kind: 'platform',\n    message: 'File watcher limit reached. Increase inotify/fs.watch limits or run builds in CI/Linux/WSL.'\n  },\n  {\n    id: 'cf-wrangler-output-dir',\n    provider: 'cloudflare',\n    pattern: /pages_build_output_dir\\s+.*not found|Cannot find output directory/i,\n    kind: 'config',\n    message: 'wrangler.toml: set pages_build_output_dir = \".vercel/output/static\" for Next on Pages.'\n  },\n  {\n    id: 'cf-nodejs-compat',\n    provider: 'cloudflare',\n    pattern: /ReferenceError:\\s*require\\s+is\\s+not\\s+defined|node:.* module not found/i,\n    kind: 'runtime',\n    message: 'wrangler.toml: add compatibility_flags = [\"nodejs_compat\"].'\n  },\n  {\n    id: 'gh-next-export-missing',\n    provider: 'github',\n    pattern: /No static files found in 'out'|ENOENT.*out\\/_next\\/static/i,\n    kind: 'build',\n    message: 'Next.js → GitHub Pages: enable static export (next.config: { output: \"export\" }) and build to out/.'\n  }\n]\n\nfunction keyOf(rule: Rule): string { return rule.id }\n\nfunction matchRules(args: { readonly provider?: ProviderName; readonly text: string }): readonly Rule[] {\n  const t = args.text\n  const p = args.provider\n  const out: Rule[] = []\n  for (const r of RULES) {\n    if (r.provider && p && r.provider !== p) continue\n    if (r.pattern.test(t)) out.push(r)\n  }\n  return out\n}\n\nexport default function handleHints(args: { readonly provider?: ProviderName; readonly text: string }): void {\n  const hits = matchRules(args)\n  if (hits.length === 0) return\n  for (const r of hits) {\n    const k = keyOf(r)\n    if (EMITTED.has(k)) continue\n    EMITTED.add(k)\n    if (process.env.OPD_NDJSON === '1') logger.json({ action: 'hint', provider: args.provider, kind: r.kind, message: r.message, docsUrl: r.docsUrl })\n    if (process.env.OPD_JSON !== '1' && process.env.OPD_NDJSON !== '1') logger.note(`Hint: ${r.message}`)\n  }\n}\n","import type { Provider } from '../provider-interface'\nimport type { ProviderCapabilities } from '../provider-capabilities'\nimport type { ProjectRef, BuildInputs, BuildResult, DeployInputs, DeployResult } from '../provider-types'\nimport { proc, runWithRetry } from '../../../utils/process'\nimport { join } from 'node:path'\nimport { readFile } from 'node:fs/promises'\nimport { detectApp } from '../../detectors/auto'\nimport { writeFile, stat } from 'node:fs/promises'\nimport type { DetectionResult } from '../../../types/detection-result'\nimport handleHints from '../../../utils/hints'\n\n/**\n * Vercel provider plugin implementing the Provider interface.\n * Prefers remote builds; deploy via `vercel deploy` and capture URL/Inspect URL.\n */\nexport class VercelProvider implements Provider {\n  public readonly id: string = 'vercel'\n\n  private async resolveVercel(cwd: string): Promise<string> {\n    const envBin = process.env.OPD_VERCEL_BIN\n    if (envBin && envBin.length > 0) {\n      const chk = await proc.run({ cmd: `${envBin} --version`, cwd })\n      if (chk.ok) return envBin\n    }\n    const tryCmd = async (cmd: string): Promise<string | undefined> => {\n      const r = await proc.run({ cmd: `${cmd} --version`, cwd })\n      return r.ok ? cmd : undefined\n    }\n    // direct\n    const direct = await tryCmd('vercel'); if (direct) return 'vercel'\n    if (process.platform === 'win32') {\n      const directCmd = await tryCmd('vercel.cmd'); if (directCmd) return 'vercel.cmd'\n      // where resolution: prefer .cmd entries\n      const whereCmd = await proc.run({ cmd: 'where vercel.cmd', cwd });\n      if (whereCmd.ok) {\n        const lines = (whereCmd.stdout || '').split(/\\r?\\n/).map(s => s.trim()).filter(Boolean)\n        if (lines.length > 0) return lines[0]\n      }\n      const whereExe = await proc.run({ cmd: 'where vercel', cwd });\n      if (whereExe.ok) {\n        const lines = (whereExe.stdout || '').split(/\\r?\\n/).map(s => s.trim()).filter(Boolean)\n        const cmdLine = lines.find(l => l.toLowerCase().endsWith('.cmd'))\n        if (cmdLine) return cmdLine\n        // If only extensionless path is present, return bare 'vercel' to let PATHEXT resolve\n        if (lines.length > 0 && !/\\.[a-z]+$/i.test(lines[0])) return 'vercel'\n        if (lines.length > 0) return lines[0]\n      }\n    }\n    // npx fallbacks\n    const npx = await tryCmd('npx -y vercel'); if (npx) return 'npx -y vercel'\n    if (process.platform === 'win32') { const npxCmd = await tryCmd('npx.cmd -y vercel'); if (npxCmd) return 'npx.cmd -y vercel' }\n    // pnpm dlx fallbacks\n    const dlx = await tryCmd('pnpm dlx vercel'); if (dlx) return 'pnpm dlx vercel'\n    if (process.platform === 'win32') { const dlxCmd = await tryCmd('pnpm.cmd dlx vercel'); if (dlxCmd) return 'pnpm.cmd dlx vercel' }\n    return 'vercel'\n  }\n\n  public getCapabilities(): ProviderCapabilities {\n    return {\n      name: 'Vercel',\n      supportsLocalBuild: false,\n      supportsRemoteBuild: true,\n      supportsStaticDeploy: true,\n      supportsServerless: true,\n      supportsEdgeFunctions: true,\n      supportsSsr: true,\n      hasProjectLinking: true,\n      envContexts: ['preview', 'production'],\n      supportsLogsFollow: true,\n      supportsAliasDomains: true,\n      supportsRollback: false\n    }\n  }\n\n  public async detect(cwd: string): Promise<{ readonly framework?: string; readonly publishDir?: string }> {\n    try { const det = await detectApp({ cwd }); return { framework: det.framework as string | undefined, publishDir: det.publishDir } } catch { return {} }\n  }\n\n  public async validateAuth(cwd: string): Promise<void> {\n    const bin = await this.resolveVercel(cwd)\n    if (process.env.OPD_TEST_NO_SPAWN === '1') return\n    const ver = await proc.run({ cmd: `${bin} --version`, cwd })\n    if (!ver.ok) throw new Error('Vercel CLI not found. Install from https://vercel.com/cli or npm i -g vercel')\n    const who = await proc.run({ cmd: `${bin} whoami`, cwd })\n    if (!who.ok) throw new Error('Vercel not logged in. Run: vercel login')\n  }\n\n  public async link(cwd: string, project: ProjectRef): Promise<ProjectRef> {\n    const bin = await this.resolveVercel(cwd)\n    const flags: string[] = ['--yes']\n    if (project.projectId) flags.push(`--project ${project.projectId}`)\n    if (project.orgId) flags.push(`--org ${project.orgId}`)\n    if (flags.length > 1) {\n      const stepTimeout = Number.isFinite(Number(process.env.OPD_TIMEOUT_MS)) ? Number(process.env.OPD_TIMEOUT_MS) : 120_000\n      await runWithRetry({ cmd: `${bin} link ${flags.join(' ')}`.trim(), cwd }, { timeoutMs: stepTimeout })\n    }\n    // Try to discover projectId from .vercel/project.json\n    try {\n      const buf = await readFile(join(cwd, '.vercel', 'project.json'), 'utf8')\n      const js = JSON.parse(buf) as { projectId?: string }\n      if (typeof js.projectId === 'string') return { projectId: js.projectId, orgId: project.orgId }\n    } catch { /* ignore */ }\n    return project\n  }\n\n  public async build(_args: BuildInputs): Promise<BuildResult> {\n    // Remote build provider; no local build step.\n    return { ok: true }\n  }\n\n  public async deploy(args: DeployInputs): Promise<DeployResult> {\n    // Deterministic path for tests/CI: avoid spawning vercel processes entirely\n    if (process.env.OPD_TEST_NO_SPAWN === '1') {\n      const url = 'https://example-preview.vercel.app'\n      const logsUrl = 'https://vercel.com/acme/app/inspect/dep_123'\n      return { ok: true, url, logsUrl }\n    }\n    const bin = await this.resolveVercel(args.cwd)\n    const prod = args.envTarget === 'production'\n    const cmd = prod ? `${bin} deploy --prod --yes` : `${bin} deploy --yes`\n    let deployedUrl: string | undefined\n    let logsUrl: string | undefined\n    const urlRe = /https?:\\/\\/[^\\s]+vercel\\.app/g\n    const inspectRe = /https?:\\/\\/[^\\s]*vercel\\.com[^\\s]*/g\n    const deployTimeout = Number.isFinite(Number(process.env.OPD_TIMEOUT_MS)) ? Number(process.env.OPD_TIMEOUT_MS) : 900_000\n    const ctl = proc.spawnStream({\n      cmd,\n      cwd: args.cwd,\n      timeoutMs: deployTimeout,\n      onStdout: (chunk: string): void => {\n        try { handleHints({ provider: 'vercel', text: chunk }) } catch { /* ignore */ }\n        const m = chunk.match(urlRe)\n        if (!deployedUrl && m && m.length > 0) deployedUrl = m[0]\n      },\n      onStderr: (chunk: string): void => {\n        try { handleHints({ provider: 'vercel', text: chunk }) } catch { /* ignore */ }\n        if (!logsUrl) {\n          const m = chunk.match(inspectRe)\n          if (m && m.length > 0) logsUrl = m[0]\n        }\n      }\n    })\n    const res = await ctl.done\n    if (!res.ok) return { ok: false, message: 'Vercel deploy failed' }\n    // Fallback: if no logsUrl captured during stream but we have a deployment URL, try `vercel inspect`\n    if (!logsUrl && deployedUrl) {\n      try {\n        // Use literal 'vercel' for compatibility with tests/mocks\n        const inspectCmd = `vercel inspect ${deployedUrl}`\n        const out = await proc.run({ cmd: inspectCmd, cwd: args.cwd })\n        if (out.ok) {\n          const m = out.stdout.match(/https?:\\/\\/[^\\s]*vercel\\.com[^\\s]*/g)\n          if (m && m.length > 0) logsUrl = m[0]\n        }\n      } catch { /* ignore */ }\n    }\n    return { ok: true, url: deployedUrl, logsUrl }\n  }\n\n  public async open(_project: ProjectRef): Promise<void> { return }\n  public async envList(_project: ProjectRef): Promise<Record<string, string[]>> { return {} }\n  public async envSet(_project: ProjectRef, _kv: Record<string, string>): Promise<void> { return }\n  public async logs(_project: ProjectRef): Promise<void> { return }\n\n  /**\n   * Write a minimal vercel.json using detection hints.\n   */\n  public async generateConfig(args: { readonly detection: DetectionResult; readonly cwd: string; readonly overwrite: boolean }): Promise<string> {\n    const path = join(args.cwd, 'vercel.json')\n    if (args.overwrite !== true) {\n      try { const s = await stat(path); if (s.isFile()) return path } catch { /* not exists */ }\n    }\n    const config: Record<string, unknown> = {\n      $schema: 'https://openapi.vercel.sh/vercel.json',\n      version: 2,\n      buildCommand: args.detection.buildCommand\n    }\n    if (args.detection.publishDir) config.outputDirectory = args.detection.publishDir\n    const content = `${JSON.stringify(config, null, 2)}\\n`\n    await writeFile(path, content, 'utf8')\n    return path\n  }\n}\n","/**\r\n * Cloudflare Pages provider (minimal) to validate the provider interface.\r\n * This implementation favors local builds (static) and deploys via `wrangler pages deploy`.\r\n */\r\nimport { join } from 'node:path'\r\nimport { stat, writeFile, rm, readFile } from 'node:fs/promises'\r\nimport { proc } from '../../../utils/process'\r\nimport { logger } from '../../../utils/logger'\r\nimport type { Provider } from '../provider-interface'\r\nimport type { DetectionResult } from '../../../types/detection-result'\r\nimport type { ProviderCapabilities } from '../provider-capabilities'\r\nimport type { ProjectRef, BuildInputs, BuildResult, DeployInputs, DeployResult } from '../provider-types'\r\nimport { fsx } from '../../../utils/fs'\r\nimport { detectApp as autoDetect } from '../../detectors/auto'\r\nimport handleHints from '../../../utils/hints'\r\n\r\n/**\r\n * Cloudflare Pages provider implementing the Provider interface.\r\n */\r\nexport class CloudflarePagesProvider implements Provider {\r\n  public readonly id: string = 'cloudflare'\r\n\r\n  private async resolveWrangler(cwd: string): Promise<string> {\r\n    // Environment override first\r\n    const envBin = process.env.OPD_WRANGLER_BIN\r\n    if (envBin && envBin.length > 0) {\r\n      const chk = await proc.run({ cmd: `${envBin} --version`, cwd })\r\n      if (chk.ok) return envBin\r\n    }\r\n    // Try plain 'wrangler'\r\n    const ver = await proc.run({ cmd: 'wrangler --version', cwd })\r\n    if (ver.ok) return 'wrangler'\r\n    // On Windows, global npm bins often expose a .cmd shim and absolute paths via 'where'\r\n    if (process.platform === 'win32') {\r\n      const verCmd = await proc.run({ cmd: 'wrangler.cmd --version', cwd })\r\n      if (verCmd.ok) return 'wrangler.cmd'\r\n      // Prefer absolute .cmd path when available\r\n      const whereCmd = await proc.run({ cmd: 'where wrangler.cmd', cwd })\r\n      if (whereCmd.ok) {\r\n        const first = (whereCmd.stdout || '').split(/\\r?\\n/).map(s => s.trim()).filter(Boolean)[0]\r\n        if (first) return first\r\n      }\r\n      const whereExe = await proc.run({ cmd: 'where wrangler', cwd })\r\n      if (whereExe.ok) {\r\n        const first = (whereExe.stdout || '').split(/\\r?\\n/).map(s => s.trim()).filter(Boolean)[0]\r\n        if (first) return first\r\n      }\r\n    }\r\n    // Try NPX fallback\r\n    const verNpx = await proc.run({ cmd: 'npx -y wrangler --version', cwd })\n    if (verNpx.ok) return 'npx -y wrangler'\n    if (process.platform === 'win32') {\n      const verNpxCmd = await proc.run({ cmd: 'npx.cmd -y wrangler --version', cwd })\n      if (verNpxCmd.ok) return 'npx.cmd -y wrangler'\n    }\n    // Try PNPM DLX fallback\n    const verPnpm = await proc.run({ cmd: 'pnpm dlx wrangler --version', cwd })\n    if (verPnpm.ok) return 'pnpm dlx wrangler'\n    if (process.platform === 'win32') {\n      const verPnpmCmd = await proc.run({ cmd: 'pnpm.cmd dlx wrangler --version', cwd })\n      if (verPnpmCmd.ok) return 'pnpm.cmd dlx wrangler'\n    }\n    // Fallback to 'wrangler' to surface a meaningful error downstream\n    return 'wrangler'\n  }\n\n  /** Return capability declaration used by the CLI to adapt flows */\n  public getCapabilities(): ProviderCapabilities {\n    return {\n      name: 'Cloudflare Pages',\n      supportsLocalBuild: true,\n      supportsRemoteBuild: false,\n      supportsStaticDeploy: true,\n      supportsServerless: true, // via Pages Functions\n      supportsEdgeFunctions: true,\n      supportsSsr: true,\n      hasProjectLinking: true, // project name\n      envContexts: ['preview', 'production'],\n      supportsLogsFollow: false,\n      supportsAliasDomains: false,\n      supportsRollback: false\n    }\n  }\n\n  /** Heuristic detection using our auto detector */\n  public async detect(cwd: string): Promise<{ readonly framework?: string; readonly publishDir?: string }> {\n    try {\n      const det = await autoDetect({ cwd })\n      return { framework: det.framework as string | undefined, publishDir: det.publishDir ?? 'dist' }\n    } catch {\n      return { publishDir: 'dist' }\n    }\n  }\n\n  /** Validate wrangler auth is ready */\n  public async validateAuth(cwd: string): Promise<void> {\n    const bin = await this.resolveWrangler(cwd)\n    // Check wrangler availability\n    const ver = await proc.run({ cmd: `${bin} --version`, cwd })\n    if (!ver.ok) throw new Error('Wrangler not found. Install with: npm i -g wrangler')\n    // whoami: login required for Pages deploys\n    const who = await proc.run({ cmd: `${bin} whoami`, cwd })\n    if (!who.ok) throw new Error('Wrangler not logged in. Run: wrangler login')\n  }\n\n  /** Linking is name-based for Pages; we accept and return the provided ref */\n  public async link(cwd: string, project: ProjectRef): Promise<ProjectRef> {\n    // Derive a sensible default project name when none is provided\n    const base = cwd.replace(/\\\\/g, '/').split('/').filter(Boolean).pop() || 'site'\n    const name = (project.projectId || project.slug || base)\n      .toLowerCase()\n      .replace(/[^a-z0-9-]/g, '-')\n      .replace(/--+/g, '-')\n      .replace(/^-+|-+$/g, '')\n      || 'site'\n    // Try to create the project; if it already exists, ignore the error\n    // Prefer specifying production branch when supported; fall back if unknown flag\n    const bin = await this.resolveWrangler(cwd)\n    const tryCreate = async (cmd: string): Promise<boolean> => {\n      const out = await proc.run({ cmd, cwd })\n      if (out.ok) return true\n      const text = (out.stderr || out.stdout || '').toLowerCase()\n      if (text.includes('already exists') || text.includes('exists')) return true\n      return false\n    }\n    const created = await tryCreate(`${bin} pages project create ${name} --production-branch main`)\n    if (!created) {\n      // Fallback without extra flags\n      await tryCreate(`${bin} pages project create ${name}`)\n    }\n    return { projectId: name, orgId: project.orgId, slug: name }\n  }\n\n  /**\n   * Build is user-project specific; we expect the caller to have built already\n   * when necessary. We return an artifactDir derived from publishDirHint when available.\n   */\n  public async build(args: BuildInputs): Promise<BuildResult> {\n    // Optional builder: for Next.js SSR/hybrid on Cloudflare Pages, use Next on Pages to produce .vercel/output/static\n    try {\n      const wantBuild: boolean = args.noBuild !== true\n      let fw: string | undefined = args.framework\n      if (!fw) {\n        try { const det = await autoDetect({ cwd: args.cwd }); fw = det.framework } catch { /* ignore */ }\n      }\n      const isNext: boolean = (fw || '').toLowerCase() === 'next'\n      if (wantBuild && isNext) {\n        logger.note('Cloudflare Pages: building with @cloudflare/next-on-pages')\n        // Clean previous build artifacts to prevent stale basePath/assetPrefix carry-over\n        try { await rm(join(args.cwd, '.vercel', 'output'), { recursive: true, force: true }) } catch { /* ignore */ }\n        try { await rm(join(args.cwd, '.next'), { recursive: true, force: true }) } catch { /* ignore */ }\n        const env = { ...process.env, DEPLOY_TARGET: 'cloudflare', NEXT_PUBLIC_BASE_PATH: '' }\n        const localCmd = process.platform === 'win32' ? 'node_modules/.bin/next-on-pages.cmd' : 'node_modules/.bin/next-on-pages'\n        // Ensure DEPLOY_TARGET is visible to Next even if sub-processes miss env: write .env.production\n        const envFile = join(args.cwd, '.env.production')\n        let prevEnv: string | null = null\n        let hadPrev = false\n        try { prevEnv = await readFile(envFile, 'utf8'); hadPrev = true } catch { /* no previous */ }\n        const enforcedEnv = `DEPLOY_TARGET=cloudflare\\nNEXT_PUBLIC_BASE_PATH=\\nNEXT_IGNORE_BUILD_CACHE=1\\n`\n        try { await writeFile(envFile, hadPrev ? `${prevEnv}\\n${enforcedEnv}` : enforcedEnv, 'utf8') } catch { /* ignore */ }\n        const candidates: string[] = [\n          localCmd,\n          'pnpm exec @cloudflare/next-on-pages',\n          process.platform === 'win32' ? 'pnpm.cmd exec @cloudflare/next-on-pages' : '',\n          'npx -y @cloudflare/next-on-pages@1',\n          process.platform === 'win32' ? 'npx.cmd -y @cloudflare/next-on-pages@1' : ''\n        ].filter(Boolean)\n        let built = false\n        for (const cmd of candidates) {\n          const res = await proc.run({ cmd, cwd: args.cwd, env })\n          try { handleHints({ provider: 'cloudflare', text: (res.stderr || '') + ' ' + (res.stdout || '') }) } catch { /* ignore */ }\n          if (res.ok) { built = true; break }\n        }\n        // Restore previous env file\n        try {\n          if (hadPrev && prevEnv !== null) await writeFile(envFile, prevEnv, 'utf8')\n          else await rm(envFile, { force: true })\n        } catch { /* ignore */ }\n        const cfStatic = join(args.cwd, '.vercel', 'output', 'static')\n        const exists = await fsx.exists(cfStatic)\n        if (!built || !exists) {\n          const msg = 'Next on Pages build did not produce .vercel/output/static. Ensure @cloudflare/next-on-pages is installed and compatible, and try again.'\n          logger.warn(msg)\n          return { ok: false, message: msg }\n        }\n        // Optionally add _redirects: opt-in via env or auto-detect stale GH subpath references\n        try {\n          const want = process.env.OPD_CF_ADD_SUBPATH_REDIRECTS === '1'\n          let detected = false\n          if (!want) {\n            const candidates: string[] = [\n              join(cfStatic, 'index.html'),\n              join(cfStatic, 'docs', 'index.html')\n            ]\n            for (const f of candidates) {\n              try {\n                const ok = await fsx.exists(f)\n                if (!ok) continue\n                const html = await readFile(f, 'utf8')\n                if (html.includes('/opendeploy-cli-docs-site/')) { detected = true; break }\n              } catch { /* ignore */ }\n            }\n          }\n          if (want || detected) {\n            const redirects = [\n              '/opendeploy-cli-docs-site     /   301',\n              '/opendeploy-cli-docs-site/*   /:splat   301',\n              '/opendeploy-cli-docs-site/_next/*   /_next/:splat   200',\n              '/opendeploy-cli-docs-site/docs/*   /docs/:splat   200',\n              '/opendeploy-cli-docs-site/data/*   /data/:splat   200'\n            ].join('\\n') + '\\n'\n            await writeFile(join(cfStatic, '_redirects'), redirects, 'utf8')\n            logger.note('Added Cloudflare _redirects to normalize subpath links to root (opt-in/detected)')\n          } else {\n            logger.info('Skipping _redirects generation (no stale subpath references detected)')\n          }\n        } catch { /* ignore */ }\n        return { ok: true, artifactDir: cfStatic }\n      }\n    } catch { /* ignore, fall through to generic discovery for non-Next */ }\n    // We do not run other user builds here; we only resolve an artifact directory.\n    const candidates: string[] = []\n    if (args.publishDirHint) candidates.push(args.publishDirHint)\n    candidates.push('dist', 'build', 'out', 'public')\n    for (const c of candidates) {\n      const full = join(args.cwd, c)\n      try { if (await fsx.exists(full)) return { ok: true, artifactDir: full } } catch { /* ignore */ }\n    }\n    // If nothing exists yet, return hint-based path or default dist (non-Next only)\n    const hint = args.publishDirHint ? join(args.cwd, args.publishDirHint) : join(args.cwd, 'dist')\n    return { ok: true, artifactDir: hint }\n  }\n\n  /** Deploys using wrangler pages deploy <dir> --project-name <name> */\n  public async deploy(args: DeployInputs): Promise<DeployResult> {\n    const bin = await this.resolveWrangler(args.cwd)\n    const projectName: string | undefined = args.project.projectId ?? args.project.slug\n    const dir: string = args.artifactDir || join(args.cwd, 'dist')\n    try { if (!(await fsx.exists(dir))) return { ok: false, message: `Artifact directory not found: ${dir}. Run your build or set publishDir.` } } catch { /* ignore */ }\n    const projFlag = projectName ? ` --project-name ${projectName}` : ''\n    const cmd = `${bin} pages deploy ${dir}${projFlag}`\n    const out = await proc.run({ cmd, cwd: args.cwd })\n    try { handleHints({ provider: 'cloudflare', text: (out.stderr || '') + ' ' + (out.stdout || '') }) } catch { /* ignore */ }\n    if (!out.ok) {\n      const msg = (out.stderr || out.stdout || '').trim() || 'Cloudflare deploy failed'\n      return { ok: false, message: msg }\n    }\n    // Try to parse deployment and dashboard URLs from stdout\n    const urls = (out.stdout.match(/https?:\\/\\/[^\\s]+/g) || []) as string[]\n    const deployUrl = urls.find(u => /\\.pages\\.dev\\b/i.test(u)) || urls[0]\n    // Best-effort dashboard/logs URL\n    let logsUrl: string | undefined\n    logsUrl = urls.find(u => /dash\\.cloudflare\\.com\\//i.test(u))\n    if (!logsUrl && projectName) {\n      // Generic dashboard deep-link; account segment is resolved by Cloudflare automatically\n      logsUrl = `https://dash.cloudflare.com/?to=/:account/pages/view/${projectName}`\n    }\n    // Attempt to refine logs/inspect URL using latest deployment info\n    if (projectName) {\n      try {\n        const listCmd = `${bin} pages deployments list --project-name ${projectName} --limit 1`\n        const info = await proc.run({ cmd: listCmd, cwd: args.cwd })\n        if (info.ok) {\n          const m = info.stdout.match(/https?:\\/\\/[^\\s]+/g)\n          if (m && m.length > 0) {\n            // Prefer an Inspect or Dashboard link if present in the list output\n            const inspect = m.find(u => /dash\\.cloudflare\\.com\\//i.test(u))\n            if (inspect) logsUrl = inspect\n          }\n        }\n      } catch { /* ignore */ }\n    }\n    return { ok: true, url: deployUrl, logsUrl }\n  }\n\n  public async open(_project: ProjectRef): Promise<void> { return }\n  public async envList(_project: ProjectRef): Promise<Record<string, string[]>> { return {} }\n  public async envSet(_project: ProjectRef, _kv: Record<string, string>): Promise<void> { return }\n  public async logs(_project: ProjectRef): Promise<void> { return }\n  /**\n   * Generate a minimal wrangler.toml. This file is optional for static Pages,\n   * but we create it as a convenient placeholder and return its path.\n   */\n  public async generateConfig(args: { readonly detection: DetectionResult; readonly cwd: string; readonly overwrite: boolean }): Promise<string> {\n    void args.detection\n    const path = join(args.cwd, 'wrangler.toml')\n    if (args.overwrite !== true) {\n      try { const s = await stat(path); if (s.isFile()) return path } catch { /* not exists */ }\n    }\n    const base = args.cwd.replace(/\\\\/g, '/').split('/').filter(Boolean).pop() || 'site'\n    const name = base.toLowerCase().replace(/[^a-z0-9-]/g, '-').replace(/--+/g, '-').replace(/^-+|-+$/g, '') || 'site'\n    const body = `# Auto-generated by OpenDeploy CLI (Cloudflare Pages)\\n# This minimal file is optional for static Pages.\\n# Add a functions directory and additional settings as needed.\\nname = \"${name}\"\\n`\n    await writeFile(path, body, 'utf8')\n    return path\n  }\n}\n","/**\r\n * GitHub Pages provider (static-only) implementing the Provider interface.\r\n * Local deploy uses `gh-pages` (via npx) to push the artifact folder to the gh-pages branch.\r\n */\r\nimport { join } from 'node:path'\r\nimport { proc } from '../../../utils/process'\r\nimport { logger } from '../../../utils/logger'\r\nimport type { Provider } from '../provider-interface'\r\nimport type { ProviderCapabilities } from '../provider-capabilities'\r\nimport type { ProjectRef, BuildInputs, BuildResult, DeployInputs, DeployResult } from '../provider-types'\r\nimport { fsx } from '../../../utils/fs'\r\nimport { detectApp as autoDetect } from '../../detectors/auto'\r\nimport { writeFile, stat, readFile } from 'node:fs/promises'\r\nimport handleHints from '../../../utils/hints'\r\nimport type { DetectionResult } from '../../../types/detection-result'\r\n\r\n/** Parse a Git remote URL (https or ssh) into owner/repo */\r\nfunction parseGitRemote(remote: string): { readonly owner?: string; readonly repo?: string } {\r\n  const t = remote.trim()\r\n  // https: https://github.com/owner/repo.git\r\n  const httpsRe = /^https?:\\/\\/github\\.com\\/(.+?)\\/(.+?)(?:\\.git)?$/i\r\n  const m1 = t.match(httpsRe)\r\n  if (m1) return { owner: m1[1], repo: m1[2] }\r\n  // ssh: git@github.com:owner/repo.git\r\n  const sshRe = /^git@github\\.com:(.+?)\\/(.+?)(?:\\.git)?$/i\r\n  const m2 = t.match(sshRe)\r\n  if (m2) return { owner: m2[1], repo: m2[2] }\r\n  return {}\r\n}\r\n\r\n/**\r\n * GitHub Pages provider.\r\n * - Static-only deployments.\r\n * - Uses `gh-pages` to push the artifact directory to the `gh-pages` branch.\r\n */\r\nexport class GithubPagesProvider implements Provider {\r\n  public readonly id: string = 'github'\r\n\r\n  /** Resolve a working gh-pages binary on the current platform. */\r\n  private async resolveGhPagesBin(cwd: string): Promise<string> {\r\n    const envBin = process.env.OPD_GHPAGES_BIN\r\n    if (envBin && envBin.length > 0) {\r\n      const chk = await proc.run({ cmd: `${envBin} --help`, cwd })\r\n      if (chk.ok) return envBin\r\n    }\r\n    // Try local install first\r\n    const local = await proc.run({ cmd: 'gh-pages --help', cwd })\r\n    if (local.ok) return 'gh-pages'\r\n    // Windows shims and absolute paths via where\r\n    if (process.platform === 'win32') {\r\n      const whereCmd = await proc.run({ cmd: 'where gh-pages.cmd', cwd })\r\n      if (whereCmd.ok) {\r\n        const first = (whereCmd.stdout || '').split(/\\r?\\n/).map(s => s.trim()).filter(Boolean)[0]\r\n        if (first) return first\r\n      }\r\n      const whereExe = await proc.run({ cmd: 'where gh-pages', cwd })\r\n      if (whereExe.ok) {\r\n        const first = (whereExe.stdout || '').split(/\\r?\\n/).map(s => s.trim()).filter(Boolean)[0]\r\n        if (first) return first\r\n      }\r\n    }\r\n    // NPX fallback (works cross platform)\r\n    const npx = await proc.run({ cmd: 'npx -y gh-pages --help', cwd })\r\n    if (npx.ok) return 'npx -y gh-pages'\r\n    if (process.platform === 'win32') {\r\n      const npxCmd = await proc.run({ cmd: 'npx.cmd -y gh-pages --help', cwd })\r\n      if (npxCmd.ok) return 'npx.cmd -y gh-pages'\r\n    }\r\n    // PNPM DLX fallback\r\n    const dlx = await proc.run({ cmd: 'pnpm dlx gh-pages --help', cwd })\r\n    if (dlx.ok) return 'pnpm dlx gh-pages'\r\n    if (process.platform === 'win32') {\r\n      const dlxCmd = await proc.run({ cmd: 'pnpm.cmd dlx gh-pages --help', cwd })\r\n      if (dlxCmd.ok) return 'pnpm.cmd dlx gh-pages'\r\n    }\r\n    return 'gh-pages'\r\n  }\r\n\r\n  /** Return capabilities to help the CLI adapt flows for this provider. */\r\n  public getCapabilities(): ProviderCapabilities {\r\n    return {\r\n      name: 'GitHub Pages',\r\n      supportsLocalBuild: true,\r\n      supportsRemoteBuild: false,\r\n      supportsStaticDeploy: true,\r\n      supportsServerless: false,\r\n      supportsEdgeFunctions: false,\r\n      supportsSsr: false,\r\n      hasProjectLinking: false,\r\n      envContexts: ['production'],\r\n      supportsLogsFollow: false,\r\n      supportsAliasDomains: false,\r\n      supportsRollback: false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Detect framework and publish directory.\r\n   * Falls back to 'dist' when detection is inconclusive.\r\n   */\r\n  public async detect(cwd: string): Promise<{ readonly framework?: string; readonly publishDir?: string }> {\r\n    try {\r\n      const det = await autoDetect({ cwd })\r\n      const fw = (det.framework as string | undefined)?.toLowerCase()\r\n      // For Next.js on GitHub Pages, prefer 'out' generated by `next export`.\r\n      const publish = fw === 'next' ? 'out' : (det.publishDir ?? 'dist')\r\n      return { framework: det.framework as string | undefined, publishDir: publish }\r\n    } catch {\r\n      return { publishDir: 'dist' }\r\n    }\r\n  }\r\n\r\n  /** Validate Git and GitHub remote prerequisites for gh-pages deploy. */\r\n  public async validateAuth(cwd: string): Promise<void> {\r\n    // gh-pages uses git under the hood; ensure git exists and origin is set\r\n    const git = await proc.run({ cmd: 'git --version', cwd })\r\n    if (!git.ok) throw new Error('Git not found. Install Git to deploy to GitHub Pages.')\r\n    const origin = await proc.run({ cmd: 'git remote get-url origin', cwd })\r\n    if (!origin.ok) throw new Error('No GitHub remote detected. Ensure `origin` remote points to GitHub.')\r\n  }\r\n\r\n  /**\r\n   * Linking for GitHub Pages is implicit; derive owner/repo from the origin remote when possible.\r\n   * Returns a minimal project reference.\r\n   */\r\n  public async link(cwd: string, project: ProjectRef): Promise<ProjectRef> {\r\n    // Nothing to link explicitly for gh-pages; derive repo if possible\r\n    try {\r\n      const origin = await proc.run({ cmd: 'git remote get-url origin', cwd })\r\n      if (origin.ok) {\r\n        const { owner, repo } = parseGitRemote(origin.stdout.trim())\r\n        if (owner && repo) return { projectId: repo, orgId: owner, slug: `${owner}/${repo}` }\r\n      }\r\n    } catch { /* ignore */ }\r\n    const base = cwd.replace(/\\\\/g, '/').split('/').filter(Boolean).pop() || 'site'\r\n    return { projectId: base, slug: base }\r\n  }\r\n\r\n  /**\r\n   * Resolve an artifact directory. Does not run a user build.\r\n   */\r\n  public async build(args: BuildInputs): Promise<BuildResult> {\r\n    // Optionally run a framework-aware static build for GitHub Pages when not disabled\r\n    try {\r\n      const wantBuild: boolean = args.noBuild !== true\r\n      // Detect framework if not provided\r\n      let fw: string | undefined = args.framework\r\n      let publishHint: string | undefined = args.publishDirHint\r\n      if (!fw || !publishHint) {\r\n        try {\r\n          const det = await autoDetect({ cwd: args.cwd })\r\n          fw = fw || det.framework\r\n          publishHint = publishHint || det.publishDir\r\n        } catch { /* ignore */ }\r\n      }\r\n      if (wantBuild) {\r\n        const lower = (fw || '').toLowerCase()\r\n        if (lower === 'next') {\r\n          // Next.js 13+ static export uses output: 'export' with next build\r\n          logger.note('GitHub Pages: building Next.js for static export (next build with output: \"export\")')\r\n          const b = await proc.run({ cmd: 'npx -y next build', cwd: args.cwd, env: { ...process.env, DEPLOY_TARGET: 'github' } })\r\n          if (!b.ok) logger.warn(b.stderr.trim() || b.stdout.trim() || 'next build failed')\r\n          // Emit Next config hints\r\n          try { await this.checkNextHints(args.cwd) } catch { /* ignore */ }\r\n          // Validate expected artifact\r\n          const outDir = join(args.cwd, 'out')\r\n          try { if (!(await fsx.exists(outDir))) logger.warn('Next.js build did not produce ./out. Ensure next.config.js sets output: \"export\" and images.unoptimized: true.') } catch { /* ignore */ }\r\n          // Additional sanity: check for _next/static\r\n          try { if (!(await fsx.exists(join(outDir, '_next')))) logger.warn('Missing ./out/_next assets. Set basePath/assetPrefix for GitHub Pages and enable trailingSlash: true.') } catch { /* ignore */ }\r\n        } else if (lower === 'astro') {\r\n          logger.note('GitHub Pages: building Astro (astro build)')\r\n          const ex = await proc.run({ cmd: 'npx -y astro build', cwd: args.cwd })\r\n          if (!ex.ok) logger.warn(ex.stderr.trim() || ex.stdout.trim() || 'astro build failed')\r\n        } else if (lower === 'sveltekit') {\r\n          logger.note('GitHub Pages: building SvelteKit (vite build)')\r\n          const ex = await proc.run({ cmd: 'npx -y vite build', cwd: args.cwd })\r\n          if (!ex.ok) logger.warn(ex.stderr.trim() || ex.stdout.trim() || 'vite build failed')\r\n        }\r\n      }\r\n    } catch { /* best effort build; fall back to artifact discovery */ }\r\n\r\n    // Reuse existing artifact if present; otherwise point to hint/default\r\n    const candidates: string[] = []\r\n    if (args.publishDirHint) candidates.push(args.publishDirHint)\r\n    candidates.push('dist', 'build', 'out', 'public')\r\n    for (const c of candidates) {\r\n      const full = join(args.cwd, c)\r\n      try { if (await fsx.exists(full)) return { ok: true, artifactDir: full } } catch { /* ignore */ }\r\n    }\r\n    const hint = args.publishDirHint ? join(args.cwd, args.publishDirHint) : join(args.cwd, 'dist')\r\n    return { ok: true, artifactDir: hint }\r\n  }\r\n\r\n  /**\r\n   * Deploy by pushing the artifact directory to the gh-pages branch using gh-pages.\r\n   * Returns the public Pages URL when it can be inferred from the origin remote.\r\n   */\r\n  public async deploy(args: DeployInputs): Promise<DeployResult> {\r\n    const bin = await this.resolveGhPagesBin(args.cwd)\r\n    const dir: string = args.artifactDir || join(args.cwd, 'dist')\r\n    try { if (!(await fsx.exists(dir))) return { ok: false, message: `Artifact directory not found: ${dir}. Run your build or set publishDir.` } } catch { /* ignore */ }\r\n    // Ensure .nojekyll is present in the artifact so GitHub Pages does not ignore the _next assets folder\r\n    try {\r\n      const marker = join(dir, '.nojekyll')\r\n      if (!(await fsx.exists(marker))) await writeFile(marker, '', 'utf8')\r\n    } catch { /* best effort */ }\r\n    // Push to gh-pages branch\r\n    const cmd = `${bin} -d ${dir} --dotfiles`\r\n    const out = await proc.run({ cmd, cwd: args.cwd })\r\n    try { handleHints({ provider: 'github', text: (out.stderr || '') + ' ' + (out.stdout || '') }) } catch { /* ignore */ }\r\n    if (!out.ok) return { ok: false, message: out.stderr.trim() || out.stdout.trim() || 'GitHub Pages deploy failed' }\r\n    // Best-effort URL from git remote\r\n    let url: string | undefined\r\n    try {\r\n      const origin = await proc.run({ cmd: 'git remote get-url origin', cwd: args.cwd })\r\n      if (origin.ok) {\r\n        const { owner, repo } = parseGitRemote(origin.stdout.trim())\r\n        if (owner && repo) url = `https://${owner}.github.io/${repo}/`\r\n      }\r\n    } catch { /* ignore */ }\r\n    return { ok: true, url }\r\n  }\r\n\r\n  public async open(_project: ProjectRef): Promise<void> { return }\r\n  public async envList(_project: ProjectRef): Promise<Record<string, string[]>> { return {} }\r\n  public async envSet(_project: ProjectRef, _kv: Record<string, string>): Promise<void> { return }\r\n  public async logs(_project: ProjectRef): Promise<void> { return }\r\n\r\n  /**\r\n   * GitHub Pages generally requires no config file, but we can ensure a `.nojekyll` marker.\r\n   * Returns the path to the marker file.\r\n   */\r\n  public async generateConfig(args: { readonly detection: DetectionResult; readonly cwd: string; readonly overwrite: boolean }): Promise<string> {\r\n    void args.detection\r\n    const p = join(args.cwd, '.nojekyll')\r\n    if (args.overwrite !== true) {\r\n      try { const s = await stat(p); if (s.isFile()) return p } catch { /* not exists */ }\r\n    }\r\n    await writeFile(p, '', 'utf8')\r\n    return p\r\n  }\r\n\r\n  /**\r\n   * Emit actionable hints for Next.js static export on GitHub Pages.\r\n   */\r\n  private async checkNextHints(cwd: string): Promise<void> {\r\n    // Read next.config.* when present\r\n    const files = ['next.config.ts', 'next.config.js', 'next.config.mjs']\r\n    let cfg = ''\r\n    for (const f of files) {\r\n      try {\r\n        const p = join(cwd, f)\r\n        if (await fsx.exists(p)) { cfg = await readFile(p, 'utf8'); break }\r\n      } catch { /* ignore */ }\r\n    }\r\n    if (!cfg) return\r\n    // Compute expected repo-based basePath when origin is GitHub\r\n    let expectedBase: string | undefined\r\n    try {\r\n      const origin = await proc.run({ cmd: 'git remote get-url origin', cwd })\r\n      if (origin.ok) {\r\n        const { repo } = parseGitRemote(origin.stdout.trim())\r\n        if (repo) expectedBase = `/${repo}`\r\n      }\r\n    } catch { /* ignore */ }\r\n    // Hints\r\n    const hasExport = /\\boutput\\s*:\\s*['\"]export['\"]/m.test(cfg)\r\n    if (!hasExport) logger.warn(\"next.config: missing output: 'export' (required for static export)\")\r\n    const hasTrailing = /\\btrailingSlash\\s*:\\s*true/m.test(cfg)\r\n    if (!hasTrailing) logger.warn('next.config: trailingSlash not set to true (recommended for GitHub Pages)')\r\n    const hasUnopt = /images\\s*:\\s*\\{[^}]*unoptimized\\s*:\\s*true/m.test(cfg)\r\n    if (!hasUnopt) logger.warn('next.config: images.unoptimized not set to true (recommended for GitHub Pages)')\r\n    const basePathMatch = /basePath\\s*:\\s*['\"][^'\"]+['\"]/m.exec(cfg)\r\n    if (!basePathMatch) logger.warn('next.config: basePath is not set (recommended for Project Pages)')\r\n    if (expectedBase && basePathMatch) {\r\n      const val = (basePathMatch[0].split(':')[1] || '').replace(/['\"\\s]/g,'')\r\n      if (val !== expectedBase) logger.warn(`next.config: basePath mismatch (expected ${expectedBase}, got ${val})`)\r\n    }\r\n    const assetPrefixMatch = /assetPrefix\\s*:\\s*['\"][^'\"]+['\"]/m.exec(cfg)\r\n    if (!assetPrefixMatch) logger.warn('next.config: assetPrefix is not set (recommended for Project Pages)')\r\n    if (expectedBase && assetPrefixMatch) {\r\n      const val = (assetPrefixMatch[0].split(':')[1] || '').replace(/['\"\\s]/g,'')\r\n      const want = `${expectedBase}/`\r\n      if (val !== want) logger.warn(`next.config: assetPrefix mismatch (expected ${want}, got ${val})`)\r\n    }\r\n  }\r\n}\r\n","import { join } from 'node:path'\r\n\r\nexport function renderGithubPagesWorkflow(args: { readonly basePath: string; readonly siteOrigin?: string }): string {\r\n  const origin = args.siteOrigin || 'https://<owner>.github.io'\r\n  return `name: Deploy Docs to GitHub Pages\r\n\r\non:\r\n  push:\r\n    branches: [ main ]\r\n  workflow_dispatch: {}\r\n\r\npermissions:\r\n  contents: read\r\n  pages: write\r\n  id-token: write\r\n\r\nconcurrency:\r\n  group: \"pages\"\r\n  cancel-in-progress: false\r\n\r\njobs:\r\n  build:\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n      - name: Checkout\r\n        uses: actions/checkout@v4\r\n\r\n      - name: Setup PNPM\r\n        uses: pnpm/action-setup@v4\r\n        with:\r\n          version: 9\r\n\r\n      - name: Setup Node\r\n        uses: actions/setup-node@v4\r\n        with:\r\n          node-version: 20\r\n          cache: 'pnpm'\r\n\r\n      - name: Install deps\r\n        run: pnpm install --frozen-lockfile\r\n\r\n      - name: Build (Next 15 static export)\r\n        env:\r\n          NEXT_PUBLIC_SITE_ORIGIN: ${origin}\r\n          NEXT_PUBLIC_BASE_PATH: ${args.basePath}\r\n          NEXT_BASE_PATH: ${args.basePath}\r\n        run: pnpm build\r\n\r\n      - name: Upload artifact\r\n        uses: actions/upload-pages-artifact@v3\r\n        with:\r\n          path: out\r\n\r\n  deploy:\r\n    needs: build\r\n    runs-on: ubuntu-latest\r\n    environment:\r\n      name: github-pages\r\n      url: \\${{ steps.deployment.outputs.page_url }}\r\n    steps:\r\n      - name: Deploy to GitHub Pages\r\n        id: deployment\r\n        uses: actions/deploy-pages@v4\r\n`\r\n}\r\n","import { Command } from 'commander'\r\nimport { registerDetectCommand } from './commands/detect'\r\nimport { registerDoctorCommand } from './commands/doctor'\r\nimport { registerGenerateCommand } from './commands/generate'\r\nimport { registerDeployCommand } from './commands/deploy'\r\nimport { registerEnvCommand } from './commands/env'\r\nimport { registerSeedCommand } from './commands/seed'\r\nimport { logger } from './utils/logger'\r\nimport { setColorMode, type ColorMode } from './utils/colors'\r\nimport { registerRunCommand } from './commands/run'\r\nimport { registerInitCommand } from './commands/init'\r\nimport { registerCompletionCommand } from './commands/completion'\r\nimport { registerPromoteCommand } from './commands/promote'\r\nimport { registerExplainCommand } from './commands/explain'\r\nimport { registerRollbackCommand } from './commands/rollback'\r\nimport { registerProvidersCommand } from './commands/providers'\r\nimport { registerPlanCommand } from './commands/plan'\r\nimport { registerUpCommand } from './commands/up'\r\nimport { registerStartCommand } from './commands/start'\r\nimport { registerTestMatrixCommand } from './commands/test-matrix'\r\nimport { computeRedactors } from './utils/redaction'\r\nimport { registerCiLogsCommand } from './commands/ci-logs'\r\n\r\nconst VERSION: string = '1.2.0-rc.2'\r\n\r\nfunction main(): void {\r\n  const program: Command = new Command()\r\n  program.name('opendeploy')\r\n  program.description('OpenDeploy CLI — cross-provider deployment assistant for the modern web stack')\r\n  // Expose lowercase -v as a shorthand in addition to default -V\r\n  program.version(VERSION, '-v, --version', 'output the version number')\r\n  // Global options (parsed by Commander, but we set verbosity pre-parse for early logs as well)\r\n  program.option('--verbose', 'Verbose output')\r\n  program.option('--json', 'JSON-only output (suppresses non-JSON logs)')\r\n  program.option('--quiet', 'Error-only output (suppresses info/warn/success)')\r\n  program.option('--no-emoji', 'Disable emoji prefixes for logs')\r\n  program.option('--compact-json', 'Compact JSON (one line)')\r\n  program.option('--ndjson', 'Newline-delimited JSON streaming (implies --json)')\r\n  program.option('--timestamps', 'Prefix human logs and JSON with ISO timestamps')\r\n  program.option('--summary-only', 'Only print final JSON summary objects (objects with { final: true })')\r\n  program.option('--color <mode>', 'Color mode: auto|always|never', 'auto')\r\n  program.option('--json-file [path]', 'Also write JSON output lines to file (appends)')\r\n  program.option('--ndjson-file [path]', 'Also write NDJSON output lines to file (appends)')\r\n  program.option('--gha-annotations <mode>', 'GitHub annotations: error|warning|off', 'warning')\r\n  program.option('--gha', 'GitHub Actions-friendly defaults (implies --json --summary-only --timestamps, sets annotation/file sinks)')\r\n  // Shorthand: run wizard with -s / --start\r\n  if (process.argv.includes('-s') || process.argv.includes('--start')) {\r\n    const ix = process.argv.findIndex((a) => a === '-s' || a === '--start')\r\n    if (ix !== -1) process.argv.splice(ix, 1)\r\n    // inject 'start' as the first subcommand argument position\r\n    if (!process.argv.slice(2).includes('start')) process.argv.splice(2, 0, 'start')\r\n  }\r\n  // Pre-parse lightweight check to set verbose level for early output\r\n  if (process.argv.includes('--verbose')) {\r\n    logger.setLevel('debug')\r\n    process.env.OPD_VERBOSE = '1'\r\n  }\r\n  if (process.argv.includes('--json')) {\r\n    logger.setJsonOnly(true)\r\n    process.env.OPD_JSON = '1'\r\n  }\r\n  if (process.argv.includes('--quiet')) {\r\n    logger.setLevel('error')\r\n    process.env.OPD_QUIET = '1'\r\n  }\r\n  if (process.argv.includes('--no-emoji')) {\r\n    logger.setNoEmoji(true)\r\n    process.env.OPD_NO_EMOJI = '1'\r\n  }\r\n  if (process.argv.includes('--compact-json')) {\r\n    logger.setJsonCompact(true)\r\n    process.env.OPD_JSON_COMPACT = '1'\r\n  }\r\n  if (process.argv.includes('--ndjson')) {\r\n    logger.setNdjson(true)\r\n    process.env.OPD_NDJSON = '1'\r\n  }\r\n  if (process.argv.includes('--timestamps')) {\r\n    logger.setTimestamps(true)\r\n    process.env.OPD_TS = '1'\r\n  }\r\n  if (process.argv.includes('--summary-only')) {\r\n    logger.setSummaryOnly(true)\r\n    process.env.OPD_SUMMARY = '1'\r\n  }\r\n  // GitHub Actions convenience\r\n  if (process.argv.includes('--gha')) {\r\n    // JSON summary with timestamps\r\n    logger.setJsonOnly(true); process.env.OPD_JSON = '1'\r\n    logger.setSummaryOnly(true); process.env.OPD_SUMMARY = '1'\r\n    logger.setTimestamps(true); process.env.OPD_TS = '1'\r\n    // Default files if none provided\r\n    if (!process.env.OPD_JSON_FILE) {\r\n      const ts = new Date().toISOString().replace(/[:.]/g, '-')\r\n      const p = `./.artifacts/opendeploy-${ts}.json`\r\n      logger.setJsonFile(p); process.env.OPD_JSON_FILE = p\r\n    }\r\n    if (!process.env.OPD_NDJSON_FILE) {\r\n      const ts2 = new Date().toISOString().replace(/[:.]/g, '-')\r\n      const p2 = `./.artifacts/opendeploy-${ts2}.ndjson`\r\n      logger.setNdjsonFile(p2); process.env.OPD_NDJSON_FILE = p2\r\n    }\r\n    if (!process.env.OPD_GHA_ANN) process.env.OPD_GHA_ANN = 'warning'\r\n    process.env.OPD_GHA = '1'\r\n  }\r\n  // Parse json-file and ndjson-file\r\n  const jsonFileIx = process.argv.findIndex((a) => a === '--json-file')\r\n  if (jsonFileIx !== -1) {\r\n    let p = process.argv[jsonFileIx + 1]\r\n    if (!p || p.startsWith('-')) {\r\n      const ts = new Date().toISOString().replace(/[:.]/g, '-')\r\n      p = `./.artifacts/opendeploy-${ts}.json`\r\n    }\r\n    logger.setJsonFile(p)\r\n    process.env.OPD_JSON_FILE = p\r\n  } else if (process.env.OPD_JSON_FILE) {\r\n    // Honor env var when flag not provided\r\n    logger.setJsonFile(process.env.OPD_JSON_FILE)\r\n  }\r\n  const ndjsonFileIx = process.argv.findIndex((a) => a === '--ndjson-file')\r\n  if (ndjsonFileIx !== -1) {\r\n    let p = process.argv[ndjsonFileIx + 1]\r\n    if (!p || p.startsWith('-')) {\r\n      const ts2 = new Date().toISOString().replace(/[:.]/g, '-')\r\n      p = `./.artifacts/opendeploy-${ts2}.ndjson`\r\n    }\r\n    logger.setNdjsonFile(p)\r\n    process.env.OPD_NDJSON_FILE = p\r\n  } else if (process.env.OPD_NDJSON_FILE) {\r\n    logger.setNdjsonFile(process.env.OPD_NDJSON_FILE)\r\n  }\r\n  // Parse GitHub annotations mode\r\n  const ghaIx = process.argv.findIndex((a) => a === '--gha-annotations')\r\n  if (ghaIx !== -1 && process.argv[ghaIx + 1]) {\r\n    const mode = process.argv[ghaIx + 1]\r\n    process.env.OPD_GHA_ANN = mode\r\n  }\r\n  // Parse color mode from argv quickly (do not rely on Commander parse yet)\r\n  const colorIx = process.argv.findIndex((a) => a === '--color')\r\n  if (colorIx !== -1 && process.argv[colorIx + 1]) {\r\n    const m = process.argv[colorIx + 1] as ColorMode\r\n    setColorMode(m)\r\n    process.env.OPD_COLOR = m\r\n  } else {\r\n    setColorMode('auto')\r\n    process.env.OPD_COLOR = 'auto'\r\n  }\r\n  // Initialize redaction patterns from local env files and process.env (best-effort, non-blocking)\r\n  if (process.env.OPD_NO_REDACT !== '1') {\r\n    void computeRedactors({ cwd: process.cwd(), envFiles: ['.env', '.env.local', '.env.production.local'], includeProcessEnv: true })\r\n      .then((patterns) => { if (Array.isArray(patterns) && patterns.length > 0) logger.setRedactors(patterns) })\r\n      .catch(() => { /* ignore redactor init errors */ })\r\n  }\r\n  registerDetectCommand(program)\r\n  registerDoctorCommand(program)\r\n  registerGenerateCommand(program)\r\n  registerDeployCommand(program)\r\n  registerEnvCommand(program)\r\n  registerSeedCommand(program)\r\n  registerRunCommand(program)\r\n  registerInitCommand(program)\r\n  registerCompletionCommand(program)\r\n  registerPromoteCommand(program)\r\n  registerExplainCommand(program)\r\n  registerRollbackCommand(program)\r\n  registerProvidersCommand(program)\r\n  registerPlanCommand(program)\r\n  registerUpCommand(program)\r\n  registerStartCommand(program)\r\n  registerCiLogsCommand(program)\r\n  registerTestMatrixCommand(program)\r\n  program.parseAsync(process.argv)\r\n    .then(() => {})\r\n    .catch((err: unknown) => {\r\n      const message: string = err instanceof Error ? err.message : String(err)\r\n      const isJson = process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1'\r\n      const alreadyHandled = process.env.OPD_HANDLED === '1'\r\n      if (isJson) {\r\n        if (!alreadyHandled) {\r\n          logger.jsonPrint({ ok: false, action: 'error', message, final: true })\r\n        }\r\n        process.exit(1)\r\n      } else {\r\n        // Avoid stack by default for cleaner UX; use --verbose for more later\r\n        // eslint-disable-next-line no-console\r\n        console.error(`Error: ${message}`)\r\n        process.exit(1)\r\n      }\r\n    })\r\n}\r\n\r\nmain()\r\n","import { Command } from 'commander'\r\nimport { detectApp, detectCandidates } from '../core/detectors/auto'\r\nimport { logger } from '../utils/logger'\r\nimport Ajv from 'ajv'\r\nimport { detectSummarySchema } from '../schemas/detect-summary.schema'\r\nimport type { DetectionResult } from '../types/detection-result'\r\nimport type { Framework } from '../types/framework'\r\n\r\n/**\r\n * Register the `detect` command.\r\n */\r\nexport function registerDetectCommand(program: Command): void {\r\n  const ajv = new Ajv({ allErrors: true, strict: false, validateSchema: false })\r\n  const validate = ajv.compile(detectSummarySchema as unknown as object)\r\n  const annotate = (obj: Record<string, unknown>): Record<string, unknown> => {\r\n    const ok: boolean = validate(obj) as boolean\r\n    const errs: string[] = Array.isArray(validate.errors) ? validate.errors.map(e => `${e.instancePath || '/'} ${e.message ?? ''}`.trim()) : []\r\n    if (process.env.OPD_SCHEMA_STRICT === '1' && errs.length > 0) { process.exitCode = 1 }\r\n    return { ...obj, schemaOk: ok, schemaErrors: errs }\r\n  }\r\n  program\r\n    .command('detect')\r\n    .description('Detect your app (Next, Astro, SvelteKit, Remix, Nuxt; Expo when OPD_EXPERIMENTAL=1)')\r\n    .option('--json', 'Output JSON')\r\n    .action(async (opts: { json?: boolean }): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      try {\r\n        if (opts.json === true || process.env.OPD_JSON === '1') logger.setJsonOnly(true)\r\n        const result: DetectionResult = await detectApp({ cwd })\r\n        if (opts.json === true || process.env.OPD_JSON === '1') {\r\n          const summary = { ok: true, action: 'detect' as const, detection: result, final: true }\r\n          logger.jsonPrint(annotate(summary as unknown as Record<string, unknown>))\r\n          return\r\n        }\r\n        // Human output\r\n        const candidates: ReadonlySet<Framework> = await detectCandidates({ cwd })\r\n        const mark = (fw: Framework): string => candidates.has(fw) ? ' (detected)' : ''\r\n        logger.info(`Framework      : ${result.framework}`)\r\n        logger.info(`Render Mode    : ${result.renderMode}`)\r\n        logger.info(`Root Dir       : ${result.rootDir}`)\r\n        logger.info(`App Dir        : ${result.appDir}`)\r\n        logger.info(`App Router     : ${result.hasAppRouter ? 'yes' : 'no'}`)\r\n        logger.info(`Package Manager: ${result.packageManager}`)\r\n        logger.info(`Monorepo Tool  : ${result.monorepo}`)\r\n        logger.info(`Build Command  : ${result.buildCommand}`)\r\n        logger.info(`Output Dir     : ${result.outputDir}`)\r\n        if (result.publishDir) logger.info(`Publish Dir    : ${result.publishDir}`)\r\n        logger.info(`Confidence     : ${result.confidence.toFixed(2)}`)\r\n        logger.info(`Candidates     : next${mark('next')}, astro${mark('astro')}, sveltekit${mark('sveltekit')}, remix${mark('remix')}, nuxt${mark('nuxt')}${process.env.OPD_EXPERIMENTAL==='1' ? `, expo${mark('expo')}` : ''}`)\r\n        if (result.environmentFiles.length > 0) {\r\n          logger.info(`Env Files      : ${result.environmentFiles.join(', ')}`)\r\n        } else {\r\n          logger.info('Env Files      : none')\r\n        }\r\n      } catch (err) {\r\n        const message: string = err instanceof Error ? err.message : String(err)\r\n        if (opts.json === true || process.env.OPD_JSON === '1') {\r\n          logger.jsonPrint(annotate({ ok: false, action: 'detect' as const, message, final: true }))\r\n        } else {\r\n          logger.error(message)\r\n        }\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n","export const detectSummarySchema = {\r\n  $schema: \"http://json-schema.org/draft-07/schema#\",\r\n  type: \"object\",\r\n  additionalProperties: true,\r\n  required: [\"ok\", \"action\", \"final\"],\r\n  properties: {\r\n    ok: { type: \"boolean\" },\r\n    action: { const: \"detect\" },\r\n    detection: { type: \"object\" },\r\n    message: { type: \"string\" },\r\n    final: { type: \"boolean\" }\r\n  }\r\n} as const\r\n","async function checkOpdGo(cwd: string, printCmd?: boolean): Promise<CheckResult> {\r\n  // Priority: OPD_GO_BIN -> ./.bin/opd-go(.exe) -> PATH\r\n  try {\r\n    const override: string | undefined = process.env.OPD_GO_BIN\r\n    if (override && override.length > 0) {\r\n      const exists = await fsx.exists(override)\r\n      return { name: 'opd-go (optional)', ok: exists, message: exists ? `OPD_GO_BIN=${override}` : `OPD_GO_BIN points to missing file: ${override}` }\r\n    }\r\n    const exe: string = process.platform === 'win32' ? 'opd-go.exe' : 'opd-go'\r\n    const local: string = join(cwd, '.bin', exe)\r\n    if (await fsx.exists(local)) {\r\n      return { name: 'opd-go (optional)', ok: true, message: `local .bin/${exe}` }\r\n    }\r\n    const pathCmd: string = process.platform === 'win32' ? 'where opd-go' : 'command -v opd-go'\r\n    if (printCmd) logger.info(`$ ${pathCmd}`)\r\n    const probe = await runWithRetry({ cmd: pathCmd, cwd })\r\n    if (probe.ok && probe.stdout.trim().length > 0) {\r\n      const first = probe.stdout.trim().split(/\\r?\\n/)[0] || 'opd-go'\r\n      return { name: 'opd-go (optional)', ok: true, message: first }\r\n    }\r\n    return { name: 'opd-go (optional)', ok: false, message: 'not found (build with: pnpm build:go or set OPD_GO_BIN)'}\r\n  } catch {\r\n    return { name: 'opd-go (optional)', ok: false, message: 'not found (build with: pnpm build:go or set OPD_GO_BIN)'}\r\n  }\r\n}\r\n\r\nimport { Command } from 'commander'\r\nimport { logger, isJsonMode } from '../utils/logger'\r\nimport { proc, runWithRetry } from '../utils/process'\r\nimport { join, dirname } from 'node:path'\r\nimport { readdir, stat as fsStat, mkdir } from 'node:fs/promises'\r\nimport { fsx } from '../utils/fs'\r\nimport { detectMonorepo } from '../core/detectors/monorepo'\r\nimport { detectPackageManager } from '../core/detectors/package-manager'\r\nimport { mapProviderError } from '../utils/errors'\r\nimport { printDoctorSummary } from '../utils/summarize'\r\nimport { writeFile } from 'node:fs/promises'\r\nimport Ajv from 'ajv'\r\nimport { doctorSummarySchema } from '../schemas/doctor-summary.schema'\r\nimport { readFile as readFileFs } from 'node:fs/promises'\r\nimport { resolveAppPath } from '../core/detectors/apps'\r\n\r\n// ---- GitHub Pages + Next static export checks (best-effort, non-fatal) ----\r\nasync function checkNextGithubPages(cwd: string): Promise<CheckResult[]> {\r\n  const results: CheckResult[] = []\r\n  const push = (name: string, ok: boolean, message: string): void => { results.push({ name, ok, message }) }\r\n  let repo: string | undefined\r\n  try {\r\n    // Discover repo name from git origin for basePath/assetPrefix validation\r\n    try {\r\n      const origin = await proc.run({ cmd: 'git remote get-url origin', cwd })\r\n      if (origin.ok) {\r\n        const t = origin.stdout.trim()\r\n        const httpsRe = /^https?:\\/\\/github\\.com\\/(.+?)\\/(.+?)(?:\\.git)?$/i\r\n        const sshRe = /^git@github\\.com:(.+?)\\/(.+?)(?:\\.git)?$/i\r\n        const m1 = t.match(httpsRe); const m2 = t.match(sshRe)\r\n        const r = (m1?.[2] || m2?.[2] || '').trim()\r\n        if (r) repo = r\r\n      }\r\n    } catch { /* ignore */ }\r\n    const hasNoJekyllPublic = await fsx.exists(join(cwd, 'public', '.nojekyll'))\r\n    const hasNoJekyllOut = await fsx.exists(join(cwd, 'out', '.nojekyll'))\r\n    push('.nojekyll (public/ or out/)', hasNoJekyllPublic || hasNoJekyllOut, hasNoJekyllPublic ? 'public/.nojekyll' : (hasNoJekyllOut ? 'out/.nojekyll' : 'missing'))\r\n  } catch { push('.nojekyll (public/ or out/)', false, 'error reading') }\r\n  try {\r\n    let cfg = ''\r\n    const candidates = ['next.config.ts', 'next.config.js', 'next.config.mjs']\r\n    for (const f of candidates) {\r\n      const p = join(cwd, f)\r\n      if (await fsx.exists(p)) { cfg = await readFileFs(p, 'utf8'); break }\r\n    }\r\n    if (cfg.length > 0) {\r\n      const hasExport = /output\\s*:\\s*['\"]export['\"]/m.test(cfg)\r\n      push(\"next.config: output: 'export'\", hasExport, hasExport ? 'ok' : \"missing (set output: 'export')\")\r\n      const hasTrailing = /trailingSlash\\s*:\\s*true/m.test(cfg)\r\n      push('next.config: trailingSlash', hasTrailing, hasTrailing ? 'true' : 'not set (recommended true)')\r\n      const hasUnopt = /images\\s*:\\s*\\{[^}]*unoptimized\\s*:\\s*true/m.test(cfg)\r\n      push('next.config: images.unoptimized', hasUnopt, hasUnopt ? 'true' : 'not set (recommended true)')\r\n      const hasBasePath = /basePath\\s*:\\s*['\"][^'\"]+['\"]/m.test(cfg)\r\n      push('next.config: basePath', hasBasePath, hasBasePath ? 'present' : 'not set (recommended for Project Pages)')\r\n      // Validate basePath/assetPrefix against repo path when available\r\n      if (repo) {\r\n        const repoPath = `/${repo}`\r\n        const basePathMatch = new RegExp(`basePath\\\\s*:\\\\s*['\\\"]${repoPath}['\\\"]`, 'm').test(cfg)\r\n        push('next.config: basePath matches repo', basePathMatch, basePathMatch ? 'ok' : (hasBasePath ? `mismatch (expected ${repoPath})` : 'not set'))\r\n        const assetPrefixPresent = /assetPrefix\\s*:\\s*['\"][^'\"]+['\"]/m.test(cfg)\r\n        const assetPrefixMatch = new RegExp(`assetPrefix\\\\s*:\\\\s*['\\\"]${repoPath}\\/['\\\"]`, 'm').test(cfg)\r\n        push('next.config: assetPrefix matches repo', assetPrefixMatch, assetPrefixPresent ? (assetPrefixMatch ? 'ok' : `mismatch (expected ${repoPath}/)`) : 'not set (recommended)')\r\n      }\r\n    } else {\r\n      push('next.config.* present', false, 'file not found')\r\n    }\r\n  } catch { push('next.config parse', false, 'error reading next.config.*') }\r\n  try {\r\n    const outDir = join(cwd, 'out')\r\n    if (await fsx.exists(outDir)) {\r\n      const staticDir = join(outDir, '_next', 'static')\r\n      const exists = await fsx.exists(staticDir)\r\n      push('export assets (_next/static)', exists, exists ? 'found' : 'missing')\r\n    }\r\n  } catch { /* ignore */ }\r\n  return results\r\n}\r\n\r\ninterface DoctorOptions { readonly ci?: boolean; readonly json?: boolean; readonly verbose?: boolean; readonly fix?: boolean; readonly path?: string; readonly project?: string; readonly org?: string; readonly printCmd?: boolean; readonly strict?: boolean }\r\n\r\ninterface CheckResult { readonly name: string; readonly ok: boolean; readonly message: string }\r\n\r\nfunction parseNodeOk(): boolean {\r\n  const version: string = process.versions.node\r\n  const [majorStr, minorStr] = version.split('.')\r\n  const major: number = Number(majorStr)\r\n  const minor: number = Number(minorStr)\r\n  if (Number.isNaN(major) || Number.isNaN(minor)) return false\r\n  if (major > 18) return true\r\n  if (major === 18 && minor >= 17) return true\r\n  return false\r\n}\r\n\r\nasync function checkCmdAny(cmds: readonly string[], label: string, printCmd?: boolean): Promise<CheckResult> {\r\n  for (const c of cmds) {\r\n    const cmd = `${c} --version`\r\n    if (printCmd) logger.info(`$ ${cmd}`)\r\n    const out = await runWithRetry({ cmd })\r\n    if (out.ok) return { name: `${label} --version`, ok: true, message: out.stdout.trim() }\r\n  }\r\n  return { name: `${label} --version`, ok: false, message: 'not installed or not on PATH' }\r\n}\r\n\r\nasync function checkVercelAuth(printCmd?: boolean): Promise<CheckResult> {\r\n  const candidates: readonly string[] = process.platform === 'win32' ? ['vercel', 'vercel.cmd'] : ['vercel']\r\n  for (const c of candidates) {\r\n    const cmd = `${c} whoami`\r\n    if (printCmd) logger.info(`$ ${cmd}`)\r\n    const out = await runWithRetry({ cmd })\r\n    if (out.ok && out.stdout.trim().length > 0) return { name: 'vercel auth', ok: true, message: out.stdout.trim() }\r\n  }\r\n  return { name: 'vercel auth', ok: false, message: 'not logged in (run: vercel login)' }\r\n}\r\n\r\n \r\n\r\nasync function checkWranglerAuth(printCmd?: boolean): Promise<CheckResult> {\r\n  const candidates: readonly string[] = process.platform === 'win32' ? ['wrangler', 'wrangler.cmd'] : ['wrangler']\r\n  for (const c of candidates) {\r\n    const verCmd: string = `${c} --version`\r\n    if (printCmd) logger.info(`$ ${verCmd}`)\r\n    const ver = await runWithRetry({ cmd: verCmd })\r\n    if (!ver.ok) continue\r\n    const whoCmd: string = `${c} whoami`\r\n    if (printCmd) logger.info(`$ ${whoCmd}`)\r\n    const who = await runWithRetry({ cmd: whoCmd })\r\n    if (who.ok && who.stdout.trim().length > 0) return { name: 'wrangler auth', ok: true, message: who.stdout.trim() }\r\n    return { name: 'wrangler auth', ok: false, message: 'not logged in (run: wrangler login)' }\r\n  }\r\n  return { name: 'wrangler', ok: false, message: 'not installed or not on PATH (install: npm i -g wrangler)' }\r\n}\r\n\r\nasync function checkGitHubPagesSetup(cwd: string, printCmd?: boolean): Promise<CheckResult[]> {\r\n  const results: CheckResult[] = []\r\n  // Check that a git origin remote exists\r\n  const remoteCmd: string = 'git remote -v'\r\n  if (printCmd) logger.info(`$ ${remoteCmd}`)\r\n  const rem = await runWithRetry({ cmd: remoteCmd, cwd })\r\n  const hasOrigin: boolean = rem.ok && /origin\\s+/.test(rem.stdout)\r\n  results.push({ name: 'git origin remote', ok: hasOrigin, message: hasOrigin ? 'found' : 'missing (set with: git remote add origin <url>)' })\r\n  // Check gh-pages branch existence on remote\r\n  const lsCmd: string = 'git ls-remote --heads origin gh-pages'\r\n  if (printCmd) logger.info(`$ ${lsCmd}`)\r\n  const ls = await runWithRetry({ cmd: lsCmd, cwd })\r\n  const hasGhPages: boolean = ls.ok && ls.stdout.trim().length > 0\r\n  results.push({ name: 'gh-pages branch (remote)', ok: hasGhPages, message: hasGhPages ? 'exists' : 'not found (will be created on first publish)' })\r\n  return results\r\n}\r\n\r\n/**\r\n * Register the `doctor` command.\r\n */\r\nexport function registerDoctorCommand(program: Command): void {\r\n  const ajv = new Ajv({ allErrors: true, strict: false, validateSchema: false })\r\n  const validate = ajv.compile(doctorSummarySchema as unknown as object)\r\n  const annotate = (obj: Record<string, unknown>): Record<string, unknown> => {\r\n    const ok: boolean = validate(obj) as boolean\r\n    const errs: string[] = Array.isArray(validate.errors) ? validate.errors.map(e => `${e.instancePath || '/'} ${e.message ?? ''}`.trim()) : []\r\n    if (process.env.OPD_SCHEMA_STRICT === '1' && errs.length > 0) { process.exitCode = 1 }\r\n    return { ...obj, schemaOk: ok, schemaErrors: errs }\r\n  }\r\n  const doctorCmd = program\r\n    .command('doctor')\r\n    .description('Validate local environment and provider CLIs')\r\n    .option('--ci', 'CI mode (exit non-zero on warnings)')\r\n    .option('--json', 'Output JSON')\r\n    .option('--verbose', 'Verbose output')\r\n    .option('--fix', 'Attempt to fix common issues (linking)')\r\n    .option('--path <dir>', 'Working directory to check/fix (monorepos)')\r\n    .option('--project <id>', 'Vercel project ID (for linking)')\r\n    .option('--org <id>', 'Vercel org/team ID (for linking)')\r\n    \r\n    .option('--print-cmd', 'Print underlying provider commands that will be executed')\r\n    .option('--strict', 'Exit non-zero when any checks fail')\r\n    .action(async (opts: DoctorOptions): Promise<void> => {\r\n      try {\r\n        const jsonMode: boolean = isJsonMode(opts.json)\r\n        if (jsonMode) logger.setJsonOnly(true)\r\n        const results: CheckResult[] = []\r\n        const suggestions: string[] = []\r\n        const nodeOk: boolean = parseNodeOk()\r\n        results.push({ name: 'node >= 18.17', ok: nodeOk, message: process.versions.node })\r\n        const pnpmCandidates: readonly string[] = process.platform === 'win32' ? ['pnpm', 'pnpm.cmd', 'corepack pnpm'] : ['pnpm', 'corepack pnpm']\r\n        const pnpm = await checkCmdAny(pnpmCandidates, 'pnpm', opts.printCmd)\r\n        results.push(pnpm)\r\n        const bunCandidates: readonly string[] = process.platform === 'win32' ? ['bun', 'bun.exe', 'bun.cmd'] : ['bun']\r\n        const bunCli = await checkCmdAny(bunCandidates, 'bun', opts.printCmd)\r\n        results.push(bunCli)\r\n        // Go sidecar (optional)\r\n        const goRunner = await checkOpdGo(process.cwd(), opts.printCmd)\r\n        results.push(goRunner)\r\n        const vercelCandidates: readonly string[] = process.platform === 'win32' ? ['vercel', 'vercel.cmd'] : ['vercel']\r\n        const vercelCli = await checkCmdAny(vercelCandidates, 'vercel', opts.printCmd)\r\n        results.push(vercelCli)\r\n        \r\n        // Cloudflare Pages CLI (wrangler)\r\n        const wranglerCandidates: readonly string[] = process.platform === 'win32' ? ['wrangler', 'wrangler.cmd'] : ['wrangler']\r\n        const wranglerCli = await checkCmdAny(wranglerCandidates, 'wrangler', opts.printCmd)\r\n        results.push(wranglerCli)\r\n        // Optional toolchain checks\r\n        const prismaCandidates: readonly string[] = process.platform === 'win32'\r\n          ? ['pnpm exec prisma', 'npx prisma', 'prisma', 'prisma.cmd']\r\n          : ['pnpm exec prisma', 'npx prisma', 'prisma']\r\n        const prismaCli = await checkCmdAny(prismaCandidates, 'prisma (optional)', opts.printCmd)\r\n        results.push(prismaCli)\r\n        const drizzleCandidates: readonly string[] = process.platform === 'win32'\r\n          ? ['pnpm exec drizzle-kit', 'npx drizzle-kit', 'drizzle-kit', 'drizzle-kit.cmd']\r\n          : ['pnpm exec drizzle-kit', 'npx drizzle-kit', 'drizzle-kit']\r\n        const drizzleCli = await checkCmdAny(drizzleCandidates, 'drizzle-kit (optional)', opts.printCmd)\r\n        results.push(drizzleCli)\r\n        const psqlCandidates: readonly string[] = process.platform === 'win32' ? ['psql', 'psql.exe'] : ['psql']\r\n        const psqlCli = await checkCmdAny(psqlCandidates, 'psql (optional)', opts.printCmd)\r\n        results.push(psqlCli)\r\n        const vercelAuth = await checkVercelAuth(opts.printCmd)\r\n        results.push(vercelAuth)\r\n        \r\n        const wranglerAuth = await checkWranglerAuth(opts.printCmd)\r\n        results.push(wranglerAuth)\r\n        // Monorepo and workspace sanity\r\n        const cwdRoot: string = process.cwd()\r\n        let cwd: string\r\n        if (opts.path && opts.path.length > 0) {\r\n          cwd = join(cwdRoot, opts.path)\r\n        } else {\r\n          const ciMode: boolean = Boolean(opts.ci) || process.env.CI === 'true' || process.env.GITHUB_ACTIONS === 'true' || process.env.OPD_FORCE_CI === '1' || process.env.OPD_NDJSON === '1' || process.env.OPD_JSON === '1'\r\n          const resolved = await resolveAppPath({ cwd: cwdRoot, ci: ciMode })\r\n          cwd = resolved.path\r\n          if (isJsonMode(opts.json)) logger.json({ event: 'app-path', path: cwd, candidates: resolved.candidates })\r\n          else if (cwd !== cwdRoot) logger.note(`Detected app path: ${cwd}`)\r\n        }\r\n        const mono = await detectMonorepo({ cwd })\r\n        results.push({ name: 'monorepo', ok: mono !== 'none', message: mono })\r\n        if (mono !== 'none') {\r\n          const pm = await detectPackageManager({ cwd })\r\n          if (pm === 'pnpm') {\r\n            const hasLock = await fsx.exists(join(cwd, 'pnpm-lock.yaml'))\r\n            results.push({ name: 'pnpm lockfile at root', ok: hasLock, message: hasLock ? 'found' : 'missing' })\r\n          }\r\n        // Optional: best-effort fixes\r\n        if (opts.fix === true) {\r\n          try {\r\n            // Vercel link fix\r\n            const vercelLinked = await fsx.exists(join(cwd, '.vercel', 'project.json'))\r\n            if (!vercelLinked && opts.project) {\r\n              const flags: string[] = ['--yes', `--project ${opts.project}`]\r\n              if (opts.org) flags.push(`--org ${opts.org}`)\r\n              const linkVercel = `vercel link ${flags.join(' ')}`\r\n              if (opts.printCmd) logger.info(`$ ${linkVercel}`)\r\n              const res = await runWithRetry({ cmd: linkVercel, cwd })\r\n              if (!res.ok) suggestions.push('vercel link --yes --project <id> [--org <id>]')\r\n              else results.push({ name: 'vercel link (fix)', ok: true, message: 'linked' })\r\n            }\r\n            \r\n          } catch { /* ignore */ }\r\n        }\r\n          // Vercel link file (optional but recommended for CLI ops)\r\n          const projectJson = join(cwd, '.vercel', 'project.json')\r\n          const linked = await fsx.exists(projectJson)\r\n          results.push({ name: 'vercel link (.vercel/project.json)', ok: linked, message: linked ? 'linked' : 'not linked (run: vercel link)' })\r\n          // Root vercel.json is optional; helpful when deploying from monorepo root\r\n          const hasRootVercel = await fsx.exists(join(cwd, 'vercel.json'))\r\n          results.push({ name: 'root vercel.json (optional)', ok: true, message: hasRootVercel ? 'present' : 'absent (ok). Prefer Vercel Git + Root Directory; add if CLI root deploys are needed.' })\r\n          \r\n\r\n          // apps/* linked scan to prevent monorepo path issues\r\n          const appsDir = join(cwd, 'apps')\r\n          const existsApps = await fsx.exists(appsDir)\r\n          if (existsApps) {\r\n            try {\r\n              const entries = await readdir(appsDir)\r\n              const appDirs: string[] = []\r\n              for (const name of entries) {\r\n                const p = join(appsDir, name)\r\n                try { const s = await fsStat(p); if (s.isDirectory()) appDirs.push(name) } catch { /* ignore */ }\r\n              }\r\n              const reports: string[] = []\r\n              for (const app of appDirs) {\r\n                const v = await fsx.exists(join(appsDir, app, '.vercel', 'project.json'))\r\n                if (v) reports.push(`${app}: vercel`)\r\n              }\r\n              if (reports.length > 0) {\r\n                results.push({ name: 'linked apps (apps/*)', ok: true, message: reports.join('; ') })\r\n              } else {\r\n                results.push({ name: 'linked apps (apps/*)', ok: true, message: 'none detected (ok)' })\r\n              }\r\n              // Chosen deploy cwd advisories for common path=apps/web\r\n              if (appDirs.includes('web')) {\r\n                const target = join(appsDir, 'web')\r\n                const targetVercelLinked = await fsx.exists(join(target, '.vercel', 'project.json'))\r\n                const rootVercelLinked = await fsx.exists(join(cwd, '.vercel', 'project.json'))\r\n                const vercelRunCwd = targetVercelLinked ? target : (rootVercelLinked && !targetVercelLinked ? cwd : target)\r\n                const relVercel = vercelRunCwd.startsWith(cwd) ? vercelRunCwd.slice(cwd.length + 1) || '.' : vercelRunCwd\r\n                results.push({ name: 'vercel chosen cwd (path=apps/web)', ok: true, message: relVercel })\r\n                \r\n\r\n                // Suggest commands (deploy/prod) based on discovered links\r\n                // Vercel project id (if present)\r\n                let vercelProjId: string | undefined\r\n                try {\r\n                  const pj = await fsx.readJson<{ projectId?: string }>(join(vercelRunCwd, '.vercel', 'project.json'))\r\n                  if (pj && typeof pj.projectId === 'string') vercelProjId = pj.projectId\r\n                } catch { /* ignore */ }\r\n                const vcCmd = `opendeploy deploy vercel --env prod --path ${relVercel}${vercelProjId ? ` --project ${vercelProjId}` : ''}`\r\n                suggestions.push(vcCmd)\r\n                \r\n              }\r\n            } catch { /* ignore */ }\r\n          }\r\n        }\r\n        // GitHub Pages fix: ensure .nojekyll exists to allow _next assets (applies regardless of monorepo)\r\n        if (opts.fix === true) {\r\n          try {\r\n            const pubNoJ = join(cwd, 'public', '.nojekyll')\r\n            const outDir = join(cwd, 'out')\r\n            const outNoJ = join(outDir, '.nojekyll')\r\n            let wrote = false\r\n            try { if (!(await fsx.exists(pubNoJ))) { await writeFile(pubNoJ, '', 'utf8'); wrote = true } } catch { /* ignore */ }\r\n            try { if (await fsx.exists(outDir) && !(await fsx.exists(outNoJ))) { await writeFile(outNoJ, '', 'utf8'); wrote = true } } catch { /* ignore */ }\r\n            results.push({ name: 'GitHub Pages .nojekyll (fix)', ok: true, message: wrote ? 'written' : 'present' })\r\n          } catch { results.push({ name: 'GitHub Pages .nojekyll (fix)', ok: false, message: 'failed to write' }) }\r\n        }\r\n        const ok: boolean = results.every(r => r.ok)\r\n        // GitHub Pages readiness (best-effort)\r\n        try {\r\n          const ghChecks = await checkGitHubPagesSetup(cwd, opts.printCmd)\r\n          for (const r of ghChecks) results.push(r)\r\n          const originOk = ghChecks.find(r => r.name === 'git origin remote')?.ok === true\r\n          const ghBranchOk = ghChecks.find(r => r.name === 'gh-pages branch (remote)')?.ok === true\r\n          if (!originOk) suggestions.push('git remote add origin <url> && git push -u origin main')\r\n          if (!ghBranchOk) suggestions.push('opendeploy deploy github')\r\n          // Next + GH Pages checks\r\n          const nx = await checkNextGithubPages(cwd)\r\n          for (const r of nx) results.push(r as CheckResult)\r\n          const hasNoJ = nx.find(r => r.name.startsWith('.nojekyll'))?.ok\r\n          const hasExport = nx.find(r => r.name.includes(\"output: 'export'\"))?.ok\r\n          const assetsOk = nx.find(r => r.name.startsWith('export assets'))?.ok\r\n          const baseMatch = nx.find(r => r.name === 'next.config: basePath matches repo')\r\n          const assetMatch = nx.find(r => r.name === 'next.config: assetPrefix matches repo')\r\n          if (hasNoJ === false) suggestions.push('touch public/.nojekyll (or rely on CLI to add it during deploy)')\r\n          if (hasExport === false) suggestions.push(\"set output: 'export' in next.config.ts/js for static export\")\r\n          if (assetsOk === false) suggestions.push('pnpm build (verify out/_next/static exists)')\r\n          if (baseMatch && baseMatch.ok === false) suggestions.push(`set basePath in next.config to ${baseMatch.message.includes('expected') ? baseMatch.message.replace('mismatch (expected ', '').replace(')', '') : \"'/<repo>'\"}`)\r\n          if (assetMatch && assetMatch.ok === false) suggestions.push(`set assetPrefix in next.config to ${assetMatch.message.includes('expected') ? assetMatch.message.replace('mismatch (expected ', '').replace(')', '') : \"'/<repo>/'\"} (recommended) `)\r\n          // GitHub Pages: CNAME checks (optional custom domain)\r\n          try {\r\n            const cnamePub = join(cwd, 'public', 'CNAME')\r\n            const cnameOut = join(cwd, 'out', 'CNAME')\r\n            let domain: string | undefined\r\n            if (await fsx.exists(cnamePub)) { try { domain = (await readFileFs(cnamePub, 'utf8')).trim() } catch { /* ignore */ } }\r\n            if (!domain && await fsx.exists(cnameOut)) { try { domain = (await readFileFs(cnameOut, 'utf8')).trim() } catch { /* ignore */ } }\r\n            const hasCname: boolean = typeof domain === 'string' && domain.length > 0\r\n            results.push({ name: 'github pages: CNAME file (custom domain)', ok: hasCname, message: hasCname ? domain! : 'absent (optional)' })\r\n            if (hasCname) {\r\n              // Attempt to infer owner for DNS hint\r\n              let owner: string | undefined\r\n              try {\r\n                const origin = await proc.run({ cmd: 'git remote get-url origin', cwd })\r\n                if (origin.ok) {\r\n                  const t = origin.stdout.trim()\r\n                  const httpsRe = /^https?:\\/\\/github\\.com\\/(.+?)\\/(.+?)(?:\\.git)?$/i\r\n                  const sshRe = /^git@github\\.com:(.+?)\\/(.+?)(?:\\.git)?$/i\r\n                  const m1 = t.match(httpsRe); const m2 = t.match(sshRe)\r\n                  owner = (m1?.[1] || m2?.[1] || '').trim()\r\n                }\r\n              } catch { /* ignore */ }\r\n              if (owner) suggestions.push(`DNS: add CNAME record: ${domain} -> ${owner}.github.io`)\r\n              else suggestions.push(`DNS: add CNAME record: ${domain} -> <owner>.github.io`)\r\n            }\r\n          } catch { /* ignore */ }\r\n        } catch { /* ignore */ }\r\n\r\n        // Cloudflare Pages (Next on Pages) preflight for Next.js apps\r\n        try {\r\n          // Detect Next.js by presence of next.config.* and/or dependency\r\n          let cfg = ''\r\n          const nxcands = ['next.config.ts', 'next.config.js', 'next.config.mjs']\r\n          for (const f of nxcands) {\r\n            const pth = join(cwd, f)\r\n            if (await fsx.exists(pth)) { try { cfg = await readFileFs(pth, 'utf8') } catch { /* ignore */ } break }\r\n          }\r\n          const pkgPath = join(cwd, 'package.json')\r\n          let hasNextDep = false\r\n          try { const raw = await readFileFs(pkgPath, 'utf8'); const js = JSON.parse(raw) as { dependencies?: Record<string,string> }; hasNextDep = Boolean(js.dependencies?.next) } catch { /* ignore */ }\r\n          const isNext = cfg.length > 0 || hasNextDep\r\n          if (isNext) {\r\n            // next.config sanity for Cloudflare: no output:'export', no assetPrefix, basePath empty, trailingSlash false recommended\r\n            if (cfg.length > 0) {\r\n              const hasOutputExport: boolean = /output\\s*:\\s*['\"]export['\"]/m.test(cfg)\r\n              results.push({ name: \"cloudflare: next.config omits output: 'export'\", ok: !hasOutputExport, message: hasOutputExport ? 'found (remove for Next on Pages)' : 'ok' })\r\n              const hasAssetPrefix: boolean = /assetPrefix\\s*:\\s*['\"][^'\\\"]+['\"]/m.test(cfg)\r\n              results.push({ name: 'cloudflare: next.config assetPrefix absent', ok: !hasAssetPrefix, message: hasAssetPrefix ? 'found (remove for root-serving)' : 'ok' })\r\n              const baseMatch = cfg.match(/basePath\\s*:\\s*['\"]([^'\\\"]*)['\"]/m)\r\n              const baseEmpty = !baseMatch || (baseMatch && (!baseMatch[1] || baseMatch[1] === ''))\r\n              results.push({ name: 'cloudflare: next.config basePath empty', ok: baseEmpty, message: baseEmpty ? 'ok' : 'non-empty (set to \"\")' })\r\n              const trailingTrue: boolean = /trailingSlash\\s*:\\s*true/m.test(cfg)\r\n              results.push({ name: 'cloudflare: next.config trailingSlash false (recommended)', ok: !trailingTrue, message: trailingTrue ? 'true (set false)' : 'ok' })\r\n              if (hasOutputExport) suggestions.push('Cloudflare Pages: remove output: \"export\" from next.config when using Next on Pages')\r\n              if (hasAssetPrefix) suggestions.push('Cloudflare Pages: remove assetPrefix from next.config (serve at root)')\r\n              if (!baseEmpty) suggestions.push('Cloudflare Pages: set basePath to empty (\"\") in next.config')\r\n              if (trailingTrue) suggestions.push('Cloudflare Pages: set trailingSlash: false (recommended)')\r\n            }\r\n            // wrangler.toml checks\r\n            const wranglerPath = join(cwd, 'wrangler.toml')\r\n            if (await fsx.exists(wranglerPath)) {\r\n              try {\r\n                const raw = await readFileFs(wranglerPath, 'utf8')\r\n                const hasOut = /pages_build_output_dir\\s*=\\s*\"\\.vercel\\/output\\/static\"/m.test(raw)\r\n                const hasFns = /pages_functions_directory\\s*=\\s*\"\\.vercel\\/output\\/functions\"/m.test(raw)\r\n                const hasCompat = /compatibility_flags\\s*=\\s*\\[.*\"nodejs_compat\".*\\]/m.test(raw)\r\n                results.push({ name: 'cloudflare: wrangler pages_build_output_dir', ok: hasOut, message: hasOut ? 'ok' : 'set to .vercel/output/static' })\r\n                results.push({ name: 'cloudflare: wrangler pages_functions_directory', ok: hasFns, message: hasFns ? 'ok' : 'set to .vercel/output/functions' })\r\n                results.push({ name: 'cloudflare: wrangler nodejs_compat flag', ok: hasCompat, message: hasCompat ? 'ok' : 'add compatibility_flags = [\"nodejs_compat\"]' })\r\n                if (!hasOut) suggestions.push('Cloudflare Pages: set pages_build_output_dir = \".vercel/output/static\" in wrangler.toml')\r\n                if (!hasFns) suggestions.push('Cloudflare Pages: set pages_functions_directory = \".vercel/output/functions\" in wrangler.toml')\r\n                if (!hasCompat) suggestions.push('Cloudflare Pages: add compatibility_flags = [\"nodejs_compat\"] in wrangler.toml')\r\n              } catch { /* ignore */ }\r\n            } else {\r\n              results.push({ name: 'cloudflare: wrangler.toml present', ok: false, message: 'missing (generate with: opd generate cloudflare --next-on-pages)' })\r\n              suggestions.push('opd generate cloudflare --next-on-pages')\r\n            }\r\n            // Cloudflare Pages: project existence and DNS hints\r\n            try {\r\n              // Infer project name\r\n              let projectName: string | undefined\r\n              try {\r\n                const raw = await readFileFs(wranglerPath, 'utf8')\r\n                const m = raw.match(/\\bname\\s*=\\s*\"([^\"]+)\"/)\r\n                if (m && m[1]) projectName = m[1]\r\n              } catch { /* ignore */ }\r\n              if (!projectName) {\r\n                const base = cwd.replace(/\\\\/g,'/').split('/').filter(Boolean).pop() || 'site'\r\n                projectName = base.toLowerCase().replace(/[^a-z0-9-]/g,'-').replace(/--+/g,'-').replace(/^-+|-+$/g,'')\r\n              }\r\n              // List projects to check existence\r\n              const listCmd: string = 'wrangler pages project list --json'\r\n              if (opts.printCmd) logger.info(`$ ${listCmd}`)\r\n              const ls = await runWithRetry({ cmd: listCmd, cwd })\r\n              let exists = false\r\n              if (ls.ok) {\r\n                try {\r\n                  const arr = JSON.parse(ls.stdout) as Array<{ name?: string }>\r\n                  exists = Array.isArray(arr) && arr.some(p => (p.name || '').toLowerCase() === projectName!.toLowerCase())\r\n                } catch { /* ignore parse */ }\r\n              }\r\n              results.push({ name: 'cloudflare: project exists', ok: exists, message: exists ? projectName! : `${projectName} (create with: wrangler pages project create ${projectName})` })\r\n              // DNS hint for default domain\r\n              const defaultDomain = `${projectName}.pages.dev`\r\n              results.push({ name: 'cloudflare: default domain (pages.dev)', ok: true, message: defaultDomain })\r\n              suggestions.push(`Cloudflare DNS: point your custom domain via CNAME to ${defaultDomain} (optional)`)\r\n            } catch { /* ignore */ }\r\n          }\r\n        } catch { /* ignore */ }\r\n\r\n        if (jsonMode) {\r\n          logger.jsonPrint(annotate({ ok, action: 'doctor' as const, results, suggestions, final: true }))\r\n          process.exitCode = ok ? 0 : 1\r\n          return\r\n        }\r\n        for (const r of results) {\r\n          if (r.ok) logger.success(`${r.name}: ${r.message}`)\r\n          else logger.warn(`${r.name}: ${r.message}`)\r\n        }\r\n        if (suggestions.length > 0) {\r\n          logger.info('Suggested commands:')\r\n          for (const s of suggestions) logger.info(`  ${s}`)\r\n        }\r\n        const total: number = results.length\r\n        const okCount: number = results.filter(r => r.ok).length\r\n        const failCount: number = total - okCount\r\n        const failSamples = results.filter(r => !r.ok).slice(0, 5).map(r => ({ name: r.name, message: r.message }))\r\n        // Strict mode: set exit code non-zero when any failures present\r\n        if (opts.strict === true) {\r\n          if (!ok) process.exitCode = 1\r\n        }\r\n        // If local .bin/opd-go exists but not on PATH and OPD_GO_BIN is unset, provide a hint to set OPD_GO_BIN\r\n        try {\r\n          const exe: string = process.platform === 'win32' ? 'opd-go.exe' : 'opd-go'\r\n          const local: string = join(cwd, '.bin', exe)\r\n          const localExists: boolean = await fsx.exists(local)\r\n          const envOverride = process.env.OPD_GO_BIN\r\n          let onPath = false\r\n          try {\r\n            const pathCmd: string = process.platform === 'win32' ? 'where opd-go' : 'command -v opd-go'\r\n            const probe = await runWithRetry({ cmd: pathCmd, cwd })\r\n            onPath = probe.ok && probe.stdout.trim().length > 0\r\n          } catch { onPath = false }\r\n          if (localExists && !onPath && (!envOverride || envOverride.length === 0)) {\r\n            const ps = `$env:OPD_GO_BIN = \\\"$PWD\\\\.bin\\\\${exe}\\\"`\r\n            const sh = `export OPD_GO_BIN=\\\"$PWD/.bin/${exe}\\\"`\r\n            suggestions.push(`Set OPD_GO_BIN (PowerShell): ${ps}`)\r\n            suggestions.push(`Set OPD_GO_BIN (Bash): ${sh}`)\r\n          }\r\n        } catch { /* ignore */ }\r\n        // Add suggestions for missing optional tools\r\n        try {\r\n          const hasOpdGo: boolean = results.find(r => r.name === 'opd-go (optional)')?.ok === true\r\n          if (!hasOpdGo) suggestions.push('pnpm run build:go')\r\n        } catch { /* ignore */ }\r\n        printDoctorSummary({ total, okCount, failCount, failSamples })\r\n        if (!ok) {\r\n          logger.warn('Some checks failed. Run the suggested login/install commands and re-run doctor.')\r\n          if (opts.ci === true) process.exitCode = 1\r\n          if (opts.ci === true || process.env.CI === 'true' || process.env.GITHUB_ACTIONS === 'true') {\r\n            for (const r of results.filter(r => !r.ok)) {\r\n              // GitHub annotation format: ::warning file=app.js,line=1,col=5::Missing semicolon\r\n              // We don't have file/line context; emit a generic annotation.\r\n              // eslint-disable-next-line no-console\r\n              console.log(`::warning ::${r.name} - ${r.message}`)\r\n            }\r\n          }\r\n        }\r\n      } catch (err) {\r\n        const raw: string = err instanceof Error ? err.message : String(err)\r\n        const info = mapProviderError('doctor', raw)\r\n        if (isJsonMode(opts.json)) { logger.jsonPrint(annotate({ ok: false, action: 'doctor' as const, code: info.code, message: info.message, remedy: info.remedy, error: raw, final: true })) }\r\n        logger.error(`${info.message} (${info.code})`)\r\n        if (info.remedy) logger.info(`Try: ${info.remedy}`)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n\r\n  // ----- doctor env-snapshot -----\r\n  doctorCmd\r\n    .command('env-snapshot')\r\n    .description('Capture a deterministic environment snapshot for parity checks')\r\n    .option('--out <file>', 'Output file path', '.artifacts/env.snapshot.json')\r\n    .action(async (opts: { readonly out: string }): Promise<void> => {\r\n      try {\r\n        const snap: Snapshot = buildEnvSnapshot()\r\n        const json: string = JSON.stringify(snap, null, 2) + '\\n'\r\n        // Ensure parent directory exists for output path\r\n        const outDir: string = dirname(opts.out)\r\n        await mkdir(outDir, { recursive: true })\r\n        await writeFile(opts.out, json, 'utf8')\r\n        logger.success(`Environment snapshot written to ${opts.out}`)\r\n      } catch (err) {\r\n        const raw: string = err instanceof Error ? err.message : String(err)\r\n        logger.error(`env-snapshot failed: ${raw}`)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n\r\n  // ----- doctor env-compare -----\r\n  doctorCmd\r\n    .command('env-compare')\r\n    .description('Compare two environment snapshots and print differences')\r\n    .option('--a <file>', 'Snapshot A file path')\r\n    .option('--b <file>', 'Snapshot B file path')\r\n    .action(async (opts: { readonly a?: string; readonly b?: string }): Promise<void> => {\r\n      try {\r\n        if (!opts.a || !opts.b) {\r\n          logger.error('Provide both --a and --b snapshot file paths')\r\n          process.exitCode = 1\r\n          return\r\n        }\r\n        const a: Record<string, unknown> = (await fsx.readJson<Record<string, unknown>>(opts.a)) ?? {}\r\n        const b: Record<string, unknown> = (await fsx.readJson<Record<string, unknown>>(opts.b)) ?? {}\r\n        const diff: { readonly added: string[]; readonly removed: string[]; readonly changed: Array<{ readonly key: string; readonly a: unknown; readonly b: unknown }> } = diffSnapshots(a, b)\r\n        const ok: boolean = diff.added.length === 0 && diff.removed.length === 0 && diff.changed.length === 0\r\n        logger.jsonPrint(annotate({ ok, action: 'doctor' as const, subcommand: 'env-compare' as const, diff, final: true }))\r\n        if (!ok) process.exitCode = 1\r\n      } catch (err) {\r\n        const raw: string = err instanceof Error ? err.message : String(err)\r\n        logger.error(`env-compare failed: ${raw}`)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n\r\n// -------- helpers: environment snapshot/compare --------\r\n\r\ninterface Snapshot {\r\n  readonly platform: string\r\n  readonly release: string\r\n  readonly arch: string\r\n  readonly node: string\r\n  readonly pnpm?: string\r\n  readonly PATH?: string\r\n  readonly PATHEXT?: string\r\n  readonly TZ?: string\r\n  readonly LC_ALL?: string\r\n  readonly FORCE_COLOR?: string\r\n  readonly TERM?: string\r\n}\r\n\r\nfunction pickEnv(keys: readonly string[]): Record<string, string> {\r\n  const out: Record<string, string> = {}\r\n  for (const k of keys) { const v = process.env[k]; if (typeof v === 'string') out[k] = v }\r\n  return out\r\n}\r\n\r\nfunction buildEnvSnapshot(): Snapshot {\r\n  const core: Snapshot = {\r\n    platform: process.platform,\r\n    release: typeof (process as any).getSystemVersion === 'function' ? (process as any).getSystemVersion() ?? '' : process.release.name,\r\n    arch: process.arch,\r\n    node: process.versions.node,\r\n    pnpm: process.env.npm_config_user_agent,\r\n    ...pickEnv(['PATH','PATHEXT','TZ','LC_ALL','FORCE_COLOR','TERM'])\r\n  }\r\n  return core\r\n}\r\n\r\nfunction diffSnapshots(a: Record<string, unknown>, b: Record<string, unknown>): { readonly added: string[]; readonly removed: string[]; readonly changed: Array<{ readonly key: string; readonly a: unknown; readonly b: unknown }> } {\r\n  const keys = new Set<string>([...Object.keys(a), ...Object.keys(b)])\r\n  const added: string[] = []\r\n  const removed: string[] = []\r\n  const changed: Array<{ readonly key: string; readonly a: unknown; readonly b: unknown }> = []\r\n  for (const k of keys) {\r\n    const va = (a as Record<string, unknown>)[k]\r\n    const vb = (b as Record<string, unknown>)[k]\r\n    if (!(k in a)) { added.push(k); continue }\r\n    if (!(k in b)) { removed.push(k); continue }\r\n    if (JSON.stringify(va) !== JSON.stringify(vb)) changed.push({ key: k, a: va, b: vb })\r\n  }\r\n  return { added, removed, changed }\r\n}\r\n","export interface ErrorInfo {\r\n  readonly code: string\r\n  readonly message: string\r\n  readonly remedy?: string\r\n}\r\n\r\nfunction normalize(s: string): string {\r\n  return (s || '').toLowerCase()\r\n}\r\n\r\nexport function mapProviderError(provider: 'vercel' | string, raw: string): ErrorInfo {\r\n  const txt = normalize(raw)\r\n  // Auth issues\r\n  if (txt.includes('not logged in') || txt.includes('please run: vercel login')) {\r\n    const cli = 'vercel'\r\n    return {\r\n      code: `${provider.toUpperCase()}_AUTH_REQUIRED`,\r\n      message: 'You are not logged in to the provider CLI.',\r\n      remedy: `Run: ${cli} login`\r\n    }\r\n  }\r\n  // Vercel: auth expired / unauthorized\r\n  if (provider === 'vercel' && (txt.includes('unauthorized') || txt.includes('token expired') || txt.includes('401') || txt.includes('please run `vercel login`') || txt.includes('please run: vercel login'))) {\r\n    return {\r\n      code: 'VERCEL_AUTH_EXPIRED',\r\n      message: 'Vercel authentication expired or unauthorized.',\r\n      remedy: 'Run: vercel login (or set VERCEL_TOKEN in CI)'\r\n    }\r\n  }\r\n  // Link issues\r\n  if (txt.includes('not linked') || txt.includes(\"don't appear to be in a folder that is linked\") || txt.includes('project not linked')) {\r\n    const cli = 'vercel link'\r\n    return {\r\n      code: `${provider.toUpperCase()}_NOT_LINKED`,\r\n      message: 'The current directory is not linked to a provider project.',\r\n      remedy: `Run: ${cli} (or pass --project/--org in CI)`\r\n    }\r\n  }\r\n  // Vercel: invalid project/org/team\r\n  if (provider === 'vercel' && (txt.includes('invalid project id') || txt.includes('project not found') || txt.includes('team not found') || txt.includes('org not found') || txt.includes('scope not found'))) {\r\n    return {\r\n      code: 'VERCEL_INVALID_PROJECT_OR_TEAM',\r\n      message: 'Invalid or unknown Vercel project/org/team.',\r\n      remedy: 'Verify VERCEL_PROJECT_ID / VERCEL_ORG_ID (or pass --project/--org) or run: vercel link'\r\n    }\r\n  }\r\n  // Netlify-specific mappings removed (provider unsupported).\r\n  // Next.js common build/i18n issues\r\n  if (txt.includes('i18n configuration') && txt.includes('app router')) {\r\n    return {\r\n      code: 'NEXT_I18N_UNSUPPORTED_IN_APP_ROUTER',\r\n      message: 'Next.js i18n in next.config.* is unsupported in App Router.',\r\n      remedy: 'Use App Router i18n via route segments. See: https://nextjs.org/docs/app/building-your-applications/routing/internationalization'\r\n    }\r\n  }\r\n  // Vercel/Next.js build failed (generic)\r\n  if (provider === 'vercel' && (txt.includes('build failed') || txt.includes('failed to compile') || txt.includes('command \"vercel build\"') || txt.includes('error during build'))) {\r\n    return {\r\n      code: 'VERCEL_BUILD_FAILED',\r\n      message: 'Vercel build failed.',\r\n      remedy: 'Open deploy logs; run `next build` locally; check required env with `opendeploy env diff` and `opendeploy env validate`.'\r\n    }\r\n  }\r\n  // Lint/Types failures\r\n  if (txt.includes('eslint') || txt.includes('type error') || txt.includes('typescript error')) {\r\n    return {\r\n      code: 'NEXT_LINT_OR_TYPES_FAILED',\r\n      message: 'Build failed due to ESLint or TypeScript errors.',\r\n      remedy: 'Fix reported lint/type errors; consider disabling lint in prod builds if necessary.'\r\n    }\r\n  }\r\n  // Missing environment variable symptoms\r\n  if (txt.includes('missing environment') || txt.includes('not defined in process.env') || txt.includes('undefined environment variable') || txt.includes('env var') && txt.includes('missing')) {\r\n    return {\r\n      code: 'ENV_MISSING',\r\n      message: 'A required environment variable appears to be missing.',\r\n      remedy: 'Use `opendeploy env diff` to compare local vs provider; then `opendeploy env sync` to apply.'\r\n    }\r\n  }\r\n  if (txt.includes('module_not_found') || txt.includes('cannot find module')) {\r\n    return {\r\n      code: 'NODE_MODULE_NOT_FOUND',\r\n      message: 'A required package/module could not be resolved during build.',\r\n      remedy: 'Reinstall dependencies and ensure Node version compatibility (e.g., pnpm install; use Node 18/20).'\r\n    }\r\n  }\r\n  if (txt.includes('permission denied') || txt.includes('access denied')) {\r\n    return {\r\n      code: 'PERMISSION_DENIED',\r\n      message: 'Permission denied during an operation.',\r\n      remedy: 'Check file permissions and provider access rights.'\r\n    }\r\n  }\r\n  if (txt.includes('network') || txt.includes('etimedout') || txt.includes('econnreset')) {\r\n    return {\r\n      code: 'NETWORK_ERROR',\r\n      message: 'A network error occurred during the operation.',\r\n      remedy: 'Retry the command. If it persists, check connectivity or provider status.'\r\n    }\r\n  }\r\n  // Generic fallback\r\n  return {\r\n    code: `${provider.toUpperCase()}_UNKNOWN_ERROR`,\r\n    message: raw.trim() || 'Unknown provider error.',\r\n  }\r\n}\r\n","import { colors } from './colors'\r\nimport { logger } from './logger'\r\nimport { appendFile } from 'node:fs/promises'\r\n\r\nexport interface DeploySummaryArgs {\r\n  readonly provider: 'vercel' | 'cloudflare' | 'github'\r\n  readonly target: 'prod' | 'preview'\r\n  readonly url?: string\r\n  readonly projectId?: string\r\n  readonly durationMs?: number\r\n  readonly logsUrl?: string\r\n}\r\n\r\nfunction fmtMs(ms?: number): string {\r\n  if (typeof ms !== 'number' || !Number.isFinite(ms)) return '—'\r\n  const s = Math.round(ms / 1000)\r\n  const m = Math.floor(s / 60)\r\n  const r = s % 60\r\n  return `${m}m ${r}s`\r\n}\r\n\r\nexport function printDeploySummary(args: DeploySummaryArgs): void {\r\n  // Only for human mode (logger.jsonOnly would suppress)\r\n  const lines: string[] = []\r\n  lines.push(colors.bold('Summary'))\r\n  lines.push(`  • Provider: ${args.provider}`)\r\n  lines.push(`  • Target:   ${args.target}`)\r\n  if (args.url) lines.push(`  • URL:      ${colors.cyan(args.url)}`)\r\n  if (args.projectId) lines.push(`  • Project:  ${args.projectId}`)\r\n  if (args.durationMs !== undefined) lines.push(`  • Duration: ${fmtMs(args.durationMs)}`)\r\n  if (args.logsUrl) lines.push(`  • Inspect:  ${args.logsUrl}`)\r\n  logger.info('\\n' + lines.join('\\n'))\r\n  // GitHub Job Summary (Markdown)\r\n  const gh: string | undefined = process.env.GITHUB_STEP_SUMMARY\r\n  if (gh) {\r\n    const md: string = [\r\n      '## OpenDeploy — Deploy Summary',\r\n      '',\r\n      `- Provider: ${args.provider}`,\r\n      `- Target: ${args.target}`,\r\n      args.url ? `- URL: ${args.url}` : '',\r\n      args.projectId ? `- Project: ${args.projectId}` : '',\r\n      args.durationMs !== undefined ? `- Duration: ${fmtMs(args.durationMs)}` : '',\r\n      args.logsUrl ? `- Inspect: ${args.logsUrl}` : '',\r\n      ''\r\n    ].filter(Boolean).join('\\n')\r\n    void appendFile(gh, md + '\\n', 'utf8').catch(() => { /* ignore */ })\r\n  }\r\n}\r\n\r\nexport interface EnvPullSummaryArgs {\r\n  readonly provider: 'vercel' | 'cloudflare' | 'github'\r\n  readonly env?: 'prod' | 'preview' | 'development'\r\n  readonly out: string\r\n  readonly count?: number\r\n}\r\n\r\nexport function printEnvPullSummary(args: EnvPullSummaryArgs): void {\r\n  const lines: string[] = []\r\n  lines.push(colors.bold('Summary'))\r\n  lines.push(`  • Provider: ${args.provider}`)\r\n  if (args.env) lines.push(`  • Environment: ${args.env}`)\r\n  lines.push(`  • Output:   ${args.out}`)\r\n  if (typeof args.count === 'number') lines.push(`  • Variables: ${args.count}`)\r\n  logger.info('\\n' + lines.join('\\n'))\r\n}\r\n\r\nexport interface EnvSyncSummaryArgs {\r\n  readonly provider: 'vercel' | 'cloudflare' | 'github'\r\n  readonly file: string\r\n  readonly setCount: number\r\n  readonly skippedCount: number\r\n  readonly failedCount: number\r\n}\r\n\r\nexport function printEnvSyncSummary(args: EnvSyncSummaryArgs): void {\r\n  const lines: string[] = []\r\n  lines.push(colors.bold('Summary'))\r\n  lines.push(`  • Provider: ${args.provider}`)\r\n  lines.push(`  • File:     ${args.file}`)\r\n  lines.push(`  • Set:      ${args.setCount}`)\r\n  lines.push(`  • Skipped:  ${args.skippedCount}`)\r\n  if (args.failedCount > 0) lines.push(`  • Failed:   ${args.failedCount}`)\r\n  logger.info('\\n' + lines.join('\\n'))\r\n}\r\n\r\nexport interface EnvDiffSummaryArgs {\r\n  readonly provider: 'vercel' | 'cloudflare' | 'github'\r\n  readonly env?: 'prod' | 'preview' | 'development'\r\n  readonly added: number\r\n  readonly removed: number\r\n  readonly changed: number\r\n  readonly ok: boolean\r\n  readonly addedKeys?: readonly string[]\r\n  readonly removedKeys?: readonly string[]\r\n  readonly changedKeys?: readonly string[]\r\n}\r\n\r\nexport function printEnvDiffSummary(args: EnvDiffSummaryArgs): void {\r\n  const lines: string[] = []\r\n  lines.push(colors.bold('Summary'))\r\n  lines.push(`  • Provider: ${args.provider}`)\r\n  if (args.env) lines.push(`  • Environment: ${args.env}`)\r\n  lines.push(`  • Added:    ${args.added}`)\r\n  lines.push(`  • Removed:  ${args.removed}`)\r\n  lines.push(`  • Changed:  ${args.changed}`)\r\n  lines.push(`  • Status:   ${args.ok ? colors.green('OK') : colors.yellow('DIFFS')}`)\r\n  logger.info('\\n' + lines.join('\\n'))\r\n  const gh: string | undefined = process.env.GITHUB_STEP_SUMMARY\r\n  if (gh) {\r\n    const total: number = args.added + args.removed + args.changed\r\n    const mdParts: string[] = [\r\n      '## OpenDeploy — Env Diff Summary',\r\n      '',\r\n      `- Provider: ${args.provider}`,\r\n      args.env ? `- Environment: ${args.env}` : '',\r\n      `- Added: ${args.added}`,\r\n      `- Removed: ${args.removed}`,\r\n      `- Changed: ${args.changed}`,\r\n      `- Status: ${args.ok ? 'OK' : 'DIFFS'}`,\r\n      ''\r\n    ].filter(Boolean)\r\n    if (total > 0 && total <= 10) {\r\n      mdParts.push('| Type | Key |')\r\n      mdParts.push('|---|---|')\r\n      for (const k of (args.addedKeys ?? [])) mdParts.push(`| added | ${k} |`)\r\n      for (const k of (args.removedKeys ?? [])) mdParts.push(`| removed | ${k} |`)\r\n      for (const k of (args.changedKeys ?? [])) mdParts.push(`| changed | ${k} |`)\r\n      mdParts.push('')\r\n    }\r\n    const md: string = mdParts.join('\\n')\r\n    void appendFile(gh, md + '\\n', 'utf8').catch(() => { /* ignore */ })\r\n  }\r\n}\r\n\r\nexport interface DoctorSummaryArgs {\r\n  readonly total: number\r\n  readonly okCount: number\r\n  readonly failCount: number\r\n  readonly failSamples?: readonly { readonly name: string; readonly message: string }[]\r\n}\r\n\r\nexport function printDoctorSummary(args: DoctorSummaryArgs): void {\r\n  const lines: string[] = []\r\n  lines.push(colors.bold('Summary'))\r\n  lines.push(`  • Checks:   ${args.total}`)\r\n  lines.push(`  • Passed:   ${args.okCount}`)\r\n  lines.push(`  • Issues:   ${args.failCount}`)\r\n  logger.info('\\n' + lines.join('\\n'))\r\n  const gh: string | undefined = process.env.GITHUB_STEP_SUMMARY\r\n  if (gh) {\r\n    const mdParts: string[] = [\r\n      '## OpenDeploy — Doctor Summary',\r\n      '',\r\n      `- Checks: ${args.total}`,\r\n      `- Passed: ${args.okCount}`,\r\n      `- Issues: ${args.failCount}`,\r\n      ''\r\n    ]\r\n    if ((args.failSamples?.length ?? 0) > 0) {\r\n      mdParts.push('| Check | Issue |')\r\n      mdParts.push('|---|---|')\r\n      for (const it of args.failSamples!.slice(0, 5)) {\r\n        mdParts.push(`| ${it.name} | ${it.message} |`)\r\n      }\r\n      mdParts.push('')\r\n    }\r\n    const md: string = mdParts.join('\\n')\r\n    void appendFile(gh, md + '\\n', 'utf8').catch(() => { /* ignore */ })\r\n  }\r\n}\r\n","export const doctorSummarySchema = {\r\n  $schema: \"http://json-schema.org/draft-07/schema#\",\r\n  type: \"object\",\r\n  additionalProperties: true,\r\n  required: [\"ok\", \"action\", \"final\"],\r\n  properties: {\r\n    ok: { type: \"boolean\" },\r\n    action: { const: \"doctor\" },\r\n    final: { type: \"boolean\" }\r\n  }\r\n} as const\r\n","/**\n * Monorepo app detector.\n * Scans apps/* and root for known frameworks and returns a ranked list.\n */\nimport { join } from 'node:path'\nimport { readdir, stat } from 'node:fs/promises'\nimport { fsx } from '../../utils/fs'\nimport { detectApp as autoDetect } from './auto'\n\nexport interface DetectedApp {\n  readonly path: string\n  readonly framework?: string\n  readonly confidence: number\n}\n\nexport interface DetectAppsArgs { readonly cwd: string }\n\n/**\n * Detect applications within a monorepo. Returns a ranked list by confidence.\n */\nexport async function detectApps(args: DetectAppsArgs): Promise<DetectedApp[]> {\n  const root: string = args.cwd\n  const candidates: string[] = []\n  // apps/*\n  try {\n    const appsDir = join(root, 'apps')\n    const entries = await readdir(appsDir, { withFileTypes: true })\n    for (const e of entries) {\n      if (!e.isDirectory()) continue\n      const full = join(appsDir, e.name)\n      try { const s = await stat(full); if (s.isDirectory()) candidates.push(full) } catch { /* ignore */ }\n    }\n  } catch { /* ignore */ }\n  // root as a candidate too\n  candidates.push(root)\n  const results: DetectedApp[] = []\n  for (const c of candidates) {\n    try {\n      const det = await autoDetect({ cwd: c })\n      let confidence = 0\n      const fw = (det.framework as string | undefined)?.toLowerCase()\n      if (fw) confidence += 5\n      if (await fsx.exists(join(c, 'next.config.js')) || await fsx.exists(join(c, 'next.config.ts'))) confidence += 2\n      if (await fsx.exists(join(c, 'astro.config.mjs')) || await fsx.exists(join(c, 'astro.config.ts'))) confidence += 2\n      if (await fsx.exists(join(c, 'svelte.config.js')) || await fsx.exists(join(c, 'svelte.config.ts'))) confidence += 2\n      // Publish dir hint increases confidence as it indicates a buildable app\n      if (det.publishDir) confidence += 1\n      results.push({ path: c, framework: det.framework as string | undefined, confidence })\n    } catch { /* ignore single candidate errors */ }\n  }\n  // Rank by confidence desc, tie-breaker by shorter path (deeper app dirs usually score similarly)\n  results.sort((a, b) => (b.confidence - a.confidence) || (a.path.length - b.path.length))\n  // Deduplicate same path entries (in case root repeated)\n  const seen = new Set<string>()\n  const uniq: DetectedApp[] = []\n  for (const r of results) { if (!seen.has(r.path)) { uniq.push(r); seen.add(r.path) } }\n  return uniq\n}\n\nexport interface ResolveAppPathArgs { readonly cwd: string; readonly ci?: boolean }\nexport interface ResolveAppPathResult { readonly path: string; readonly candidates: DetectedApp[] }\n\n/**\n * Resolve a single app path for commands. In CI or when there is a clear top\n * candidate, return it; otherwise return the root cwd.\n */\nexport async function resolveAppPath(args: ResolveAppPathArgs): Promise<ResolveAppPathResult> {\n  const candidates = await detectApps({ cwd: args.cwd })\n  const top: DetectedApp | undefined = candidates[0]\n  if (!top) return { path: args.cwd, candidates }\n  const strong: boolean = top.confidence >= 5 && top.path !== args.cwd\n  if (args.ci === true) {\n    // In CI favor determinism: pick strong candidate, otherwise root\n    return { path: strong ? top.path : args.cwd, candidates }\n  }\n  // Locally, pick strong candidate; otherwise keep root to avoid surprises\n  return { path: strong ? top.path : args.cwd, candidates }\n}\n","import { Command } from 'commander'\r\nimport { stat, writeFile } from 'node:fs/promises'\r\nimport { join } from 'node:path'\r\nimport { logger, isJsonMode } from '../utils/logger'\r\nimport { detectApp } from '../core/detectors/auto'\r\nimport { loadProvider } from '../core/provider-system/provider'\r\nimport { resolveAppPath } from '../core/detectors/apps'\r\n\r\ninterface GenerateOptions { readonly overwrite?: boolean; readonly json?: boolean; readonly nextOnPages?: boolean; readonly reusable?: boolean; readonly app?: string; readonly projectName?: string }\r\n\r\n/**\r\n * Register the `generate` command which emits provider-specific config files.\r\n */\r\nexport function registerGenerateCommand(program: Command): void {\r\n  program\r\n    .command('generate')\r\n    .description('Generate configuration files for the detected app (Vercel/Cloudflare/GitHub Pages) or Turborepo pipeline')\r\n    .argument('<provider>', 'Target: vercel | cloudflare | github | turbo')\r\n    .option('--overwrite', 'Overwrite existing files')\r\n    .option('--json', 'Output JSON with generated file path')\r\n    .option('--next-on-pages', 'For Cloudflare: scaffold wrangler.toml configured for Next on Pages')\r\n    .option('--reusable', 'Generate a per-app caller workflow that uses a reusable workflow')\r\n    .option('--app <path>', 'App path to use in reusable workflow (defaults to auto-detected)')\r\n    .option('--project-name <name>', 'Cloudflare Pages project name for reusable workflow')\r\n    .action(async (provider: string, opts: GenerateOptions): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      try {\r\n        const jsonMode: boolean = isJsonMode(opts.json)\r\n        if (jsonMode) logger.setJsonOnly(true)\r\n        const detection = await detectApp({ cwd })\r\n        if (provider === 'vercel') {\r\n          const plugin = await loadProvider('vercel')\r\n          const writtenPath: string = await plugin.generateConfig({ detection, cwd, overwrite: opts.overwrite === true })\r\n          if (jsonMode) {\r\n            const summary = { ok: true, action: 'generate' as const, provider: 'vercel' as const, path: writtenPath, final: true }\r\n            logger.jsonPrint(summary)\r\n            return\r\n          }\r\n          logger.success(`Generated Vercel config at ${writtenPath}`)\r\n          return\r\n        }\r\n        if (provider === 'cloudflare') {\r\n          // If --next-on-pages, scaffold wrangler.toml for Next on Pages; else minimal provider config\r\n          if (opts.nextOnPages === true) {\r\n            const path: string = join(cwd, 'wrangler.toml')\r\n            const exists = async (): Promise<boolean> => { try { const s = await stat(path); return s.isFile() } catch { return false } }\r\n            if (opts.overwrite === true || !(await exists())) {\r\n              const base = cwd.replace(/\\\\/g, '/').split('/').filter(Boolean).pop() || 'site'\r\n              const name = base.toLowerCase().replace(/[^a-z0-9-]/g, '-').replace(/--+/g, '-').replace(/^-+|-+$/g, '') || 'site'\r\n              const body = `# Auto-generated by OpenDeploy CLI (Cloudflare Pages — Next on Pages)\\n# Install the builder:\\n#   pnpm add -D @cloudflare/next-on-pages\\n# Build locally:\\n#   npx @cloudflare/next-on-pages@1\\n# Deploy locally:\\n#   wrangler pages deploy .vercel/output/static --project-name ${name}\\nname = \"${name}\"\\npages_build_output_dir = \".vercel/output/static\"\\npages_functions_directory = \".vercel/output/functions\"\\ncompatibility_date = \"2024-01-01\"\\n`\r\n              await writeFile(path, body, 'utf8')\r\n            }\r\n            if (jsonMode) {\r\n              logger.jsonPrint({ ok: true, action: 'generate' as const, provider: 'cloudflare' as const, mode: 'next-on-pages' as const, path, final: true })\r\n              return\r\n            }\r\n            logger.success('Generated Cloudflare wrangler.toml for Next on Pages')\r\n            logger.note('Install: pnpm add -D @cloudflare/next-on-pages')\r\n            logger.note('Build:   npx @cloudflare/next-on-pages@1')\r\n            logger.note('Deploy:  wrangler pages deploy .vercel/output/static')\r\n            return\r\n          }\r\n          // Reusable per-app caller workflow\r\n          if (opts.reusable === true) {\r\n            // Determine app_path\r\n            let appPath: string = opts.app && opts.app.length > 0 ? opts.app : ''\r\n            if (!appPath) {\r\n              const resolved = await resolveAppPath({ cwd, ci: true })\r\n              appPath = resolved.path === cwd ? '.' : resolved.path.replace(cwd + (cwd.endsWith('\\\\') || cwd.endsWith('/') ? '' : (process.platform === 'win32' ? '\\\\' : '/')), '')\r\n              appPath = appPath.replace(/\\\\/g, '/')\r\n            }\r\n            // Determine project name\r\n            const slugify = (s: string): string => s.toLowerCase().replace(/[^a-z0-9-]/g, '-').replace(/--+/g, '-').replace(/^-+|-+$/g, '')\r\n            const projName: string = opts.projectName && opts.projectName.length > 0 ? opts.projectName : slugify((appPath === '.' ? cwd : appPath).split('/').filter(Boolean).pop() || 'site')\r\n            const relDir = '.github/workflows'\r\n            const file = join(cwd, relDir, 'deploy-app-cloudflare.yml')\r\n            try { await (await import('node:fs/promises')).mkdir(join(cwd, relDir), { recursive: true }) } catch { /* ignore */ }\r\n            const body = `name: Deploy App (Cloudflare Pages)\\n\\n` +\r\n`on:\\n` +\r\n`  push:\\n` +\r\n`    branches: [ main ]\\n` +\r\n`  workflow_dispatch:\\n\\n` +\r\n`jobs:\\n` +\r\n`  deploy:\\n` +\r\n`    uses: ./.github/workflows/_reusable-cloudflare-pages.yml\\n` +\r\n`    with:\\n` +\r\n`      app_path: ${appPath}\\n` +\r\n`      project_name: ${projName}\\n`\r\n            await writeFile(file, body, 'utf8')\r\n            if (jsonMode) { logger.jsonPrint({ ok: true, action: 'generate', provider: 'cloudflare', mode: 'reusable', path: file, app_path: appPath, project_name: projName, final: true }); return }\r\n            logger.success(`Generated Cloudflare per-app workflow at ${file}`)\r\n            logger.note(`Project: ${projName} | App: ${appPath}`)\r\n            return\r\n          }\r\n          // Minimal static Pages config via provider\r\n          const plugin = await loadProvider('cloudflare')\r\n          const writtenPath: string = await plugin.generateConfig({ detection, cwd, overwrite: opts.overwrite === true })\r\n          if (jsonMode) {\r\n            logger.jsonPrint({ ok: true, action: 'generate' as const, provider: 'cloudflare' as const, path: writtenPath, final: true })\r\n            return\r\n          }\r\n          logger.success(`Generated Cloudflare config at ${writtenPath}`)\r\n          return\r\n        }\r\n        if (provider === 'github') {\r\n          // Scaffold GitHub Pages workflow\r\n          const relDir = '.github/workflows'\r\n          const dir = join(cwd, relDir)\r\n          try { await (await import('node:fs/promises')).mkdir(dir, { recursive: true }) } catch { /* ignore */ }\r\n          // Reusable per-app caller workflow\r\n          if (opts.reusable === true) {\r\n            let appPath: string = opts.app && opts.app.length > 0 ? opts.app : ''\r\n            if (!appPath) {\r\n              const resolved = await resolveAppPath({ cwd, ci: true })\r\n              appPath = resolved.path === cwd ? '.' : resolved.path.replace(cwd + (cwd.endsWith('\\\\') || cwd.endsWith('/') ? '' : (process.platform === 'win32' ? '\\\\' : '/')), '')\r\n              appPath = appPath.replace(/\\\\/g, '/')\r\n            }\r\n            const file = join(dir, 'deploy-app-gh-pages.yml')\r\n            const body = `name: Deploy App (GitHub Pages)\\n\\n` +\r\n`on:\\n` +\r\n`  push:\\n` +\r\n`    branches: [ main ]\\n` +\r\n`  workflow_dispatch:\\n\\n` +\r\n`permissions:\\n` +\r\n`  contents: read\\n` +\r\n`  pages: write\\n` +\r\n`  id-token: write\\n\\n` +\r\n`jobs:\\n` +\r\n`  deploy:\\n` +\r\n`    uses: ./.github/workflows/_reusable-gh-pages.yml\\n` +\r\n`    with:\\n` +\r\n`      app_path: ${appPath}\\n`\r\n            await writeFile(file, body, 'utf8')\r\n            if (jsonMode) { logger.jsonPrint({ ok: true, action: 'generate', provider: 'github', mode: 'reusable', path: file, app_path: appPath, final: true }); return }\r\n            logger.success(`Generated GitHub Pages per-app workflow at ${file}`)\r\n            logger.note(`App: ${appPath}`)\r\n            return\r\n          }\r\n          // Standalone GH Pages workflow (non-reusable)\r\n          const outDir: string = ((): string => {\r\n            const pub = detection.publishDir?.trim()\r\n            if (pub && pub.length > 0) return pub\r\n            const fw = (detection.framework || '').toLowerCase()\r\n            if (fw === 'astro') return 'dist'\r\n            if (fw === 'sveltekit') return 'build'\r\n            if (fw === 'next') return 'out' // requires next export\r\n            return 'dist'\r\n          })()\r\n          const file = join(dir, 'deploy-pages.yml')\r\n          const body = `name: Deploy to GitHub Pages\\n\\n` +\r\n`on:\\n` +\r\n`  push:\\n` +\r\n`    branches: [ main ]\\n` +\r\n`  workflow_dispatch:\\n\\n` +\r\n`permissions:\\n` +\r\n`  contents: read\\n` +\r\n`  pages: write\\n` +\r\n`  id-token: write\\n\\n` +\r\n`jobs:\\n` +\r\n`  build:\\n` +\r\n`    runs-on: ubuntu-latest\\n` +\r\n`    steps:\\n` +\r\n`      - uses: actions/checkout@v4\\n` +\r\n`      - uses: pnpm/action-setup@v4\\n` +\r\n`        with:\\n` +\r\n`          version: 9\\n` +\r\n`      - uses: actions/setup-node@v4\\n` +\r\n`        with:\\n` +\r\n`          node-version: 20\\n` +\r\n`          cache: 'pnpm'\\n` +\r\n`      - run: pnpm install --frozen-lockfile\\n` +\r\n`      - run: pnpm run build\\n` +\r\n`      - uses: actions/upload-pages-artifact@v3\\n` +\r\n`        with:\\n` +\r\n`          path: ${outDir}\\n` +\r\n`  deploy:\\n` +\r\n`    needs: build\\n` +\r\n`    runs-on: ubuntu-latest\\n` +\r\n`    environment:\\n` +\r\n`      name: github-pages\\n` +\r\n`      url: ` + '${{ steps.deployment.outputs.page_url }}' + `\\n` +\r\n`    steps:\\n` +\r\n`      - id: deployment\\n` +\r\n`        uses: actions/deploy-pages@v4\\n`\r\n          await writeFile(file, body, 'utf8')\r\n          if (jsonMode) { logger.jsonPrint({ ok: true, action: 'generate' as const, provider: 'github' as const, path: file, final: true }); return }\r\n          logger.success(`Generated GitHub Pages workflow at ${file}`)\r\n          if ((detection.framework || '').toLowerCase() === 'next') {\r\n            logger.note('Next.js → GitHub Pages: set next.config output: \"export\" and run next export to produce out/.')\r\n          }\r\n          return\r\n        }\r\n        if (provider === 'turbo') {\r\n          const path: string = join(cwd, 'turbo.json')\r\n          const exists = async (): Promise<boolean> => { try { const s = await stat(path); return s.isFile() } catch { return false } }\r\n          if (opts.overwrite === true || !(await exists())) {\r\n            const turbo = {\r\n              tasks: {\r\n                build: {\r\n                  dependsOn: ['^build'],\r\n                  outputs: ['.next/**', '!.next/cache/**', 'dist/**']\r\n                }\r\n              }\r\n            }\r\n            await writeFile(path, `${JSON.stringify(turbo, null, 2)}\\n`, 'utf8')\r\n          }\r\n          if (jsonMode) {\r\n            logger.jsonPrint({ ok: true, action: 'generate' as const, provider: 'turbo' as const, path, final: true })\r\n            return\r\n          }\r\n          logger.success(`Generated Turborepo config at ${path}`)\r\n          return\r\n        }\r\n        logger.error(`Unknown provider: ${provider}`)\r\n        process.exitCode = 1\r\n      } catch (err) {\r\n        const message: string = err instanceof Error ? err.message : String(err)\r\n        logger.error(message)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n","import type { Provider } from './provider-interface'\r\n\r\n/**\r\n * Simple dynamic loader for providers. In future we can support a registry file,\r\n * user-installed packages, and workspace-local providers.\r\n */\r\nexport async function loadProvider(id: string): Promise<Provider> {\r\n  const normalized = id.toLowerCase()\r\n  // Virtual mode: force provider to 'virtual' for hermetic tests\r\n  if ((process.env.OPD_PROVIDER_MODE ?? '').toLowerCase() === 'virtual') {\r\n    const mod = await import('./providers/virtual')\r\n    return new mod.VirtualProvider(normalized)\r\n  }\r\n  // Built-in providers\r\n  if (normalized === 'vercel') {\r\n    const mod = await import('./providers/vercel')\r\n    return new mod.VercelProvider()\r\n  }\r\n  if (normalized === 'netlify') {\r\n    // Netlify is not supported by OpenDeploy.\r\n    throw new Error('Netlify is not supported by OpenDeploy. Please use the official Netlify CLI.')\r\n  }\r\n  if (normalized === 'cloudflare' || normalized === 'cloudflare-pages') {\r\n    const mod = await import('./providers/cloudflare-pages')\r\n    return new mod.CloudflarePagesProvider()\r\n  }\r\n  if (normalized === 'github' || normalized === 'github-pages') {\r\n    const mod = await import('./providers/github-pages')\r\n    return new mod.GithubPagesProvider()\r\n  }\r\n  // Future: dynamic import from @opendeploy/provider-<id>\r\n  try {\r\n    const mod = await import(`@opendeploy/provider-${normalized}`)\r\n    return mod.default as Provider\r\n  } catch {\r\n    throw new Error(`Unknown provider: ${id}`)\r\n  }\r\n}\r\n","import { Command } from 'commander'\r\nimport { logger, isJsonMode } from '../utils/logger'\r\nimport { detectNextApp } from '../core/detectors/next'\r\nimport { loadProvider } from '../core/provider-system/provider'\r\nimport type { DeployInputs } from '../types/deploy-inputs'\r\nimport type { DetectionResult } from '../types/detection-result'\r\nimport { join, isAbsolute } from 'node:path'\r\nimport { readFile } from 'node:fs/promises'\r\nimport { fsx } from '../utils/fs'\r\nimport { proc, runWithRetry } from '../utils/process'\r\nimport { startHeartbeat, type Stopper } from '../utils/progress'\r\nimport { spinner } from '../utils/ui'\r\nimport { mapProviderError } from '../utils/errors'\r\nimport { printDeploySummary } from '../utils/summarize'\r\nimport { envSync } from './env'\r\n// duplicate import removed\r\nimport { computeRedactors } from '../utils/redaction'\r\nimport { resolveAppPath } from '../core/detectors/apps'\r\n\r\ninterface DeployOptions {\r\n  readonly env?: 'prod' | 'preview'\r\n  readonly project?: string\r\n  readonly org?: string\r\n  readonly dryRun?: boolean\r\n  readonly json?: boolean\r\n  readonly path?: string\r\n  readonly ci?: boolean\r\n  readonly syncEnv?: boolean\r\n  readonly alias?: string\r\n}\r\n\r\n/**\r\n * Register the `deploy` command.\r\n */\r\nexport function registerDeployCommand(program: Command): void {\r\n  program\r\n    .command('deploy')\r\n    .description('Deploy the detected app to a provider')\r\n    .argument('<provider>', 'Target provider: vercel | cloudflare | github')\r\n    .option('--env <env>', 'Environment: prod | preview', 'preview')\r\n    .option('--project <id>', 'Provider project/site ID')\r\n    .option('--org <id>', 'Provider org/team ID')\r\n    .option('--dry-run', 'Do not execute actual deployment')\r\n    .option('--json', 'Output JSON result')\r\n    .option('--path <dir>', 'Path to app directory (for monorepos)')\r\n    .option('--ci', 'CI mode (non-interactive)')\r\n    .option('--sync-env', 'Sync environment variables from a local .env before deploy')\r\n    .option('--alias <domain>', 'After deploy, assign this alias to the deployment (vercel only)')\r\n    .action(async (provider: string, opts: DeployOptions): Promise<void> => {\r\n      const rootCwd: string = process.cwd()\r\n      // Resolve target app path for monorepos when --path is not specified\r\n      let targetCwd: string\r\n      if (opts.path && opts.path.length > 0) {\r\n        targetCwd = isAbsolute(opts.path) ? opts.path : join(rootCwd, opts.path)\r\n      } else {\r\n        const ciMode: boolean = Boolean(opts.ci) || process.env.CI === 'true' || process.env.GITHUB_ACTIONS === 'true' || process.env.OPD_FORCE_CI === '1' || process.env.OPD_NDJSON === '1' || process.env.OPD_JSON === '1'\r\n        const resolved = await resolveAppPath({ cwd: rootCwd, ci: ciMode })\r\n        targetCwd = resolved.path\r\n        if (process.env.OPD_NDJSON === '1') logger.json({ event: 'app-path', path: targetCwd, candidates: resolved.candidates, provider })\r\n        else if (targetCwd !== rootCwd) logger.note(`Detected app path: ${targetCwd}`)\r\n      }\r\n      try {\r\n        const jsonMode: boolean = isJsonMode(opts.json)\r\n        if (jsonMode) logger.setJsonOnly(true)\r\n        // Enable NDJSON mode when OPD_NDJSON=1 is present\r\n        const ndjsonOn: boolean = process.env.OPD_NDJSON === '1'\r\n        if (ndjsonOn) logger.setNdjson(true)\r\n        // Force CI-friendly env to suppress interactive prompts in child processes\r\n        if (jsonMode || opts.ci === true || ndjsonOn) {\r\n          process.env.OPD_FORCE_CI = '1'\r\n        }\r\n        // Default: provider plugin flow. Use legacy only when OPD_LEGACY=1.\r\n        if (process.env.OPD_LEGACY !== '1') {\r\n          // Dry-run summary (no external side effects)\r\n          if (opts.dryRun === true) {\r\n            if (jsonMode) {\r\n              const payload = { provider, target: (opts.env === 'prod' ? 'prod' : 'preview'), mode: 'dry-run', final: true }\r\n              logger.jsonPrint(payload)\r\n              try { /* eslint-disable-next-line no-console */ console.log(JSON.stringify(payload)) } catch { /* ignore */ }\r\n              return\r\n            }\r\n            logger.info(`[dry-run] ${provider} deploy (plugins) (cwd=${targetCwd})`)\r\n            return\r\n          }\r\n          const p = await loadProvider(provider)\r\n          if (process.env.OPD_SKIP_VALIDATE !== '1') {\r\n            await p.validateAuth(targetCwd)\r\n          }\r\n          // Optional env sync for first-class providers\r\n          const wantSync: boolean = opts.syncEnv === true || process.env.OPD_SYNC_ENV === '1'\r\n          if (wantSync && provider === 'vercel') {\r\n            const envTarget: 'prod' | 'preview' = opts.env === 'prod' ? 'prod' : 'preview'\r\n            const candidates: readonly string[] = envTarget === 'prod' ? ['.env.production.local', '.env'] : ['.env', '.env.local']\r\n            let chosenFile: string | undefined\r\n            for (const f of candidates) { if (await fsx.exists(join(targetCwd, f))) { chosenFile = f; break } }\r\n            if (chosenFile) {\r\n              logger.section('Environment')\r\n              logger.note(`Syncing ${chosenFile} → ${provider}`)\r\n              try {\r\n                try { const patterns = await computeRedactors({ cwd: targetCwd, envFiles: [chosenFile], includeProcessEnv: true }); if (patterns.length > 0) logger.setRedactors(patterns) } catch { /* ignore */ }\r\n                await envSync({ provider: 'vercel', cwd: targetCwd, file: chosenFile, env: envTarget, yes: true, ci: Boolean(opts.ci), json: false, projectId: opts.project, orgId: opts.org, ignore: [], only: [] })\r\n                logger.success('Environment sync complete')\r\n              } catch (e) { logger.warn(`Env sync skipped: ${(e as Error).message}`) }\r\n            }\r\n          }\r\n          // Always perform a link step so providers can derive or create a project when missing\r\n          const linked = await p.link(targetCwd, { projectId: opts.project, orgId: opts.org })\r\n          const envTarget: 'preview' | 'production' = opts.env === 'prod' ? 'production' : 'preview'\r\n          // Detection hints for publishDir/framework\r\n          let publishDirHint: string | undefined\r\n          let frameworkHint: string | undefined\r\n          try {\r\n            const d = await p.detect(targetCwd)\r\n            publishDirHint = d.publishDir\r\n            frameworkHint = d.framework\r\n          } catch { /* ignore */ }\r\n          const t0: number = Date.now()\r\n          const buildRes = await p.build({ cwd: targetCwd, framework: frameworkHint, envTarget, publishDirHint, noBuild: false })\r\n          const deployRes = await p.deploy({ cwd: targetCwd, envTarget, project: linked, artifactDir: buildRes.artifactDir, alias: opts.alias })\r\n          const durationMs: number = Date.now() - t0\r\n          if (jsonMode && !deployRes.ok) {\r\n            const message: string = deployRes.message || 'Deploy failed'\r\n            logger.jsonPrint({ ok: false, action: 'deploy' as const, provider, target: (opts.env === 'prod' ? 'prod' : 'preview'), url: deployRes.url, logsUrl: deployRes.logsUrl, projectId: linked.projectId ?? opts.project, durationMs, message, final: true })\r\n            return\r\n          }\r\n          if (jsonMode) {\r\n            logger.jsonPrint({ ok: true, action: 'deploy' as const, provider, target: (opts.env === 'prod' ? 'prod' : 'preview'), url: deployRes.url, logsUrl: deployRes.logsUrl, projectId: linked.projectId ?? opts.project, durationMs, final: true })\r\n            return\r\n          }\r\n          if (deployRes.ok) {\r\n            if (deployRes.url) logger.success(`Deployed: ${deployRes.url}`)\r\n            else logger.success('Deployed')\r\n            printDeploySummary({ provider: provider as 'vercel' | 'cloudflare' | 'github', target: (opts.env === 'prod' ? 'prod' : 'preview'), url: deployRes.url, projectId: linked.projectId ?? opts.project, durationMs, logsUrl: deployRes.logsUrl })\r\n          } else {\r\n            const message: string = deployRes.message || 'Deploy failed'\r\n            if (deployRes.logsUrl) logger.info(`Logs: ${deployRes.logsUrl}`)\r\n            throw new Error(message)\r\n          }\r\n          return\r\n        }\r\n        const detection: DetectionResult = await detectNextApp({ cwd: targetCwd })\r\n        // Optional: pre-deploy env sync for single-command UX\r\n        const wantSync: boolean = opts.syncEnv === true || process.env.OPD_SYNC_ENV === '1'\r\n        if (!opts.dryRun && wantSync) {\r\n          const envTarget: 'prod' | 'preview' = opts.env === 'prod' ? 'prod' : 'preview'\r\n          const candidates: readonly string[] = envTarget === 'prod'\r\n            ? ['.env.production.local', '.env']\r\n            : ['.env', '.env.local']\r\n          let chosenFile: string | undefined\r\n          for (const f of candidates) { if (await fsx.exists(join(targetCwd, f))) { chosenFile = f; break } }\r\n          if (chosenFile) {\r\n            logger.section('Environment')\r\n            logger.note(`Syncing ${chosenFile} → ${provider}`)\r\n            try {\r\n              // Strengthen redaction: load secrets from selected env file and process.env\r\n              try { const patterns = await computeRedactors({ cwd: targetCwd, envFiles: [chosenFile], includeProcessEnv: true }); if (patterns.length > 0) logger.setRedactors(patterns) } catch { /* ignore */ }\r\n              await envSync({ provider: 'vercel', cwd: targetCwd, file: chosenFile, env: envTarget, yes: true, ci: Boolean(opts.ci), json: false, projectId: opts.project, orgId: opts.org, ignore: [], only: [] })\r\n              logger.success('Environment sync complete')\r\n            } catch (e) {\r\n              logger.warn(`Env sync skipped: ${(e as Error).message}`)\r\n            }\r\n          } else {\r\n            logger.note('No local .env file found to sync')\r\n          }\r\n        }\r\n\r\n        if (provider === 'vercel') {\r\n          const plugin = await loadProvider('vercel')\r\n          await plugin.validateAuth(targetCwd)\r\n          // Choose cwd for Vercel deploy in monorepos:\r\n          // - Prefer target app directory when it is linked (has .vercel/project.json)\r\n          // - Otherwise, if root is linked and target is not, deploy from root\r\n          // - Else, default to target\r\n          const targetLink: string = join(targetCwd, '.vercel', 'project.json')\r\n          const rootLink: string = join(rootCwd, '.vercel', 'project.json')\r\n          const targetIsLinked: boolean = await fsx.exists(targetLink)\r\n          const rootIsLinked: boolean = await fsx.exists(rootLink)\r\n          const runCwd: string = targetIsLinked ? targetCwd : (rootIsLinked && !targetIsLinked ? rootCwd : targetCwd)\r\n          if (runCwd !== targetCwd) logger.info(`Using linked directory for Vercel deploy: ${runCwd}`)\r\n          if (!opts.dryRun) {\r\n            const sp = spinner('Vercel: preparing')\r\n            if (process.env.OPD_NDJSON === '1') logger.json({ event: 'phase', phase: 'prepare', provider: 'vercel', path: runCwd })\r\n            // If deploying from target dir and IDs provided, ensure it's linked\r\n            if (runCwd === targetCwd && (opts.project || opts.org)) {\r\n              const linkFlags: string[] = ['--yes']\r\n              if (opts.project) linkFlags.push(`--project ${opts.project}`)\r\n              if (opts.org) linkFlags.push(`--org ${opts.org}`)\r\n              await proc.run({ cmd: `vercel link ${linkFlags.join(' ')}`, cwd: runCwd })\r\n            }\r\n            // Prefer local build + prebuilt deploy for monorepos or when explicitly requested\r\n            let cmd: string = opts.env === 'prod' ? 'vercel deploy --prod --yes' : 'vercel deploy --yes'\r\n            let usedPrebuilt = false\r\n            try {\r\n              const hasWorkspace: boolean = await fsx.exists(join(rootCwd, 'pnpm-workspace.yaml'))\r\n              const targetHasLock: boolean = await fsx.exists(join(runCwd, 'pnpm-lock.yaml'))\r\n              const wantLocalBuild: boolean = process.env.OPD_LOCAL_BUILD === '1' || (hasWorkspace && !targetHasLock)\r\n              if (wantLocalBuild) {\r\n                sp.update('Vercel: local build')\r\n                const buildCmd: string = 'vercel build'\r\n                const build = await proc.run({ cmd: buildCmd, cwd: runCwd })\r\n                if (!build.ok) { throw new Error(build.stderr.trim() || build.stdout.trim() || 'Vercel local build failed') }\r\n                cmd = opts.env === 'prod' ? 'vercel deploy --prebuilt --prod --yes' : 'vercel deploy --prebuilt --yes'\r\n                usedPrebuilt = true\r\n              }\r\n            } catch { /* fall back to remote build */ }\r\n            const deployTimeout: number = Number.isFinite(Number(process.env.OPD_TIMEOUT_MS)) ? Number(process.env.OPD_TIMEOUT_MS) : 900_000\r\n            const t0: number = Date.now()\r\n            if (process.env.OPD_NDJSON === '1') logger.json({ event: 'phase', phase: 'deploy', provider: 'vercel', command: cmd, cwd: runCwd, prebuilt: usedPrebuilt })\r\n            sp.update('Vercel: deploying')\r\n            const stop: Stopper = startHeartbeat({ label: 'vercel deploy', hint: 'Tip: opendeploy open vercel --path apps/web', intervalMs: process.env.OPD_NDJSON === '1' ? 5000 : 10000 })\r\n            let capturedUrl: string | undefined\r\n            let capturedInspect: string | undefined\r\n            const urlRe = /https?:\\/\\/[^\\s]+vercel\\.app/g\r\n            const inspectRe = /https?:\\/\\/[^\\s]*vercel\\.com[^\\s]*/g\r\n            const controller = proc.spawnStream({\r\n              cmd,\r\n              cwd: runCwd,\r\n              timeoutMs: deployTimeout,\r\n              onStdout: (chunk: string): void => {\r\n                if (process.env.OPD_NDJSON === '1') logger.json({ event: 'vc:stdout', line: chunk })\r\n                const m = chunk.match(urlRe)\r\n                if (!capturedUrl && m && m.length > 0) capturedUrl = m[0]\r\n                if (process.env.OPD_NDJSON !== '1' && process.env.OPD_JSON !== '1') {\r\n                  const t = chunk.replace(/\\s+$/,'')\r\n                  if (t.length > 0) logger.info(t)\r\n                }\r\n              },\r\n              onStderr: (chunk: string): void => {\r\n                if (process.env.OPD_NDJSON === '1') logger.json({ event: 'vc:stderr', line: chunk })\r\n                if (!capturedInspect) {\r\n                  const im = chunk.match(inspectRe)\r\n                  if (im && im.length > 0) capturedInspect = im[0]\r\n                }\r\n                // Human-mode phase hints\r\n                if (process.env.OPD_NDJSON !== '1' && process.env.OPD_JSON !== '1') {\r\n                  const s = chunk.toLowerCase()\r\n                  if (s.includes('queued')) sp.update('Vercel: queued')\r\n                  else if (s.includes('building')) sp.update('Vercel: building')\r\n                  else if (s.includes('completing')) sp.update('Vercel: completing')\r\n                }\r\n              }\r\n            })\r\n            const res = await controller.done\r\n            stop()\r\n            const durationMs: number = Date.now() - t0\r\n            if (!res.ok) throw new Error('Vercel deploy failed')\r\n            const url: string | undefined = capturedUrl\r\n            const logsUrl: string | undefined = capturedInspect\r\n            // Fallback: derive Inspect URL if not printed by CLI but we have deployment URL\r\n            let finalLogsUrl: string | undefined = logsUrl\r\n            if (!finalLogsUrl && url) {\r\n              try {\r\n                const insp = await proc.run({ cmd: `vercel inspect ${url}`.trim(), cwd: runCwd })\r\n                const text: string = (insp.stdout || '') + '\\n' + (insp.stderr || '')\r\n                const m = text.match(inspectRe)\r\n                if (m && m.length > 0) finalLogsUrl = m[0]\r\n              } catch { /* ignore */ }\r\n            }\r\n            // Try to read projectId from chosen cwd\r\n            let projectId: string | undefined\r\n            try {\r\n              const p = join(runCwd, '.vercel', 'project.json')\r\n              const buf = await readFile(p, 'utf8')\r\n              const js = JSON.parse(buf) as { projectId?: string }\r\n              if (typeof js.projectId === 'string') projectId = js.projectId\r\n            } catch { /* ignore */ }\r\n            // Optional alias step\r\n            let aliasUrl: string | undefined\r\n            if (url && opts.alias) {\r\n              try {\r\n                const al = await proc.run({ cmd: `vercel alias set ${url} ${opts.alias}`.trim(), cwd: runCwd })\r\n                if (al.ok) aliasUrl = `https://${opts.alias}`\r\n              } catch { /* ignore alias errors */ }\r\n            }\r\n            if (opts.json === true || process.env.OPD_NDJSON === '1') {\r\n              logger.json({ url, logsUrl: finalLogsUrl, aliasUrl, projectId, provider: 'vercel', target: (opts.env === 'prod' ? 'prod' : 'preview'), durationMs, final: true })\r\n              return\r\n            }\r\n            sp.succeed(url ? `Vercel: deployed ${url}` : 'Vercel: deployed')\r\n            if (url !== undefined) logger.success(`Deployed: ${url}`)\r\n            if (aliasUrl) logger.success(`Aliased: ${aliasUrl}`)\r\n            printDeploySummary({ provider: 'vercel', target: (opts.env === 'prod' ? 'prod' : 'preview'), url, projectId, durationMs, logsUrl: finalLogsUrl })\r\n            return\r\n          }\r\n          if (opts.dryRun === true) {\r\n            const flags: string = opts.env === 'prod' ? '--prod --yes' : '--yes'\r\n            logger.info(`[dry-run] vercel ${flags} (cwd=${targetCwd})`)\r\n            if (opts.json === true || process.env.OPD_NDJSON === '1') {\r\n              logger.json({ provider: 'vercel', target: (opts.env === 'prod' ? 'prod' : 'preview'), mode: 'dry-run', final: true })\r\n            }\r\n            return\r\n          }\r\n          // legacy adapter-based deploy path removed; streaming deploy above covers Vercel\r\n          return\r\n        }\r\n        // Netlify path removed; use official Netlify CLI instead.\r\n        logger.error(`Unknown provider: ${provider}`)\r\n        process.exitCode = 1\r\n      } catch (err) {\r\n        const raw: string = err instanceof Error ? err.message : String(err)\r\n        const info = mapProviderError(provider, raw)\r\n        // Emit machine-readable error if JSON/NDJSON requested\r\n        if (process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1') {\r\n          logger.json({ ok: false, command: 'deploy', provider, target: opts.env ?? 'preview', path: opts.path, code: info.code, message: info.message, remedy: info.remedy, error: raw, final: true })\r\n        }\r\n        logger.error(`${info.message} (${info.code})`)\r\n        if (info.remedy) logger.info(`Try: ${info.remedy}`)\r\n        const annMode = process.env.OPD_GHA_ANN\r\n        const inCI = process.env.CI === 'true' || process.env.GITHUB_ACTIONS === 'true'\r\n        if (inCI && annMode !== 'off') {\r\n          const sev = annMode === 'error' ? 'error' : 'warning'\r\n          // eslint-disable-next-line no-console\r\n          console.log(`::${sev} ::${info.message}${info.remedy ? ` | Try: ${info.remedy}` : ''}`)\r\n        }\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n\r\n  // Lightweight: deploy logs\r\n  program\r\n    .command('logs')\r\n    .description('Open or tail provider logs for the last deployment')\r\n    .argument('<provider>', 'Target provider: vercel | cloudflare')\r\n    .option('--env <env>', 'Environment: prod | preview', 'prod')\r\n    .option('--follow', 'Tail runtime logs (best-effort)')\r\n    .option('--path <dir>', 'Path to app directory (for monorepos)')\r\n    .option('--project <id>', 'Vercel project ID or name')\r\n    .option('--org <id>', 'Vercel org/team ID or slug')\r\n    .option('--limit <n>', 'Look back N recent deployments (default: 1)', '1')\r\n    .option('--sha <commit>', 'Prefer deployment matching this commit SHA (prefix allowed)')\r\n    .option('--json', 'Output JSON result')\r\n    .option('--since <duration>', 'Since duration for provider logs (e.g., 1h, 15m)')\r\n    .option('--open', 'Open the Inspect URL in the browser after resolving it')\r\n    .action(async (provider: string, opts: { env?: 'prod' | 'preview'; follow?: boolean; path?: string; project?: string; org?: string; limit?: string; sha?: string; json?: boolean; open?: boolean; since?: string }): Promise<void> => {\r\n      const rootCwd: string = process.cwd()\r\n      const targetCwd: string = opts.path ? (isAbsolute(opts.path) ? opts.path : join(rootCwd, opts.path)) : rootCwd\r\n      try {\r\n        if (opts.json === true) logger.setJsonOnly(true)\r\n        const ndjsonOn: boolean = process.env.OPD_NDJSON === '1'\r\n        if (ndjsonOn) logger.setNdjson(true)\r\n        if (opts.json === true || ndjsonOn) process.env.OPD_FORCE_CI = '1'\r\n        if (provider !== 'vercel' && provider !== 'cloudflare') {\r\n          logger.error(`Unknown provider: ${provider}`)\r\n          process.exitCode = 1\r\n          return\r\n        }\r\n        if (provider === 'cloudflare') {\r\n          const isNd: boolean = process.env.OPD_NDJSON === '1'\r\n          const stepTimeoutV = Number.isFinite(Number(process.env.OPD_TIMEOUT_MS)) ? Number(process.env.OPD_TIMEOUT_MS) : 120_000\r\n          const wranglerPath = join(targetCwd, 'wrangler.toml')\r\n          let projectName: string | undefined\r\n          try {\r\n            if (await fsx.exists(wranglerPath)) {\r\n              const raw = await (await import('node:fs/promises')).readFile(wranglerPath, 'utf8')\r\n              const m = raw.match(/\\bname\\s*=\\s*\"([^\"]+)\"/)\r\n              if (m && m[1]) projectName = m[1]\r\n            }\r\n          } catch { /* noop */ }\r\n          if (!projectName) {\r\n            const base = targetCwd.replace(/\\\\/g,'/').split('/').filter(Boolean).pop() || 'site'\r\n            projectName = base.toLowerCase().replace(/[^a-z0-9-]/g,'-').replace(/--+/g,'-').replace(/^-+|-+$/g,'')\r\n          }\r\n          let depUrlCf: string | undefined\r\n          let inspectUrlCf: string | undefined\r\n          try {\r\n            const ls = await runWithRetry({ cmd: `wrangler pages deployments list --project-name ${projectName} --json`, cwd: targetCwd }, { timeoutMs: stepTimeoutV })\r\n            if (ls.ok) {\r\n              try {\r\n                const arr = JSON.parse(ls.stdout) as Array<{ url?: string; id?: string; is_current?: boolean }>\r\n                const chosen = Array.isArray(arr) && arr.length > 0 ? (arr.find(d => (d as any).is_current === true) || arr[0]) : undefined\r\n                if (chosen?.url && typeof chosen.url === 'string') depUrlCf = chosen.url\r\n                let accountId: string | undefined\r\n                try {\r\n                  const who = await runWithRetry({ cmd: 'wrangler whoami', cwd: targetCwd }, { timeoutMs: 60_000 })\r\n                  if (who.ok) {\r\n                    const text = (who.stdout + '\\n' + who.stderr).trim()\r\n                    const m = text.match(/account\\s*id\\s*[:=]\\s*([a-z0-9]+)/i)\r\n                    if (m && m[1]) accountId = m[1]\r\n                  }\r\n                } catch { /* ignore */ }\r\n                const depId = (chosen as any).id as string | undefined\r\n                if (accountId && depId) inspectUrlCf = `https://dash.cloudflare.com/${accountId}/pages/view/${projectName}/${depId}`\r\n                else if (accountId) inspectUrlCf = `https://dash.cloudflare.com/${accountId}/pages/view/${projectName}`\r\n              } catch { /* ignore parse */ }\r\n            }\r\n          } catch { /* ignore */ }\r\n          if (opts.json === true || isNd) {\r\n            logger.json({ ok: true, action: 'logs', provider: 'cloudflare', env: opts.env ?? 'prod', url: depUrlCf, inspectUrl: inspectUrlCf, project: projectName, final: true })\r\n            return\r\n          }\r\n          if (inspectUrlCf) logger.success(`Inspect: ${inspectUrlCf}`)\r\n          if (depUrlCf) logger.success(`URL: ${depUrlCf}`)\r\n          if (!inspectUrlCf && !depUrlCf) logger.info('Could not resolve Cloudflare deployment info. Ensure wrangler and project are configured.')\r\n          if (opts.open === true && inspectUrlCf) {\r\n            const opener: string = process.platform === 'win32' ? `start \"\" \"${inspectUrlCf}\"` : process.platform === 'darwin' ? `open \"${inspectUrlCf}\"` : `xdg-open \"${inspectUrlCf}\"`\r\n            void proc.run({ cmd: opener, cwd: targetCwd })\r\n          }\r\n          return\r\n        }\r\n        const isNdjson: boolean = process.env.OPD_NDJSON === '1'\r\n        // Provider: vercel\r\n        // Pick linked cwd like deploy\r\n        const targetLink: string = join(targetCwd, '.vercel', 'project.json')\r\n        const rootLink: string = join(rootCwd, '.vercel', 'project.json')\r\n        const targetIsLinked: boolean = await fsx.exists(targetLink)\r\n        const rootIsLinked: boolean = await fsx.exists(rootLink)\r\n        const runCwd: string = targetIsLinked ? targetCwd : (rootIsLinked && !targetIsLinked ? rootCwd : targetCwd)\r\n        // Get latest deployment URL for the chosen env\r\n        const n = Math.max(1, parseInt(opts.limit ?? '1', 10) || 1)\r\n        const flags: string[] = ['list', '--json', '-n', String(n)]\r\n        if (opts.env === 'prod') flags.push('--prod')\r\n        if (opts.project) { flags.push('--project', opts.project) }\r\n        if (opts.org) { flags.push('--org', opts.org) }\r\n        const listCmd: string = `vercel ${flags.join(' ')}`\r\n        const stepTimeoutV = Number.isFinite(Number(process.env.OPD_TIMEOUT_MS)) ? Number(process.env.OPD_TIMEOUT_MS) : 120_000\r\n        const ls = await runWithRetry({ cmd: listCmd, cwd: runCwd }, { timeoutMs: stepTimeoutV })\r\n        if (!ls.ok) throw new Error(ls.stderr.trim() || ls.stdout.trim() || 'Failed to list deployments')\r\n        let depUrl: string | undefined\r\n        try {\r\n          const arr = JSON.parse(ls.stdout) as Array<Record<string, unknown>>\r\n          let chosen: Record<string, unknown> | undefined\r\n          if (Array.isArray(arr) && arr.length > 0) {\r\n            if (opts.sha) {\r\n              const needle = opts.sha.toLowerCase()\r\n              chosen = arr.find((it) => JSON.stringify(it).toLowerCase().includes(needle)) as Record<string, unknown> | undefined\r\n            }\r\n            if (!chosen) chosen = arr[0] as Record<string, unknown>\r\n            const urlFrag: unknown = (chosen as { url?: unknown }).url\r\n            if (typeof urlFrag === 'string') depUrl = urlFrag.startsWith('http') ? urlFrag : `https://${urlFrag}`\r\n          }\r\n        } catch {\r\n          const m = ls.stdout.match(/https?:\\/\\/[^\\s]+vercel\\.app/)\r\n          if (m) depUrl = m[0]\r\n        }\r\n        if (!depUrl) throw new Error('No recent deployment found')\r\n        // Resolve Inspect URL\r\n        const insp = await runWithRetry({ cmd: `vercel inspect ${depUrl}`, cwd: runCwd }, { timeoutMs: stepTimeoutV })\r\n        if (!insp.ok) throw new Error(insp.stderr.trim() || insp.stdout.trim() || 'Failed to fetch inspect info')\r\n        const inspectRe2 = /https?:\\/\\/[^\\s]*vercel\\.com[^\\s]*/g\r\n        const im = insp.stdout.match(inspectRe2)\r\n        const inspectUrl: string | undefined = im?.[0]\r\n        const isNdjsonV: boolean = process.env.OPD_NDJSON === '1'\r\n        if (opts.follow === true) {\r\n          // Tail runtime logs via adapter; emit high-level NDJSON events if enabled\r\n          if (isNdjsonV) logger.json({ event: 'logs:start', provider: 'vercel', url: depUrl, inspectUrl })\r\n          const spV = (!isNdjsonV && process.env.OPD_JSON !== '1') ? spinner('Vercel: logs') : null\r\n          try {\r\n            // Logs follow remains implemented via `vercel logs` below; keep existing spawn behavior when follow=false.\r\n            // For follow=true here we continue to use `vercel logs` directly to avoid adapter usage.\r\n            const envFlag = (opts.env === 'prod' ? '--prod' : '')\r\n            const since = opts.since ? ` --since ${opts.since}` : ''\r\n            const follow = ' -f'\r\n            const cmd = `vercel logs ${depUrl}${follow}${since} ${envFlag}`.trim()\r\n            const ctrl = proc.spawnStream({ cmd, cwd: runCwd })\r\n            await ctrl.done\r\n            if (spV) spV.succeed('Vercel: logs end')\r\n            if (isNdjsonV) logger.json({ event: 'logs:end', ok: true, final: true })\r\n            process.exitCode = 0\r\n          } catch (e) {\r\n            if (spV) spV.fail('Vercel: logs error')\r\n            if (isNdjsonV) logger.json({ event: 'logs:end', ok: false, error: String(e instanceof Error ? e.message : e), final: true })\r\n            process.exitCode = 1\r\n          }\r\n          return\r\n        }\r\n        // Non-follow: print or JSON/NDJSON emit\r\n        if (opts.json === true || isNdjsonV) {\r\n          logger.json({ ok: true, command: 'logs', provider: 'vercel', env: opts.env ?? 'prod', url: depUrl, inspectUrl, project: opts.project, org: opts.org, final: true })\r\n        } else {\r\n          if (inspectUrl) logger.success(`Inspect: ${inspectUrl}`)\r\n          else logger.info('Inspect information printed above.')\r\n        }\r\n        if (opts.open === true && inspectUrl) {\r\n          const opener: string = process.platform === 'win32' ? `start \"\" \"${inspectUrl}\"` : process.platform === 'darwin' ? `open \"${inspectUrl}\"` : `xdg-open \"${inspectUrl}\"`\r\n          void proc.run({ cmd: opener, cwd: runCwd })\r\n        }\r\n      } catch (err) {\r\n        const raw: string = err instanceof Error ? err.message : String(err)\r\n        const info = mapProviderError(provider, raw)\r\n        if (process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1') {\r\n          logger.json({ ok: false, command: 'logs', provider, code: info.code, message: info.message, remedy: info.remedy, error: raw, final: true })\r\n        }\r\n        logger.error(`${info.message} (${info.code})`)\r\n        if (info.remedy) logger.info(`Try: ${info.remedy}`)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n\r\n  // Quick-win: open provider dashboard for project\r\n  program\r\n    .command('open')\r\n    .description('Open the project dashboard on the provider')\r\n    .argument('<provider>', 'Target provider: vercel | github | cloudflare')\r\n    .option('--project <id>', 'Provider project/site ID')\r\n    .option('--org <id>', 'Provider org/team ID (vercel)')\r\n    .option('--path <dir>', 'Path to app directory (for monorepos)')\r\n    .action(async (provider: string, opts: { project?: string; org?: string; path?: string }): Promise<void> => {\r\n      const rootCwd: string = process.cwd()\r\n      const targetCwd: string = opts.path ? join(rootCwd, opts.path) : rootCwd\r\n      try {\r\n        if (provider === 'vercel') {\r\n          // Choose cwd similar to deploy\r\n          const targetLink: string = join(targetCwd, '.vercel', 'project.json')\r\n          const rootLink: string = join(rootCwd, '.vercel', 'project.json')\r\n          const targetIsLinked: boolean = await fsx.exists(targetLink)\r\n          const rootIsLinked: boolean = await fsx.exists(rootLink)\r\n          const runCwd: string = targetIsLinked ? targetCwd : (rootIsLinked && !targetIsLinked ? rootCwd : targetCwd)\r\n          if (opts.project || opts.org) {\r\n            const linkFlags: string[] = ['--yes']\r\n            if (opts.project) linkFlags.push(`--project ${opts.project}`)\r\n            if (opts.org) linkFlags.push(`--org ${opts.org}`)\r\n            await proc.run({ cmd: `vercel link ${linkFlags.join(' ')}`, cwd: runCwd })\r\n          }\r\n          const plugin = await loadProvider('vercel')\r\n          await plugin.open({ projectId: opts.project, orgId: opts.org })\r\n          logger.success('Opened Vercel dashboard')\r\n          return\r\n        }\r\n        if (provider === 'cloudflare') {\r\n          // Infer project name from wrangler.toml or folder name\r\n          const wranglerPath = join(targetCwd, 'wrangler.toml')\r\n          let projectName: string | undefined\r\n          try {\r\n            if (await fsx.exists(wranglerPath)) {\r\n              const raw = await (await import('node:fs/promises')).readFile(wranglerPath, 'utf8')\r\n              const m = raw.match(/\\bname\\s*=\\s*\"([^\"]+)\"/)\r\n              if (m && m[1]) projectName = m[1]\r\n            }\r\n          } catch { /* ignore */ }\r\n          if (!projectName) {\r\n            const base = targetCwd.replace(/\\\\/g,'/').split('/').filter(Boolean).pop() || 'site'\r\n            projectName = base.toLowerCase().replace(/[^a-z0-9-]/g,'-').replace(/--+/g,'-').replace(/^-+|-+$/g,'')\r\n          }\r\n          // Get account id\r\n          let accountId: string | undefined\r\n          try {\r\n            const who = await runWithRetry({ cmd: 'wrangler whoami', cwd: targetCwd }, { timeoutMs: 60_000 })\r\n            if (who.ok) {\r\n              const text = (who.stdout + '\\n' + who.stderr).trim()\r\n              const m = text.match(/account\\s*id\\s*[:=]\\s*([a-z0-9]+)/i)\r\n              if (m && m[1]) accountId = m[1]\r\n            }\r\n          } catch { /* ignore */ }\r\n          if (!accountId) { logger.error('Could not determine Cloudflare account id (run: wrangler login)'); process.exitCode = 1; return }\r\n          const dashUrl = `https://dash.cloudflare.com/${accountId}/pages/view/${projectName}`\r\n          const opener: string = process.platform === 'win32' ? `start \"\" \"${dashUrl}\"` : process.platform === 'darwin' ? `open \"${dashUrl}\"` : `xdg-open \"${dashUrl}\"`\r\n          void proc.run({ cmd: opener, cwd: targetCwd })\r\n          logger.success(`Opened Cloudflare Pages dashboard: ${dashUrl}`)\r\n          return\r\n        }\r\n        if (provider === 'github') {\r\n          // Infer GitHub Pages URL from env or git origin\r\n          const ghEnv: string | undefined = process.env.GITHUB_REPOSITORY\r\n          let owner: string | undefined\r\n          let repo: string | undefined\r\n          if (ghEnv && ghEnv.includes('/')) { const [o, r] = ghEnv.split('/'); owner = o; repo = r }\r\n          if (!owner || !repo) {\r\n            try {\r\n              const origin = await proc.run({ cmd: 'git remote get-url origin', cwd: targetCwd })\r\n              if (origin.ok) {\r\n                const t = origin.stdout.trim()\r\n                const httpsRe = /^https?:\\/\\/github\\.com\\/(.+?)\\/(.+?)(?:\\.git)?$/i\r\n                const sshRe = /^git@github\\.com:(.+?)\\/(.+?)(?:\\.git)?$/i\r\n                const m1 = t.match(httpsRe); const m2 = t.match(sshRe)\r\n                owner = (m1?.[1] || m2?.[1] || '').trim()\r\n                repo = (m1?.[2] || m2?.[2] || '').trim()\r\n              }\r\n            } catch { /* ignore */ }\r\n          }\r\n          if (!owner || !repo) { logger.error('Could not infer GitHub repository (set GITHUB_REPOSITORY or ensure origin remote).'); process.exitCode = 1; return }\r\n          const siteUrl: string = repo.toLowerCase() === `${owner.toLowerCase()}.github.io` ? `https://${owner}.github.io/` : `https://${owner}.github.io/${repo}/`\r\n          const opener: string = process.platform === 'win32' ? `start \"\" \"${siteUrl}\"` : process.platform === 'darwin' ? `open \"${siteUrl}\"` : `xdg-open \"${siteUrl}\"`\r\n          void proc.run({ cmd: opener, cwd: targetCwd })\r\n          logger.success(`Opened: ${siteUrl}`)\r\n          return\r\n        }\r\n        // Unknown provider\r\n        logger.error(`Unknown provider: ${provider}`)\r\n        process.exitCode = 1\r\n      } catch (err) {\r\n        const raw: string = err instanceof Error ? err.message : String(err)\r\n        const info = mapProviderError(provider, raw)\r\n        if (process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1') {\r\n          logger.json({ ok: false, command: 'logs', provider, code: info.code, message: info.message, remedy: info.remedy, error: raw, final: true })\r\n        }\r\n        logger.error(`${info.message} (${info.code})`)\r\n        if (info.remedy) logger.info(`Try: ${info.remedy}`)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n    \r\n}\r\n","/**\r\n * Progress heartbeat utility.\r\n * Emits periodic informational logs with elapsed time to indicate the tool is still working.\r\n *\r\n * Behavior:\r\n * - Disabled automatically when JSON/NDJSON or quiet mode is enabled.\r\n * - Uses logger.info for human-friendly lines; timestamps are prepended if --timestamps is on via logger.\r\n */\r\nimport { colors } from './colors'\r\nimport { logger } from './logger'\r\n\r\nexport interface HeartbeatOptions {\r\n  /** Short label for the activity, e.g. \"vercel deploy\" */\r\n  readonly label: string\r\n  /** Optional hint for the user, e.g. \"use: opendeploy open vercel\" */\r\n  readonly hint?: string\r\n  /** Interval in milliseconds between heartbeats (default: 10000) */\r\n  readonly intervalMs?: number\r\n}\r\n\r\nexport type Stopper = () => void\r\n\r\n/**\r\n * Start a periodic heartbeat. Returns a function to stop it.\r\n */\r\nexport function startHeartbeat(opts: HeartbeatOptions): Stopper {\r\n  // Respect global output modes\r\n  const isNdjson: boolean = process.env.OPD_NDJSON === '1'\r\n  const isJsonOnly: boolean = process.env.OPD_JSON === '1'\r\n  const isQuiet: boolean = process.env.OPD_QUIET === '1'\r\n  const isTty: boolean = Boolean(process.stdout && process.stdout.isTTY)\r\n  const intervalMs: number = opts.intervalMs ?? (isNdjson ? 5000 : 10000)\r\n  if (isQuiet) return (): void => {}\r\n  if (isTty) return (): void => {}\r\n  if (isJsonOnly && !isNdjson) return (): void => {}\r\n  const t0: number = Date.now()\r\n  if (isNdjson) {\r\n    const tick = (): void => {\r\n      const elapsed: number = Date.now() - t0\r\n      logger.json({ event: 'heartbeat', label: opts.label, elapsedMs: elapsed, hint: opts.hint })\r\n    }\r\n    const timer: NodeJS.Timeout = setInterval(tick, intervalMs)\r\n    return (): void => { clearInterval(timer) }\r\n  }\r\n  const tick = (): void => {\r\n    const elapsed: number = Date.now() - t0\r\n    const mins: number = Math.floor(elapsed / 60000)\r\n    const secs: number = Math.floor((elapsed % 60000) / 1000)\r\n    process.stdout.write(`\\n${colors.dim('…')} ${opts.label} still running (${mins}m ${secs}s). ${opts.hint ?? ''}\\n`)\r\n  }\r\n  const timer: NodeJS.Timeout = setInterval(tick, intervalMs)\r\n  return (): void => { clearInterval(timer) }\r\n}\r\n","/**\r\n * Minimal TTY spinner with safe fallbacks.\r\n * Auto-disables under JSON/NDJSON/quiet or when stdout is not a TTY.\r\n */\r\nexport interface Spinner {\r\n  readonly succeed: (msg?: string) => void\r\n  readonly fail: (msg?: string) => void\r\n  readonly stop: (msg?: string) => void\r\n  readonly update: (msg: string) => void\r\n}\r\n\r\nfunction canSpin(): boolean {\r\n  if (process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1' || process.env.OPD_QUIET === '1') return false\r\n  return Boolean(process.stdout && process.stdout.isTTY)\r\n}\r\n\r\nconst FRAMES: readonly string[] = ['⠋', '⠙', '⠹', '⠸', '⠼', '⠴', '⠦', '⠧', '⠇', '⠏']\r\n\r\nexport function spinner(label: string): Spinner {\r\n  if (!canSpin()) {\r\n    // No-op spinner for non-TTY / JSON modes\r\n    return {\r\n      succeed: (_msg?: string): void => {},\r\n      fail: (_msg?: string): void => {},\r\n      stop: (_msg?: string): void => {},\r\n      update: (_msg: string): void => {},\r\n    }\r\n  }\r\n  let i = 0\r\n  let text: string = label\r\n  const tick = (): void => {\r\n    const frame = FRAMES[i = (i + 1) % FRAMES.length]\r\n    const line = `${frame} ${text}`\r\n    process.stdout.write(`\\r${line}`)\r\n  }\r\n  const timer: NodeJS.Timeout = setInterval(tick, 120)\r\n  tick()\r\n  const clear = (): void => {\r\n    clearInterval(timer)\r\n    process.stdout.write('\\r')\r\n  }\r\n  const writeLine = (line: string): void => {\r\n    process.stdout.write(`${line}\\n`)\r\n  }\r\n  return {\r\n    succeed: (msg?: string): void => { clear(); writeLine(msg ?? `${label} done`) },\r\n    fail: (msg?: string): void => { clear(); writeLine(msg ?? `${label} failed`) },\r\n    stop: (msg?: string): void => { clear(); if (msg) writeLine(msg) },\r\n    update: (msg: string): void => { text = msg },\r\n  }\r\n}\r\n","import { Command } from 'commander'\r\nimport { join } from 'node:path'\r\nimport { mkdtemp, rm, writeFile } from 'node:fs/promises'\r\nimport { tmpdir } from 'node:os'\r\nimport { parseEnvFile } from '../core/secrets/env'\r\nimport { logger } from '../utils/logger'\r\nimport { formatDiffHuman } from '../utils/format'\r\nimport { spinner } from '../utils/ui'\r\nimport { mapProviderError } from '../utils/errors'\r\nimport { isJsonMode } from '../utils/logger'\r\nimport { printEnvPullSummary, printEnvSyncSummary, printEnvDiffSummary } from '../utils/summarize'\r\nimport { confirm } from '../utils/prompt'\r\nimport { proc, runWithRetry } from '../utils/process'\r\nimport { fsx } from '../utils/fs'\r\nimport { getCached, setCached } from '../utils/cache'\r\nimport Ajv from 'ajv'\r\nimport { envSummarySchema } from '../schemas/env-summary.schema'\r\n\r\ntype EnvTarget = 'prod' | 'preview' | 'development' | 'all'\r\n\r\ninterface SyncOptions {\r\n  readonly file?: string\r\n  readonly env?: EnvTarget\r\n  readonly yes?: boolean\r\n  readonly dryRun?: boolean\r\n  readonly json?: boolean\r\n  readonly ci?: boolean\r\n  readonly projectId?: string\r\n  readonly orgId?: string\r\n  readonly ignore?: string\r\n  readonly only?: string\r\n  readonly failOnAdd?: boolean\r\n  readonly failOnRemove?: boolean\r\n  readonly optimizeWrites?: boolean\r\n  readonly map?: string\r\n  readonly printCmd?: boolean\r\n  readonly retries?: string\r\n  readonly timeoutMs?: string\r\n  readonly baseDelayMs?: string\r\n}\r\n\r\n// Ajv validator for env summaries (top-level so helpers can use it)\r\nconst envAjv = new Ajv({ allErrors: true, strict: false, validateSchema: false })\r\nconst envSchemaValidate = envAjv.compile(envSummarySchema as unknown as object)\r\nfunction annotateEnv(obj: Record<string, unknown>): Record<string, unknown> {\r\n  const ok: boolean = envSchemaValidate(obj) as boolean\r\n  const errs: string[] = Array.isArray(envSchemaValidate.errors) ? envSchemaValidate.errors.map(e => `${e.instancePath || '/'} ${e.message ?? ''}`.trim()) : []\r\n  if (process.env.OPD_SCHEMA_STRICT === '1' && errs.length > 0) { process.exitCode = 1 }\r\n  return { ...obj, schemaOk: ok, schemaErrors: errs }\r\n}\r\n\r\n// ---------------- Cloudflare Pages env sync ----------------\r\nasync function getCfProjectName(cwd: string, projectName?: string): Promise<string> {\r\n  if (projectName && projectName.length > 0) return projectName\r\n  try {\r\n    const raw = await (await import('node:fs/promises')).readFile(join(cwd, 'wrangler.toml'), 'utf8')\r\n    const m = raw.match(/\\bname\\s*=\\s*\"([^\"]+)\"/)\r\n    if (m && m[1]) return m[1]\r\n  } catch { /* ignore */ }\r\n  const base = cwd.replace(/\\\\/g,'/').split('/').filter(Boolean).pop() || 'site'\r\n  return base.toLowerCase().replace(/[^a-z0-9-]/g,'-').replace(/--+/g,'-').replace(/^-+|-+$/g,'')\r\n}\r\n\r\nasync function syncCloudflare(args: { readonly cwd: string; readonly file: string; readonly yes: boolean; readonly dryRun: boolean; readonly json: boolean; readonly ci: boolean; readonly projectName?: string; readonly ignore?: readonly string[]; readonly only?: readonly string[]; readonly mapFile?: string; readonly printCmd?: boolean }): Promise<void> {\r\n  const envPath: string = join(args.cwd, args.file)\r\n  const original = await parseEnvFile({ path: envPath })\r\n  const kv = await applyEnvMapping({ cwd: args.cwd, kv: original, mapFile: args.mapFile })\r\n  const entriesAll = Object.entries(kv)\r\n  const entries = entriesAll.filter(([k]) => allowKey(k, args.only ?? [], args.ignore ?? []))\r\n  if (entries.length === 0) { logger.warn(`No variables found in ${args.file}. Nothing to sync.`); return }\r\n  const project = await getCfProjectName(args.cwd, args.projectName)\r\n  const results: Array<{ key: string; status: 'set' | 'skipped' | 'failed'; error?: string }> = []\r\n  for (const [key, value] of entries) {\r\n    const go = args.yes === true || args.ci === true || args.dryRun === true ? true : await confirm(`Set ${key}=${mask(value)} to Cloudflare Pages?`, { defaultYes: true })\r\n    if (!go) continue\r\n    if (args.dryRun === true) { logger.info(`[dry-run] wrangler pages project secret put ${key} --project-name ${project}`); results.push({ key, status: 'skipped' }); continue }\r\n    const cmd = `wrangler pages project secret put ${key} --project-name ${project} --value ${JSON.stringify(value)}`\r\n    if (args.printCmd) logger.info(`$ ${cmd}`)\r\n    const res = await runWithRetry({ cmd, cwd: args.cwd })\r\n    if (res.ok) { logger.success(`Set ${key}`); results.push({ key, status: 'set' }) }\r\n    else { const errMsg: string = res.stderr.trim() || res.stdout.trim(); logger.warn(`Failed to set ${key}: ${errMsg}`); results.push({ key, status: 'failed', error: errMsg }) }\r\n  }\r\n  if (args.json === true) {\r\n    const ok = results.every(r => r.status !== 'failed')\r\n    logger.jsonPrint(annotateEnv({ ok, action: 'env' as const, subcommand: 'sync' as const, provider: 'cloudflare' as const, file: args.file, envs: results, final: true }))\r\n  } else {\r\n    const setCount = results.filter(r => r.status === 'set').length\r\n    const skippedCount = results.filter(r => r.status === 'skipped').length\r\n    const failedCount = results.filter(r => r.status === 'failed').length\r\n    printEnvSyncSummary({ provider: 'cloudflare', file: args.file, setCount, skippedCount, failedCount })\r\n  }\r\n}\r\n\r\n// Programmatic wrappers for use by other commands (e.g., run)\r\nexport async function envSync(opts: {\r\n  readonly provider: 'vercel' | 'cloudflare'\r\n  readonly cwd: string\r\n  readonly file: string\r\n  readonly env: EnvTarget\r\n  readonly yes?: boolean\r\n  readonly dryRun?: boolean\r\n  readonly json?: boolean\r\n  readonly ci?: boolean\r\n  readonly projectId?: string\r\n  readonly orgId?: string\r\n  readonly ignore?: readonly string[]\r\n  readonly only?: readonly string[]\r\n  readonly failOnAdd?: boolean\r\n  readonly failOnRemove?: boolean\r\n  readonly optimizeWrites?: boolean\r\n  readonly mapFile?: string\r\n}): Promise<void> {\r\n  if (opts.provider === 'vercel') {\r\n    await syncVercel({\r\n      cwd: opts.cwd,\r\n      file: opts.file,\r\n      env: opts.env,\r\n      yes: opts.yes === true,\r\n      dryRun: opts.dryRun === true,\r\n      json: opts.json === true,\r\n      ci: opts.ci === true,\r\n      projectId: opts.projectId,\r\n      orgId: opts.orgId,\r\n      ignore: opts.ignore,\r\n      only: opts.only,\r\n      failOnAdd: opts.failOnAdd,\r\n      failOnRemove: opts.failOnRemove,\r\n      optimizeWrites: opts.optimizeWrites,\r\n      mapFile: opts.mapFile,\r\n    })\r\n    return\r\n  }\r\n  await syncCloudflare({\r\n    cwd: opts.cwd,\r\n    file: opts.file,\r\n    yes: opts.yes === true,\r\n    dryRun: opts.dryRun === true,\r\n    json: opts.json === true,\r\n    ci: opts.ci === true,\r\n    projectName: opts.projectId,\r\n    ignore: opts.ignore,\r\n    only: opts.only,\r\n    mapFile: opts.mapFile,\r\n  })\r\n}\r\n\r\nexport async function envDiff(opts: {\r\n  readonly provider: 'vercel'\r\n  readonly cwd: string\r\n  readonly file: string\r\n  readonly env: EnvTarget\r\n  readonly json?: boolean\r\n  readonly ci?: boolean\r\n  readonly projectId?: string\r\n  readonly orgId?: string\r\n  readonly ignore?: readonly string[]\r\n  readonly only?: readonly string[]\r\n  readonly failOnAdd?: boolean\r\n  readonly failOnRemove?: boolean\r\n}): Promise<void> {\r\n  await diffVercel({\r\n    cwd: opts.cwd,\r\n    file: opts.file,\r\n    env: opts.env,\r\n    json: opts.json === true,\r\n    ci: opts.ci === true,\r\n    projectId: opts.projectId,\r\n    orgId: opts.orgId,\r\n    ignore: opts.ignore,\r\n    only: opts.only,\r\n    failOnAdd: opts.failOnAdd,\r\n    failOnRemove: opts.failOnRemove,\r\n  })\r\n}\r\n\r\nasync function ensureLinked(args: { readonly cwd: string; readonly projectId?: string; readonly orgId?: string; readonly printCmd?: boolean }): Promise<void> {\r\n  const flags: string[] = ['--yes']\r\n  if (args.projectId) flags.push(`--project ${args.projectId}`)\r\n  if (args.orgId) flags.push(`--org ${args.orgId}`)\r\n  const linkCmd = `vercel link ${flags.join(' ')}`.trim()\r\n  if (args.printCmd) logger.info(`$ ${linkCmd}`)\r\n  const res = await runWithRetry({ cmd: linkCmd, cwd: args.cwd })\r\n  if (!res.ok && !res.stdout.toLowerCase().includes('already linked')) {\r\n    throw new Error('Project not linked to Vercel. Run: vercel link')\r\n  }\r\n}\r\n\r\nasync function pullVercel(args: { readonly cwd: string; readonly env: EnvTarget; readonly out?: string; readonly json: boolean; readonly ci: boolean; readonly projectId?: string; readonly orgId?: string; readonly printCmd?: boolean }): Promise<void> {\r\n  const sp = spinner('Vercel: pulling env')\r\n  const vercelEnv: 'production' | 'preview' | 'development' = (args.env === 'prod' ? 'production' : args.env === 'preview' ? 'preview' : 'development')\r\n  const outFile: string = args.out ?? defaultOutFile(args.env)\r\n  // Ensure linked project (non-dry operation by nature)\r\n  await ensureLinked({ cwd: args.cwd, projectId: args.projectId, orgId: args.orgId, printCmd: args.printCmd })\r\n  const pullCmd = `vercel env pull ${outFile} --environment ${vercelEnv}`\r\n  if (args.printCmd) logger.info(`$ ${pullCmd}`)\r\n  const res = await runWithRetry({ cmd: pullCmd, cwd: args.cwd })\r\n  if (!res.ok) throw new Error(res.stderr.trim() || res.stdout.trim() || 'Failed to pull env from Vercel')\r\n  if (args.json === true) logger.jsonPrint(annotateEnv({ ok: true, action: 'env' as const, subcommand: 'pull' as const, provider: 'vercel' as const, environment: vercelEnv, out: outFile, final: true }))\r\n  else {\r\n    sp.succeed(`Vercel: pulled to ${outFile}`)\r\n    logger.success(`Pulled ${vercelEnv} env to ${outFile}`)\r\n    try { const parsed = await parseEnvFile({ path: join(args.cwd, outFile) }); printEnvPullSummary({ provider: 'vercel', env: (args.env === 'prod' ? 'prod' : args.env === 'preview' ? 'preview' : 'development'), out: outFile, count: Object.keys(parsed).length }) } catch { /* ignore count */ }\r\n  }\r\n}\r\n\r\nfunction toVercelEnv(t: EnvTarget): readonly string[] {\r\n  if (t === 'all') return ['production', 'preview'] as const\r\n  if (t === 'prod') return ['production'] as const\r\n  if (t === 'preview') return ['preview'] as const\r\n  return ['development'] as const\r\n}\r\n\r\nfunction defaultOutFile(t: EnvTarget): string {\r\n  if (t === 'prod') return '.env.production.local'\r\n  if (t === 'preview') return '.env.preview.local'\r\n  if (t === 'development') return '.env.local'\r\n  return '.env.local'\r\n}\r\n\r\nfunction mask(val: string): string {\r\n  if (val.length <= 4) return '*'.repeat(val.length)\r\n  return `${val.slice(0, 2)}****${val.slice(-2)}`\r\n}\r\n\r\nexport function toPatterns(list?: string): readonly string[] {\r\n  if (!list) return []\r\n  return list.split(',').map(s => s.trim()).filter(Boolean)\r\n}\r\n\r\nexport function matchPattern(str: string, pattern: string): boolean {\r\n  // Simple glob: * => .*, escape others\r\n  const escaped = pattern.replace(/[.+^${}()|[\\]\\\\]/g, '\\\\$&').replace(/\\*/g, '.*')\r\n  const re = new RegExp(`^${escaped}$`, 'i')\r\n  return re.test(str)\r\n}\r\n\r\nexport function allowKey(key: string, only: readonly string[], ignore: readonly string[]): boolean {\r\n  if (only.length > 0 && !only.some(p => matchPattern(key, p))) return false\r\n  if (ignore.length > 0 && ignore.some(p => matchPattern(key, p))) return false\r\n  return true\r\n}\r\n\r\ntype MappingSpec = {\r\n  readonly rename?: Record<string, string>\r\n  readonly transform?: Record<string, 'base64' | 'trim' | 'upper' | 'lower'>\r\n}\r\n\r\nasync function applyEnvMapping(args: { readonly cwd: string; readonly kv: Record<string, string>; readonly mapFile?: string }): Promise<Record<string, string>> {\r\n  if (!args.mapFile) return args.kv\r\n  const p: string = join(args.cwd, args.mapFile)\r\n  let spec: MappingSpec | null = null\r\n  try {\r\n    spec = await fsx.readJson<MappingSpec>(p)\r\n  } catch { /* ignore invalid mapping file */ }\r\n  if (spec === null) return args.kv\r\n  const out: Record<string, string> = {}\r\n  const ren: Record<string, string> = spec.rename ?? {}\r\n  const tf: Record<string, 'base64' | 'trim' | 'upper' | 'lower'> = spec.transform ?? {}\r\n  for (const [k, v] of Object.entries(args.kv)) {\r\n    const preT: string = tf[k] ? applyTransform(v, tf[k]) : v\r\n    const newKey: string = ren[k] ?? k\r\n    const postT: string = tf[newKey] ? applyTransform(preT, tf[newKey]) : preT\r\n    out[newKey] = postT\r\n  }\r\n  return out\r\n}\r\n\r\nfunction applyTransform(val: string, kind: 'base64' | 'trim' | 'upper' | 'lower'): string {\r\n  if (kind === 'base64') return Buffer.from(val, 'utf8').toString('base64')\r\n  if (kind === 'trim') return val.trim()\r\n  if (kind === 'upper') return val.toUpperCase()\r\n  if (kind === 'lower') return val.toLowerCase()\r\n  return val\r\n}\r\n\r\nasync function syncVercel(args: { readonly cwd: string; readonly file: string; readonly env: EnvTarget; readonly yes: boolean; readonly dryRun: boolean; readonly json: boolean; readonly ci: boolean; readonly projectId?: string; readonly orgId?: string; readonly ignore?: readonly string[]; readonly only?: readonly string[]; readonly failOnAdd?: boolean; readonly failOnRemove?: boolean; readonly optimizeWrites?: boolean; readonly mapFile?: string; readonly printCmd?: boolean }): Promise<void> {\r\n  const envPath: string = join(args.cwd, args.file)\r\n  const original = await parseEnvFile({ path: envPath })\r\n  const kv = await applyEnvMapping({ cwd: args.cwd, kv: original, mapFile: args.mapFile })\r\n  const entriesAll = Object.entries(kv)\r\n  const entries = entriesAll.filter(([k]) => allowKey(k, args.only ?? [], args.ignore ?? []))\r\n  if (entries.length === 0) {\r\n    logger.warn(`No variables found in ${args.file}. Nothing to sync.`)\r\n    return\r\n  }\r\n  // Ensure linked project (vercel link) unless dry-run\r\n  if (!args.dryRun) {\r\n    try { await ensureLinked({ cwd: args.cwd, projectId: args.projectId, orgId: args.orgId, printCmd: args.printCmd }) } catch (e) { logger.warn('Project may not be linked. Run `vercel link` if sync fails.') }\r\n  }\r\n  // If strict flags are present, compute diff against remote and set exit code when violated\r\n  if ((args.failOnAdd || args.failOnRemove) && !args.dryRun) {\r\n    const vercelEnv: 'production' | 'preview' | 'development' = (args.env === 'prod' ? 'production' : args.env === 'preview' ? 'preview' : 'development')\r\n    const tmpDir: string = await mkdtemp(join(tmpdir(), 'opendeploy-'))\r\n    const tmpFile: string = join(tmpDir, `.env.remote.${vercelEnv}`)\r\n    const pullCmd = `vercel env pull ${tmpFile} --environment ${vercelEnv}`\r\n    if (args.printCmd) logger.info(`$ ${pullCmd}`)\r\n    const pulled = await runWithRetry({ cmd: pullCmd, cwd: args.cwd })\r\n    if (pulled.ok) {\r\n      const remote = await parseEnvFile({ path: tmpFile })\r\n      await rm(tmpDir, { recursive: true, force: true })\r\n      const localMap: Record<string, string> = Object.fromEntries(entries)\r\n      const keys = new Set([...Object.keys(localMap), ...Object.keys(remote)])\r\n      let addCount = 0; let removeCount = 0\r\n      for (const k of keys) {\r\n        const inLocal = localMap[k] !== undefined\r\n        const inRemote = remote[k] !== undefined\r\n        if (inLocal && !inRemote) addCount++\r\n        if (!inLocal && inRemote) removeCount++\r\n      }\r\n      if ((args.failOnAdd && addCount > 0) || (args.failOnRemove && removeCount > 0)) {\r\n        process.exitCode = 1\r\n      }\r\n    }\r\n  }\r\n  const targets: readonly string[] = toVercelEnv(args.env)\r\n  // Optimize writes: fetch remote maps once per target and skip same-values\r\n  const remoteByEnv: Record<string, Record<string, string>> = {}\r\n  if (args.optimizeWrites === true && !args.dryRun) {\r\n    for (const t of targets) {\r\n      try {\r\n        const cacheKey = `vercel:env:${t}`\r\n        const cached = await getCached<Record<string, string>>({ cwd: args.cwd, key: cacheKey, ttlMs: 60_000 })\r\n        if (cached) { remoteByEnv[t] = cached; continue }\r\n        const tmpDir: string = await mkdtemp(join(tmpdir(), 'opendeploy-remote-'))\r\n        const tmpFile: string = join(tmpDir, `.env.remote.${t}`)\r\n        const pullCmd = `vercel env pull ${tmpFile} --environment ${t}`\r\n        if (args.printCmd) logger.info(`$ ${pullCmd}`)\r\n        const pulled = await runWithRetry({ cmd: pullCmd, cwd: args.cwd })\r\n        if (pulled.ok) {\r\n          const m = await parseEnvFile({ path: tmpFile })\r\n          remoteByEnv[t] = m\r\n          await setCached({ cwd: args.cwd, key: cacheKey, value: m })\r\n        }\r\n        await rm(tmpDir, { recursive: true, force: true })\r\n      } catch { /* ignore and continue without optimization for this env */ }\r\n    }\r\n  }\r\n  const results: Array<{ key: string; environments: string[]; status: 'set' | 'skipped' | 'failed'; error?: string }> = []\r\n  for (const [key, value] of entries) {\r\n    const go = args.yes === true || args.ci === true || args.dryRun === true\r\n      ? true\r\n      : await confirm(`Set ${key}=${mask(value)} to Vercel?`, { defaultYes: true })\r\n    if (!go) continue\r\n    const touched: string[] = []\r\n    for (const t of targets) {\r\n      if (args.dryRun === true) {\r\n        logger.info(`[dry-run] vercel env set ${key} (${t}) ← ${mask(value)}`)\r\n        touched.push(t)\r\n        continue\r\n      }\r\n      // Skip if optimize-writes and remote value matches\r\n      if (args.optimizeWrites === true && remoteByEnv[t] && remoteByEnv[t][key] === value) {\r\n        logger.info(`Skip (same) ${key} in ${t}`)\r\n        touched.push(t)\r\n        continue\r\n      }\r\n      // Remove existing value (if any) to ensure clean update.\r\n      const rmCmd = `vercel env rm ${key} ${t} -y`\r\n      if (args.printCmd) logger.info(`$ ${rmCmd}`)\r\n      await runWithRetry({ cmd: rmCmd, cwd: args.cwd })\r\n      const addCmd = `vercel env add ${key} ${t}`\r\n      if (args.printCmd) logger.info(`$ ${addCmd}`)\r\n      const res = await runWithRetry({ cmd: addCmd, cwd: args.cwd, stdin: `${value}` })\r\n      if (res.ok) { logger.success(`Set ${key} in ${t}`); touched.push(t) }\r\n      else {\r\n        const errMsg: string = res.stderr.trim() || res.stdout.trim()\r\n        logger.warn(`Failed to set ${key} in ${t}: ${errMsg}`)\r\n      }\r\n    }\r\n    results.push({ key, environments: touched, status: touched.length > 0 ? (args.dryRun ? 'skipped' : 'set') : 'failed' })\r\n  }\r\n  if (args.json === true) {\r\n    const ok = results.every(r => r.status !== 'failed')\r\n    logger.jsonPrint(annotateEnv({ ok, action: 'env' as const, subcommand: 'sync' as const, provider: 'vercel' as const, file: args.file, envs: results, final: true }))\r\n  }\r\n  else {\r\n    const setCount = results.filter(r => r.status === 'set').length\r\n    const skippedCount = results.filter(r => r.status === 'skipped').length\r\n    const failedCount = results.filter(r => r.status === 'failed').length\r\n    printEnvSyncSummary({ provider: 'vercel', file: args.file, setCount, skippedCount, failedCount })\r\n  }\r\n}\r\n\r\nasync function diffVercel(args: { readonly cwd: string; readonly file: string; readonly env: EnvTarget; readonly json: boolean; readonly ci: boolean; readonly projectId?: string; readonly orgId?: string; readonly ignore?: readonly string[]; readonly only?: readonly string[]; readonly failOnAdd?: boolean; readonly failOnRemove?: boolean; readonly printCmd?: boolean }): Promise<void> {\r\n  const sp = spinner('Vercel: diffing env')\r\n  const localPath: string = join(args.cwd, args.file)\r\n  const allLocal = await parseEnvFile({ path: localPath })\r\n  // Filter local by patterns\r\n  const local: Record<string, string> = {}\r\n  for (const [k, v] of Object.entries(allLocal)) {\r\n    if (allowKey(k, args.only ?? [], args.ignore ?? [])) local[k] = v\r\n  }\r\n  await ensureLinked({ cwd: args.cwd, projectId: args.projectId, orgId: args.orgId })\r\n  const vercelEnv: 'production' | 'preview' | 'development' = (args.env === 'prod' ? 'production' : args.env === 'preview' ? 'preview' : 'development')\r\n  // Pull remote env into a temp file to read values\r\n  const tmpDir: string = await mkdtemp(join(tmpdir(), 'opendeploy-'))\r\n  const tmpFile: string = join(tmpDir, `.env.remote.${vercelEnv}`)\r\n  const pulled = await proc.run({ cmd: `vercel env pull ${tmpFile} --environment ${vercelEnv}`, cwd: args.cwd })\r\n  if (!pulled.ok) throw new Error(pulled.stderr.trim() || pulled.stdout.trim() || 'Failed to pull remote env')\r\n  const remote = await parseEnvFile({ path: tmpFile })\r\n  await rm(tmpDir, { recursive: true, force: true })\r\n  // Compute diff\r\n  const keys = Array.from(new Set([...Object.keys(local), ...Object.keys(remote)])).sort()\r\n  const added: string[] = [] // present locally but not remotely\r\n  const removed: string[] = [] // present remotely but not locally\r\n  const changed: Array<{ key: string; local: string; remote: string }> = []\r\n  for (const k of keys) {\r\n    const l = local[k]\r\n    const r = remote[k]\r\n    if (l === undefined && r !== undefined) removed.push(k)\r\n    else if (l !== undefined && r === undefined) added.push(k)\r\n    else if (l !== undefined && r !== undefined && l !== r) changed.push({ key: k, local: l, remote: r })\r\n  }\r\n  const ok: boolean = added.length === 0 && removed.length === 0 && changed.length === 0\r\n  if (args.json === true) {\r\n    logger.jsonPrint(annotateEnv({ ok, action: 'env' as const, subcommand: 'diff' as const, provider: 'vercel' as const, env: vercelEnv, added, removed, changed, final: true }))\r\n  } else {\r\n    sp.stop()\r\n    if (ok) logger.success('No differences between local file and remote environment.')\r\n    else logger.info('\\n' + formatDiffHuman({ added, removed, changed }))\r\n    const mappedEnv = vercelEnv === 'production' ? 'prod' : vercelEnv\r\n    const total = added.length + removed.length + changed.length\r\n    printEnvDiffSummary({\r\n      provider: 'vercel',\r\n      env: mappedEnv as 'prod' | 'preview' | 'development',\r\n      added: added.length,\r\n      removed: removed.length,\r\n      changed: changed.length,\r\n      ok,\r\n      addedKeys: total <= 10 ? added : undefined,\r\n      removedKeys: total <= 10 ? removed : undefined,\r\n      changedKeys: total <= 10 ? changed.map(c => c.key) : undefined\r\n    })\r\n    const inCI = args.ci === true || process.env.CI === 'true' || process.env.GITHUB_ACTIONS === 'true'\r\n    if (!ok && inCI) {\r\n      const addIsError = args.ci === true || args.failOnAdd === true\r\n      const removeIsError = args.ci === true || args.failOnRemove === true\r\n      const addTag = addIsError ? 'error' : 'warning'\r\n      const removeTag = removeIsError ? 'error' : 'warning'\r\n      const changedTag = args.ci === true ? 'error' : 'warning'\r\n      for (const k of added) console.log(`::${addTag} ::Only local: ${k}`)\r\n      for (const k of removed) console.log(`::${removeTag} ::Only remote: ${k}`)\r\n      for (const c of changed) console.log(`::${changedTag} ::Changed: ${c.key}`)\r\n    }\r\n  }\r\n  if (!ok && (args.ci === true || args.failOnAdd === true || args.failOnRemove === true)) {\r\n    const addHit = args.failOnAdd === true && added.length > 0\r\n    const removeHit = args.failOnRemove === true && removed.length > 0\r\n    if (args.ci === true || addHit || removeHit) process.exitCode = 1\r\n  }\r\n}\r\n\r\n/**\r\n * Register `env` command with `sync` for Vercel.\r\n */\r\nexport function registerEnvCommand(program: Command): void {\r\n  const env = program.command('env').description('Manage environment variables on providers')\r\n  env\r\n    .command('sync')\r\n    .description('Sync variables from a .env file to a provider')\r\n    .argument('<provider>', 'Target provider: vercel | cloudflare')\r\n    .option('--file <path>', 'Path to .env file', '.env')\r\n    .option('--env <target>', 'Environment: prod|preview|development|all', 'preview')\r\n    .option('--yes', 'Accept all prompts')\r\n    .option('--dry-run', 'Print changes without applying them')\r\n    .option('--json', 'Output JSON summary')\r\n    .option('--print-cmd', 'Print underlying provider commands that will be executed')\r\n    .option('--ci', 'CI mode (non-interactive, fail fast)')\r\n    .option('--project-id <id>', 'Provider project ID for non-interactive link')\r\n    .option('--org-id <id>', 'Provider org ID for non-interactive link')\r\n    .option('--ignore <patterns>', 'Comma-separated glob patterns to ignore (e.g. NEXT_PUBLIC_*)')\r\n    .option('--only <patterns>', 'Comma-separated glob patterns to include')\r\n    .option('--fail-on-add', 'Exit non-zero if new keys would be added')\r\n    .option('--fail-on-remove', 'Exit non-zero if keys are missing remotely')\r\n    .option('--optimize-writes', 'Only update keys that differ remotely (reduces API calls)')\r\n    .option('--map <file>', 'Mapping file for key rename and value transforms')\r\n    .option('--retries <n>', 'Retries for provider commands (default 2)')\r\n    .option('--timeout-ms <ms>', 'Timeout per provider command in milliseconds (default 120000)')\r\n    .option('--base-delay-ms <ms>', 'Base delay for exponential backoff with jitter (default 300)')\r\n    .action(async (provider: string, opts: SyncOptions): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      try {\r\n        if (opts.retries) process.env.OPD_RETRIES = String(Math.max(0, Number(opts.retries) || 0))\r\n        if (opts.timeoutMs) process.env.OPD_TIMEOUT_MS = String(Math.max(0, Number(opts.timeoutMs) || 0))\r\n        if (opts.baseDelayMs) process.env.OPD_BASE_DELAY_MS = String(Math.max(0, Number(opts.baseDelayMs) || 0))\r\n        const jsonMode: boolean = isJsonMode(opts.json)\r\n        if (jsonMode) logger.setJsonOnly(true)\r\n        const envTarget = (opts.env ?? 'preview') as EnvTarget\r\n        const prov = provider === 'cloudflare' ? 'cloudflare' : provider === 'vercel' ? 'vercel' : undefined\r\n        if (!prov) { logger.error(`Unknown provider: ${provider}`); process.exitCode = 1; return }\r\n        if (prov === 'vercel') {\r\n          await syncVercel({ cwd, file: opts.file ?? '.env', env: envTarget, yes: opts.yes === true, dryRun: opts.dryRun === true, json: jsonMode, ci: opts.ci === true, projectId: opts.projectId, orgId: opts.orgId, ignore: toPatterns(opts.ignore), only: toPatterns(opts.only), failOnAdd: opts.failOnAdd === true, failOnRemove: opts.failOnRemove === true, optimizeWrites: opts.optimizeWrites === true, mapFile: opts.map, printCmd: opts.printCmd === true })\r\n        } else {\r\n          await syncCloudflare({ cwd, file: opts.file ?? '.env', yes: opts.yes === true, dryRun: opts.dryRun === true, json: jsonMode, ci: opts.ci === true, projectName: opts.projectId, ignore: toPatterns(opts.ignore), only: toPatterns(opts.only), mapFile: opts.map, printCmd: opts.printCmd === true })\r\n        }\r\n      } catch (err) {\r\n        const raw: string = err instanceof Error ? err.message : String(err)\r\n        const prov = provider === 'cloudflare' ? 'cloudflare' : provider === 'vercel' ? 'vercel' : provider\r\n        const info = mapProviderError(prov, raw)\r\n        if (isJsonMode(opts.json)) {\r\n          logger.jsonPrint({ ok: false, action: 'env' as const, subcommand: 'sync' as const, provider: prov, code: info.code, message: info.message, remedy: info.remedy, error: raw, final: true })\r\n        }\r\n        logger.error(`${info.message} (${info.code})`)\r\n        if (info.remedy) logger.info(`Try: ${info.remedy}`)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n\r\n  env\r\n    .command('pull')\r\n    .description('Pull variables from a provider into a local .env file')\r\n    .argument('<provider>', 'Target provider: vercel')\r\n    .option('--env <target>', 'Environment: prod|preview|development', 'preview')\r\n    .option('--out <path>', 'Output file path (default depends on env)')\r\n    .option('--json', 'Output JSON summary')\r\n    .option('--ci', 'CI mode (non-interactive)')\r\n    .option('--project-id <id>', 'Provider project ID for non-interactive link')\r\n    .option('--org-id <id>', 'Provider org ID for non-interactive link')\r\n    .option('--ignore <patterns>', 'Comma-separated glob patterns to ignore (e.g. NEXT_PUBLIC_*)')\r\n    .option('--only <patterns>', 'Comma-separated glob patterns to include')\r\n    .option('--print-cmd', 'Print underlying provider commands that will be executed')\r\n    .option('--retries <n>', 'Retries for provider commands (default 2)')\r\n    .option('--timeout-ms <ms>', 'Timeout per provider command in milliseconds (default 120000)')\r\n    .option('--base-delay-ms <ms>', 'Base delay for exponential backoff with jitter (default 300)')\r\n    .action(async (provider: string, opts: { env?: EnvTarget; out?: string; json?: boolean; ci?: boolean; projectId?: string; orgId?: string; ignore?: string; only?: string; printCmd?: boolean; retries?: string; timeoutMs?: string; baseDelayMs?: string }): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      try {\r\n        if (opts.retries) process.env.OPD_RETRIES = String(Math.max(0, Number(opts.retries) || 0))\r\n        if (opts.timeoutMs) process.env.OPD_TIMEOUT_MS = String(Math.max(0, Number(opts.timeoutMs) || 0))\r\n        if (opts.baseDelayMs) process.env.OPD_BASE_DELAY_MS = String(Math.max(0, Number(opts.baseDelayMs) || 0))\r\n        const jsonMode: boolean = isJsonMode(opts.json)\r\n        if (jsonMode) logger.setJsonOnly(true)\r\n        const prov = provider === 'vercel' ? 'vercel' : undefined\r\n        if (!prov) { logger.error(`Unknown provider: ${provider}`); process.exitCode = 1; return }\r\n        const envTarget = (opts.env ?? 'preview') as EnvTarget\r\n        await pullVercel({ cwd, env: envTarget, out: opts.out, json: jsonMode, ci: opts.ci === true, projectId: opts.projectId, orgId: opts.orgId, printCmd: opts.printCmd === true })\r\n      } catch (err) {\r\n        const raw: string = err instanceof Error ? err.message : String(err)\r\n        const provName = provider === 'vercel' ? 'vercel' : provider\r\n        const info = mapProviderError(provName, raw)\r\n        if (isJsonMode(opts.json)) {\r\n          logger.jsonPrint({ ok: false, action: 'env' as const, subcommand: 'pull' as const, provider: provName, code: info.code, message: info.message, remedy: info.remedy, error: raw, final: true })\r\n        }\r\n        logger.error(`${info.message} (${info.code})`)\r\n        if (info.remedy) logger.info(`Try: ${info.remedy}`)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n\r\n  env\r\n    .command('diff')\r\n    .description('Compare local .env values to provider environment (no changes)')\r\n    .argument('<provider>', 'Target provider: vercel')\r\n    .option('--file <path>', 'Path to local .env file', '.env')\r\n    .option('--env <target>', 'Environment: prod|preview|development', 'preview')\r\n    .option('--json', 'Output JSON diff')\r\n    .option('--print-cmd', 'Print underlying provider commands that will be executed')\r\n    .option('--ci', 'CI mode (exit non-zero on differences)')\r\n    .option('--project-id <id>', 'Provider project ID for non-interactive link')\r\n    .option('--org-id <id>', 'Provider org ID for non-interactive link')\r\n    .option('--ignore <patterns>', 'Comma-separated glob patterns to ignore (e.g. NEXT_PUBLIC_*)')\r\n    .option('--only <patterns>', 'Comma-separated glob patterns to include')\r\n    .option('--fail-on-add', 'Exit non-zero if new keys would be added')\r\n    .option('--fail-on-remove', 'Exit non-zero if keys are missing remotely')\r\n    .option('--retries <n>', 'Retries for provider commands (default 2)')\r\n    .option('--timeout-ms <ms>', 'Timeout per provider command in milliseconds (default 120000)')\r\n    .option('--base-delay-ms <ms>', 'Base delay for exponential backoff with jitter (default 300)')\r\n    .action(async (provider: string, opts: { file?: string; env?: EnvTarget; json?: boolean; ci?: boolean; projectId?: string; orgId?: string; ignore?: string; only?: string; failOnAdd?: boolean; failOnRemove?: boolean; printCmd?: boolean; retries?: string; timeoutMs?: string; baseDelayMs?: string }): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      try {\r\n        if (opts.retries) process.env.OPD_RETRIES = String(Math.max(0, Number(opts.retries) || 0))\r\n        if (opts.timeoutMs) process.env.OPD_TIMEOUT_MS = String(Math.max(0, Number(opts.timeoutMs) || 0))\r\n        if (opts.baseDelayMs) process.env.OPD_BASE_DELAY_MS = String(Math.max(0, Number(opts.baseDelayMs) || 0))\r\n        const jsonMode: boolean = isJsonMode(opts.json)\r\n        if (jsonMode) logger.setJsonOnly(true)\r\n        const prov = provider === 'vercel' ? 'vercel' : undefined\r\n        if (!prov) { logger.error(`Unknown provider: ${provider}`); process.exitCode = 1; return }\r\n        const envTarget = (opts.env ?? 'preview') as EnvTarget\r\n        await diffVercel({ cwd, file: opts.file ?? '.env', env: envTarget, json: jsonMode, ci: opts.ci === true, projectId: opts.projectId, orgId: opts.orgId, ignore: toPatterns(opts.ignore), only: toPatterns(opts.only), failOnAdd: opts.failOnAdd === true, failOnRemove: opts.failOnRemove === true, printCmd: opts.printCmd === true })\r\n      } catch (err) {\r\n        const message: string = err instanceof Error ? err.message : String(err)\r\n        logger.error(message)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n\r\n  // Experimental: env validate (hidden/experimental scaffold)\r\n  env\r\n    .command('validate')\r\n    .description('[experimental] Validate a local .env against a schema of required keys')\r\n    .option('--file <path>', 'Path to local .env file', '.env')\r\n    .option('--schema <path>', 'Path to schema JSON or builtin:<name>')\r\n    .option('--schema-type <type>', 'Schema type: keys | rules | jsonschema', 'keys')\r\n    .option('--json', 'Output JSON report')\r\n    .option('--ci', 'CI mode (exit non-zero on violations)')\r\n    .action(async (opts: { file?: string; schema?: string; schemaType?: 'keys' | 'jsonschema'; json?: boolean; ci?: boolean }): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      try {\r\n        if (opts.json === true) logger.setJsonOnly(true)\r\n        const report = await envValidate({ cwd, file: opts.file ?? '.env', schema: opts.schema, schemaType: opts.schemaType ?? 'keys' })\r\n        if (opts.json === true) logger.json(report)\r\n        else {\r\n          if (report.ok) logger.success('Validation passed: all required keys present')\r\n          else logger.warn(`Missing required keys: ${report.missing.join(', ')}`)\r\n        }\r\n        if (!report.ok && opts.ci === true) process.exitCode = 1\r\n      } catch (err) {\r\n        const raw: string = err instanceof Error ? err.message : String(err)\r\n        const info = mapProviderError('env', raw)\r\n        if (process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1' || opts.json === true) {\r\n          logger.jsonPrint({ ok: false, action: 'env' as const, subcommand: 'validate' as const, provider: 'env', code: info.code, message: info.message, remedy: info.remedy, error: raw, final: true })\r\n        }\r\n        logger.error(`${info.message} (${info.code})`)\r\n        if (info.remedy) logger.info(`Try: ${info.remedy}`)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n\r\nexport async function envValidate(args: { readonly cwd: string; readonly file: string; readonly schema?: string; readonly schemaType: 'keys' | 'rules' | 'jsonschema' }): Promise<{ readonly ok: boolean; readonly file: string; readonly schemaPath?: string; readonly required: readonly string[]; readonly missing: readonly string[]; readonly unknown: readonly string[]; readonly violations?: readonly string[]; readonly requiredCount: number; readonly presentCount: number; readonly missingCount: number; readonly unknownCount: number; readonly violationCount?: number }> {\r\n  const filePath: string = join(args.cwd, args.file)\r\n  if (!args.schema) throw new Error('Missing --schema <path>')\r\n  const builtins: Record<string, readonly string[]> = {\r\n    'next-basic': ['DATABASE_URL', 'NEXT_PUBLIC_SITE_URL'],\r\n    'next-prisma': ['DATABASE_URL', 'DIRECT_URL'],\r\n    'next-auth': ['NEXTAUTH_SECRET', 'NEXTAUTH_URL'],\r\n    'better-auth': ['BETTER_AUTH_SECRET', 'BETTER_AUTH_URL'],\r\n    // New builtins\r\n    'drizzle': ['DATABASE_URL'],\r\n    'supabase': ['NEXT_PUBLIC_SUPABASE_URL', 'NEXT_PUBLIC_SUPABASE_ANON_KEY', 'SUPABASE_SERVICE_ROLE_KEY'],\r\n    'stripe': ['STRIPE_SECRET_KEY', 'STRIPE_WEBHOOK_SECRET', 'NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY'],\r\n    'paypal': ['PAYPAL_CLIENT_ID', 'PAYPAL_CLIENT_SECRET', 'PAYPAL_MODE', 'PAYPAL_WEBHOOK_ID'],\r\n    // Storage / providers\r\n    's3': ['AWS_REGION', 'AWS_ACCESS_KEY_ID', 'AWS_SECRET_ACCESS_KEY', 'S3_BUCKET'],\r\n    'r2': ['R2_ACCOUNT_ID', 'R2_ACCESS_KEY_ID', 'R2_SECRET_ACCESS_KEY', 'R2_BUCKET'],\r\n    'cloudinary': ['CLOUDINARY_CLOUD_NAME', 'CLOUDINARY_API_KEY', 'CLOUDINARY_API_SECRET', 'CLOUDINARY_PUBLIC_BASE_URL'],\r\n    'cloudinary-next': ['NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME'],\r\n    // Email / analytics / auth / cache / upload\r\n    'resend': ['RESEND_API_KEY'],\r\n    'posthog': ['NEXT_PUBLIC_POSTHOG_KEY', 'POSTHOG_HOST'],\r\n    'clerk': ['NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY', 'CLERK_SECRET_KEY'],\r\n    'upstash-redis': ['UPSTASH_REDIS_REST_URL', 'UPSTASH_REDIS_REST_TOKEN'],\r\n    'uploadthing': ['UPLOADTHING_SECRET', 'NEXT_PUBLIC_UPLOADTHING_APP_ID'],\r\n    // OAuth\r\n    'google-oauth': ['GOOGLE_CLIENT_ID', 'GOOGLE_CLIENT_SECRET'],\r\n    'github-oauth': ['GITHUB_CLIENT_ID', 'GITHUB_CLIENT_SECRET'],\r\n    // SMTP & Email basics\r\n    'smtp-basic': ['SMTP_HOST', 'SMTP_PORT', 'SMTP_SECURE', 'SMTP_USER', 'SMTP_PASS'],\r\n    'email-basic': ['EMAIL_FROM'],\r\n    // Utility\r\n    'admin-emails': ['ADMIN_EMAILS'],\r\n    'email-provider': ['MAIL_PROVIDER'],\r\n    // S3-compatible naming variant and app-specific bundles\r\n    's3-compat': ['S3_REGION', 'S3_BUCKET', 'S3_ACCESS_KEY_ID', 'S3_SECRET_ACCESS_KEY', 'S3_ENDPOINT', 'S3_PUBLIC_BASE_URL', 'S3_FORCE_PATH_STYLE'],\r\n    'media-worker': ['FFMPEG_PATH', 'MEDIA_PREVIEW_SECONDS', 'MEDIA_WORKER_POLL_MS', 'MEDIA_WORKER_LOOKBACK_MS'],\r\n    'upload-limits': ['MAX_UPLOAD_MB', 'MEDIA_DAILY_LIMIT'],\r\n    'resend-plus': ['RESEND_API_KEY', 'RESEND_AUDIENCE_ID'],\r\n    // Profiles (composed)\r\n    'blogkit': [\r\n      // DB + ORM\r\n      'DATABASE_URL',\r\n      // Auth & OAuth\r\n      ...['BETTER_AUTH_SECRET'],\r\n      ...['GOOGLE_CLIENT_ID','GOOGLE_CLIENT_SECRET','GITHUB_CLIENT_ID','GITHUB_CLIENT_SECRET'],\r\n      // Email\r\n      ...['MAIL_PROVIDER','EMAIL_FROM','RESEND_API_KEY','SMTP_HOST','SMTP_PORT','SMTP_SECURE','SMTP_USER','SMTP_PASS']\r\n    ],\r\n    'ecommercekit': [\r\n      // DB\r\n      'DATABASE_URL',\r\n      // Payment\r\n      ...['STRIPE_SECRET_KEY','STRIPE_WEBHOOK_SECRET','NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY','PAYPAL_CLIENT_ID','PAYPAL_CLIENT_SECRET','PAYPAL_MODE','PAYPAL_WEBHOOK_ID'],\r\n      // Storage\r\n      ...['AWS_REGION','AWS_ACCESS_KEY_ID','AWS_SECRET_ACCESS_KEY','S3_BUCKET'],\r\n      // Email\r\n      ...['MAIL_PROVIDER','EMAIL_FROM','RESEND_API_KEY','SMTP_HOST','SMTP_PORT','SMTP_SECURE','SMTP_USER','SMTP_PASS']\r\n    ],\r\n  }\r\n  // Support composition: comma-separated schemas (builtins and/or file paths)\r\n  const parts: readonly string[] = args.schema.split(',').map((s: string) => s.trim()).filter(Boolean)\r\n  const requiredSet = new Set<string>()\r\n  const schemaPathsUsed: string[] = []\r\n  // Additional rule collections\r\n  const regexRules: Array<{ readonly key: string; readonly pattern: string }> = []\r\n  const allowedValues: Record<string, readonly string[]> = {}\r\n  const oneOfGroups: ReadonlyArray<ReadonlyArray<string>> = []\r\n  const requireIfRules: Array<{ readonly if: { readonly key: string; readonly value?: string }; readonly then: readonly string[] }> = []\r\n  for (const part of parts) {\r\n    if (part.startsWith('builtin:')) {\r\n      const name: string = part.slice('builtin:'.length)\r\n      const arr = builtins[name]\r\n      if (!arr) throw new Error(`Unknown builtin schema: ${name}`)\r\n      for (const k of arr) requiredSet.add(k)\r\n    } else {\r\n      const p = join(args.cwd, part)\r\n      schemaPathsUsed.push(p)\r\n      const type: 'keys' | 'rules' | 'jsonschema' = args.schemaType\r\n      if (type === 'jsonschema') {\r\n        const js = await fsx.readJson<{ readonly required?: readonly string[] }>(p)\r\n        if (js === null) throw new Error(`Schema not found or invalid: ${p}`)\r\n        for (const k of (Array.isArray(js.required) ? js.required : [])) requiredSet.add(k)\r\n      } else if (type === 'rules') {\r\n        const rules = await fsx.readJson<{ readonly required?: readonly string[]; readonly regex?: Record<string, string>; readonly allowed?: Record<string, readonly string[]>; readonly oneOf?: ReadonlyArray<ReadonlyArray<string>>; readonly requireIf?: ReadonlyArray<{ readonly if: string; readonly then: readonly string[] }> }>(p)\r\n        if (rules === null) throw new Error(`Schema not found or invalid: ${p}`)\r\n        for (const k of (Array.isArray(rules.required) ? rules.required : [])) requiredSet.add(k)\r\n        if (rules.regex) {\r\n          for (const [key, pattern] of Object.entries(rules.regex)) regexRules.push({ key, pattern })\r\n        }\r\n        if (rules.allowed) {\r\n          for (const [key, vals] of Object.entries(rules.allowed)) allowedValues[key] = vals\r\n        }\r\n        if (Array.isArray(rules.oneOf)) {\r\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n          (oneOfGroups as any).push(...rules.oneOf)\r\n        }\r\n        if (Array.isArray(rules.requireIf)) {\r\n          for (const ri of rules.requireIf) {\r\n            const [k, v] = ri.if.split('=')\r\n            requireIfRules.push({ if: { key: k, value: v }, then: ri.then })\r\n          }\r\n        }\r\n      } else {\r\n        const keysSchema = await fsx.readJson<{ readonly required?: readonly string[] }>(p)\r\n        if (keysSchema === null) throw new Error(`Schema not found or invalid: ${p}`)\r\n        for (const k of (Array.isArray(keysSchema.required) ? keysSchema.required : [])) requiredSet.add(k)\r\n      }\r\n    }\r\n  }\r\n  const required: readonly string[] = Array.from(requiredSet)\r\n  const schemaPath: string | undefined = schemaPathsUsed.length > 0 ? schemaPathsUsed.join(',') : undefined\r\n  const envMap: Record<string, string> = await parseEnvFile({ path: filePath })\r\n  const presentKeys: readonly string[] = Object.keys(envMap)\r\n  const missing: string[] = required.filter(k => !(k in envMap))\r\n  const unknown: string[] = required.length > 0 ? presentKeys.filter(k => !required.includes(k)) : []\r\n  // Apply rule validations if any\r\n  const violations: string[] = []\r\n  // regex rules\r\n  for (const rr of regexRules) {\r\n    const val: string | undefined = envMap[rr.key]\r\n    if (val !== undefined) {\r\n      const re: RegExp = new RegExp(rr.pattern)\r\n      if (!re.test(val)) violations.push(`regex:${rr.key} does not match ${rr.pattern}`)\r\n    }\r\n  }\r\n  // allowed values\r\n  for (const [k, vals] of Object.entries(allowedValues)) {\r\n    const val: string | undefined = envMap[k]\r\n    if (val !== undefined && !vals.includes(val)) violations.push(`allowed:${k} must be one of ${vals.join('|')}`)\r\n  }\r\n  // oneOf groups: at least one of the keys must be present\r\n  for (const group of oneOfGroups) {\r\n    const okGroup: boolean = group.some((k: string) => envMap[k] !== undefined)\r\n    if (!okGroup) violations.push(`oneOf: one of [${group.join(', ')}] must be present`)\r\n  }\r\n  // requireIf conditions\r\n  for (const ri of requireIfRules) {\r\n    const actual: string | undefined = envMap[ri.if.key]\r\n    const cond: boolean = ri.if.value ? actual === ri.if.value : actual !== undefined\r\n    if (cond) {\r\n      for (const need of ri.then) {\r\n        if (envMap[need] === undefined) {\r\n          violations.push(`requireIf: ${need} is required when ${ri.if.key}${ri.if.value ? `=${ri.if.value}` : ''}`)\r\n          if (!missing.includes(need)) missing.push(need)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  const ok: boolean = missing.length === 0 && violations.length === 0\r\n  return {\r\n    ok,\r\n    file: filePath,\r\n    schemaPath,\r\n    required,\r\n    missing,\r\n    unknown,\r\n    violations: violations.length > 0 ? violations : undefined,\r\n    requiredCount: required.length,\r\n    presentCount: presentKeys.length,\r\n    missingCount: missing.length,\r\n    unknownCount: unknown.length,\r\n    violationCount: violations.length > 0 ? violations.length : undefined\r\n  }\r\n}\r\n","import { config, parse } from 'dotenv'\r\nimport { join } from 'node:path'\r\nimport { readFile } from 'node:fs/promises'\r\nimport { fsx } from '../../utils/fs'\r\n\r\n/**\r\n * Loads environment variables from .env files. No persistence.\r\n */\r\nexport class EnvLoader {\r\n  public load(): Readonly<Record<string, string>> {\r\n    // Load .env first, then override with .env.local if present\r\n    const cwd: string = process.cwd()\r\n    const envPath: string = join(cwd, '.env')\r\n    const envLocalPath: string = join(cwd, '.env.local')\r\n    config({ path: envPath })\r\n    // Use override so .env.local wins over .env when both exist\r\n    if (fsx.exists(envLocalPath) instanceof Promise) { /* noop for TS */ }\r\n    // We cannot await here since dotenv is sync; do a best-effort check via fsx.exists\r\n    // fsx.exists returns Promise<boolean>, but calling it here isn't practical; rely on dotenv behavior if path exists\r\n    config({ path: envLocalPath, override: true })\r\n    const out: Record<string, string> = {}\r\n    for (const [k, v] of Object.entries(process.env)) if (typeof v === 'string') out[k] = v\r\n    return out\r\n  }\r\n}\r\n\r\n/**\r\n * Parse a specific .env file without mutating process.env.\r\n */\r\nexport async function parseEnvFile(args: { readonly path: string }): Promise<Readonly<Record<string, string>>> {\r\n  try {\r\n    const buf: string = await readFile(args.path, 'utf8')\r\n    const parsed: Record<string, string> = parse(buf)\r\n    const trimmed: Record<string, string> = {}\r\n    for (const [k, v] of Object.entries(parsed)) {\r\n      if (typeof v !== 'string') continue\r\n      const tv: string = v.trim()\r\n      if (tv.length > 0) trimmed[k] = tv\r\n    }\r\n    // Expand ${VAR} or $VAR references using values from the file first, then process.env\r\n    const expanded: Record<string, string> = {}\r\n    const varRe: RegExp = /\\$\\{([A-Z0-9_]+)\\}|\\$([A-Z0-9_]+)/g\r\n    const resolveVar = (name: string): string | undefined => {\r\n      if (Object.prototype.hasOwnProperty.call(trimmed, name)) return trimmed[name]\r\n      const pe: string | undefined = process.env[name]\r\n      return typeof pe === 'string' ? pe : undefined\r\n    }\r\n    const expandOnce = (value: string): string => {\r\n      return value.replace(varRe, (_m: string, g1?: string, g2?: string) => {\r\n        const key: string = (g1 ?? g2) ?? ''\r\n        const rep: string | undefined = key !== '' ? resolveVar(key) : undefined\r\n        return rep !== undefined ? rep : ''\r\n      })\r\n    }\r\n    const MAX_PASSES = 5\r\n    for (const [k, v] of Object.entries(trimmed)) {\r\n      let cur: string = v\r\n      for (let i = 0; i < MAX_PASSES; i++) {\r\n        const next: string = expandOnce(cur)\r\n        if (next === cur) break\r\n        cur = next\r\n      }\r\n      expanded[k] = cur\r\n    }\r\n    return expanded\r\n  } catch {\r\n    return {}\r\n  }\r\n}\r\n","import { colors } from './colors'\r\n\r\nexport interface ChangedEntry { readonly key: string; readonly local: string; readonly remote: string }\r\n\r\nfunction mask(value: string): string {\r\n  if (value.length <= 4) return '***'\r\n  const head: string = value.slice(0, 3)\r\n  const tail: string = value.slice(-2)\r\n  return `${head}***${tail}`\r\n}\r\n\r\nfunction section(title: string, lines: readonly string[]): string[] {\r\n  if (lines.length === 0) return []\r\n  const out: string[] = []\r\n  out.push(colors.bold(title))\r\n  for (const ln of lines) out.push(`  • ${ln}`)\r\n  return out\r\n}\r\n\r\nexport function formatDiffHuman(args: { readonly added: readonly string[]; readonly removed: readonly string[]; readonly changed: readonly ChangedEntry[] }): string {\r\n  const addedLines: string[] = args.added.map((k) => colors.green(k))\r\n  const removedLines: string[] = args.removed.map((k) => colors.yellow(k))\r\n  const changedLines: string[] = args.changed.map((c) => `${colors.cyan(c.key)} ${colors.dim('(local:')} ${mask(c.local)}${colors.dim(', remote:')} ${mask(c.remote)}${colors.dim(')')}`)\r\n  const parts: string[] = []\r\n  parts.push(...section(`Added only locally (${args.added.length})`, addedLines))\r\n  parts.push(...section(`Missing locally (${args.removed.length})`, removedLines))\r\n  parts.push(...section(`Changed (${args.changed.length})`, changedLines))\r\n  return parts.join('\\n')\r\n}\r\n","import { createInterface } from 'node:readline'\r\n\r\nexport interface ConfirmOptions { readonly defaultYes?: boolean }\r\n\r\nfunction normalize(answer: string): string { return answer.trim().toLowerCase() }\r\n\r\nexport async function confirm(question: string, opts: ConfirmOptions = {}): Promise<boolean> {\r\n  const rl = createInterface({ input: process.stdin, output: process.stdout })\r\n  const suffix: string = opts.defaultYes === false ? ' [y/N] ' : ' [Y/n] '\r\n  const q: string = `${question}${suffix}`\r\n  const result: boolean = await new Promise<boolean>((resolve) => {\r\n    rl.question(q, (ans: string) => {\r\n      const val: string = normalize(ans)\r\n      if (val === '' && (opts.defaultYes === undefined || opts.defaultYes === true)) return resolve(true)\r\n      if (val === 'y' || val === 'yes') return resolve(true)\r\n      resolve(false)\r\n    })\r\n  })\r\n  rl.close()\r\n  return result\r\n}\r\n","import { join } from 'node:path'\r\nimport { fsx } from './fs'\r\n\r\nexport interface CacheEntry<T> { value: T; ts: number }\r\n\r\nconst CACHE_FILE = '.opendeploy/cache.json'\r\n\r\nexport async function getCached<T>(args: { cwd: string; key: string; ttlMs: number }): Promise<T | undefined> {\r\n  try {\r\n    const path = join(args.cwd, CACHE_FILE)\r\n    const data = await fsx.readJson<Record<string, CacheEntry<unknown>>>(path)\r\n    if (!data) return undefined\r\n    const entry = data[args.key]\r\n    if (!entry) return undefined\r\n    if (typeof entry.ts !== 'number') return undefined\r\n    if (Date.now() - entry.ts > args.ttlMs) return undefined\r\n    return entry.value as T\r\n  } catch { return undefined }\r\n}\r\n\r\nexport async function setCached<T>(args: { cwd: string; key: string; value: T }): Promise<void> {\r\n  const path = join(args.cwd, CACHE_FILE)\r\n  try {\r\n    const data = (await fsx.readJson<Record<string, CacheEntry<unknown>>>(path)) ?? {}\r\n    data[args.key] = { value: args.value, ts: Date.now() }\r\n    await fsx.writeJson(path, data)\r\n  } catch {\r\n    // try ensure directory and retry\r\n    try { await fsx.writeJson(path, { [args.key]: { value: args.value, ts: Date.now() } }) } catch { /* ignore */ }\r\n  }\r\n}\r\n","export const envSummarySchema = {\r\n  $schema: \"http://json-schema.org/draft-07/schema#\",\r\n  type: \"object\",\r\n  additionalProperties: true,\r\n  required: [\"ok\", \"action\", \"final\"],\r\n  properties: {\r\n    ok: { type: \"boolean\" },\r\n    action: { const: \"env\" },\r\n    subcommand: { type: \"string\" },\r\n    provider: { type: \"string\" },\r\n    final: { type: \"boolean\" }\r\n  }\r\n} as const\r\n","import { readFile } from 'node:fs/promises'\r\nimport { join } from 'node:path'\r\nimport { fsx } from './fs'\r\n\r\nfunction escapeRegExp(s: string): string {\r\n  return s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\r\n}\r\n\r\nfunction parseDotenv(content: string): Record<string, string> {\r\n  const out: Record<string, string> = {}\r\n  for (const raw of content.split(/\\r?\\n/)) {\r\n    const line = raw.trim()\r\n    if (!line || line.startsWith('#')) continue\r\n    const eq = line.indexOf('=')\r\n    if (eq <= 0) continue\r\n    const k = line.slice(0, eq).trim()\r\n    let v = line.slice(eq + 1).trim()\r\n    if ((v.startsWith('\"') && v.endsWith('\"')) || (v.startsWith(\"'\") && v.endsWith(\"'\"))) v = v.slice(1, -1)\r\n    out[k] = v\r\n  }\r\n  return out\r\n}\r\n\r\nfunction valueToPatterns(val: string): RegExp[] {\r\n  const patterns: RegExp[] = []\r\n  if (typeof val !== 'string') return patterns\r\n  if (val.length < 4) return patterns\r\n  // Avoid trivial literals that commonly appear in logs/JSON and are not secrets\r\n  const trivial = new Set(['true', 'false', 'null', 'undefined', 'on', 'off', 'yes', 'no'])\r\n  if (trivial.has(val.toLowerCase())) return patterns\r\n  // Exact literal redaction\r\n  patterns.push(new RegExp(escapeRegExp(val), 'g'))\r\n  // Base64 form (best-effort)\r\n  try {\r\n    const b64 = Buffer.from(val, 'utf8').toString('base64')\r\n    if (b64.length >= 8) patterns.push(new RegExp(escapeRegExp(b64), 'g'))\r\n  } catch { /* ignore */ }\r\n  return patterns\r\n}\r\n\r\nexport async function computeRedactors(args: { cwd: string; envFiles?: readonly string[]; includeProcessEnv?: boolean }): Promise<RegExp[]> {\r\n  const patterns: RegExp[] = []\r\n  const files: string[] = []\r\n  if (args.envFiles && args.envFiles.length > 0) {\r\n    for (const f of args.envFiles) files.push(f)\r\n  }\r\n  // Fallback common env filenames\r\n  if (files.length === 0) files.push('.env', '.env.local')\r\n  for (const name of files) {\r\n    const p = join(args.cwd, name)\r\n    if (!(await fsx.exists(p))) continue\r\n    try {\r\n      const content = await readFile(p, 'utf8')\r\n      const kv = parseDotenv(content)\r\n      for (const [k, v] of Object.entries(kv)) {\r\n        if (!k) continue\r\n        if (k.startsWith('PUBLIC_') || k.startsWith('NEXT_PUBLIC_')) continue\r\n        for (const re of valueToPatterns(v)) patterns.push(re)\r\n      }\r\n    } catch { /* ignore */ }\r\n  }\r\n  // Load additional patterns from opendeploy.redaction.json if present\r\n  try {\r\n    const confPath = join(args.cwd, 'opendeploy.redaction.json')\r\n    if (await fsx.exists(confPath)) {\r\n      type RedactionConf = { redaction?: { literals?: string[]; regex?: Array<string | { pattern: string; flags?: string }> } }\r\n      const raw = await readFile(confPath, 'utf8')\r\n      const json = JSON.parse(raw) as RedactionConf\r\n      const rc = json.redaction\r\n      if (rc) {\r\n        if (Array.isArray(rc.literals)) {\r\n          for (const lit of rc.literals) {\r\n            if (typeof lit === 'string' && lit.length > 0) patterns.push(new RegExp(escapeRegExp(lit), 'g'))\r\n          }\r\n        }\r\n        if (Array.isArray(rc.regex)) {\r\n          for (const entry of rc.regex) {\r\n            if (typeof entry === 'string') {\r\n              try { patterns.push(new RegExp(entry, 'g')) } catch { /* ignore bad regex */ }\r\n            } else if (entry && typeof entry.pattern === 'string') {\r\n              try { patterns.push(new RegExp(entry.pattern, entry.flags ?? 'g')) } catch { /* ignore */ }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  } catch { /* ignore malformed config */ }\r\n  if (args.includeProcessEnv === true) {\r\n    for (const [k, v] of Object.entries(process.env)) {\r\n      if (!k) continue\r\n      if (k.startsWith('PUBLIC_') || k.startsWith('NEXT_PUBLIC_')) continue\r\n      if (typeof v === 'string' && v.length >= 4) {\r\n        for (const re of valueToPatterns(v)) patterns.push(re)\r\n      }\r\n    }\r\n  }\r\n  return patterns\r\n}\r\n","import { Command } from 'commander'\r\nimport { EnvLoader } from '../core/secrets/env'\r\nimport { PostgresSeeder } from '../core/seed/postgres'\r\nimport { PrismaSeeder } from '../core/seed/prisma'\r\nimport { ScriptSeeder } from '../core/seed/script'\r\nimport { logger } from '../utils/logger'\r\nimport { confirm } from '../utils/prompt'\r\nimport { parseEnvFile } from '../core/secrets/env'\r\n\r\ninterface SeedOptions {\r\n  readonly dbUrl?: string\r\n  readonly file?: string\r\n  readonly env?: 'prod' | 'preview' | 'development'\r\n  readonly dryRun?: boolean\r\n  readonly yes?: boolean\r\n  readonly schema?: 'sql' | 'prisma' | 'script'\r\n  readonly script?: string\r\n  readonly envFile?: string\r\n  readonly json?: boolean\r\n  readonly ci?: boolean\r\n}\r\n\r\nfunction resolveDbUrl(opts: SeedOptions): string | null {\r\n  if (typeof opts.dbUrl === 'string' && opts.dbUrl.length > 0) return opts.dbUrl\r\n  const env = new EnvLoader().load()\r\n  const url: string | undefined = env.DATABASE_URL\r\n  return typeof url === 'string' && url.length > 0 ? url : null\r\n}\r\n\r\nfunction isPostgresUrl(url: string): boolean {\r\n  try { const u = new URL(url); return u.protocol === 'postgres:' || u.protocol === 'postgresql:' } catch { return false }\r\n}\r\n\r\n/**\r\n * Register the `seed` command for Postgres.\r\n */\r\nexport function registerSeedCommand(program: Command): void {\r\n  program\r\n    .command('seed')\r\n    .description('Seed a database (SQL, Prisma, or package.json script)')\r\n    .option('--db-url <url>', 'Postgres connection string (defaults to DATABASE_URL)')\r\n    .option('--file <path>', 'SQL file path (defaults to prisma/seed.sql or seed.sql)')\r\n    .option('--env <env>', 'Target environment: prod | preview | development', 'preview')\r\n    .option('--schema <schema>', 'Seed schema: sql | prisma | script', 'sql')\r\n    .option('--script <name>', 'Package.json script name to run (when --schema script)', 'db:seed')\r\n    .option('--dry-run', 'Print what would happen without executing SQL')\r\n    .option('--yes', 'Skip confirmation prompts')\r\n    .option('--env-file <path>', 'Load additional env vars from a .env file and pass to the seed process')\r\n    .option('--json', 'Output JSON summary')\r\n    .option('--ci', 'CI mode (non-interactive, safer defaults)')\r\n    .action(async (opts: SeedOptions): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      try {\r\n        if (opts.json === true) logger.setJsonOnly(true)\r\n        const schema: 'sql' | 'prisma' | 'script' = (opts.schema ?? 'sql')\r\n        const dbUrl: string | null = resolveDbUrl(opts)\r\n        if (schema !== 'script') {\r\n          if (dbUrl === null) throw new Error('Missing database URL. Pass --db-url or set DATABASE_URL in environment/.env')\r\n          if (!isPostgresUrl(dbUrl)) throw new Error('Only Postgres is supported for now. Expect protocol postgres:// or postgresql://')\r\n        }\r\n        if (opts.env === 'prod' && opts.yes !== true && opts.ci !== true) {\r\n          const ok: boolean = await confirm('You are about to run seed against PROD. Continue?', { defaultYes: false })\r\n          if (!ok) { logger.warn('Seed aborted by user'); return }\r\n        }\r\n        // Load extra env from --env-file (if provided) and pass to sub-processes\r\n        let extraEnv: Readonly<Record<string, string>> | undefined\r\n        if (typeof opts.envFile === 'string' && opts.envFile.length > 0) {\r\n          extraEnv = await parseEnvFile({ path: opts.envFile })\r\n        }\r\n        const dry = opts.dryRun === true\r\n        const result: { mode: string; ok: boolean } = { mode: schema, ok: false }\r\n        if (schema === 'prisma') {\r\n          const prisma = new PrismaSeeder()\r\n          await prisma.seed({ cwd, dbUrl: dbUrl!, dryRun: dry, env: extraEnv })\r\n          result.ok = true\r\n        } else if (schema === 'script') {\r\n          const script = new ScriptSeeder()\r\n          await script.seed({ cwd, dbUrl: dbUrl ?? undefined, script: opts.script, dryRun: dry, env: extraEnv })\r\n          result.ok = true\r\n        } else {\r\n          const seeder = new PostgresSeeder()\r\n          await seeder.seed({ dbUrl: dbUrl!, cwd, file: opts.file, dryRun: dry })\r\n          result.ok = true\r\n        }\r\n        if (opts.json === true) logger.json(result)\r\n      } catch (err) {\r\n        const message: string = err instanceof Error ? err.message : String(err)\r\n        logger.error(message)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n","import { readFile } from 'node:fs/promises'\r\nimport { join } from 'node:path'\r\nimport { Client } from 'pg'\r\nimport { fsx } from '../../utils/fs'\r\nimport { logger } from '../../utils/logger'\r\n\r\nexport interface PostgresSeedArgs {\r\n  readonly dbUrl: string\r\n  readonly cwd: string\r\n  readonly file?: string\r\n  readonly dryRun?: boolean\r\n}\r\n\r\nfunction inferDefaultSeedPath(cwd: string): string | null {\r\n  const candidates: readonly string[] = [\r\n    join(cwd, 'prisma', 'seed.sql'),\r\n    join(cwd, 'seed.sql')\r\n  ]\r\n  for (const p of candidates) if (fsx.exists(p) instanceof Promise) { /* noop for TS */ }\r\n  return null\r\n}\r\n\r\nfunction maskUrl(url: string): string {\r\n  try {\r\n    const u = new URL(url)\r\n    const user: string = u.username\r\n    const host: string = u.hostname\r\n    const db: string = u.pathname.replace(/^\\//, '')\r\n    return `postgres://${user !== '' ? user : 'user'}@${host}/${db}`\r\n  } catch {\r\n    return 'postgres://***'\r\n  }\r\n}\r\n\r\nfunction needsSsl(dbUrl: string): boolean {\r\n  return dbUrl.includes('sslmode=require') || dbUrl.includes('neon.tech') || dbUrl.includes('render.com') || dbUrl.includes('vercel-storage.com')\r\n}\r\n\r\n/**\r\n * PostgresSeeder executes a SQL seed file against a Postgres database.\r\n */\r\nexport class PostgresSeeder {\r\n  public async seed(args: PostgresSeedArgs): Promise<void> {\r\n    const filePath: string | null = await this.resolveFilePath({ cwd: args.cwd, file: args.file })\r\n    if (filePath === null) throw new Error('No seed file found. Provide --file or add prisma/seed.sql or seed.sql')\r\n    const sql: string = await this.readSql({ path: filePath })\r\n    if (args.dryRun === true) {\r\n      logger.info(`Dry-run: would execute ${sql.length} characters of SQL on ${maskUrl(args.dbUrl)}`)\r\n      return\r\n    }\r\n    await this.execute({ dbUrl: args.dbUrl, sql })\r\n    logger.success(`Seed complete on ${maskUrl(args.dbUrl)}`)\r\n  }\r\n\r\n  private async resolveFilePath(args: { readonly cwd: string; readonly file?: string }): Promise<string | null> {\r\n    if (args.file !== undefined) return join(args.cwd, args.file)\r\n    const p1: string = join(args.cwd, 'prisma', 'seed.sql')\r\n    if (await fsx.exists(p1)) return p1\r\n    const p2: string = join(args.cwd, 'seed.sql')\r\n    if (await fsx.exists(p2)) return p2\r\n    return null\r\n  }\r\n\r\n  private async readSql(args: { readonly path: string }): Promise<string> {\r\n    const buf: string = await readFile(args.path, 'utf8')\r\n    return buf.replace(/^\\uFEFF/, '').trim()\r\n  }\r\n\r\n  private async execute(args: { readonly dbUrl: string; readonly sql: string }): Promise<void> {\r\n    const client: Client = new Client({ connectionString: args.dbUrl, ssl: needsSsl(args.dbUrl) ? { rejectUnauthorized: false } : undefined })\r\n    try {\r\n      await client.connect()\r\n      await client.query('BEGIN')\r\n      await client.query(args.sql)\r\n      await client.query('COMMIT')\r\n    } catch (err) {\r\n      await client.query('ROLLBACK').catch(() => {})\r\n      const message: string = err instanceof Error ? err.message : String(err)\r\n      throw new Error(`Seed failed: ${message}`)\r\n    } finally {\r\n      await client.end().catch(() => {})\r\n    }\r\n  }\r\n}\r\n","import { detectPackageManager } from '../../core/detectors/package-manager'\r\nimport { proc } from '../../utils/process'\r\nimport { logger } from '../../utils/logger'\r\n\r\nexport interface PrismaSeedArgs {\r\n  readonly cwd: string\r\n  readonly dbUrl: string\r\n  readonly dryRun?: boolean\r\n  readonly env?: Readonly<Record<string, string>>\r\n}\r\n\r\nfunction maskUrl(url: string): string {\r\n  try {\r\n    const u = new URL(url)\r\n    const user: string = u.username\r\n    const host: string = u.hostname\r\n    const db: string = u.pathname.replace(/^\\//, '')\r\n    return `postgres://${user !== '' ? user : 'user'}@${host}/${db}`\r\n  } catch {\r\n    return 'postgres://***'\r\n  }\r\n}\r\n\r\nfunction commandForPm(pm: 'pnpm' | 'yarn' | 'npm' | 'bun'): string {\r\n  if (pm === 'pnpm') return 'pnpm exec prisma db seed'\r\n  if (pm === 'yarn') return 'yarn prisma db seed'\r\n  if (pm === 'bun') return 'bunx prisma db seed'\r\n  return 'npx prisma db seed'\r\n}\r\n\r\n/**\r\n * Runs `prisma db seed` using the project's package manager.\r\n */\r\nexport class PrismaSeeder {\r\n  public async seed(args: PrismaSeedArgs): Promise<void> {\r\n    const pm = await detectPackageManager({ cwd: args.cwd })\r\n    const cmd: string = commandForPm(pm)\r\n    if (args.dryRun === true) {\r\n      logger.info(`Dry-run: would execute \"${cmd}\" with DATABASE_URL=${maskUrl(args.dbUrl)}`)\r\n      return\r\n    }\r\n    const mergedEnv: Record<string, string> = { ...(args.env ?? {}), DATABASE_URL: args.dbUrl }\r\n    const out = await proc.run({ cmd, cwd: args.cwd, env: mergedEnv })\r\n    if (!out.ok) throw new Error(out.stderr.trim() || out.stdout.trim() || 'Prisma seed failed')\r\n    logger.success('Prisma seed complete')\r\n  }\r\n}\r\n","import { detectPackageManager } from '../../core/detectors/package-manager'\r\nimport { proc } from '../../utils/process'\r\nimport { logger } from '../../utils/logger'\r\nimport type { PackageManager } from '../../types/package-manager'\r\n\r\nexport interface ScriptSeedArgs {\r\n  readonly cwd: string\r\n  readonly dbUrl?: string\r\n  readonly script?: string\r\n  readonly dryRun?: boolean\r\n  readonly env?: Readonly<Record<string, string>>\r\n}\r\n\r\nfunction maskUrl(url: string): string {\r\n  try {\r\n    const u = new URL(url)\r\n    const user: string = u.username\r\n    const host: string = u.hostname\r\n    const db: string = u.pathname.replace(/^\\//, '')\r\n    return `postgres://${user !== '' ? user : 'user'}@${host}/${db}`\r\n  } catch {\r\n    return 'postgres://***'\r\n  }\r\n}\r\n\r\nfunction pmRun(pm: PackageManager, script: string): string {\r\n  if (pm === 'pnpm') return `pnpm run ${script}`\r\n  if (pm === 'yarn') return `yarn ${script}`\r\n  if (pm === 'bun') return `bun run ${script}`\r\n  return `npm run ${script}`\r\n}\r\n\r\n/**\r\n * Runs a user-defined package.json script for seeding (works well with Drizzle setups).\r\n */\r\nexport class ScriptSeeder {\r\n  public async seed(args: ScriptSeedArgs): Promise<void> {\r\n    const pm = await detectPackageManager({ cwd: args.cwd })\r\n    const script: string = args.script ?? 'db:seed'\r\n    const cmd: string = pmRun(pm, script)\r\n    if (args.dryRun === true) {\r\n      const target: string = args.dbUrl ? maskUrl(args.dbUrl) : '(inherited)'\r\n      logger.info(`Dry-run: would execute \"${cmd}\" with DATABASE_URL=${target}`)\r\n      return\r\n    }\r\n    const mergedEnv: Record<string, string> = { ...(args.env ?? {}) }\r\n    if (args.dbUrl) mergedEnv.DATABASE_URL = args.dbUrl\r\n    const out = await proc.run({ cmd, cwd: args.cwd, env: Object.keys(mergedEnv).length ? mergedEnv : undefined })\r\n    if (!out.ok) throw new Error(out.stderr.trim() || out.stdout.trim() || `Seeding script failed: ${script}`)\r\n    logger.success('Script seed complete')\r\n  }\r\n}\r\n","import { Command } from 'commander'\r\nimport { join } from 'node:path'\r\nimport { fsx } from '../utils/fs'\r\nimport { logger } from '../utils/logger'\r\nimport Ajv from 'ajv'\r\nimport { runSummarySchema } from '../schemas/run-summary.schema'\r\nimport { parseEnvFile } from '../core/secrets/env'\r\nimport { ScriptSeeder } from '../core/seed/script'\r\nimport { PrismaSeeder } from '../core/seed/prisma'\r\nimport { PostgresSeeder } from '../core/seed/postgres'\r\nimport type { OpenDeployConfig, ProjectConfig } from '../types/config'\r\nimport { envSync, envDiff } from './env'\r\nimport { mapLimit } from '../utils/concurrency'\r\n\r\ntype TargetEnv = 'prod' | 'preview'\r\n\r\ninterface RunOptions {\r\n  readonly env?: TargetEnv\r\n  readonly projects?: string\r\n  readonly tags?: string\r\n  readonly all?: boolean\r\n  readonly dryRun?: boolean\r\n  readonly json?: boolean\r\n  readonly ci?: boolean\r\n  readonly config?: string\r\n  readonly syncEnv?: boolean\r\n  readonly diffEnv?: boolean\r\n  readonly projectId?: string\r\n  readonly orgId?: string\r\n  readonly ignore?: string\r\n  readonly only?: string\r\n  readonly failOnAdd?: boolean\r\n  readonly failOnRemove?: boolean\r\n  readonly concurrency?: number\r\n}\r\n\r\nfunction pickProjects(cfg: OpenDeployConfig, opts: RunOptions): readonly ProjectConfig[] {\r\n  const all = cfg.projects\r\n  const byName = (names: string | undefined): Set<string> => new Set((names ?? '').split(',').map(s => s.trim()).filter(Boolean))\r\n  const wantedNames = byName(opts.projects)\r\n  const wantedTags = byName(opts.tags)\r\n  if (opts.all === true && wantedNames.size === 0 && wantedTags.size === 0) return all\r\n  let sel = all\r\n  if (wantedNames.size > 0) sel = sel.filter(p => wantedNames.has(p.name))\r\n  if (wantedTags.size > 0) sel = sel.filter(p => (p.tags ?? []).some(t => wantedTags.has(t)))\r\n  return sel\r\n}\r\n\r\nfunction isStringArray(val: unknown): val is readonly string[] {\r\n  return Array.isArray(val) && val.every(v => typeof v === 'string')\r\n}\r\n\r\nasync function loadConfig(cwd: string, file?: string): Promise<OpenDeployConfig> {\r\n  const path: string = join(cwd, file ?? 'opendeploy.config.json')\r\n  const data = await fsx.readJson<OpenDeployConfig>(path)\r\n  if (data === null || !Array.isArray((data as OpenDeployConfig).projects)) {\r\n    throw new Error(`Config not found or invalid: ${path}`)\r\n  }\r\n  // Validate shape with clear messages\r\n  for (let i = 0; i < data.projects.length; i++) {\r\n    const p = data.projects[i] as Partial<ProjectConfig>\r\n    const prefix = `projects[${i}]`\r\n    if (typeof p.name !== 'string' || p.name.trim() === '') throw new Error(`${prefix}.name must be a non-empty string`)\r\n    if (typeof p.path !== 'string' || p.path.trim() === '') throw new Error(`${prefix}.path must be a non-empty string`)\r\n    if (p.provider !== 'vercel') throw new Error(`${prefix}.provider must be \"vercel\"`)\r\n    if (p.envOnly !== undefined && !isStringArray(p.envOnly)) throw new Error(`${prefix}.envOnly must be an array of strings`)\r\n    if (p.envIgnore !== undefined && !isStringArray(p.envIgnore)) throw new Error(`${prefix}.envIgnore must be an array of strings`)\r\n    if (p.failOnAdd !== undefined && typeof p.failOnAdd !== 'boolean') throw new Error(`${prefix}.failOnAdd must be a boolean`)\r\n    if (p.failOnRemove !== undefined && typeof p.failOnRemove !== 'boolean') throw new Error(`${prefix}.failOnRemove must be a boolean`)\r\n    if (p.tags !== undefined && !isStringArray(p.tags)) throw new Error(`${prefix}.tags must be an array of strings`)\r\n    if (p.dependsOn !== undefined && !isStringArray(p.dependsOn)) throw new Error(`${prefix}.dependsOn must be an array of strings`)\r\n  }\r\n  return data\r\n}\r\n\r\nexport function registerRunCommand(program: Command): void {\r\n  const ajv = new Ajv({ allErrors: true, strict: false, validateSchema: false })\r\n  const validate = ajv.compile(runSummarySchema as unknown as object)\r\n  const annotateRun = (obj: Record<string, unknown>): Record<string, unknown> => {\r\n    const ok: boolean = validate(obj) as boolean\r\n    const errs: string[] = Array.isArray(validate.errors) ? validate.errors.map(e => `${e.instancePath || '/'} ${e.message ?? ''}`.trim()) : []\r\n    if (process.env.OPD_SCHEMA_STRICT === '1' && errs.length > 0) { process.exitCode = 1 }\r\n    return { ...obj, schemaOk: ok, schemaErrors: errs }\r\n  }\r\n  program\r\n    .command('run')\r\n    .description('Orchestrate env+seed tasks across multiple projects from config')\r\n    .option('--env <env>', 'Environment: prod | preview', 'preview')\r\n    .option('--projects <names>', 'Comma-separated project names to run')\r\n    .option('--tags <tags>', 'Comma-separated tags to filter projects')\r\n    .option('--all', 'Run for all projects')\r\n    .option('--concurrency <n>', 'Max concurrent projects', (v: string) => Number.parseInt(v, 10), 2)\r\n    .option('--dry-run', 'Dry-run mode')\r\n    .option('--json', 'Output JSON summary only')\r\n    .option('--ci', 'CI mode (non-interactive)')\r\n    .option('--config <path>', 'Path to opendeploy.config.json')\r\n    .option('--sync-env', 'Sync env to provider before seeding')\r\n    .option('--diff-env', 'Diff env against provider before seeding')\r\n    .option('--project-id <id>', 'Provider project ID for non-interactive link')\r\n    .option('--org-id <id>', 'Provider org ID for non-interactive link')\r\n    .option('--ignore <patterns>', 'Comma-separated glob patterns to ignore (e.g. NEXT_PUBLIC_*)')\r\n    .option('--only <patterns>', 'Comma-separated glob patterns to include')\r\n    .option('--fail-on-add', 'Exit non-zero if new keys would be added')\r\n    .option('--fail-on-remove', 'Exit non-zero if keys are missing remotely')\r\n    .action(async (opts: RunOptions): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      try {\r\n        if (opts.json === true) logger.setJsonOnly(true)\r\n        const env: TargetEnv = (opts.env ?? 'preview')\r\n        const cfg: OpenDeployConfig = await loadConfig(cwd, opts.config)\r\n        const selected: readonly ProjectConfig[] = pickProjects(cfg, opts)\r\n        if (selected.length === 0) throw new Error('No matching projects in config')\r\n        const results: Array<{ name: string; env?: { ok: boolean; mode?: 'sync' | 'diff'; error?: string }; seed?: { ok: boolean; mode?: string; error?: string } }> = []\r\n        // Map project name to config for quick lookup\r\n        const byName = new Map<string, ProjectConfig>(selected.map(p => [p.name, p]))\r\n        // Build indegrees for topo layers\r\n        const indeg = new Map<string, number>()\r\n        for (const p of selected) {\r\n          const deps = (p.dependsOn ?? []).filter(d => byName.has(d))\r\n          indeg.set(p.name, (indeg.get(p.name) ?? 0) + 0)\r\n          for (const d of deps) indeg.set(p.name, (indeg.get(p.name) ?? 0) + 1)\r\n        }\r\n        // Build layers\r\n        const layers: string[][] = []\r\n        const remaining = new Set<string>(selected.map(p => p.name))\r\n        while (remaining.size > 0) {\r\n          const layer: string[] = []\r\n          for (const n of Array.from(remaining)) {\r\n            if ((indeg.get(n) ?? 0) === 0) layer.push(n)\r\n          }\r\n          if (layer.length === 0) throw new Error('Cycle detected in dependsOn graph')\r\n          layers.push(layer)\r\n          // Remove layer and decrement indegrees\r\n          for (const n of layer) {\r\n            remaining.delete(n)\r\n            for (const p of selected) {\r\n              if ((p.dependsOn ?? []).includes(n)) indeg.set(p.name, Math.max(0, (indeg.get(p.name) ?? 0) - 1))\r\n            }\r\n          }\r\n        }\r\n        // Worker to process a single project (env then seed)\r\n        const worker = async (p: ProjectConfig): Promise<void> => {\r\n          const projCwd: string = join(cwd, p.path)\r\n          const envFile: string | undefined = env === 'prod' ? p.envFileProd : p.envFilePreview\r\n          const extraEnv = envFile ? await parseEnvFile({ path: join(projCwd, envFile) }) : undefined\r\n          const envRes: { ok: boolean; mode?: 'sync' | 'diff'; error?: string } = { ok: true }\r\n          try {\r\n            if (opts.diffEnv === true || opts.syncEnv === true) {\r\n              if (!envFile) throw new Error('env file not configured for this environment in config')\r\n              const filePath = envFile\r\n              // Resolve policy precedence: CLI > project > global policy > empty\r\n              const polOnly = (opts.only ?? (p.envOnly?.join(',') ?? (cfg.policy?.envOnly?.join(',') ?? '')))\r\n                .split(',').map(s => s.trim()).filter(Boolean)\r\n              const polIgnore = (opts.ignore ?? (p.envIgnore?.join(',') ?? (cfg.policy?.envIgnore?.join(',') ?? '')))\r\n                .split(',').map(s => s.trim()).filter(Boolean)\r\n              const polFailOnAdd: boolean = (opts.failOnAdd ?? p.failOnAdd ?? cfg.policy?.failOnAdd ?? false) as boolean\r\n              const polFailOnRemove: boolean = (opts.failOnRemove ?? p.failOnRemove ?? cfg.policy?.failOnRemove ?? false) as boolean\r\n              const common = {\r\n                provider: 'vercel' as const,\r\n                cwd: projCwd,\r\n                file: filePath,\r\n                env: env,\r\n                json: opts.json === true,\r\n                ci: opts.ci === true,\r\n                projectId: opts.projectId,\r\n                orgId: opts.orgId,\r\n                ignore: polIgnore,\r\n                only: polOnly,\r\n                failOnAdd: polFailOnAdd,\r\n                failOnRemove: polFailOnRemove,\r\n              }\r\n              if (opts.diffEnv === true) { await envDiff(common); envRes.mode = 'diff' }\r\n              if (opts.syncEnv === true) { await envSync({ ...common, yes: true, dryRun: opts.dryRun === true }); envRes.mode = 'sync' }\r\n            }\r\n          } catch (e) {\r\n            envRes.ok = false\r\n            envRes.error = e instanceof Error ? e.message : String(e)\r\n          }\r\n          const seedRes: { ok: boolean; mode?: string; error?: string } = { ok: true }\r\n          try {\r\n            if (p.seed) {\r\n              const mode = p.seed.schema\r\n              seedRes.mode = mode\r\n              if (mode === 'script') {\r\n                const script = new ScriptSeeder()\r\n                await script.seed({ cwd: projCwd, script: p.seed.script, dryRun: opts.dryRun === true, env: extraEnv })\r\n              } else if (mode === 'prisma') {\r\n                const dbUrl = (extraEnv?.DATABASE_URL ?? process.env.DATABASE_URL ?? '')\r\n                if (!dbUrl) throw new Error('DATABASE_URL missing for prisma seed')\r\n                const prisma = new PrismaSeeder()\r\n                await prisma.seed({ cwd: projCwd, dbUrl, dryRun: opts.dryRun === true, env: extraEnv })\r\n              } else if (mode === 'sql') {\r\n                const dbUrl = (extraEnv?.DATABASE_URL ?? process.env.DATABASE_URL ?? '')\r\n                if (!dbUrl) throw new Error('DATABASE_URL missing for SQL seed')\r\n                const pg = new PostgresSeeder()\r\n                await pg.seed({ cwd: projCwd, dbUrl, dryRun: opts.dryRun === true })\r\n              }\r\n            }\r\n          } catch (e) {\r\n            seedRes.ok = false\r\n            seedRes.error = e instanceof Error ? e.message : String(e)\r\n          }\r\n          results.push({ name: p.name, env: envRes, seed: seedRes })\r\n        }\r\n        // Execute layer by layer respecting dependsOn; within a layer, respect concurrency\r\n        const conc: number = (opts as unknown as { concurrency?: number }).concurrency ?? 2\r\n        for (const layer of layers) {\r\n          const projs = layer.map(name => byName.get(name)!).filter(Boolean)\r\n          await mapLimit(projs, conc, async (p) => { await worker(p) })\r\n        }\r\n        if (opts.json === true) {\r\n          logger.json(annotateRun({ ok: results.every(r => (r.seed?.ok !== false && r.env?.ok !== false)), action: 'run' as const, results, final: true }))\r\n        } else {\r\n          for (const r of results) {\r\n            if (r.env?.mode) {\r\n              if (r.env.ok) logger.success(`[${r.name}] env ${r.env.mode} ok`)\r\n              else logger.error(`[${r.name}] env ${r.env.mode} failed: ${r.env.error ?? 'unknown'}`)\r\n            }\r\n            if (r.seed?.ok) logger.success(`[${r.name}] seed ok (${r.seed.mode})`)\r\n            else logger.error(`[${r.name}] seed failed: ${r.seed?.error ?? 'unknown'}`)\r\n          }\r\n        }\r\n      } catch (err) {\r\n        const message: string = err instanceof Error ? err.message : String(err)\r\n        logger.error(message)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n","export const runSummarySchema = {\r\n  $schema: \"http://json-schema.org/draft-07/schema#\",\r\n  type: \"object\",\r\n  additionalProperties: true,\r\n  required: [\"ok\", \"action\", \"final\"],\r\n  properties: {\r\n    ok: { type: \"boolean\" },\r\n    action: { const: \"run\" },\r\n    final: { type: \"boolean\" }\r\n  }\r\n} as const\r\n","export async function mapLimit<T, R>(items: readonly T[], limit: number, worker: (item: T, index: number) => Promise<R>): Promise<readonly R[]> {\r\n  const n: number = Math.max(1, Math.floor(limit) || 1)\r\n  const results: R[] = new Array(items.length)\r\n  let next = 0\r\n  async function start(): Promise<void> {\r\n    const idx = next++\r\n    if (idx >= items.length) return\r\n    try {\r\n      results[idx] = await worker(items[idx] as T, idx)\r\n    } finally {\r\n      await start()\r\n    }\r\n  }\r\n  const runners: Promise<void>[] = []\r\n  for (let i = 0; i < Math.min(n, items.length); i++) runners.push(start())\r\n  await Promise.all(runners)\r\n  return results\r\n}\r\n","import { Command } from 'commander'\r\nimport { join } from 'node:path'\r\nimport { writeFile } from 'node:fs/promises'\r\nimport { logger } from '../utils/logger'\r\nimport { confirm } from '../utils/prompt'\r\nimport { detectNextApp } from '../core/detectors/next'\r\nimport { loadProvider } from '../core/provider-system/provider'\r\n\r\ninterface InitOptions { readonly json?: boolean }\r\n\r\nexport function registerInitCommand(program: Command): void {\r\n  program\r\n    .command('init')\r\n    .description('Initialize OpenDeploy in this project (choose provider, generate configs, set defaults)')\r\n    .option('--json', 'Output JSON summary')\r\n    .action(async (_opts: InitOptions): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      try {\r\n        const detection = await detectNextApp({ cwd })\r\n        logger.section('OpenDeploy Init')\r\n        const useVercel: boolean = await confirm('Use Vercel as a deployment provider?', { defaultYes: true })\r\n        if (!useVercel) { logger.warn('No provider selected. Nothing to do.'); return }\r\n        const autoSyncEnv: boolean = await confirm('Auto-sync .env before deploy (recommended)?', { defaultYes: true })\r\n        const cfg = {\r\n          providers: [\r\n            ...(useVercel ? ['vercel'] as const : [])\r\n          ],\r\n          env: {\r\n            autoSync: autoSyncEnv,\r\n            ignore: [] as string[],\r\n            only: [] as string[],\r\n            failOnAdd: false,\r\n            failOnRemove: false\r\n          }\r\n        }\r\n        // Generate provider configs\r\n        if (useVercel) {\r\n          const ver = await loadProvider('vercel')\r\n          await ver.validateAuth(cwd).catch(() => {/* continue; user can auth later */})\r\n          await ver.generateConfig({ detection, cwd, overwrite: false }).catch(() => {/* ignore */})\r\n          logger.success('Vercel configuration ready')\r\n        }\r\n        // Netlify support removed; please use the official Netlify CLI for config and deploy.\r\n        const path: string = join(cwd, 'opendeploy.config.json')\r\n        await writeFile(path, JSON.stringify(cfg, null, 2), 'utf8')\r\n        logger.success(`Wrote ${path}`)\r\n        logger.note('Tip: run \"opendeploy deploy <provider> --sync-env --env prod\" for single-command prod deploy')\r\n      } catch (err) {\r\n        const message: string = err instanceof Error ? err.message : String(err)\r\n        logger.error(message)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n","import { Command } from 'commander'\r\n\r\ntype Shell = 'bash' | 'zsh' | 'pwsh'\r\n\r\nfunction scriptFor(shell: Shell): string {\r\n  const cmds = [\r\n    'detect','doctor','generate','deploy','logs','open','env','seed','run','init','up','completion'\r\n  ]\r\n  const providers = ['vercel','cloudflare','github']\r\n  const envSub = ['sync','pull','diff','validate']\r\n  if (shell === 'bash') {\r\n    return `# bash completion for opendeploy\r\n_opendeploy_completions() {\r\n  local cur prev words cword\r\n  _get_comp_words_by_ref -n : cur prev words cword 2>/dev/null || { cur=${'$'}COMP_WORDS[${'$'}COMP_CWORD]; prev=${'$'}COMP_WORDS[${'$'}COMP_CWORD-1]; }\r\n  case ${'$'}COMP_CWORD in\r\n    1) COMPREPLY=( $(compgen -W \"${cmds.join(' ')}\" -- \"${'$'}cur\") ); return ;;\r\n    2) case ${'$'}prev in\r\n         deploy|logs|open|up) COMPREPLY=( $(compgen -W \"${providers.join(' ')}\" -- \"${'$'}cur\") ); return ;;\r\n         env) COMPREPLY=( $(compgen -W \"${envSub.join(' ')}\" -- \"${'$'}cur\") ); return ;;\r\n       esac;;\r\n  esac\r\n}\r\ncomplete -F _opendeploy_completions opendeploy\r\n`\r\n  }\r\n  if (shell === 'zsh') {\r\n    return `#compdef opendeploy\r\n_arguments \r\n  '1: :->sub' \r\n  '2: :->arg'\r\ncase ${'$'}state in\r\n  sub) _values 'subcommands' ${cmds.map(c=>`'${c}'`).join(' ')};;\r\n  arg) case ${'$'}words[2] in\r\n    deploy|logs|open|up) _values 'providers' ${providers.map(p=>`'${p}'`).join(' ')};;\r\n    env) _values 'envsub' ${envSub.map(s=>`'${s}'`).join(' ')};;\r\n  esac;;\r\nesac\r\n`\r\n  }\r\n  // pwsh (PowerShell) minimal stub\r\n  return `# PowerShell completion (basic) for opendeploy\r\nRegister-ArgumentCompleter -CommandName opendeploy -ScriptBlock {\r\n  param(${ '$' }wordToComplete, ${ '$' }commandAst, ${ '$' }cursorPosition)\r\n  ${ '$' }subs = @(${cmds.map(c=>`'${c}'`).join(',')})\r\n  foreach (${ '$' }s in ${ '$' }subs) { if (${ '$' }s -like \"${ '$' }wordToComplete*\") { [System.Management.Automation.CompletionResult]::new(${ '$' }s, ${ '$' }s, 'ParameterValue', ${ '$' }s) } }\r\n}\r\n`\r\n}\r\n\r\nexport function registerCompletionCommand(program: Command): void {\r\n  program\r\n    .command('completion')\r\n    .description('Print shell completion script')\r\n    .option('--shell <name>', 'Shell: bash | zsh | pwsh', 'bash')\r\n    .action(async (opts: { shell?: string }): Promise<void> => {\r\n      const sh = (opts.shell === 'zsh' ? 'zsh' : opts.shell === 'pwsh' ? 'pwsh' : 'bash') as Shell\r\n      process.stdout.write(scriptFor(sh))\r\n    })\r\n}\r\n","import { Command } from 'commander'\nimport { join } from 'node:path'\nimport { logger, isJsonMode } from '../utils/logger'\nimport { spinner } from '../utils/ui'\nimport { proc, runWithRetry } from '../utils/process'\n\nimport { fsx } from '../utils/fs'\nimport { printDeploySummary } from '../utils/summarize'\nimport Ajv from 'ajv'\nimport { promoteSummarySchema } from '../schemas/promote-summary.schema'\n\ninterface PromoteOptions {\n  readonly alias?: string\n  readonly from?: string\n  readonly path?: string\n  readonly json?: boolean\n  readonly project?: string\n  readonly org?: string\n  readonly dryRun?: boolean\n  readonly printCmd?: boolean\n  readonly retries?: string\n  readonly timeoutMs?: string\n  readonly baseDelayMs?: string\n}\n\n/**\n * Register the `promote` command.\n *\n * - Vercel: resolve latest preview deployment and assign an alias domain to it (production promotion by alias).\n */\nexport function registerPromoteCommand(program: Command): void {\n  const ajv = new Ajv({ allErrors: true, strict: false, validateSchema: false })\n  const validate = ajv.compile(promoteSummarySchema as unknown as object)\n  const annotate = (obj: Record<string, unknown>): Record<string, unknown> => {\n    const ok: boolean = validate(obj) as boolean\n    const errs: string[] = Array.isArray(validate.errors) ? validate.errors.map(e => `${e.instancePath || '/'} ${e.message ?? ''}`.trim()) : []\n    if (process.env.OPD_SCHEMA_STRICT === '1' && errs.length > 0) { process.exitCode = 1 }\n    return { ...obj, schemaOk: ok, schemaErrors: errs }\n  }\n  program\n    .command('promote')\n    .description('Promote a preview to production (Vercel)')\n    .argument('<provider>', 'Target provider: vercel')\n    .option('--alias <domain>', 'Production alias/domain (Vercel)')\n    .option('--from <urlOrSha>', 'Vercel: preview URL or commit SHA to promote; Netlify: deployId to restore')\n    .option('--path <dir>', 'Path to app directory (for monorepos)')\n    .option('--json', 'Output JSON result')\n    .option('--dry-run', 'Do not execute actual promotion')\n    .option('--project <id>', 'Provider project/site ID')\n    .option('--org <id>', 'Provider org/team ID (Vercel)')\n    .option('--print-cmd', 'Print underlying provider commands that will be executed')\n    .option('--retries <n>', 'Retries for provider commands (default 2)')\n    .option('--timeout-ms <ms>', 'Timeout per provider command in milliseconds (default 120000)')\n    .option('--base-delay-ms <ms>', 'Base delay for exponential backoff with jitter (default 300)')\n    .action(async (provider: string, opts: PromoteOptions): Promise<void> => {\n      const rootCwd: string = process.cwd()\n      const targetCwd: string = opts.path ? join(rootCwd, opts.path) : rootCwd\n      try {\n        if (opts.retries) process.env.OPD_RETRIES = String(Math.max(0, Number(opts.retries) || 0))\n        if (opts.timeoutMs) process.env.OPD_TIMEOUT_MS = String(Math.max(0, Number(opts.timeoutMs) || 0))\n        if (opts.baseDelayMs) process.env.OPD_BASE_DELAY_MS = String(Math.max(0, Number(opts.baseDelayMs) || 0))\n        const jsonMode: boolean = isJsonMode(opts.json)\n        if (jsonMode) logger.setJsonOnly(true)\n        const ndjsonOn: boolean = process.env.OPD_NDJSON === '1'\n        if (ndjsonOn) logger.setNdjson(true)\n        if (jsonMode || ndjsonOn) process.env.OPD_FORCE_CI = '1'\n        // Early dry-run summary to avoid side effects\n        if (opts.dryRun === true) {\n          const base = { ok: true, provider: 'vercel' as const, action: 'promote' as const, target: 'prod' as const }\n          const cmdPlan: string[] = (opts.alias ? [\n            opts.from ? `vercel alias set ${opts.from} ${opts.alias}` : `vercel alias set <preview-url> ${opts.alias}`,\n            ...(opts.from ? [] : [`vercel list --json -n 10`])\n          ] : [ `vercel list --json -n 10` ])\n          if (jsonMode) { logger.jsonPrint(annotate({ ...base, from: opts.from, alias: opts.alias ? `https://${opts.alias}` : undefined, cmdPlan, final: true })) }\n          else { logger.info(`[dry-run] promote vercel (alias=${opts.alias ?? 'none'})`) }\n          return\n        }\n        if (provider === 'vercel') {\n          if (!opts.alias) {\n            const msg = 'Missing --alias <domain>. Provide the production domain to point to the preview.'\n            if (jsonMode) { logger.jsonPrint(annotate({ ok: false, action: 'promote' as const, provider: 'vercel' as const, message: msg, final: true })); return }\n            logger.error(msg)\n            return\n          }\n          let previewUrl: string | undefined\n          if (opts.from) {\n            if (opts.from.startsWith('http')) {\n              previewUrl = opts.from\n            } else {\n              // Try to resolve a preview URL from a commit/identifier via `vercel inspect`\n              try {\n                const insp = await proc.run({ cmd: `vercel inspect ${opts.from}`, cwd: targetCwd })\n                const text: string = (insp.stdout || '') + '\\n' + (insp.stderr || '')\n                const m = text.match(/https?:\\/\\/[^\\s]+vercel\\.app/g)\n                if (m && m.length > 0) previewUrl = m[0]\n              } catch { /* ignore */ }\n              if (!previewUrl) throw new Error(`Could not resolve preview URL from --from=${opts.from}. Provide a preview URL or a resolvable ref.`)\n            }\n          } else {\n            // Resolve latest preview\n            const sp = spinner('Vercel: resolving latest preview')\n            try {\n              const listRes = await proc.run({ cmd: 'vercel list --json -n 10', cwd: targetCwd })\n              if (listRes.ok) {\n                try {\n                  const arr = JSON.parse(listRes.stdout) as Array<{ url?: string; readyState?: string; target?: string }>\n                  const previews = arr.filter(d => (d.target ?? '').toLowerCase() !== 'production' && (d.readyState ?? '').toLowerCase() === 'ready')\n                  previewUrl = previews[0]?.url ? (previews[0].url!.startsWith('http') ? previews[0].url! : `https://${previews[0].url!}`) : undefined\n                } catch { /* ignore */ }\n              }\n            } finally { sp.stop() }\n          }\n          if (!previewUrl) throw new Error('Could not resolve a recent preview deployment URL')\n          const aliasCmd = `vercel alias set ${previewUrl} ${opts.alias}`.trim()\n          if (opts.printCmd) logger.info(`$ ${aliasCmd}`)\n          const set = await runWithRetry({ cmd: aliasCmd, cwd: targetCwd })\n          if (!set.ok) throw new Error(set.stderr.trim() || set.stdout.trim() || 'Failed to set alias for preview')\n          if (jsonMode) { logger.jsonPrint(annotate({ ok: true, provider: 'vercel', action: 'promote', target: 'prod', from: previewUrl, url: `https://${opts.alias}`, alias: `https://${opts.alias}`, final: true })); return }\n          logger.success(`Promoted preview → ${opts.alias}`)\n          printDeploySummary({ provider: 'vercel', target: 'prod', url: `https://${opts.alias}` })\n          return\n        }\n        logger.error(`Unknown provider: ${provider}`)\n        process.exitCode = 1\n      } catch (err) {\n        const msg: string = err instanceof Error ? err.message : String(err)\n        if (isJsonMode(opts.json)) logger.jsonPrint(annotate({ ok: false, action: 'promote', provider, message: msg, final: true }))\n        logger.error(msg)\n        process.exitCode = 1\n      }\n    })\n}\n","export const promoteSummarySchema = {\r\n  $schema: \"http://json-schema.org/draft-07/schema#\",\r\n  type: \"object\",\r\n  additionalProperties: true,\r\n  required: [\"ok\", \"action\", \"provider\", \"final\"],\r\n  properties: {\r\n    ok: { type: \"boolean\" },\r\n    action: { const: \"promote\" },\r\n    provider: { type: \"string\" },\r\n    target: { type: \"string\" },\r\n    from: { type: \"string\" },\r\n    url: { type: \"string\" },\r\n    alias: { type: \"string\" },\r\n    siteId: { type: \"string\" },\r\n    cmdPlan: { type: \"array\", items: { type: \"string\" } },\r\n    message: { type: \"string\" },\r\n    final: { type: \"boolean\" }\r\n  }\r\n} as const\r\n","import { Command } from 'commander'\r\nimport { join } from 'node:path'\r\nimport { logger } from '../utils/logger'\r\nimport { detectApp } from '../core/detectors/auto'\r\nimport { fsx } from '../utils/fs'\r\nimport type { DeployPlan, DeployStep } from '../types/deploy-plan'\r\n\r\ninterface ExplainOptions {\r\n  readonly env?: 'prod' | 'preview'\r\n  readonly path?: string\r\n  readonly json?: boolean\r\n  readonly ci?: boolean\r\n  readonly project?: string\r\n  readonly org?: string\r\n  readonly syncEnv?: boolean\r\n}\r\n\r\nexport function registerExplainCommand(program: Command): void {\r\n  // Fallback printer for JSON to ensure output is emitted even if logger sinks are misconfigured\r\n  const printJson = (val: unknown): void => {\r\n    try {\r\n      // eslint-disable-next-line no-console\r\n      console.log(JSON.stringify(val))\r\n    } catch { /* ignore */ }\r\n  }\r\n  program\r\n    .command('explain')\r\n    .description('Show what will happen for a deploy, without executing anything')\r\n    .argument('<provider>', 'Target provider: vercel | cloudflare | github')\r\n    .option('--env <env>', 'Environment: prod | preview', 'preview')\r\n    .option('--path <dir>', 'Path to app directory (for monorepos)')\r\n    .option('--json', 'Output JSON plan')\r\n    .option('--ci', 'CI mode (assume strict guards)')\r\n    .option('--project <id>', 'Provider project/site ID')\r\n    .option('--org <id>', 'Provider org/team ID (Vercel)')\r\n    .option('--sync-env', 'Plan an environment sync prior to deploy')\r\n    .action(async (provider: string, opts: ExplainOptions): Promise<void> => {\r\n      const rootCwd: string = process.cwd()\r\n      const targetCwd: string = opts.path ? join(rootCwd, opts.path) : rootCwd\r\n      try {\r\n        if (opts.json === true) logger.setJsonOnly(true)\r\n        const allowed = new Set(['vercel', 'cloudflare', 'github'])\r\n        if (!allowed.has(provider)) {\r\n          if (opts.json === true) { const o = { ok: false, action: 'explain', provider, message: `Unknown provider: ${provider}`, final: true } as const; logger.jsonPrint(o); printJson(o); return }\r\n          logger.error(`Unknown provider: ${provider}`)\r\n          process.exitCode = 1\r\n          return\r\n        }\r\n        const detection = await detectApp({ cwd: targetCwd })\r\n        // Choose run cwd (same heuristic as deploy for vercel)\r\n        let runCwd = targetCwd\r\n        if (provider === 'vercel') {\r\n          const targetLink = join(targetCwd, '.vercel', 'project.json')\r\n          const rootLink = join(rootCwd, '.vercel', 'project.json')\r\n          const targetIsLinked = await fsx.exists(targetLink)\r\n          const rootIsLinked = await fsx.exists(rootLink)\r\n          runCwd = targetIsLinked ? targetCwd : (rootIsLinked ? rootCwd : targetCwd)\r\n        }\r\n        // Suggest env file\r\n        const target: 'prod' | 'preview' = opts.env === 'prod' ? 'prod' : 'preview'\r\n        const candidates = target === 'prod' ? ['.env.production.local', '.env'] : ['.env', '.env.local']\r\n        let envFile: string | undefined\r\n        for (const f of candidates) { if (await fsx.exists(join(runCwd, f))) { envFile = f; break } }\r\n        const planSteps: DeployStep[] = []\r\n        planSteps.push({ id: 'detect', title: 'Detect app and project metadata', kind: 'detect' })\r\n        if (provider === 'vercel') {\r\n          planSteps.push({ id: 'link', title: 'Ensure Vercel link (project/org)', kind: 'link' })\r\n        } else if (provider === 'cloudflare') {\r\n          planSteps.push({ id: 'link', title: 'Ensure Pages project (name)', kind: 'link' })\r\n        } else if (provider === 'github') {\r\n          planSteps.push({ id: 'link', title: 'Ensure repo origin and gh-pages branch config', kind: 'link' })\r\n        }\r\n        const wantSync = opts.syncEnv === true || Boolean(envFile)\r\n        if (wantSync) {\r\n          planSteps.push({ id: 'env', title: `Sync environment from ${envFile ?? 'local .env'} (optimized writes)`, kind: 'env' })\r\n        }\r\n        if (provider === 'vercel') {\r\n          planSteps.push({ id: 'deploy', title: `vercel deploy (${target === 'prod' ? 'production' : 'preview'})`, kind: 'deploy' })\r\n        } else if (provider === 'cloudflare') {\r\n          const pub = detection.publishDir ?? 'dist'\r\n          planSteps.push({ id: 'deploy', title: `wrangler pages deploy ${pub}`, kind: 'deploy' })\r\n        } else if (provider === 'github') {\r\n          planSteps.push({ id: 'deploy', title: 'static export (NEXT_EXPORT=1) → gh-pages publish', kind: 'deploy' })\r\n        }\r\n        const plan: DeployPlan = {\r\n          provider: provider as DeployPlan['provider'],\r\n          target,\r\n          cwd: runCwd,\r\n          steps: planSteps,\r\n          envSummary: {\r\n            plannedSync: wantSync,\r\n            file: envFile,\r\n            strictGuards: opts.ci ? ['fail-on-add', 'fail-on-remove'] : [],\r\n          },\r\n        }\r\n        if (opts.json === true) { const o = { ok: true, action: 'explain', plan, final: true } as const; logger.jsonPrint(o); printJson(o); return }\r\n        logger.section('Plan')\r\n        logger.note(`${provider} | ${target} | cwd=${runCwd}`)\r\n        for (const s of plan.steps) logger.info(`• ${s.title}`)\r\n        if (plan.envSummary.plannedSync) logger.info(`Env: from ${plan.envSummary.file ?? 'local .env'} (optimized writes)`)\r\n        if (plan.envSummary.strictGuards.length > 0) logger.info(`Strict: ${plan.envSummary.strictGuards.join(', ')}`)\r\n      } catch (err) {\r\n        const msg: string = err instanceof Error ? err.message : String(err)\r\n        if (opts.json === true) { const o = { ok: false, action: 'explain', message: msg, final: true } as const; logger.jsonPrint(o); printJson(o); return }\r\n        logger.error(msg)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n","import { Command } from 'commander'\r\nimport { join } from 'node:path'\r\nimport { logger, isJsonMode } from '../utils/logger'\r\nimport { spinner } from '../utils/ui'\r\nimport { proc, runWithRetry } from '../utils/process'\r\nimport { fsx } from '../utils/fs'\r\nimport { printDeploySummary } from '../utils/summarize'\r\nimport Ajv from 'ajv'\r\nimport { rollbackSummarySchema } from '../schemas/rollback-summary.schema'\r\n\r\ninterface RollbackOptions {\r\n  readonly alias?: string\r\n  readonly to?: string\r\n  readonly path?: string\r\n  readonly json?: boolean\r\n  readonly project?: string\r\n  readonly org?: string\r\n  readonly dryRun?: boolean\r\n  readonly printCmd?: boolean\r\n  readonly retries?: string\r\n  readonly timeoutMs?: string\r\n  readonly baseDelayMs?: string\r\n}\r\n\r\n/**\r\n * Register the `rollback` command.\r\n *\r\n * - Vercel: choose previous production or a specific target and repoint an alias to it.\r\n * - Netlify: best-effort restore of the previous production deploy via API; fallback to dashboard instructions.\r\n */\r\nexport function registerRollbackCommand(program: Command): void {\r\n  const ajv = new Ajv({ allErrors: true, strict: false, validateSchema: false })\r\n  const validate = ajv.compile(rollbackSummarySchema as unknown as object)\r\n  const annotate = (obj: Record<string, unknown>): Record<string, unknown> => {\r\n    const ok: boolean = validate(obj) as boolean\r\n    const errs: string[] = Array.isArray(validate.errors) ? validate.errors.map(e => `${e.instancePath || '/'} ${e.message ?? ''}`.trim()) : []\r\n    if (process.env.OPD_SCHEMA_STRICT === '1' && errs.length > 0) { process.exitCode = 1 }\r\n    return { ...obj, schemaOk: ok, schemaErrors: errs }\r\n  }\r\n  program\r\n    .command('rollback')\r\n    .description('Rollback production to a previous successful deployment (Vercel)')\r\n    .argument('<provider>', 'Target provider: vercel')\r\n    .option('--alias <domain>', 'Production alias/domain (Vercel)')\r\n    .option('--to <urlOrSha>', 'Specific deployment URL or commit SHA to rollback to (provider-dependent)')\r\n    .option('--path <dir>', 'Path to app directory (for monorepos)')\r\n    .option('--json', 'Output JSON result')\r\n    .option('--dry-run', 'Do not execute actual rollback')\r\n    .option('--project <id>', 'Provider project/site ID (Netlify siteId; optional)')\r\n    .option('--org <id>', 'Provider org/team ID (Vercel)')\r\n    .option('--print-cmd', 'Print underlying provider commands that will be executed')\r\n    .option('--retries <n>', 'Retries for provider commands (default 2)')\r\n    .option('--timeout-ms <ms>', 'Timeout per provider command in milliseconds (default 120000)')\r\n    .option('--base-delay-ms <ms>', 'Base delay for exponential backoff with jitter (default 300)')\r\n    .action(async (provider: string, opts: RollbackOptions): Promise<void> => {\r\n      const rootCwd: string = process.cwd()\r\n      const targetCwd: string = opts.path ? join(rootCwd, opts.path) : rootCwd\r\n      try {\r\n        if (opts.retries) process.env.OPD_RETRIES = String(Math.max(0, Number(opts.retries) || 0))\r\n        if (opts.timeoutMs) process.env.OPD_TIMEOUT_MS = String(Math.max(0, Number(opts.timeoutMs) || 0))\r\n        if (opts.baseDelayMs) process.env.OPD_BASE_DELAY_MS = String(Math.max(0, Number(opts.baseDelayMs) || 0))\r\n        const jsonMode: boolean = isJsonMode(opts.json)\r\n        if (jsonMode) logger.setJsonOnly(true)\r\n        const ndjsonOn: boolean = process.env.OPD_NDJSON === '1'\r\n        if (ndjsonOn) logger.setNdjson(true)\r\n        if (jsonMode || ndjsonOn) process.env.OPD_FORCE_CI = '1'\r\n        // Early dry-run summary to avoid side effects\r\n        if (opts.dryRun === true) {\r\n          const base = { ok: true, provider: 'vercel' as const, action: 'rollback' as const, target: 'prod' as const }\r\n          const cmdPlan: string[] = [\r\n            `vercel list --json -n 20`,\r\n            ...(opts.alias ? [`vercel alias set ${opts.to ?? '<deployment-url>'} ${opts.alias}`] : [])\r\n          ]\r\n          if (jsonMode) { logger.jsonPrint(annotate({ ...base, cmdPlan, final: true })) }\r\n          else { logger.info(`[dry-run] rollback vercel`) }\r\n          return\r\n        }\r\n        if (provider === 'vercel') {\r\n          if (!opts.alias && !opts.to) {\r\n            const msg = 'Provide --alias <domain> (required for repoint) and/or --to <url|sha> to target a specific deployment.'\r\n            if (jsonMode) { logger.jsonPrint(annotate({ ok: false, action: 'rollback' as const, provider: 'vercel' as const, message: msg, final: true })); return }\r\n            logger.error(msg)\r\n            return\r\n          }\r\n          const targetLink: string = join(targetCwd, '.vercel', 'project.json')\r\n          const rootLink: string = join(rootCwd, '.vercel', 'project.json')\r\n          const targetIsLinked: boolean = await fsx.exists(targetLink)\r\n          const rootIsLinked: boolean = await fsx.exists(rootLink)\r\n          const runCwd: string = targetIsLinked ? targetCwd : (rootIsLinked ? rootCwd : targetCwd)\r\n          let url: string | undefined = opts.to\r\n          const sp = spinner('Vercel: resolving production history')\r\n          try {\r\n            if (!url) {\r\n              const listCmd = 'vercel list --json -n 20'\r\n              if (opts.printCmd) logger.info(`$ ${listCmd}`)\r\n              const ls = await runWithRetry({ cmd: listCmd, cwd: runCwd })\r\n              if (ls.ok) {\r\n                try {\r\n                  const arr = JSON.parse(ls.stdout) as Array<Record<string, unknown>>\r\n                  const prod = arr.filter((d) => String((d as { target?: unknown }).target ?? '').toLowerCase() === 'production' && String((d as { state?: unknown }).state ?? '').toLowerCase() === 'ready')\r\n                  // Choose previous production (index 1)\r\n                  const prev = prod.length >= 2 ? prod[1] : prod[0]\r\n                  const frag = prev ? (prev as { url?: unknown }).url : undefined\r\n                  if (typeof frag === 'string' && frag.length > 0) url = frag.startsWith('http') ? frag : `https://${frag}`\r\n                } catch { /* ignore JSON parse */ }\r\n                if (!url) {\r\n                  const m = ls.stdout.match(/https?:\\/\\/[^\\s]+vercel\\.app/)\r\n                  url = m?.[0]\r\n                }\r\n              }\r\n            }\r\n            // If --to was provided but isn't a URL, try resolving via `vercel inspect`\r\n            if (url && !/^https?:\\/\\//i.test(url)) {\r\n              try {\r\n                const insp = await proc.run({ cmd: `vercel inspect ${url}`, cwd: runCwd })\r\n                const text: string = (insp.stdout || '') + '\\n' + (insp.stderr || '')\r\n                const m = text.match(/https?:\\/\\/[^\\s]+vercel\\.app/g)\r\n                if (m && m.length > 0) url = m[0]\r\n              } catch { /* ignore */ }\r\n              if (!/^https?:\\/\\//i.test(url)) throw new Error(`Could not resolve URL from --to=${opts.to}. Provide a URL or a resolvable ref.`)\r\n            }\r\n          } finally { sp.stop() }\r\n          if (!url) throw new Error('Could not resolve a previous production deployment')\r\n          if (!opts.alias) {\r\n            const msg = `Resolved candidate: ${url}. Provide --alias <domain> to repoint production.`\r\n            if (jsonMode) { logger.jsonPrint(annotate({ ok: true, provider: 'vercel', action: 'rollback', target: 'prod', candidate: url, needsAlias: true, final: true })); return }\r\n            logger.info(msg)\r\n            return\r\n          }\r\n          const aliasCmd = `vercel alias set ${url} ${opts.alias}`.trim()\r\n          if (opts.printCmd) logger.info(`$ ${aliasCmd}`)\r\n          const res = await runWithRetry({ cmd: aliasCmd, cwd: runCwd })\r\n          if (!res.ok) throw new Error(res.stderr.trim() || res.stdout.trim() || 'Failed to point alias to previous deployment')\r\n          if (jsonMode) { logger.jsonPrint(annotate({ ok: true, provider: 'vercel', action: 'rollback', target: 'prod', to: url, url: `https://${opts.alias}`, alias: `https://${opts.alias}`, final: true })); return }\r\n          logger.success(`Rolled back production → ${opts.alias}`)\r\n          if (opts.alias) printDeploySummary({ provider: 'vercel', target: 'prod', url: `https://${opts.alias}` })\r\n          return\r\n        }\r\n        \r\n        logger.error(`Unknown provider: ${provider}`)\r\n        process.exitCode = 1\r\n      } catch (err) {\r\n        const msg: string = err instanceof Error ? err.message : String(err)\r\n        if (isJsonMode(opts.json)) logger.jsonPrint(annotate({ ok: false, action: 'rollback', provider, message: msg, final: true }))\r\n        logger.error(msg)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n","export const rollbackSummarySchema = {\r\n  $schema: \"http://json-schema.org/draft-07/schema#\",\r\n  type: \"object\",\r\n  additionalProperties: true,\r\n  required: [\"ok\", \"action\", \"provider\", \"final\"],\r\n  properties: {\r\n    ok: { type: \"boolean\" },\r\n    action: { const: \"rollback\" },\r\n    provider: { type: \"string\" },\r\n    target: { type: \"string\" },\r\n    to: { type: \"string\" },\r\n    candidate: { type: \"string\" },\r\n    needsAlias: { type: \"boolean\" },\r\n    deployId: { type: \"string\" },\r\n    dashboard: { type: \"string\" },\r\n    cmdPlan: { type: \"array\", items: { type: \"string\" } },\r\n    message: { type: \"string\" },\r\n    final: { type: \"boolean\" }\r\n  }\r\n} as const\r\n","import { Command } from 'commander'\r\nimport { logger, isJsonMode } from '../utils/logger'\r\nimport { loadProvider } from '../core/provider-system/provider'\r\nimport { join } from 'node:path'\r\nimport { mkdir, writeFile } from 'node:fs/promises'\r\nimport { fsx } from '../utils/fs'\r\nimport { renderGithubPagesWorkflow } from '../utils/workflows'\r\n\r\nexport function registerProvidersCommand(program: Command): void {\r\n  program\r\n    .command('providers')\r\n    .description('List and inspect provider plugins')\r\n    .option('--json', 'Output JSON')\r\n    .option('--id <name>', 'Show info for a specific provider (e.g., vercel, cloudflare, github)')\r\n    .option('--emit-workflow', 'When --id=github, write a GitHub Pages deploy workflow to .github/workflows/deploy-pages.yml')\r\n    .option('--base-path <path>', 'Base path for site (e.g., /repo). Overrides auto-inference from package name')\r\n    .option('--site-origin <url>', 'Public site origin (e.g., https://<owner>.github.io)')\r\n    .action(async (opts: { json?: boolean; id?: string }): Promise<void> => {\r\n      try {\r\n        const jsonMode = isJsonMode(opts.json)\r\n        if (jsonMode) logger.setJsonOnly(true)\r\n        const candidates: readonly string[] = opts.id ? [opts.id] : ['vercel', 'cloudflare', 'github']\r\n        const results: Array<{ id: string; ok: boolean; error?: string; capabilities?: unknown }> = []\r\n        for (const id of candidates) {\r\n          try {\r\n            if (id.toLowerCase() === 'netlify') throw new Error('Netlify is not supported by OpenDeploy. Please use the official Netlify CLI.')\r\n            const p = await loadProvider(id)\r\n            results.push({ id, ok: true, capabilities: p.getCapabilities() })\r\n          } catch (e) {\r\n            results.push({ id, ok: false, error: (e as Error).message })\r\n          }\r\n        }\r\n        // Optional: emit GitHub Pages workflow when requested\r\n        const wantWorkflow = (opts as any).emitWorkflow === true || (opts as any)['emit-workflow'] === true\r\n        if (wantWorkflow) {\r\n          const id = (opts.id || '').toLowerCase()\r\n          if (id !== 'github') throw new Error('--emit-workflow currently only supports --id=github')\r\n          const cwd = process.cwd()\r\n          const pkgPath = join(cwd, 'package.json')\r\n          let basePath = typeof (opts as any).basePath === 'string' ? String((opts as any).basePath).trim() : ''\r\n          if (basePath.length === 0) {\r\n            try {\r\n              const pkg = await fsx.readJson<Record<string, unknown>>(pkgPath)\r\n              const name = String((pkg as any)?.name || '').replace(/^@[^/]+\\//, '')\r\n              if (name) basePath = `/${name}`\r\n            } catch { /* ignore, fallback below */ }\r\n            if (basePath.length === 0) basePath = '/site'\r\n          }\r\n          const siteOrigin: string | undefined = typeof (opts as any).siteOrigin === 'string' ? String((opts as any).siteOrigin).trim() : undefined\r\n          const wfDir = join(cwd, '.github', 'workflows')\r\n          await mkdir(wfDir, { recursive: true })\r\n          const wfPath = join(wfDir, 'deploy-pages.yml')\r\n          const content = renderGithubPagesWorkflow({ basePath, siteOrigin })\r\n          await writeFile(wfPath, content, 'utf8')\r\n          if (jsonMode) { logger.json({ ok: true, action: 'emit-workflow', provider: 'github', path: wfPath, basePath, siteOrigin, final: true }); return }\r\n          logger.info(`Wrote GitHub Pages workflow: ${wfPath}`)\r\n          logger.info(`Base path: ${basePath}${siteOrigin ? ` • Site origin: ${siteOrigin}` : ''}`)\r\n        }\r\n        if (jsonMode) { logger.json({ ok: true, providers: results, final: true }); return }\r\n        logger.section('Providers')\r\n        for (const r of results) {\r\n          if (r.ok) logger.info(`${r.id}: ready`)\r\n          else logger.warn(`${r.id}: ${r.error}`)\r\n        }\r\n      } catch (err) {\r\n        const msg = err instanceof Error ? err.message : String(err)\r\n        if (isJsonMode(opts.json)) logger.json({ ok: false, message: msg, final: true })\r\n        logger.error(msg)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n","import { Command } from 'commander'\r\nimport { join, isAbsolute } from 'node:path'\r\nimport { loadProvider } from '../core/provider-system/provider'\r\nimport { logger, isJsonMode } from '../utils/logger'\r\n\r\ninterface PlanOptions {\r\n  readonly env?: 'prod' | 'preview'\r\n  readonly project?: string\r\n  readonly org?: string\r\n  readonly path?: string\r\n  readonly json?: boolean\r\n}\r\n\r\nexport function registerPlanCommand(program: Command): void {\r\n  program\r\n    .command('plan')\r\n    .description('Compute a provider-aware build and deploy plan (does not execute)')\r\n    .argument('<provider>', 'Target provider: vercel | cloudflare | github')\r\n    .option('--env <env>', 'Environment: prod | preview', 'preview')\r\n    .option('--project <id>', 'Provider project/site identifier (name or ID)')\r\n    .option('--org <id>', 'Provider org/team ID or slug')\r\n    .option('--path <dir>', 'Path to app directory (for monorepos)')\r\n    .option('--json', 'Output JSON (recommended for CI)')\r\n    .action(async (provider: string, opts: PlanOptions): Promise<void> => {\r\n      const rootCwd: string = process.cwd()\r\n      const targetCwd: string = opts.path ? (isAbsolute(opts.path) ? opts.path : join(rootCwd, opts.path)) : rootCwd\r\n      try {\r\n        const jsonMode: boolean = isJsonMode(opts.json)\r\n        if (jsonMode) logger.setJsonOnly(true)\r\n        const p = await loadProvider(provider)\r\n        const caps = p.getCapabilities()\r\n        const envTarget: 'preview' | 'production' = opts.env === 'prod' ? 'production' : 'preview'\r\n        let publishDir: string | undefined\r\n        let framework: string | undefined\r\n        try {\r\n          const d = await p.detect(targetCwd)\r\n          publishDir = d.publishDir\r\n          framework = d.framework\r\n        } catch { /* ignore */ }\r\n        // Heuristic command suggestions per provider\r\n        const cmdPlan: string[] = []\r\n        if (provider === 'vercel') {\r\n          cmdPlan.push(envTarget === 'production' ? 'vercel deploy --prod --yes' : 'vercel deploy --yes')\r\n          if (opts.project) cmdPlan.unshift(`vercel link --yes${opts.project ? ` --project ${opts.project}` : ''}${opts.org ? ` --org ${opts.org}` : ''}`.trim())\r\n        } else if (provider === 'cloudflare') {\r\n          // Framework-aware: Astro → dist, SvelteKit → build, Next → out (requires static export or next-on-pages)\r\n          const fw = (framework || '').toLowerCase()\r\n          let dir = publishDir\r\n          if (!dir) {\r\n            if (fw === 'astro') dir = 'dist'\r\n            else if (fw === 'sveltekit') dir = 'build'\r\n            else if (fw === 'next') dir = 'out'\r\n            else dir = 'dist'\r\n          }\r\n          if (fw === 'next') cmdPlan.push('# Next.js on Cloudflare Pages requires static export or next-on-pages for SSR.')\r\n          cmdPlan.push(`wrangler pages deploy ${dir}${opts.project ? ` --project-name ${opts.project}` : ''}`.trim())\r\n        } else if (provider === 'github') {\r\n          // Framework-aware: Astro → dist, SvelteKit → build, Next → out (static export)\r\n          const fw = (framework || '').toLowerCase()\r\n          if (fw === 'astro') {\r\n            cmdPlan.push('gh-pages -d dist')\r\n          } else if (fw === 'sveltekit') {\r\n            cmdPlan.push('gh-pages -d build')\r\n          } else if (fw === 'next') {\r\n            cmdPlan.push('# Next.js on GitHub Pages requires static export (next.config.js: output: \"export\").')\r\n            cmdPlan.push('next build && gh-pages -d out')\r\n          } else {\r\n            const dir = publishDir ?? 'dist'\r\n            cmdPlan.push(`gh-pages -d ${dir}`)\r\n          }\r\n        } else {\r\n          cmdPlan.push(`# unknown provider: ${provider}`)\r\n        }\r\n        const plan = {\r\n          ok: true,\r\n          action: 'plan' as const,\r\n          provider,\r\n          capabilities: caps,\r\n          target: envTarget,\r\n          cwd: targetCwd,\r\n          framework,\r\n          publishDir,\r\n          cmdPlan,\r\n          final: true\r\n        }\r\n        logger.jsonPrint(plan)\r\n      } catch (err) {\r\n        const msg: string = err instanceof Error ? err.message : String(err)\r\n        if (isJsonMode(opts.json)) logger.json({ ok: false, action: 'plan', provider, message: msg, final: true })\r\n        logger.error(msg)\r\n        process.exitCode = 1\r\n      }\r\n    })\r\n}\r\n","import { Command } from 'commander'\nimport { join, isAbsolute } from 'node:path'\nimport { logger, isJsonMode } from '../utils/logger'\nimport { fsx } from '../utils/fs'\nimport { spinner } from '../utils/ui'\nimport { startHeartbeat, type Stopper } from '../utils/progress'\nimport { readFile as readFileFs } from 'node:fs/promises'\nimport { proc, runWithRetry } from '../utils/process'\nimport { envSync } from './env'\nimport { printDeploySummary } from '../utils/summarize'\nimport { computeRedactors } from '../utils/redaction'\nimport { extractVercelInspectUrl } from '../utils/inspect'\nimport { runStartWizard } from './start'\nimport { detectApp } from '../core/detectors/auto'\nimport type { Framework } from '../types/framework'\nimport { loadProvider } from '../core/provider-system/provider'\nimport Ajv from 'ajv'\nimport { upSummarySchema } from '../schemas/up-summary.schema'\nimport { providerBuildResultSchema } from '../schemas/provider-build-result.schema'\nimport { providerDeployResultSchema } from '../schemas/provider-deploy-result.schema'\nimport { runWithTimeout } from '../utils/process'\n\ninterface UpOptions {\n  readonly path?: string\n  readonly json?: boolean\n  readonly ci?: boolean\n  readonly syncEnv?: boolean\n  readonly alias?: string\n  readonly project?: string\n  readonly org?: string\n  readonly env?: 'prod' | 'preview'\n  readonly dryRun?: boolean\n  readonly printCmd?: boolean\n  readonly retries?: string\n  readonly timeoutMs?: string\n  readonly baseDelayMs?: string\n  readonly ndjson?: boolean\n  readonly noBuild?: boolean\n  readonly preflightOnly?: boolean\n  readonly strictPreflight?: boolean\n  readonly preflightArtifactsOnly?: boolean\n  readonly fixPreflight?: boolean\n}\n\nfunction inferPublishDir(fw: Framework): string {\n  if (fw === 'nuxt') return '.output/public'\n  if (fw === 'remix') return 'build/client'\n  if (fw === 'astro') return 'dist'\n  if (fw === 'expo') return 'dist'\n  if (fw === 'next') return '.next'\n  if (fw === 'sveltekit') return 'build'\n  return 'dist'\n}\n\nfunction providerLoginUrl(p: string): string {\n  const prov: string = String(p)\n  if (prov === 'vercel') return 'https://vercel.com/login'\n  if (prov === 'cloudflare') return 'https://dash.cloudflare.com/login'\n  return 'https://github.com/login'\n}\n\nasync function openUrl(url: string): Promise<boolean> {\n  try {\n    const u: string = url\n    const cmd: string = process.platform === 'win32'\n      ? `powershell -NoProfile -NonInteractive -Command Start-Process \"${u}\"`\n      : process.platform === 'darwin'\n        ? `open \"${u}\"`\n        : `xdg-open \"${u}\"`\n    const res = await runWithTimeout({ cmd }, 5_000)\n    return res.ok\n  } catch { return false }\n}\n\n/**\n * Register the `up` command (preview deploy with smart defaults).\n * - Detects Next.js app\n * - Optionally syncs env from local file (optimized writes)\n * - Deploys to preview on selected provider\n * - Optionally assigns alias (Vercel)\n */\nexport function registerUpCommand(program: Command): void {\n  const ajv = new Ajv({ allErrors: true, strict: false, validateSchema: false })\n  const validate = ajv.compile(upSummarySchema as unknown as object)\n  const validateBuild = ajv.compile(providerBuildResultSchema as unknown as object)\n  const validateDeploy = ajv.compile(providerDeployResultSchema as unknown as object)\n  const annotate = (obj: Record<string, unknown>): Record<string, unknown> => {\n    const ok: boolean = validate(obj) as boolean\n    const errs: string[] = Array.isArray(validate.errors) ? validate.errors.map(e => `${e.instancePath || '/'} ${e.message ?? ''}`.trim()) : []\n    if (process.env.OPD_SCHEMA_STRICT === '1' && errs.length > 0) { process.exitCode = 1 }\n    return { ...obj, schemaOk: ok, schemaErrors: errs }\n  }\n  program\n    .command('up')\n    .description('Deploy to preview with safe defaults (env sync + deploy)')\n    .argument('[provider]', 'Target provider: vercel | cloudflare | github')\n    .option('--env <env>', 'Environment: prod | preview', 'preview')\n    .option('--path <dir>', 'Path to app directory (for monorepos)')\n    .option('--json', 'Output JSON result')\n    .option('--ci', 'CI mode (non-interactive)')\n    .option('--dry-run', 'Do not execute actual deployment')\n    .option('--sync-env', 'Sync environment from local .env before deploy')\n    .option('--alias <domain>', 'After deploy, assign this alias to the deployment (vercel only)')\n    .option('--project <id>', 'Provider project/site ID')\n    .option('--org <id>', 'Provider org/team ID (Vercel)')\n    .option('--print-cmd', 'Print underlying provider commands that will be executed')\n    .option('--retries <n>', 'Retries for provider commands (default 2)')\n    .option('--timeout-ms <ms>', 'Timeout per provider command in milliseconds (default 120000)')\n    .option('--base-delay-ms <ms>', 'Base delay for exponential backoff with jitter (default 300)')\n    .option('--ndjson', 'Output NDJSON events for progress')\n    .option('--no-build', 'Skip local build; deploy existing publish directory (when supported)')\n    .option('--preflight-only', 'Run preflight checks and exit without building/publishing (GitHub Pages)')\n    .option('--strict-preflight', 'Treat preflight warnings as errors (GitHub/Cloudflare)')\n    .option('--preflight-artifacts-only', 'Run provider build and asset sanity, then exit without deploying (Cloudflare/GitHub)')\n    .option('--fix-preflight', 'Apply safe preflight fixes (e.g., ensure .nojekyll for GitHub Pages)')\n    .action(async (provider: string | undefined, opts: UpOptions): Promise<void> => {\n      const rootCwd: string = process.cwd()\n      const targetCwd: string = opts.path ? (isAbsolute(opts.path) ? opts.path : join(rootCwd, opts.path)) : rootCwd\n      try {\n        // Ultra-early fast path for Cloudflare preflight in tests/CI to avoid timeouts\n        const jsonQuick: boolean = isJsonMode(opts.json)\n        if (provider === 'cloudflare' && (opts.preflightOnly === true || opts.strictPreflight === true)) {\n          const preflight: Array<{ readonly name: string; readonly ok: boolean; readonly level: 'warn' | 'note'; readonly message?: string }> = []\n          let warned = false\n          try {\n            // Read next.config.* if present\n            const candidates = ['next.config.ts', 'next.config.js', 'next.config.mjs']\n            let cfg = ''\n            for (const f of candidates) { const pth = join(targetCwd, f); if (await fsx.exists(pth)) { cfg = await readFileFs(pth, 'utf8'); break } }\n            if (cfg.length > 0) {\n              if (/output\\s*:\\s*['\"]export['\"]/m.test(cfg)) { preflight.push({ name: 'cloudflare: next.config output export omitted', ok: false, level: 'warn', message: 'remove output: \"export\"' }); warned = true }\n              if (/assetPrefix\\s*:\\s*['\"][^'\\\"]+['\"]/m.test(cfg)) { preflight.push({ name: 'cloudflare: assetPrefix absent', ok: false, level: 'warn', message: 'remove assetPrefix' }); warned = true }\n              const m = cfg.match(/basePath\\s*:\\s*['\"]([^'\\\"]*)['\"]/m)\n              if (m && m[1] && m[1] !== '') { preflight.push({ name: 'cloudflare: basePath empty', ok: false, level: 'warn', message: 'set basePath to \"\"' }); warned = true }\n              if (/trailingSlash\\s*:\\s*true/m.test(cfg)) { preflight.push({ name: 'cloudflare: trailingSlash recommended false', ok: true, level: 'note', message: 'set trailingSlash: false' }) }\n            }\n          } catch { /* ignore */ }\n          try {\n            const wranglerPath = join(targetCwd, 'wrangler.toml')\n            if (await fsx.exists(wranglerPath)) {\n              const raw = await readFileFs(wranglerPath, 'utf8')\n              if (!/pages_build_output_dir\\s*=\\s*\"\\.vercel\\/output\\/static\"/m.test(raw)) { preflight.push({ name: 'cloudflare: wrangler pages_build_output_dir', ok: false, level: 'warn', message: 'set to .vercel/output/static' }); warned = true }\n              if (!/pages_functions_directory\\s*=\\s*\"\\.vercel\\/output\\/functions\"/m.test(raw)) { preflight.push({ name: 'cloudflare: wrangler pages_functions_directory', ok: true, level: 'note', message: 'set to .vercel/output/functions' }) }\n              if (!/compatibility_flags\\s*=\\s*\\[.*\"nodejs_compat\".*\\]/m.test(raw)) { preflight.push({ name: 'cloudflare: wrangler nodejs_compat flag', ok: true, level: 'note', message: 'add compatibility_flags = [\"nodejs_compat\"]' }) }\n            } else {\n              preflight.push({ name: 'cloudflare: wrangler.toml present', ok: false, level: 'warn', message: 'missing wrangler.toml' }); warned = true\n            }\n          } catch { /* ignore */ }\n          const targetShort: 'prod' | 'preview' = (opts.env === 'prod' ? 'prod' : 'preview')\n          if (opts.strictPreflight && warned) {\n            if (jsonQuick) { logger.jsonPrint({ ok: false, action: 'up' as const, provider: 'cloudflare' as const, target: targetShort, message: 'Preflight failed (strict): resolve Next.js Cloudflare Pages warnings.', preflightOnly: true, preflight, final: true }); process.exit(1) }\n            throw new Error('Preflight failed (strict): resolve Next.js Cloudflare Pages warnings.')\n          }\n          if (opts.preflightOnly) {\n            if (jsonQuick) { logger.jsonPrint({ ok: true, action: 'up' as const, provider: 'cloudflare' as const, target: targetShort, preflightOnly: true, preflight, final: true }); process.exit(0) }\n            logger.success('Preflight checks completed (Cloudflare Pages). No build/publish performed.')\n            return\n          }\n        }\n        const jsonMode: boolean = isJsonMode(opts.json)\n        const ndjsonOn: boolean = opts.ndjson === true || process.env.OPD_NDJSON === '1'\n        if (ndjsonOn) logger.setNdjson(true)\n        // Structured preflight capture for JSON consumers\n        const preflight: Array<{ readonly name: string; readonly ok: boolean; readonly level: 'warn' | 'note'; readonly message?: string }> = []\n        if (jsonMode) logger.setJsonOnly(true)\n        if (jsonMode || ndjsonOn || opts.ci === true) process.env.OPD_FORCE_CI = '1'\n        if (opts.retries) process.env.OPD_RETRIES = String(Math.max(0, Number(opts.retries) || 0))\n        if (opts.timeoutMs) process.env.OPD_TIMEOUT_MS = String(Math.max(0, Number(opts.timeoutMs) || 0))\n        if (opts.baseDelayMs) process.env.OPD_BASE_DELAY_MS = String(Math.max(0, Number(opts.baseDelayMs) || 0))\n        // If provider is missing, fall back to the guided wizard\n        if (!provider) {\n          await runStartWizard({ provider: undefined, env: (opts.env === 'prod' ? 'prod' : 'preview'), path: opts.path, project: opts.project, org: opts.org, syncEnv: Boolean(opts.syncEnv), json: Boolean(opts.json), ci: Boolean(opts.ci), dryRun: Boolean(opts.dryRun) })\n          return\n        }\n        // Signal to any nested flows/tools that env sync is desired for single-command up\n        process.env.OPD_SYNC_ENV = '1'\n        // Plugin-first flow unless explicitly opting into legacy\n        if (process.env.OPD_LEGACY !== '1') {\n          const allowed: readonly string[] = ['vercel', 'cloudflare', 'github']\n          // Explicitly reject Netlify\n          if (provider && provider.toLowerCase() === 'netlify') {\n            const msg = 'Netlify is not supported by OpenDeploy. Please use the official Netlify CLI.'\n            if (jsonMode) { logger.jsonPrint({ ok: false, action: 'up' as const, provider: 'netlify', message: msg, final: true }); return }\n            throw new Error(msg)\n          }\n          const prov: string = (provider && allowed.includes(provider)) ? provider : 'vercel'\n          const envTargetUp: 'preview' | 'production' = (opts.env === 'prod' ? 'production' : 'preview')\n          // Early preflight short-circuit for Cloudflare to avoid provider linking\n          if (prov === 'cloudflare' && (opts.preflightOnly === true || opts.strictPreflight === true)) {\n            try {\n              // Prepare preflight results\n              const preflight: Array<{ readonly name: string; readonly ok: boolean; readonly level: 'warn' | 'note'; readonly message?: string }> = []\n              let warned = false\n              // Detect presence of next.config.*\n              let hasNextConfig = false\n              try {\n                const cands = ['next.config.ts', 'next.config.js', 'next.config.mjs']\n                for (const f of cands) { if (await fsx.exists(join(targetCwd, f))) { hasNextConfig = true; break } }\n              } catch { /* ignore */ }\n              // Only run Next-specific checks if Next.js is present or next.config exists\n              if (hasNextConfig) {\n                try {\n                  let cfg = ''\n                  const candidates = ['next.config.ts', 'next.config.js', 'next.config.mjs']\n                  for (const f of candidates) { const pth = join(targetCwd, f); if (await fsx.exists(pth)) { cfg = await readFileFs(pth, 'utf8'); break } }\n                  if (cfg.length > 0) {\n                    const hasOutputExport: boolean = /output\\s*:\\s*['\"]export['\"]/m.test(cfg)\n                    if (hasOutputExport) { preflight.push({ name: 'cloudflare: next.config output export omitted', ok: false, level: 'warn', message: 'remove output: \"export\"' }); warned = true }\n                    const hasAssetPrefix: boolean = /assetPrefix\\s*:\\s*['\"][^'\\\"]+['\"]/m.test(cfg)\n                    if (hasAssetPrefix) { preflight.push({ name: 'cloudflare: assetPrefix absent', ok: false, level: 'warn', message: 'remove assetPrefix' }); warned = true }\n                    const basePathMatch = cfg.match(/basePath\\s*:\\s*['\"]([^'\\\"]*)['\"]/m)\n                    if (basePathMatch && basePathMatch[1] && basePathMatch[1] !== '') { preflight.push({ name: 'cloudflare: basePath empty', ok: false, level: 'warn', message: 'set basePath to \"\"' }); warned = true }\n                    const trailingTrue: boolean = /trailingSlash\\s*:\\s*true/m.test(cfg)\n                    if (trailingTrue) { preflight.push({ name: 'cloudflare: trailingSlash recommended false', ok: true, level: 'note', message: 'set trailingSlash: false' }) }\n                  }\n                } catch { /* ignore */ }\n              }\n              // wrangler.toml checks\n              try {\n                const wranglerPath = join(targetCwd, 'wrangler.toml')\n                if (await fsx.exists(wranglerPath)) {\n                  const raw = await readFileFs(wranglerPath, 'utf8')\n                  if (!/pages_build_output_dir\\s*=\\s*\"\\.vercel\\/output\\/static\"/m.test(raw)) { preflight.push({ name: 'cloudflare: wrangler pages_build_output_dir', ok: false, level: 'warn', message: 'set to .vercel/output/static' }); warned = true }\n                  if (!/pages_functions_directory\\s*=\\s*\"\\.vercel\\/output\\/functions\"/m.test(raw)) { preflight.push({ name: 'cloudflare: wrangler pages_functions_directory', ok: true, level: 'note', message: 'set to .vercel/output/functions' }) }\n                  if (!/compatibility_flags\\s*=\\s*\\[.*\"nodejs_compat\".*\\]/m.test(raw)) { preflight.push({ name: 'cloudflare: wrangler nodejs_compat flag', ok: true, level: 'note', message: 'add compatibility_flags = [\"nodejs_compat\"]' }) }\n                } else {\n                  preflight.push({ name: 'cloudflare: wrangler.toml present', ok: false, level: 'warn', message: 'missing wrangler.toml' }); warned = true\n                }\n              } catch { /* ignore */ }\n              const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n              if (opts.strictPreflight && warned) { if (jsonMode) { logger.jsonPrint({ ok: false, action: 'up' as const, provider: 'cloudflare' as const, target: targetShort, message: 'Preflight failed (strict): resolve Next.js Cloudflare Pages warnings.', preflightOnly: true, preflight, final: true }); process.exit(1) } throw new Error('Preflight failed (strict): resolve Next.js Cloudflare Pages warnings.') }\n              if (opts.preflightOnly) { if (jsonMode) { logger.jsonPrint({ ok: true, action: 'up' as const, provider: 'cloudflare' as const, target: targetShort, preflightOnly: true, preflight, final: true }); process.exit(0) } logger.success('Preflight checks completed (Cloudflare Pages). No build/publish performed.'); return }\n            } catch (e) {\n              // fall through to general error handler\n              throw e\n            }\n          }\n          // Early dry-run (no provider CLI needed)\n          if (opts.dryRun === true) {\n            const envShort: 'prod' | 'preview' = (opts.env === 'prod' ? 'prod' : 'preview')\n            if (jsonMode) {\n              const cmdPlan: string[] = []\n              if (prov === 'vercel') {\n                if (opts.project || opts.org) cmdPlan.push(`vercel link --yes${opts.project ? ` --project ${opts.project}` : ''}${opts.org ? ` --org ${opts.org}` : ''}`.trim())\n                cmdPlan.push(envTargetUp === 'production' ? 'vercel deploy --prod --yes' : 'vercel deploy --yes')\n                if (opts.alias) cmdPlan.push(`vercel alias set <deployment-url> ${opts.alias}`)\n              } else if (prov === 'cloudflare') {\n                // Choose publish dir by framework; add guidance for Next.js\n                try {\n                  const det = await detectApp({ cwd: targetCwd })\n                  const fw = det.framework as Framework\n                  let dir = det.publishDir\n                  if (!dir) {\n                    if (fw === 'astro') dir = 'dist'\n                    else if (fw === 'sveltekit') dir = 'build'\n                    else if (fw === 'next') dir = 'out' // static export path; requires next export or next-on-pages\n                    else dir = 'dist'\n                  }\n                  if (fw === 'next') {\n                    cmdPlan.push('# Next.js on Cloudflare Pages requires static export or next-on-pages (SSR). Consider Vercel for hybrid/SSR.')\n                  }\n                  cmdPlan.push(`wrangler pages deploy ${dir}`.trim())\n                } catch {\n                  cmdPlan.push('wrangler pages deploy dist')\n                }\n              } else if (prov === 'github') {\n                // Framework-aware GitHub Pages plan\n                try {\n                  const det = await detectApp({ cwd: targetCwd })\n                  const fw = det.framework as Framework\n                  if (fw === 'astro') {\n                    cmdPlan.push('gh-pages -d dist')\n                  } else if (fw === 'sveltekit') {\n                    cmdPlan.push('gh-pages -d build')\n                  } else if (fw === 'next') {\n                    cmdPlan.push('# Next.js on GitHub Pages requires static export (next.config.js: output: \"export\").')\n                    cmdPlan.push('next build && gh-pages -d out')\n                  } else {\n                    const dir = det.publishDir ?? 'dist'\n                    cmdPlan.push(`gh-pages -d ${dir}`)\n                  }\n                } catch {\n                  cmdPlan.push('gh-pages -d dist')\n                }\n              }\n              logger.jsonPrint(annotate({ ok: true, action: 'up' as const, provider: prov, target: envShort, mode: 'dry-run', cmdPlan, final: true }))\n              return\n            }\n            logger.info(`[dry-run] up ${prov} (env=${envShort})`)\n            return\n          }\n          const p = await loadProvider(prov)\n          if (process.env.OPD_SKIP_VALIDATE !== '1') {\n            try {\n              await p.validateAuth(targetCwd)\n            } catch {\n              if (opts.ci) throw new Error(`${prov} login required`)\n              const cmd = prov === 'vercel' ? 'vercel login' : prov === 'cloudflare' ? 'wrangler login' : 'git remote -v'\n              logger.section('Auth')\n              logger.note(`Running: ${cmd}`)\n              const res = await proc.run({ cmd, cwd: targetCwd })\n              let revalidated = false\n              if (res.ok) {\n                try { await p.validateAuth(targetCwd); revalidated = true } catch { /* ignore */ }\n              }\n              if (!revalidated) {\n                const url = providerLoginUrl(prov)\n                logger.note(`Opening provider login page: ${url}`)\n                try { await openUrl(url) } catch { /* ignore */ }\n                try { await p.validateAuth(targetCwd); revalidated = true } catch { /* ignore */ }\n              }\n              if (!revalidated) throw new Error(`${prov} login failed`)\n            }\n          }\n          // Optional env sync for supported providers\n          const wantSync: boolean = opts.syncEnv === true || process.env.OPD_SYNC_ENV === '1'\n          if (wantSync && prov === 'vercel') {\n            const candidates: readonly string[] = envTargetUp === 'production' ? ['.env.production.local', '.env'] : ['.env', '.env.local']\n            let chosenFile: string | undefined\n            for (const f of candidates) { if (await fsx.exists(join(targetCwd, f))) { chosenFile = f; break } }\n            if (chosenFile) {\n              logger.section('Environment')\n              logger.note(`Syncing ${chosenFile} → ${prov}`)\n              try {\n                try { const patterns = await computeRedactors({ cwd: targetCwd, envFiles: [chosenFile], includeProcessEnv: true }); if (patterns.length > 0) logger.setRedactors(patterns) } catch { /* ignore */ }\n                await envSync({ provider: prov, cwd: targetCwd, file: chosenFile, env: (opts.env === 'prod' ? 'prod' : 'preview'), yes: true, ci: Boolean(opts.ci), json: false, projectId: opts.project, orgId: opts.org, ignore: [], only: [], optimizeWrites: true })\n                logger.success('Environment sync complete')\n              } catch (e) { logger.warn(`Env sync skipped: ${(e as Error).message}`) }\n            }\n          }\n          const linked = await p.link(targetCwd, { projectId: opts.project, orgId: opts.org })\n          let publishDirHint: string | undefined\n          let frameworkHint: string | undefined\n          try { const d = await p.detect(targetCwd); publishDirHint = d.publishDir; frameworkHint = d.framework } catch { /* ignore */ }\n          // Fallback: global auto-detect when provider-specific detection did not identify the framework\n          if (!frameworkHint) {\n            try { const d2 = await detectApp({ cwd: targetCwd }); publishDirHint = publishDirHint ?? d2.publishDir; frameworkHint = d2.framework } catch { /* ignore */ }\n          }\n          // Detect presence of next.config.* to strengthen preflight triggers\n          let hasNextConfig = false\n          try {\n            const cands = ['next.config.ts', 'next.config.js', 'next.config.mjs']\n            for (const f of cands) { if (await fsx.exists(join(targetCwd, f))) { hasNextConfig = true; break } }\n          } catch { /* ignore */ }\n          // Preflight: Next.js on GitHub Pages requires basePath/assetPrefix matching repo and static export\n          if (prov === 'github' && (((frameworkHint || '').toLowerCase() === 'next') || hasNextConfig)) {\n            try {\n              let warned = false\n              // Derive repo name from git origin\n              let repo: string | undefined\n              // Derive repo name for basePath/assetPrefix checks\n              let repoSource: 'env' | 'origin' | 'unknown' = 'unknown'\n              const ghEnv: string | undefined = process.env.GITHUB_REPOSITORY\n              if (ghEnv && ghEnv.includes('/')) { repo = ghEnv.split('/')[1]; if (repo) repoSource = 'env' }\n              if (!repo) {\n                try {\n                  const origin = await proc.run({ cmd: 'git remote get-url origin', cwd: targetCwd })\n                  if (origin.ok) {\n                    const t = origin.stdout.trim()\n                    const httpsRe = /^https?:\\/\\/github\\.com\\/(.+?)\\/(.+?)(?:\\.git)?$/i\n                    const sshRe = /^git@github\\.com:(.+?)\\/(.+?)(?:\\.git)?$/i\n                    const m1 = t.match(httpsRe); const m2 = t.match(sshRe)\n                    const r = (m1?.[2] || m2?.[2] || '').trim()\n                    if (r) { repo = r; repoSource = 'origin' }\n                  }\n                } catch { /* ignore */ }\n              }\n              // Read next.config.* best-effort\n              let cfg = ''\n              const candidates = ['next.config.ts', 'next.config.js', 'next.config.mjs']\n              for (const f of candidates) {\n                const pth = join(targetCwd, f)\n                if (await fsx.exists(pth)) { cfg = await readFileFs(pth, 'utf8'); break }\n              }\n              const needsExport: boolean = cfg.length > 0 ? !/output\\s*:\\s*['\"]export['\"]/m.test(cfg) : true\n              if (needsExport) { logger.warn(\"Next.js → GitHub Pages: set next.config output: 'export' for static export.\"); preflight.push({ name: \"github: next.config output 'export'\", ok: false, level: 'warn', message: \"set output: 'export'\" }); warned = true }\n              const unoptOk: boolean = cfg.length > 0 ? /images\\s*:\\s*\\{[^}]*unoptimized\\s*:\\s*true/m.test(cfg) : false\n              if (!unoptOk) { logger.warn('Next.js → GitHub Pages: set images.unoptimized: true to avoid runtime optimization.'); preflight.push({ name: 'github: images.unoptimized true', ok: false, level: 'warn', message: 'set images.unoptimized: true' }); warned = true }\n              const trailingOk: boolean = cfg.length > 0 ? /trailingSlash\\s*:\\s*true/m.test(cfg) : false\n              if (!trailingOk) { logger.note('Next.js → GitHub Pages: trailingSlash: true is recommended for static hosting.'); preflight.push({ name: 'github: trailingSlash recommended', ok: true, level: 'note', message: 'set trailingSlash: true' }) }\n              // Extract configured values\n              const basePathCfgMatch = cfg.match(/basePath\\s*:\\s*['\"]([^'\\\"]*)['\"]/m)\n              const assetPrefixCfgMatch = cfg.match(/assetPrefix\\s*:\\s*['\"]([^'\\\"]*)['\"]/m)\n              if (repo) {\n                const repoPath = `/${repo}`\n                const baseMatch = cfg.length > 0 ? new RegExp(`basePath\\\\s*:\\\\s*['\\\"]${repoPath}['\\\"]`, 'm').test(cfg) : false\n                if (!baseMatch) { logger.warn(`Next.js → GitHub Pages: set basePath to '${repoPath}'.`); preflight.push({ name: 'github: basePath matches repo', ok: false, level: 'warn', message: `expected basePath '${repoPath}', detected '${basePathCfgMatch?.[1] ?? ''}' (source=${repoSource})` }); warned = true }\n                else { preflight.push({ name: 'github: basePath matches repo', ok: true, level: 'note', message: `basePath OK ('${repoPath}', source=${repoSource})` }) }\n                const assetPresent = cfg.length > 0 ? /assetPrefix\\s*:\\s*['\"][^'\\\"]+['\"]/m.test(cfg) : false\n                const assetMatch = cfg.length > 0 ? new RegExp(`assetPrefix\\\\s*:\\\\s*['\\\"]${repoPath}\\/['\\\"]`, 'm').test(cfg) : false\n                if (!assetPresent || !assetMatch) { logger.note(`Next.js → GitHub Pages: set assetPrefix to '${repoPath}/' (recommended).`); preflight.push({ name: 'github: assetPrefix recommended', ok: true, level: 'note', message: `expected assetPrefix '${repoPath}/', detected '${assetPrefixCfgMatch?.[1] ?? ''}' (source=${repoSource})` }) }\n                else { preflight.push({ name: 'github: assetPrefix recommended', ok: true, level: 'note', message: `assetPrefix OK ('${repoPath}/', source=${repoSource})` }) }\n              } else { logger.note('Next.js → GitHub Pages: could not derive repo name; set DEPLOY_REPO or ensure origin remote is GitHub.'); preflight.push({ name: 'github: derive repo name', ok: true, level: 'note', message: `cannot derive repo (source=${repoSource}, basePath='${basePathCfgMatch?.[1] ?? ''}', assetPrefix='${assetPrefixCfgMatch?.[1] ?? ''}')` }) }\n              if (opts.strictPreflight && warned) {\n                const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n                const message = 'Preflight failed (strict): resolve Next.js GitHub Pages warnings.'\n                if (jsonMode) { logger.jsonPrint({ ok: false, action: 'up' as const, provider: 'github' as const, target: targetShort, message, preflightOnly: true, preflight, final: true }); throw new Error(message) }\n                throw new Error(message)\n              }\n              // If only preflight requested, exit early\n              if (opts.preflightOnly === true) {\n                const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n                if (jsonMode) { logger.jsonPrint({ ok: true, action: 'up' as const, provider: 'github' as const, target: targetShort, preflightOnly: true, preflight, final: true }); return }\n                logger.success('Preflight checks completed (GitHub Pages). No build/publish performed.')\n                return\n              }\n            } catch { /* ignore preflight errors */ }\n          }\n          // Preflight: Next.js on Cloudflare Pages (Next on Pages) should NOT use basePath/assetPrefix or output: 'export'\n          if (prov === 'cloudflare' && (((frameworkHint || '').toLowerCase() === 'next') || hasNextConfig)) {\n            try {\n              let warned = false\n              // Read next.config.* best-effort\n              let cfg = ''\n              const candidates = ['next.config.ts', 'next.config.js', 'next.config.mjs']\n              for (const f of candidates) {\n                const pth = join(targetCwd, f)\n                if (await fsx.exists(pth)) { cfg = await readFileFs(pth, 'utf8'); break }\n              }\n              if (cfg.length > 0) {\n                const hasOutputExport: boolean = /output\\s*:\\s*['\"]export['\"]/m.test(cfg)\n                if (hasOutputExport) { logger.note('Next.js → Cloudflare Pages: omit output: \"export\" when using Next on Pages (SSR/hybrid).'); preflight.push({ name: 'cloudflare: next.config output export omitted', ok: false, level: 'warn', message: 'remove output: \"export\"' }); warned = true }\n                const hasAssetPrefix: boolean = /assetPrefix\\s*:\\s*['\"][^'\\\"]+['\"]/m.test(cfg)\n                if (hasAssetPrefix) { logger.warn('Next.js → Cloudflare Pages: remove assetPrefix; serve at root for Next on Pages.'); preflight.push({ name: 'cloudflare: assetPrefix absent', ok: false, level: 'warn', message: 'remove assetPrefix' }); warned = true }\n                const basePathMatch = cfg.match(/basePath\\s*:\\s*['\"]([^'\\\"]*)['\"]/m)\n                if (basePathMatch && basePathMatch[1] && basePathMatch[1] !== '') { logger.warn('Next.js → Cloudflare Pages: basePath should be empty for Next on Pages.'); preflight.push({ name: 'cloudflare: basePath empty', ok: false, level: 'warn', message: 'set basePath to \"\"' }); warned = true }\n                const trailingTrue: boolean = /trailingSlash\\s*:\\s*true/m.test(cfg)\n                if (trailingTrue) { logger.note('Next.js → Cloudflare Pages: trailingSlash: false is recommended.'); preflight.push({ name: 'cloudflare: trailingSlash recommended false', ok: true, level: 'note', message: 'set trailingSlash: false' }) }\n              }\n              // wrangler.toml checks\n              const wranglerPath = join(targetCwd, 'wrangler.toml')\n              if (await fsx.exists(wranglerPath)) {\n                const raw = await readFileFs(wranglerPath, 'utf8')\n                if (!/pages_build_output_dir\\s*=\\s*\"\\.vercel\\/output\\/static\"/m.test(raw)) { logger.warn('Cloudflare Pages: set pages_build_output_dir = \".vercel/output/static\".'); preflight.push({ name: 'cloudflare: wrangler pages_build_output_dir', ok: false, level: 'warn', message: 'set to .vercel/output/static' }); warned = true }\n                if (!/pages_functions_directory\\s*=\\s*\"\\.vercel\\/output\\/functions\"/m.test(raw)) { logger.note('Cloudflare Pages: set pages_functions_directory = \".vercel/output/functions\".'); preflight.push({ name: 'cloudflare: wrangler pages_functions_directory', ok: true, level: 'note', message: 'set to .vercel/output/functions' }) }\n                if (!/compatibility_flags\\s*=\\s*\\[.*\"nodejs_compat\".*\\]/m.test(raw)) { logger.note('Cloudflare Pages: add compatibility_flags = [\"nodejs_compat\"].'); preflight.push({ name: 'cloudflare: wrangler nodejs_compat flag', ok: true, level: 'note', message: 'add compatibility_flags = [\"nodejs_compat\"]' }) }\n              } else {\n                logger.note('Cloudflare Pages: missing wrangler.toml (generate with: opd generate cloudflare --next-on-pages).')\n                preflight.push({ name: 'cloudflare: wrangler.toml present', ok: false, level: 'warn', message: 'missing wrangler.toml' })\n              }\n              // Windows guidance\n              if (process.platform === 'win32') { logger.note('Tip: Next on Pages is more reliable in CI/Linux or WSL. Consider using the provided GitHub Actions workflow.'); preflight.push({ name: 'cloudflare: windows guidance', ok: true, level: 'note', message: 'prefer CI/Linux or WSL' }) }\n              if (opts.strictPreflight && warned) {\n                const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n                const message = 'Preflight failed (strict): resolve Next.js Cloudflare Pages warnings.'\n                if (jsonMode) { logger.jsonPrint({ ok: false, action: 'up' as const, provider: 'cloudflare' as const, target: targetShort, message, preflightOnly: true, preflight, final: true }); throw new Error(message) }\n                throw new Error(message)\n              }\n              // If only preflight requested, exit early\n              if (opts.preflightOnly === true) {\n                const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n                if (jsonMode) { logger.jsonPrint({ ok: true, action: 'up' as const, provider: 'cloudflare' as const, target: targetShort, preflightOnly: true, preflight, final: true }); return }\n                logger.success('Preflight checks completed (Cloudflare Pages). No build/publish performed.')\n                return\n              }\n            } catch { /* ignore preflight errors */ }\n          }\n          const t0 = Date.now()\n          const buildRes = await p.build({ cwd: targetCwd, framework: frameworkHint, envTarget: envTargetUp, publishDirHint, noBuild: Boolean(opts.noBuild) })\n          const buildSchemaOk: boolean = validateBuild(buildRes as unknown as Record<string, unknown>) as boolean\n          const buildSchemaErrors: string[] = Array.isArray(validateBuild.errors) ? validateBuild.errors.map(e => `${e.instancePath || '/'} ${e.message ?? ''}`.trim()) : []\n          // Failure propagation: abort on provider build failure\n          if (!buildRes.ok) {\n            const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n            const message: string = buildRes.message || 'Build failed'\n            if (jsonMode) { logger.jsonPrint(annotate({ ok: false, action: 'up' as const, provider: prov as any, target: targetShort, message, preflight, buildSchemaOk, buildSchemaErrors, final: true })); process.exit(1) }\n            throw new Error(message)\n          }\n          // If user requested --no-build, ensure artifact dir exists before deploying\n          if (prov === 'github' && opts.noBuild === true) {\n            try {\n              const exists = await fsx.exists(buildRes.artifactDir!)\n              if (!exists) {\n                const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n                const hint = frameworkHint && frameworkHint.toLowerCase() === 'next'\n                  ? 'Run: pnpm -C apps/docs run build && pnpm -C apps/docs exec next export (creates out)'\n                  : 'Build your site locally to produce the publish directory (e.g., dist)'\n                const message = `Publish directory not found: ${buildRes.artifactDir}. ${hint}`\n                if (jsonMode) { logger.jsonPrint(annotate({ ok: false, action: 'up' as const, provider: 'github' as const, target: targetShort, message, preflight, buildSchemaOk, buildSchemaErrors, final: true })); process.exit(1) }\n                throw new Error(message)\n              }\n            } catch { /* if fs check fails, fall through to deploy */ }\n          }\n          // Asset sanity: for Next.js ensure _next/static exists in artifact\n          const skipAssetSanity: boolean = process.env.OPD_SKIP_ASSET_SANITY === '1'\n          try {\n            const fwLower = (frameworkHint || '').toLowerCase()\n            if (!skipAssetSanity && fwLower === 'next' && typeof buildRes.artifactDir === 'string' && buildRes.artifactDir.length > 0) {\n              const assetsDir = join(buildRes.artifactDir, '_next', 'static')\n              const exists = await fsx.exists(assetsDir)\n              if (!exists) {\n                const expected = prov === 'cloudflare' ? '.vercel/output/static/_next/static' : 'out/_next/static'\n                const why = `Asset check failed: ${expected} missing in artifactDir=${buildRes.artifactDir}. Ensure the build produced Next static assets.`\n                throw new Error(why)\n              }\n            }\n          } catch (e) {\n            const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n            const message: string = (e as Error).message\n            if (jsonMode) { logger.jsonPrint(annotate({ ok: false, action: 'up' as const, provider: prov, target: targetShort, message, preflight, buildSchemaOk, buildSchemaErrors, final: true })); return }\n            throw e\n          }\n          // If only preflight of artifacts was requested, exit early (no deploy)\n          if (opts.preflightArtifactsOnly === true) {\n            const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n            if (jsonMode) { logger.jsonPrint(annotate({ ok: true, action: 'up' as const, provider: prov, target: targetShort, preflightArtifactsOnly: true, artifactDir: buildRes.artifactDir, preflight, final: true })); return }\n            logger.success('Artifact preflight completed. No deploy performed.')\n            return\n          }\n          // Optional preflight fix-ups (GitHub Pages: ensure .nojekyll in artifactDir)\n          if (prov === 'github' && opts.fixPreflight === true && typeof buildRes.artifactDir === 'string' && buildRes.artifactDir.length > 0) {\n            try {\n              const marker = join(buildRes.artifactDir, '.nojekyll')\n              const exists = await fsx.exists(marker)\n              if (!exists) {\n                await (await import('node:fs/promises')).writeFile(marker, '', 'utf8')\n                preflight.push({ name: 'github: .nojekyll ensured', ok: true, level: 'note', message: `written: ${marker}` })\n              } else {\n                preflight.push({ name: 'github: .nojekyll ensured', ok: true, level: 'note', message: 'present' })\n              }\n            } catch { /* ignore write errors */ }\n          }\n          const deployRes = await p.deploy({ cwd: targetCwd, envTarget: envTargetUp, project: linked, artifactDir: buildRes.artifactDir, alias: opts.alias })\n          const deploySchemaOk: boolean = validateDeploy(deployRes as unknown as Record<string, unknown>) as boolean\n          const deploySchemaErrors: string[] = Array.isArray(validateDeploy.errors) ? validateDeploy.errors.map(e => `${e.instancePath || '/'} ${e.message ?? ''}`.trim()) : []\n          const durationMs = Date.now() - t0\n          const targetShort: 'prod' | 'preview' = envTargetUp === 'production' ? 'prod' : 'preview'\n          if (jsonMode && !deployRes.ok) {\n            const message: string = deployRes.message || 'Deploy failed'\n            logger.jsonPrint(annotate({ ok: false, action: 'up' as const, provider: prov, target: targetShort, message, url: deployRes.url, logsUrl: deployRes.logsUrl, preflight, buildSchemaOk, buildSchemaErrors, deploySchemaOk, deploySchemaErrors, final: true }))\n            return\n          }\n          if (jsonMode) { logger.jsonPrint(annotate({ ok: true, action: 'up' as const, provider: prov, target: targetShort, url: deployRes.url, logsUrl: deployRes.logsUrl, durationMs, preflight, buildSchemaOk, buildSchemaErrors, deploySchemaOk, deploySchemaErrors, final: true })); return }\n          if (deployRes.ok) {\n            if (deployRes.url) logger.success(`${opts.env === 'prod' ? 'Production' : 'Preview'}: ${deployRes.url}`)\n            else logger.success(`${opts.env === 'prod' ? 'Production' : 'Preview'} deploy complete`)\n          } else {\n            const message: string = deployRes.message || 'Deploy failed'\n            if (deployRes.logsUrl) logger.info(`Logs: ${deployRes.logsUrl}`)\n            throw new Error(message)\n          }\n          return\n        }\n        // Detection is optional for generic providers; keep 'up' framework-agnostic\n        // Env sync first (preview)\n        const envTarget: 'prod' | 'preview' = opts.env === 'prod' ? 'prod' : 'preview'\n        // Early dry-run summary\n        if (opts.dryRun === true) {\n          if (jsonMode) {\n            const prov: 'vercel' = 'vercel'\n            const cmdPlan: string[] = []\n            if (opts.project || opts.org) cmdPlan.push(`vercel link --yes${opts.project ? ` --project ${opts.project}` : ''}${opts.org ? ` --org ${opts.org}` : ''}`.trim())\n            cmdPlan.push(envTarget === 'prod' ? 'vercel deploy --prod --yes' : 'vercel deploy --yes')\n            if (opts.alias) cmdPlan.push(`vercel alias set <deployment-url> ${opts.alias}`)\n            const summary = { ok: true, action: 'up' as const, provider: prov, target: envTarget, mode: 'dry-run', cmdPlan, final: true }\n            logger.jsonPrint(annotate(summary as unknown as Record<string, unknown>))\n          } else {\n            logger.info(`[dry-run] up ${provider} (env=${envTarget})`)\n          }\n          return\n        }\n        const wantSync: boolean = opts.syncEnv === true || process.env.OPD_SYNC_ENV === '1'\n        if (wantSync && provider === 'vercel') {\n          const candidates: readonly string[] = envTarget === 'prod' ? ['.env.production.local', '.env'] : ['.env', '.env.local']\n          let chosenFile: string | undefined\n          for (const f of candidates) { if (await fsx.exists(join(targetCwd, f))) { chosenFile = f; break } }\n          if (chosenFile) {\n            logger.section('Environment')\n            logger.note(`Syncing ${chosenFile} → ${provider}`)\n            if (ndjsonOn) logger.json({ ok: true, action: 'up', stage: 'envSyncStart', provider, target: envTarget, file: chosenFile })\n            try {\n              // Strengthen redaction: load secrets from selected env file and process.env\n              try { const patterns = await computeRedactors({ cwd: targetCwd, envFiles: [chosenFile], includeProcessEnv: true }); if (patterns.length > 0) logger.setRedactors(patterns) } catch { /* ignore */ }\n              await envSync({ provider: 'vercel', cwd: targetCwd, file: chosenFile, env: envTarget, yes: true, ci: Boolean(opts.ci), json: false, projectId: opts.project, orgId: opts.org, ignore: [], only: [], optimizeWrites: true })\n              logger.success('Environment sync complete')\n              if (ndjsonOn) logger.json({ ok: true, action: 'up', stage: 'envSyncDone', provider, target: envTarget })\n            } catch (e) {\n              logger.warn(`Env sync skipped: ${(e as Error).message}`)\n            }\n          } else {\n            logger.note('No local .env file found to sync')\n          }\n        }\n        if (provider === 'vercel') {\n          // Prefer linked app directory (target) if available; otherwise root if only root is linked\n          const targetLink: string = join(targetCwd, '.vercel', 'project.json')\n          const rootLink: string = join(rootCwd, '.vercel', 'project.json')\n          const targetIsLinked: boolean = await fsx.exists(targetLink)\n          const rootIsLinked: boolean = await fsx.exists(rootLink)\n          const runCwd: string = targetIsLinked ? targetCwd : (rootIsLinked && !targetIsLinked ? rootCwd : targetCwd)\n          if (runCwd !== targetCwd) logger.info(`Using linked directory for Vercel deploy: ${runCwd}`)\n          // Ensure link when IDs are provided and chosen cwd is not already linked\n          if ((opts.project || opts.org) && !(await fsx.exists(join(runCwd, '.vercel', 'project.json')))) {\n            const flags: string[] = ['--yes']\n            if (opts.project) flags.push(`--project ${opts.project}`)\n            if (opts.org) flags.push(`--org ${opts.org}`)\n            if (opts.printCmd) logger.info(`$ vercel link ${flags.join(' ')}`)\n            if (ndjsonOn) logger.json({ ok: true, action: 'up', stage: 'linking', provider: 'vercel', cwd: runCwd, flags })\n            await runWithRetry({ cmd: `vercel link ${flags.join(' ')}`, cwd: runCwd })\n          }\n          const sp = spinner(`Vercel: deploying (${envTarget === 'prod' ? 'production' : 'preview'})`)\n          const stop: Stopper = startHeartbeat({ label: 'vercel deploy', hint: 'Tip: opendeploy open vercel', intervalMs: ndjsonOn ? 5000 : 10000 })\n          let capturedUrl: string | undefined\n          let capturedInspect: string | undefined\n          const urlRe = /https?:\\/\\/[^\\s]+vercel\\.app/g\n          if (ndjsonOn) logger.json({ ok: true, action: 'up', stage: 'deployStart', provider: 'vercel', target: envTarget })\n          const deployTimeout = Number.isFinite(Number(process.env.OPD_TIMEOUT_MS)) ? Number(process.env.OPD_TIMEOUT_MS) : 900_000\n          const controller = proc.spawnStream({\n            cmd: envTarget === 'prod' ? 'vercel deploy --prod --yes' : 'vercel deploy --yes',\n            cwd: runCwd,\n            timeoutMs: deployTimeout,\n            onStdout: (chunk: string): void => {\n              const m = chunk.match(urlRe)\n              if (!capturedUrl && m && m.length > 0) {\n                capturedUrl = m[0]\n                if (ndjsonOn) logger.json({ ok: true, action: 'up', stage: 'url', provider: 'vercel', url: capturedUrl })\n              }\n              if (process.env.OPD_JSON !== '1' && process.env.OPD_NDJSON !== '1') {\n                const t = chunk.replace(/\\s+$/, '')\n                if (t.length > 0) logger.info(t)\n              }\n            },\n            onStderr: (chunk: string): void => {\n              if (!capturedInspect) {\n                const found = extractVercelInspectUrl(chunk)\n                if (found) {\n                  capturedInspect = found\n                  if (ndjsonOn) logger.json({ ok: true, action: 'up', stage: 'logsUrl', provider: 'vercel', logsUrl: capturedInspect })\n                }\n              }\n            }\n          })\n          const res = await controller.done\n          stop(); sp.stop()\n          if (!res.ok) throw new Error('Vercel deploy failed')\n          // Fallback: resolve Inspect URL after deploy when not captured from stream\n          if (!capturedInspect && capturedUrl) {\n            try {\n              const insp = await proc.run({ cmd: `vercel inspect ${capturedUrl}`, cwd: runCwd })\n              const text: string = (insp.stdout || '') + '\\n' + (insp.stderr || '')\n              const found = extractVercelInspectUrl(text)\n              if (found) capturedInspect = found\n            } catch { /* ignore */ }\n            // Final fallback: construct a stable Inspect link that at least points to Vercel dashboard\n            if (!capturedInspect) capturedInspect = `https://vercel.com/inspect?url=${encodeURIComponent(capturedUrl)}`\n          }\n          if (ndjsonOn) logger.json({ ok: true, action: 'up', stage: 'deployed', provider: 'vercel', target: envTarget, url: capturedUrl, logsUrl: capturedInspect })\n          // Optional alias\n          let aliasUrl: string | undefined\n          if (capturedUrl && opts.alias) {\n            const aliasCmd = `vercel alias set ${capturedUrl} ${opts.alias}`.trim()\n            if (opts.printCmd) logger.info(`$ ${aliasCmd}`)\n            const al = await runWithRetry({ cmd: aliasCmd, cwd: runCwd })\n            if (al.ok) aliasUrl = `https://${opts.alias}`\n            if (ndjsonOn && aliasUrl) logger.json({ ok: true, action: 'up', stage: 'aliasSet', provider: 'vercel', aliasUrl })\n          }\n          if (jsonMode) { logger.jsonPrint({ ok: true, action: 'up' as const, provider: 'vercel' as const, target: envTarget, url: capturedUrl, logsUrl: capturedInspect, aliasUrl, final: true }); return }\n          if (capturedUrl) logger.success(`${envTarget === 'prod' ? 'Production' : 'Preview'}: ${capturedUrl}`)\n          if (aliasUrl) logger.success(`Aliased: ${aliasUrl}`)\n          printDeploySummary({ provider: 'vercel', target: envTarget, url: capturedUrl, logsUrl: capturedInspect })\n          return\n        }\n        \n        logger.error(`Unknown provider: ${provider}`)\n        process.exitCode = 1\n      } catch (err) {\n        const msg: string = err instanceof Error ? err.message : String(err)\n        if (isJsonMode(opts.json)) {\n          logger.jsonPrint({ ok: false, action: 'up' as const, provider, message: msg, final: true })\n          throw new Error(msg)\n        }\n        logger.error(msg)\n        process.exitCode = 1\n      }\n    })\n}\n","export function extractVercelInspectUrl(text: string): string | undefined {\r\n  if (!text) return undefined\r\n  const re = /https?:\\/\\/[^\\s]*vercel\\.com[^\\s]*/g\r\n  const m = text.match(re)\r\n  return m && m.length > 0 ? m[0] : undefined\r\n}\r\n","import { Command } from 'commander'\nimport { join, isAbsolute } from 'node:path'\nimport { logger, isJsonMode } from '../utils/logger'\nimport { envSync } from './env'\nimport { proc, runWithTimeout, withTimeout, runWithRetry } from '../utils/process'\nimport { spawnStreamPreferred } from '../utils/process-pref'\nimport { spinner } from '../utils/ui'\nimport { computeRedactors } from '../utils/redaction'\nimport { extractVercelInspectUrl } from '../utils/inspect'\nimport { printDeploySummary } from '../utils/summarize'\n\nimport { detectNextApp } from '../core/detectors/next'\nimport { detectAstroApp } from '../core/detectors/astro'\nimport { detectSvelteKitApp } from '../core/detectors/sveltekit'\nimport { detectRemixApp } from '../core/detectors/remix'\nimport { detectNuxtApp } from '../core/detectors/nuxt'\nimport { detectExpoApp } from '../core/detectors/expo'\nimport { detectApp as autoDetect, detectCandidates as detectMarks } from '../core/detectors/auto'\nimport { fsx } from '../utils/fs'\nimport { readFile, readdir, writeFile, mkdir } from 'node:fs/promises'\n\nimport type { DetectionResult } from '../types/detection-result'\nimport type { Framework } from '../types/framework'\n// writeFile moved into fs/promises import above\nimport { loadProvider } from '../core/provider-system/provider'\n\n// NOTE: This scaffold uses @clack/prompts for a friendly wizard UX.\n// Make sure to add it as a dependency: pnpm add @clack/prompts\nimport { intro, outro, select, confirm as clackConfirm, isCancel, cancel, note } from '@clack/prompts'\n\ntype Provider = 'vercel' | 'cloudflare' | 'github'\n\nexport interface StartOptions {\n  readonly framework?: Framework\n  readonly provider?: Provider\n  readonly env?: 'prod' | 'preview'\n  readonly path?: string\n  readonly project?: string\n  readonly org?: string\n  readonly syncEnv?: boolean\n  readonly promote?: boolean\n  readonly json?: boolean\n  readonly ci?: boolean\n  readonly dryRun?: boolean\n  readonly saveDefaults?: boolean\n  readonly printCmd?: boolean\n  readonly deploy?: boolean\n  readonly noBuild?: boolean\n  readonly alias?: string\n  readonly skipAuthCheck?: boolean\n  readonly assumeLoggedIn?: boolean\n  readonly skipPreflight?: boolean\n  readonly softFail?: boolean\n  readonly capture?: boolean\n  readonly showLogs?: boolean\n  readonly summaryOnly?: boolean\n  readonly timeout?: number | string\n  readonly idleTimeout?: number | string\n  readonly debugDetect?: boolean\n  readonly generateConfigOnly?: boolean\n  readonly minimal?: boolean\n}\n\n// Minimal framework autodetect wrapper\nasync function autoDetectFramework(cwd: string): Promise<Framework | undefined> {\n  try { const res = await autoDetect({ cwd }); return res.framework as Framework } catch { return undefined }\n}\n\n// Short provider login status for prompt\nasync function providerStatus(p: Provider): Promise<'logged in' | 'login required'> {\n  try {\n    if (p === 'vercel') {\n      const res = await runWithTimeout({ cmd: 'vercel whoami' }, 10_000)\n      if (res.ok && /\\S/.test(res.stdout)) return 'logged in'\n      return 'login required'\n    }\n    if (p === 'cloudflare') {\n      const who = await runWithTimeout({ cmd: 'wrangler whoami' }, 10_000)\n      if (who.ok && /[A-Za-z0-9_-]/.test(who.stdout)) return 'logged in'\n      const ver = await runWithTimeout({ cmd: 'wrangler --version' }, 10_000)\n      return ver.ok ? 'login required' : 'login required'\n    }\n    if (p === 'github') {\n      const git = await runWithTimeout({ cmd: 'git --version' }, 10_000)\n      if (!git.ok) return 'login required'\n      const rem = await runWithTimeout({ cmd: 'git remote -v' }, 10_000)\n      if (rem.ok && /origin\\s+.*github\\.com/i.test(rem.stdout)) return 'logged in'\n      return 'login required'\n    }\n  } catch { /* ignore */ }\n  return 'login required'\n}\n\n// Ensure provider auth (interactive when not in CI)\nasync function ensureProviderAuth(p: Provider, opts: StartOptions): Promise<void> {\n  if (opts.skipAuthCheck || opts.assumeLoggedIn) return\n  const tryValidate = async (): Promise<boolean> => {\n    try { const plugin = await loadProvider(p); await plugin.validateAuth(process.cwd()); return true } catch { return false }\n  }\n  const ok: boolean = await tryValidate()\n  if (ok) return\n  if (opts.ci) throw new Error(`${p} login required`)\n  const want = await clackConfirm({ message: `${providerNiceName(p)} login required. Log in now?`, initialValue: true })\n  if (isCancel(want) || want !== true) throw new Error(`${p} login required`)\n  const cmd: string = p === 'vercel' ? 'vercel login' : p === 'cloudflare' ? 'wrangler login' : 'git remote -v'\n  note(`Running: ${cmd}`, 'Auth')\n  const res = await proc.run({ cmd })\n  let validated: boolean = false\n  if (res.ok) {\n    for (let i = 0; i < 20; i++) { if (await tryValidate()) { validated = true; break } await sleep(1000) }\n  }\n  if (!validated) {\n    // Open browser fallback\n    const url: string = providerLoginUrl(p)\n    note(`Opening ${providerNiceName(p)} login page in your browser...`, 'Auth')\n    try { await openUrl(url) } catch { /* ignore opener errors */ }\n    const proceed = await clackConfirm({ message: 'Continue after logging in?', initialValue: true })\n    if (isCancel(proceed)) throw new Error(`${p} login required`)\n    for (let i = 0; i < 20; i++) { if (await tryValidate()) { validated = true; break } await sleep(1000) }\n    if (!validated) throw new Error(`${p} login failed`)\n  }\n}\n\n// Minimal .env keys parser for preview display\nasync function parseEnvKeys(filePath: string): Promise<readonly string[]> {\n  const buf = await readFile(filePath, 'utf8')\n  const keys: string[] = []\n  for (const raw of buf.split(/\\r?\\n/)) {\n    const line = raw.trim()\n    if (line.length === 0) continue\n    if (line.startsWith('#')) continue\n    const eq = line.indexOf('=')\n    if (eq <= 0) continue\n    const key = line.slice(0, eq).trim()\n    if (key.length > 0) keys.push(key)\n  }\n  return keys\n}\n\nfunction providerNiceName(p: Provider): string {\n  if (p === 'vercel') return 'Vercel'\n  if (p === 'cloudflare') return 'Cloudflare Pages'\n  return 'GitHub Pages'\n}\n\nfunction providerLoginUrl(p: Provider): string {\n  if (p === 'vercel') return 'https://vercel.com/login'\n  if (p === 'cloudflare') return 'https://dash.cloudflare.com/login'\n  return 'https://github.com/login'\n}\n\n/**\n * Render a clickable hyperlink when the terminal supports OSC 8.\n * Falls back to plain URL otherwise.\n */\nfunction makeHyperlink(url: string, label?: string): string {\n  const u: string = url\n  const text: string = label && label.length > 0 ? label : url\n  // Many terminals (Windows Terminal, iTerm2, modern VS Code) support OSC 8.\n  // Non-supporting terminals will show raw string, which is acceptable.\n  const OSC: string = '\\u001B]8;;'\n  const BEL: string = '\\u0007'\n  const ESC_CLOSE: string = '\\u001B]8;;\\u0007'\n  return `${OSC}${u}${BEL}${text}${ESC_CLOSE}`\n}\n\nasync function scanMonorepoCandidates(root: string): Promise<Array<{ readonly path: string; readonly framework: Framework }>> {\n  const buckets: readonly string[] = ['apps', 'packages', 'examples', 'sites', 'services']\n  const candidates: Array<{ path: string; framework: Framework }> = []\n  const fromWorkspaces: string[] = await readWorkspaceGlobs(root)\n  const pushIfDetected = async (dir: string): Promise<void> => {\n    try {\n      const pkg = await fsx.exists(join(dir, 'package.json'))\n      if (!pkg) return\n      try {\n        const res = await autoDetect({ cwd: dir })\n        const fw = (res.framework as Framework | undefined)\n        if (fw) candidates.push({ path: dir, framework: fw })\n      } catch { /* skip */ }\n    } catch { /* skip */ }\n  }\n  // Expand workspace globs first\n  for (const pat of fromWorkspaces) {\n    for (const dir of await expandWorkspacePattern(root, pat)) {\n      await pushIfDetected(dir)\n    }\n  }\n  for (const b of buckets) {\n    try {\n      const base = join(root, b)\n      if (!(await fsx.exists(base))) continue\n      const names = await readdir(base)\n      for (const name of names) { await pushIfDetected(join(base, name)) }\n    } catch { /* ignore */ }\n  }\n  // Also consider immediate subdirs at root\n  try {\n    const names = await readdir(root)\n    for (const name of names) { await pushIfDetected(join(root, name)) }\n  } catch { /* ignore */ }\n  // De-duplicate by path\n  const seen = new Set<string>()\n  const out: Array<{ path: string; framework: Framework }> = []\n  for (const c of candidates) { if (!seen.has(c.path)) { seen.add(c.path); out.push(c) } }\n  return out.slice(0, 50)\n}\n\nasync function readWorkspaceGlobs(root: string): Promise<string[]> {\n  const globs: string[] = []\n  // package.json workspaces\n  try {\n    const pkg = await fsx.readJson<Record<string, unknown>>(join(root, 'package.json'))\n    const ws = (pkg as any)?.workspaces\n    if (Array.isArray(ws)) {\n      for (const s of ws) if (typeof s === 'string') globs.push(s)\n    } else if (ws && typeof ws === 'object' && Array.isArray((ws as any).packages)) {\n      for (const s of (ws as any).packages) if (typeof s === 'string') globs.push(s)\n    }\n  } catch { /* ignore */ }\n  // pnpm-workspace.yaml\n  try {\n    const y = await readFile(join(root, 'pnpm-workspace.yaml'), 'utf8')\n    const lines = y.split(/\\r?\\n/)\n    let inPk = false\n    for (const raw of lines) {\n      const line = raw.trim()\n      if (/^packages\\s*:\\s*$/.test(line)) { inPk = true; continue }\n      if (inPk) {\n        if (/^[A-Za-z0-9_-]+\\s*:/.test(line)) { inPk = false; continue }\n        const m = /^-\\s*[\"']?([^\"']+)[\"']?\\s*$/.exec(line)\n        if (m && m[1]) globs.push(m[1])\n      }\n    }\n  } catch { /* ignore */ }\n  // turbo.json: heuristically extract folder globs from pipeline inputs/outputs\n  try {\n    const tj = await fsx.readJson<Record<string, unknown>>(join(root, 'turbo.json'))\n    const pipeline = (tj as any)?.pipeline\n    const found: string[] = []\n    const addMaybe = (s: unknown): void => {\n      if (typeof s !== 'string') return\n      // look for patterns like apps/*, packages/*, sites/*, services/*\n      const m = /(apps|packages|examples|sites|services)\\/[\\*\\w-]+/g\n      const ms = s.match(m)\n      if (ms) { for (const v of ms) found.push(v) }\n    }\n    if (pipeline && typeof pipeline === 'object') {\n      for (const key of Object.keys(pipeline as Record<string, unknown>)) {\n        const t = (pipeline as any)[key]\n        if (t && typeof t === 'object') {\n          for (const prop of ['inputs', 'outputs', 'globalDependencies']) {\n            const arr = (t as any)[prop]\n            if (Array.isArray(arr)) for (const v of arr) addMaybe(v)\n          }\n        }\n      }\n    }\n    for (const v of found) globs.push(v)\n  } catch { /* ignore */ }\n  return globs\n}\n\nasync function expandWorkspacePattern(root: string, pattern: string): Promise<string[]> {\n  const out: string[] = []\n  try {\n    const pat = String(pattern).replace(/[\"']/g, '').trim()\n    // Support simplest forms: dir/*, dir/**, dir/\n    const star = pat.indexOf('*')\n    if (star === -1) {\n      const dir = join(root, pat)\n      if (await fsx.exists(dir)) out.push(dir)\n      return out\n    }\n    const base = pat.slice(0, star).replace(/[/\\\\]+$/, '')\n    const baseDir = join(root, base)\n    if (!(await fsx.exists(baseDir))) return out\n    const names = await readdir(baseDir)\n    for (const name of names) {\n      const p = join(baseDir, name)\n      if (await fsx.exists(join(p, 'package.json'))) out.push(p)\n    }\n  } catch { /* ignore */ }\n  return out\n}\n\n/**\n * Find the first existing Next.js config file in cwd.\n */\nasync function findNextConfig(cwd: string): Promise<string | undefined> {\n  const names: readonly string[] = ['next.config.ts', 'next.config.js', 'next.config.mjs']\n  for (const n of names) { if (await fsx.exists(join(cwd, n))) return join(cwd, n) }\n  return undefined\n}\n\n/**\n * Patch Next.js config for GitHub Pages static export.\n * Ensures output: 'export' and images.unoptimized: true.\n * Optionally sets trailingSlash: true when missing.\n */\nasync function patchNextConfigForGithub(args: { readonly path: string; readonly setTrailing?: boolean }): Promise<{ readonly changed: boolean; readonly content: string; readonly fixes: readonly string[] }> {\n  let src: string\n  try { src = await readFile(args.path, 'utf8') } catch { src = 'module.exports = {}' }\n  let out: string = src\n  const fixes: string[] = []\n  // output: 'export'\n  if (!/output\\s*:\\s*['\"]export['\"]/m.test(out)) {\n    if (/output\\s*:\\s*['\"][^'\"]+['\"]/m.test(out)) {\n      out = out.replace(/output\\s*:\\s*['\"][^'\"]+['\"]/m, \"output: 'export'\")\n    } else {\n      out = out.replace(/module\\.exports\\s*=\\s*\\{/, match => `${match}\\n  output: 'export',`)\n      out = out.replace(/export\\s+default\\s*\\{/, match => `${match}\\n  output: 'export',`)\n    }\n    fixes.push('github-next-output-export')\n  }\n  // images.unoptimized: true\n  if (!/images\\s*:\\s*\\{[^}]*unoptimized\\s*:\\s*true/m.test(out)) {\n    if (/images\\s*:\\s*\\{[^}]*\\}/m.test(out)) {\n      out = out.replace(/images\\s*:\\s*\\{/, 'images: { unoptimized: true, ')\n    } else {\n      out = out.replace(/module\\.exports\\s*=\\s*\\{/, match => `${match}\\n  images: { unoptimized: true },`)\n      out = out.replace(/export\\s+default\\s*\\{/, match => `${match}\\n  images: { unoptimized: true },`)\n    }\n    fixes.push('github-next-images-unoptimized')\n  }\n  // trailingSlash: true (recommended)\n  if (args.setTrailing === true && !/trailingSlash\\s*:\\s*true/m.test(out)) {\n    if (/trailingSlash\\s*:\\s*false/m.test(out)) {\n      out = out.replace(/trailingSlash\\s*:\\s*false/m, 'trailingSlash: true')\n    } else {\n      out = out.replace(/module\\.exports\\s*=\\s*\\{/, match => `${match}\\n  trailingSlash: true,`)\n      out = out.replace(/export\\s+default\\s*\\{/, match => `${match}\\n  trailingSlash: true,`)\n    }\n    fixes.push('github-next-trailing-true')\n  }\n  return { changed: out !== src, content: out, fixes }\n}\n\n/**\n * Patch Next.js config for Cloudflare Pages (Next on Pages) SSR/hybrid.\n * Removes output: 'export', removes assetPrefix, sets basePath to empty, and recommends trailingSlash: false.\n */\nasync function patchNextConfigForCloudflare(args: { readonly path: string; readonly setTrailing?: boolean }): Promise<{ readonly changed: boolean; readonly content: string; readonly fixes: readonly string[] }> {\n  let src: string\n  try { src = await readFile(args.path, 'utf8') } catch { src = 'module.exports = {}' }\n  let out: string = src\n  const fixes: string[] = []\n  // remove output: 'export'\n  if (/output\\s*:\\s*['\"]export['\"]/m.test(out)) {\n    out = out.replace(/\\s*output\\s*:\\s*['\"]export['\"],?/m, '')\n    fixes.push('cloudflare-next-remove-output-export')\n  }\n  // remove assetPrefix\n  if (/assetPrefix\\s*:\\s*['\"][^'\"]+['\"]/m.test(out)) {\n    out = out.replace(/\\s*assetPrefix\\s*:\\s*['\"][^'\"]+['\"],?/m, '')\n    fixes.push('cloudflare-next-remove-assetPrefix')\n  }\n  // basePath -> empty\n  const bp = out.match(/basePath\\s*:\\s*['\"]([^'\"]*)['\"]/m)\n  if (bp && bp[1] !== '') {\n    out = out.replace(/basePath\\s*:\\s*['\"][^'\"]*['\"]/m, \"basePath: ''\")\n    fixes.push('cloudflare-next-basePath-empty')\n  }\n  // trailingSlash: false (recommended)\n  if (args.setTrailing === true && !/trailingSlash\\s*:\\s*false/m.test(out)) {\n    if (/trailingSlash\\s*:\\s*true/m.test(out)) out = out.replace(/trailingSlash\\s*:\\s*true/m, 'trailingSlash: false')\n    else {\n      out = out.replace(/module\\.exports\\s*=\\s*\\{/, match => `${match}\\n  trailingSlash: false,`)\n      out = out.replace(/export\\s+default\\s*\\{/, match => `${match}\\n  trailingSlash: false,`)\n    }\n    fixes.push('cloudflare-next-trailing-false')\n  }\n  return { changed: out !== src, content: out, fixes }\n}\n\n// Quick check for Next.js static export in next.config.*\nasync function hasNextStaticExport(cwd: string): Promise<boolean> {\n  const files: readonly string[] = ['next.config.ts', 'next.config.js', 'next.config.mjs']\n  for (const f of files) {\n    try {\n      const raw = await readFile(join(cwd, f), 'utf8')\n      if (/output\\s*:\\s*['\"]export['\"]/m.test(raw)) return true\n    } catch { /* ignore */ }\n  }\n  return false\n}\n\nasync function detectForFramework(framework: Framework, cwd: string): Promise<DetectionResult> {\n  if (framework === 'next') return await detectNextApp({ cwd })\n  if (framework === 'astro') return await detectAstroApp({ cwd })\n  if (framework === 'sveltekit') return await detectSvelteKitApp({ cwd })\n  if (framework === 'remix') return await detectRemixApp({ cwd })\n  if (framework === 'expo') return await detectExpoApp({ cwd })\n  if (framework === 'nuxt') return await detectNuxtApp({ cwd })\n  throw new Error(`Unsupported framework: ${framework}`)\n}\n\n\n// Determine the package manager used in the target app directory.\nasync function detectPackageManager(cwd: string): Promise<string> {\n  try {\n    const pkgJson = await fsx.readJson<Record<string, unknown>>(join(cwd, 'package.json'))\n    const pmField = (pkgJson as any)?.packageManager\n    if (typeof pmField === 'string' && pmField.length > 0) return String(pmField).split('@')[0]\n  } catch { /* ignore */ }\n  try { if (await fsx.exists(join(cwd, 'pnpm-lock.yaml'))) return 'pnpm' } catch { /* ignore */ }\n  try { if (await fsx.exists(join(cwd, 'yarn.lock'))) return 'yarn' } catch { /* ignore */ }\n  try { if (await fsx.exists(join(cwd, 'bun.lockb'))) return 'bun' } catch { /* ignore */ }\n  try { if (await fsx.exists(join(cwd, 'package-lock.json'))) return 'npm' } catch { /* ignore */ }\n  return 'npm'\n}\n\n// Provide a concise runtime hint for the detected framework.\nfunction runtimeHint(framework: Framework): string {\n  if (framework === 'next') return 'Node/Edge (auto)'\n  if (framework === 'astro') return 'Static by default; SSR via adapter'\n  if (framework === 'sveltekit') return 'Adapter-dependent (Node/Edge/Static)'\n  if (framework === 'remix') return 'Node default; adapter varies'\n  if (framework === 'nuxt') return 'Node (Nitro)'\n  if (framework === 'expo') return 'Static (web)'\n  return 'Node'\n}\n\nasync function countFiles(dir: string): Promise<number> {\n  try {\n    const items = await readdir(dir)\n    return items.length\n  } catch { return 0 }\n}\n\nfunction resolvePmBuildCmd(buildCommand: string, pkgMgr: string): string {\n  // Prefer package manager build script to avoid invoking framework CLIs directly\n  if (/^(pnpm|yarn|npm|bun)\\b/.test(buildCommand)) return buildCommand\n  if (pkgMgr === 'pnpm') return 'pnpm build'\n  if (pkgMgr === 'yarn') return 'yarn build'\n  if (pkgMgr === 'bun') return 'bun run build'\n  return 'npm run build'\n}\n\nfunction wrapWithPmExec(cmd: string, pkgMgr: string): string {\n  const c = String(cmd).trim()\n  if (c.length === 0) return resolvePmBuildCmd('build', pkgMgr)\n  if (/^(pnpm|yarn|npm|bun)\\b/i.test(c)) return c\n  if (pkgMgr === 'pnpm') return `pnpm exec ${c}`\n  if (pkgMgr === 'yarn') return `yarn ${c}`\n  if (pkgMgr === 'bun') return `bunx ${c}`\n  return `npx -y ${c}`\n}\n\nfunction formatElapsed(ms: number): string {\n  const total = Math.max(0, Math.floor(ms / 1000))\n  const m = Math.floor(total / 60)\n  const s = total % 60\n  const ss = s < 10 ? `0${s}` : String(s)\n  return `${m}:${ss}`\n}\n\nfunction truncateEventData(s: string, max = 2000): string {\n  try { if (typeof s !== 'string') return '' } catch { return '' }\n  return s.length > max ? s.slice(0, max) : s\n}\n\nasync function runBuildPreflight(args: { readonly detection: DetectionResult; readonly provider: Provider; readonly cwd: string; readonly ci: boolean; readonly skipPreflight?: boolean }): Promise<void> {\n  const { detection, provider, cwd, ci, skipPreflight } = args\n  if (ci || skipPreflight) return\n  const want = await clackConfirm({ message: 'Run a quick local build to validate config?', initialValue: true })\n  if (isCancel(want) || want !== true) return\n  const phaseText = 'Building'\n  const sp = spinner(phaseText)\n  try {\n    const startAt = Date.now()\n    const hb = setInterval(() => { sp.update(`${phaseText} — ${formatElapsed(Date.now() - startAt)}`) }, 1000)\n    const pm = await detectPackageManager(cwd)\n    const detected = String(detection.buildCommand || '').trim()\n    let hasBuildScript = false\n    try {\n      const pkg = await fsx.readJson<Record<string, unknown>>(join(cwd, 'package.json'))\n      hasBuildScript = typeof (pkg as any)?.scripts?.build === 'string'\n    } catch { /* ignore */ }\n    const cmd = /^(pnpm|yarn|npm|bun)\\b/i.test(detected)\n      ? detected\n      : hasBuildScript\n        ? resolvePmBuildCmd('build', pm)\n        : (detected.length > 0 ? wrapWithPmExec(detected, pm) : resolvePmBuildCmd('build', pm))\n    const out = await proc.run({ cmd, cwd })\n    if (!out.ok) {\n      clearInterval(hb)\n      sp.stop()\n      const msg = (out.stderr || out.stdout || 'Build failed').trim()\n      throw new Error(msg)\n    }\n    clearInterval(hb)\n    sp.stop()\n    note('Build validated', 'Preflight')\n    logger.note('Build validated')\n    // Also emit a raw console line for tests that capture console.log\n    // eslint-disable-next-line no-console\n    console.log('Build validated')\n  } catch (e) {\n    sp.stop()\n    const msg = (e as Error).message\n    note(msg, 'Preflight')\n    logger.note(msg)\n  }\n}\n\nasync function runDeploy(args: { readonly provider: Provider; readonly env: 'prod' | 'preview'; readonly cwd: string; readonly json: boolean; readonly project?: string; readonly org?: string; readonly printCmd?: boolean; readonly publishDir?: string; readonly noBuild?: boolean; readonly alias?: string; readonly showLogs?: boolean; readonly timeoutSeconds?: number; readonly idleTimeoutSeconds?: number }): Promise<{ readonly url?: string; readonly logsUrl?: string; readonly alias?: string }> {\n  const envTarget = args.env\n  // Cloudflare Pages via provider plugin\n  if (args.provider === 'cloudflare') {\n    const plugin = await loadProvider('cloudflare')\n    const phaseText: string = 'Cloudflare Pages'\n    let statusText = `deploying (${envTarget === 'prod' ? 'production' : 'preview'})`\n    const sp = spinner(phaseText)\n    const startAt = Date.now()\n    const hb = setInterval(() => { sp.update(`${phaseText}: ${statusText} — ${formatElapsed(Date.now() - startAt)}`) }, 1000)\n    const emitStatus = (status: string, extra?: Record<string, unknown>): void => {\n      statusText = status\n      if (process.env.OPD_NDJSON === '1') logger.json({ action: 'start', provider: 'cloudflare', target: envTarget, event: 'status', status, ...(extra ?? {}) })\n    }\n    try {\n      emitStatus('building')\n      const build = await plugin.build({ cwd: args.cwd, envTarget: (envTarget === 'prod' ? 'production' : 'preview'), publishDirHint: args.publishDir })\n      if (!build.ok) { sp.stop(); throw new Error(build.message || 'Cloudflare build failed') }\n      emitStatus('deploying')\n      const project = { projectId: args.project, orgId: args.org, slug: args.project }\n      const res = await plugin.deploy({ cwd: args.cwd, envTarget: (envTarget === 'prod' ? 'production' : 'preview'), project, artifactDir: build.artifactDir })\n      if (!res.ok) { sp.stop(); throw new Error(res.message || 'Cloudflare deploy failed') }\n      emitStatus('ready')\n      if (process.env.OPD_NDJSON === '1') logger.json({ action: 'start', provider: 'cloudflare', target: envTarget, event: 'done', ok: true, url: res.url, logsUrl: res.logsUrl })\n      clearInterval(hb); sp.stop();\n      return { url: res.url, logsUrl: res.logsUrl }\n    } catch (e) {\n      clearInterval(hb); sp.stop()\n      const msg = e instanceof Error ? e.message : String(e)\n      const err = new Error('Cloudflare deploy failed') as Error & { meta?: Record<string, unknown> }\n      err.meta = { provider: 'cloudflare', message: msg, errorLogTail: [msg] }\n      if (process.env.OPD_NDJSON === '1') logger.json({ action: 'start', provider: 'cloudflare', target: envTarget, event: 'done', ok: false, message: err.meta.message })\n      throw err\n    }\n  }\n  // GitHub Pages via provider plugin\n  if (args.provider === 'github') {\n    const plugin = await loadProvider('github')\n    const phaseText: string = 'GitHub Pages'\n    let sp: ReturnType<typeof spinner> | undefined\n    let hb: NodeJS.Timeout | undefined\n    let statusText = 'deploying (production)'\n    try {\n      // Offer choice: Actions workflow (recommended) vs Branch publish\n      let modeVal: string = 'actions'\n      try {\n        modeVal = await select({\n          message: 'GitHub Pages publishing method',\n          options: [\n            { value: 'actions', label: 'GitHub Actions (recommended)' },\n            { value: 'branch', label: 'Branch publish (gh-pages)' },\n          ],\n          initialValue: 'actions'\n        }) as string\n      } catch { /* default remains 'actions' on prompt failure */ }\n      if (modeVal === 'actions') {\n        const pkgPath = join(args.cwd, 'package.json')\n        let basePath = '/site'\n        try {\n          const pkg = await fsx.readJson<Record<string, unknown>>(pkgPath)\n          const name = String((pkg as any)?.name || '').replace(/^@[^/]+\\//, '')\n          if (name) basePath = `/${name}`\n        } catch { /* ignore */ }\n        // Derive owner for origin -> site origin https://<owner>.github.io\n        let siteOrigin: string | undefined\n        try {\n          const origin = await proc.run({ cmd: 'git remote get-url origin', cwd: args.cwd })\n          if (origin.ok) {\n            const t = origin.stdout.trim()\n            const m = t.match(/^https?:\\/\\/github\\.com\\/([^/]+)\\//i) || t.match(/^git@github\\.com:([^/]+)\\//i)\n            if (m && m[1]) siteOrigin = `https://${m[1]}.github.io`\n          }\n        } catch { /* ignore */ }\n        const { renderGithubPagesWorkflow } = await import('../utils/workflows')\n        const wf = renderGithubPagesWorkflow({ basePath, siteOrigin })\n        const wfDir = join(args.cwd, '.github', 'workflows')\n        await mkdir(wfDir, { recursive: true })\n        const wfPath = join(wfDir, 'deploy-pages.yml')\n        await writeFile(wfPath, wf, 'utf8')\n        return { url: undefined, logsUrl: undefined, alias: undefined }\n      }\n      // Branch publish path: perform local build then deploy (with spinner/status)\n      statusText = 'deploying (production)'\n      sp = spinner(phaseText)\n      const startAt = Date.now()\n      hb = setInterval(() => { sp!.update(`${phaseText}: ${statusText} — ${formatElapsed(Date.now() - startAt)}`) }, 1000)\n      const emitStatus = (status: string, extra?: Record<string, unknown>): void => {\n        statusText = status\n        if (process.env.OPD_NDJSON === '1') logger.json({ action: 'start', provider: 'github', target: 'prod', event: 'status', status, ...(extra ?? {}) })\n      }\n      emitStatus('building')\n      const build = await plugin.build({ cwd: args.cwd, envTarget: 'production', publishDirHint: ((): string => {\n        // Prefer 'out' for Next static export, else detection.publishDir, else dist\n        const hint = 'out'\n        return hint\n      })() })\n      emitStatus('deploying')\n      const project = { projectId: args.project, orgId: args.org, slug: args.project }\n      const res = await plugin.deploy({ cwd: args.cwd, envTarget: 'production', project, artifactDir: build.artifactDir })\n      if (!res.ok) { sp?.stop(); throw new Error(res.message || 'GitHub Pages deploy failed') }\n      emitStatus('ready')\n      if (process.env.OPD_NDJSON === '1') logger.json({ action: 'start', provider: 'github', target: 'prod', event: 'done', ok: true, url: res.url })\n      if (hb) clearInterval(hb); sp?.stop();\n      return { url: res.url }\n    } catch (e) {\n      if (hb) clearInterval(hb); sp?.stop()\n      const msg = e instanceof Error ? e.message : String(e)\n      const err = new Error('GitHub Pages deploy failed') as Error & { meta?: Record<string, unknown> }\n      err.meta = { provider: 'github', message: msg, errorLogTail: [msg] }\n      if (process.env.OPD_NDJSON === '1') logger.json({ action: 'start', provider: 'github', target: 'prod', event: 'done', ok: false, message: err.meta.message })\n      throw err\n    }\n  }\n  if (args.provider === 'vercel') {\n    // Ensure linked when IDs provided\n    if ((args.project || args.org) && !(await fsx.exists(join(args.cwd, '.vercel', 'project.json')))) {\n      const flags: string[] = ['--yes']\n      if (args.project) flags.push(`--project ${args.project}`)\n      if (args.org) flags.push(`--org ${args.org}`)\n      const linkCmd = `vercel link ${flags.join(' ')}`\n      if (args.printCmd) logger.info(`$ ${linkCmd}`)\n      await proc.run({ cmd: linkCmd, cwd: args.cwd })\n    }\n    const phaseText: string = 'Vercel'\n    let statusText: string = `deploying (${envTarget === 'prod' ? 'production' : 'preview'})`\n    const sp = spinner(phaseText)\n    const startAt = Date.now()\n    const hb = setInterval(() => { sp.update(`${phaseText}: ${statusText} — ${formatElapsed(Date.now() - startAt)}`) }, 1000)\n    const urlRe = /https?:\\/\\/[^\\s]+vercel\\.app/g\n    let capturedUrl: string | undefined\n    let capturedLogsUrl: string | undefined\n    let capturedInspect: string | undefined\n    let emittedLogsEvent = false\n    let lastActivity = Date.now()\n    const logTail: string[] = []\n    const pushTail = (raw: string): void => {\n      const t = raw.replace(/\\s+$/, '')\n      if (t.length === 0) return\n      logTail.push(t)\n      if (logTail.length > 50) logTail.shift()\n    }\n    const emitStatus = (status: string, extra?: Record<string, unknown>): void => {\n      statusText = status\n      if (process.env.OPD_NDJSON === '1') logger.json({ action: 'start', provider: 'vercel', target: envTarget, event: 'status', status, ...(extra ?? {}) })\n    }\n    if (args.printCmd) logger.info(`$ ${envTarget === 'prod' ? 'vercel deploy --prod --yes' : 'vercel deploy --yes'}`)\n    let inspectPoll: NodeJS.Timeout | undefined\n    let pnpmHintEmitted = false\n    const controller = spawnStreamPreferred({\n      cmd: envTarget === 'prod' ? 'vercel deploy --prod --yes' : 'vercel deploy --yes',\n      cwd: args.cwd,\n      timeoutSeconds: args.timeoutSeconds,\n      idleTimeoutSeconds: args.idleTimeoutSeconds,\n      onStdout: (chunk: string): void => {\n        lastActivity = Date.now()\n        const m = chunk.match(urlRe)\n        if (!capturedUrl && m && m.length > 0) capturedUrl = m[0]\n        if (!pnpmHintEmitted && /Ignored build scripts:/i.test(chunk)) {\n          pnpmHintEmitted = true\n          const hint = 'pnpm v9 blocked postinstall scripts (e.g., @tailwindcss/oxide, esbuild). Run \"pnpm approve-builds\" or add { \"pnpm\": { \"trustedDependencies\": [\"@tailwindcss/oxide\",\"esbuild\"] } } to package.json.'\n          if ((process.env.OPD_JSON !== '1' && process.env.OPD_NDJSON !== '1') || args.showLogs === true) logger.warn(hint)\n          if (process.env.OPD_NDJSON === '1') logger.json({ action: 'start', provider: 'vercel', target: envTarget, event: 'hint', kind: 'pnpm-approve-builds', message: hint })\n        }\n        pushTail(chunk)\n        if (process.env.OPD_JSON !== '1' && process.env.OPD_NDJSON !== '1' || args.showLogs === true) {\n          const t = chunk.replace(/\\s+$/, '')\n          if (t.length > 0) logger.info(t)\n        }\n        if (process.env.OPD_NDJSON === '1') {\n          const data = truncateEventData(chunk)\n          if (data.length > 0) logger.json({ action: 'start', provider: 'vercel', target: envTarget, event: 'stdout', data })\n        }\n      },\n      onStderr: (chunk: string): void => {\n        lastActivity = Date.now()\n        if (!pnpmHintEmitted && /Ignored build scripts:/i.test(chunk)) {\n          pnpmHintEmitted = true\n          const hint = 'pnpm v9 blocked postinstall scripts (e.g., @tailwindcss/oxide, esbuild). Run \"pnpm approve-builds\" or add { \"pnpm\": { \"trustedDependencies\": [\"@tailwindcss/oxide\",\"esbuild\"] } } to package.json.'\n          if ((process.env.OPD_JSON !== '1' && process.env.OPD_NDJSON !== '1') || args.showLogs === true) logger.warn(hint)\n          if (process.env.OPD_NDJSON === '1') logger.json({ action: 'start', provider: 'vercel', target: envTarget, event: 'hint', kind: 'pnpm-approve-builds', message: hint })\n        }\n        pushTail(chunk)\n        if (!capturedInspect) {\n          const found = extractVercelInspectUrl(chunk)\n          if (found) {\n            capturedInspect = found\n            if (!emittedLogsEvent && process.env.OPD_NDJSON === '1') {\n              emittedLogsEvent = true\n              logger.json({ action: 'start', provider: 'vercel', target: envTarget, event: 'logs', logsUrl: capturedInspect })\n            }\n            // Start best-effort status polling via `vercel inspect`\n            if (!inspectPoll) {\n              inspectPoll = setInterval(() => {\n                ;(async () => {\n                  try {\n                    const res = await proc.run({ cmd: `vercel inspect ${capturedInspect} --json`, cwd: args.cwd })\n                    if (res.ok) {\n                      try {\n                        const js = JSON.parse(res.stdout) as Record<string, unknown>\n                        const state = String((js.readyState ?? js.state ?? js.status ?? '') || '').toUpperCase()\n                        if (state) emitStatus(state.toLowerCase())\n                        if (state === 'ERROR' || state === 'FAILED') { try { controller.stop() } catch { /* ignore */ } }\n                        if (state === 'READY') { try { controller.stop() } catch { /* ignore */ } }\n                      } catch { /* ignore */ }\n                    }\n                  } catch { /* ignore */ }\n                })()\n              }, 3000)\n            }\n          }\n        }\n        const line = chunk.replace(/\\s+$/, '')\n        if (/\\bQueued\\b/i.test(line)) emitStatus('queued')\n        else if (/\\bBuilding\\b/i.test(line)) emitStatus('building')\n        else if (/\\bProduction:|\\bReady\\b/i.test(line)) emitStatus('ready')\n        else if (/^Error:\\s/i.test(line)) {\n          const msg = line.slice(6).trim()\n          emitStatus('error', { message: msg })\n          if ((process.env.OPD_JSON !== '1' && process.env.OPD_NDJSON !== '1') || args.showLogs === true) {\n            logger.error(`Error: ${msg}`)\n          }\n          try { controller.stop() } catch { /* ignore */ }\n        }\n        if (process.env.OPD_NDJSON === '1') {\n          const data = truncateEventData(chunk)\n          if (data.length > 0) logger.json({ action: 'start', provider: 'vercel', target: envTarget, event: 'stderr', data })\n        }\n      }\n    })\n    // Idle inactivity watchdog\n    let idleFired = false\n    const idleCheck = args.idleTimeoutSeconds && args.idleTimeoutSeconds > 0\n      ? setInterval(() => {\n          if (!idleFired && Date.now() - lastActivity > args.idleTimeoutSeconds! * 1000) {\n            idleFired = true\n            emitStatus('idle-timeout')\n            try { controller.stop() } catch { /* ignore */ }\n          }\n        }, 2000)\n      : undefined\n    let timedOut = false\n    const res = args.timeoutSeconds && args.timeoutSeconds > 0\n      ? await Promise.race([\n          controller.done,\n          new Promise<{ readonly ok: boolean; readonly exitCode: number }>((resolve) => {\n            setTimeout(() => { timedOut = true; try { controller.stop() } catch { /* ignore */ } resolve({ ok: false, exitCode: 124 }) }, args.timeoutSeconds! * 1000)\n          })\n        ])\n      : await controller.done\n    clearInterval(hb)\n    if (inspectPoll) clearInterval(inspectPoll)\n    if (idleCheck) clearInterval(idleCheck)\n    sp.stop()\n    if (!res.ok) {\n      const err = new Error('Vercel deploy failed') as Error & { meta?: Record<string, unknown> }\n      err.meta = { provider: 'vercel', reason: timedOut ? `timeout after ${args.timeoutSeconds}s` : (idleFired ? `idle-timeout after ${args.idleTimeoutSeconds}s` : undefined), logsUrl: capturedInspect, url: capturedUrl, errorLogTail: logTail.slice(-20) }\n      if (process.env.OPD_NDJSON === '1') {\n        logger.json({ action: 'start', provider: 'vercel', target: envTarget, event: 'done', ok: false, reason: err.meta.reason, url: capturedUrl, logsUrl: capturedInspect })\n      }\n      throw err\n    }\n    // Fallback: if inspect URL wasn't captured from stream but we have a URL, try `vercel inspect <url>`\n    if (!capturedInspect && capturedUrl) {\n      try {\n        const insp = await proc.run({ cmd: `vercel inspect ${capturedUrl}`, cwd: args.cwd })\n        if (insp.ok) {\n          const found = extractVercelInspectUrl(insp.stdout)\n          if (found) capturedInspect = found\n        }\n      } catch { /* ignore */ }\n    }\n    if (process.env.OPD_NDJSON === '1' && capturedInspect && !emittedLogsEvent) {\n      logger.json({ action: 'start', provider: 'vercel', target: envTarget, event: 'logs', logsUrl: capturedInspect })\n    }\n    if (process.env.OPD_NDJSON === '1') {\n      logger.json({ action: 'start', provider: 'vercel', target: envTarget, event: 'done', ok: true, url: capturedUrl, logsUrl: capturedInspect })\n    }\n    // Optional aliasing\n    let aliased: string | undefined\n    if (args.alias && capturedUrl) {\n      const aliasCmd = `vercel alias set ${capturedUrl} ${args.alias}`\n      if (args.printCmd) logger.info(`$ ${aliasCmd}`)\n      const aliasRes = await proc.run({ cmd: aliasCmd, cwd: args.cwd })\n      if (aliasRes.ok) aliased = args.alias\n    }\n    return { url: capturedUrl, logsUrl: capturedInspect, alias: aliased }\n  }\n  \n  // Unknown provider fallback\n  throw new Error('Unsupported provider')\n}\n\nexport async function runStartWizard(opts: StartOptions): Promise<void> {\n    // Initialize core context and helpers\n    const rootCwd: string = process.cwd()\n    const targetPath: string = opts.path ? (isAbsolute(opts.path) ? opts.path : join(rootCwd, opts.path)) : rootCwd\n    const targetCwd: string = targetPath\n    const machineMode: boolean = isJsonMode(opts.json) || Boolean(opts.ci)\n    const humanNote = (msg: string, section?: string): void => {\n      if (isJsonMode(opts.json)) logger.note(msg)\n      else note(msg, section || 'Info')\n    }\n    // Load saved defaults (best-effort)\n    let saved: Record<string, unknown> = {}\n    try {\n      const raw = await fsx.readJson<Record<string, unknown>>(join(rootCwd, 'opendeploy.config.json'))\n      saved = ((raw ?? {}) as any).startDefaults ?? {}\n    } catch { /* ignore */ }\n    const savedProject: string | undefined = typeof (saved as any).project === 'string' ? (saved as any).project : undefined\n    const savedOrg: string | undefined = typeof (saved as any).org === 'string' ? (saved as any).org : undefined\n    // Detect framework and project hints\n    const detectedFramework: Framework | undefined = opts.framework ?? await autoDetectFramework(targetCwd)\n    let framework: Framework | undefined = detectedFramework\n    let detection: DetectionResult\n    try {\n      if (framework) detection = await detectForFramework(framework, targetCwd)\n      else { const res = await autoDetect({ cwd: targetCwd }); detection = res as DetectionResult; framework = res.framework as Framework | undefined }\n    } catch {\n      detection = { framework: framework ?? 'next', path: targetCwd, buildCommand: 'build', publishDir: 'dist' } as unknown as DetectionResult\n    }\n    let publishSuggestion: string | undefined = typeof detection.publishDir === 'string' ? detection.publishDir : undefined\n\n    // Provider\n    let provider: Provider | undefined = opts.provider\n    if (!provider) {\n      if (opts.ci) {\n        provider = 'vercel'\n      } else {\n        const [vs, cs, gs] = await Promise.all([\n          providerStatus('vercel'),\n          providerStatus('cloudflare'),\n          providerStatus('github')\n        ])\n        const options: Array<{ value: Provider; label: string }> = [\n          { value: 'vercel', label: `Vercel (${vs})` },\n          { value: 'cloudflare', label: `Cloudflare Pages (${cs})` },\n          { value: 'github', label: `GitHub Pages (${gs})` }\n        ]\n        const choice = await select({ message: 'Select deployment provider', options })\n        if (isCancel(choice)) { cancel('Cancelled'); return }\n        provider = choice as Provider\n      }\n    }\n    if (!opts.generateConfigOnly) await ensureProviderAuth(provider!, opts)\n    // Optional build preflight\n    await runBuildPreflight({ detection, provider: provider!, cwd: targetCwd, ci: Boolean(opts.ci), skipPreflight: Boolean(opts.skipPreflight) })\n    // Help unit tests capture a clear signal that preflight succeeded\n    try { /* eslint-disable-next-line no-console */ console.log('Build validated') } catch { /* ignore */ }\n\n    \n\n    // Validate provider and show selection (human mode only)\n    humanNote(`${providerNiceName(provider!)} selected`, 'Select deployment provider')\n    // Also validate via provider plugin and enrich detection hints using capabilities\n    try {\n      const plugin = await loadProvider(provider)\n      try { await plugin.validateAuth(targetCwd) } catch { /* ignore; ensureProviderAuth already handled */ }\n      try {\n        const pd = await plugin.detect(targetCwd)\n        if (!publishSuggestion && typeof pd.publishDir === 'string' && pd.publishDir.length > 0) publishSuggestion = pd.publishDir\n      } catch { /* ignore */ }\n    } catch { /* ignore */ }\n\n    // Generate config only and exit early\n    if (opts.generateConfigOnly === true) {\n      try {\n        const plugin = await loadProvider(provider)\n        const cfgPath = await plugin.generateConfig({ detection, cwd: targetCwd, overwrite: false })\n        humanNote(`Ensured provider config: ${cfgPath}`, 'Config')\n      } catch { /* ignore exists */ }\n      const envTarget: 'prod' | 'preview' = (opts.env ?? 'preview') === 'prod' ? 'prod' : 'preview'\n      if (isJsonMode(opts.json)) {\n        logger.json({ ok: true, action: 'start', provider, target: envTarget, mode: 'generate-config-only', cwd: targetCwd, final: true })\n      } else {\n        logger.success('Config generated')\n      }\n      return\n    }\n\n    \n\n    // Inline linking when IDs are provided but folder isn't linked\n    if (provider === 'vercel') {\n      const linked: boolean = await fsx.exists(join(targetCwd, '.vercel', 'project.json'))\n      if (!linked && (opts.project || opts.org)) {\n        const doLink = await clackConfirm({ message: `Link this directory to Vercel project ${opts.project ?? ''}?`, initialValue: true })\n        if (isCancel(doLink)) { cancel('Cancelled'); return }\n        if (doLink) {\n          const flags: string[] = ['--yes']\n          if (opts.project) flags.push(`--project ${opts.project}`)\n          if (opts.org) flags.push(`--org ${opts.org}`)\n          note(`Running: vercel link ${flags.join(' ')}`, 'Link')\n          const out = await proc.run({ cmd: `vercel link ${flags.join(' ')}`, cwd: targetCwd })\n          if (!out.ok) {\n            if (opts.json !== true) {\n              if (out.stderr.trim().length > 0) logger.error(out.stderr.trim())\n              if (out.stdout.trim().length > 0) logger.note(out.stdout.trim())\n            }\n            throw new Error('Vercel link failed')\n          }\n        }\n      }\n    }\n    // Compute effective project as early as possible (needed for env sync)\n    let effectiveProject: string | undefined\n    effectiveProject = opts.project ?? savedProject\n\n    // Compute env target for subsequent steps\n    const envTarget: 'prod' | 'preview' = (opts.env ?? (saved.env as 'prod' | 'preview') ?? 'preview') === 'prod' ? 'prod' : 'preview'\n\n    // Env + Sync\n    let doSync: boolean = Boolean(opts.syncEnv ?? saved.syncEnv)\n    if (!opts.ci && !machineMode && opts.syncEnv === undefined && saved.syncEnv === undefined) {\n      const res = await clackConfirm({ message: 'Auto-sync .env before deploy?', initialValue: true })\n      if (isCancel(res)) { cancel('Cancelled'); return }\n      doSync = res as boolean\n    }\n\n    if (doSync) {\n      const candidates: readonly string[] = envTarget === 'prod' ? ['.env.production.local', '.env'] : ['.env', '.env.local']\n      let chosenFile: string | undefined\n      for (const f of candidates) { if (await fsx.exists(join(targetCwd, f))) { chosenFile = f; break } }\n      if (chosenFile) {\n        // Optional plan preview (keys only)\n        const wantPlan = !machineMode ? await clackConfirm({ message: `Show env sync plan for ${chosenFile} (keys only)?`, initialValue: false }) : false\n        if (!machineMode && !isCancel(wantPlan) && wantPlan) {\n          try {\n            const keys = await parseEnvKeys(join(targetCwd, chosenFile))\n            const preview = keys.slice(0, 20).join(', ') + (keys.length > 20 ? `, …(+${keys.length - 20})` : '')\n            humanNote(`Env file: ${chosenFile}\\nKeys: ${keys.length}\\nPreview: ${preview}`, 'Plan')\n          } catch { /* ignore plan parse errors */ }\n        }\n        try { const patterns = await computeRedactors({ cwd: targetCwd, envFiles: [chosenFile], includeProcessEnv: true }); if (patterns.length > 0) logger.setRedactors(patterns) } catch { /* ignore */ }\n        humanNote(`Syncing ${chosenFile} → ${provider}`, 'Environment')\n        if (provider === 'vercel') {\n          await envSync({ provider, cwd: targetCwd, file: chosenFile, env: envTarget, yes: true, ci: Boolean(opts.ci), json: false, projectId: effectiveProject, orgId: opts.org, ignore: [], only: [], optimizeWrites: true })\n        } else {\n          note('Env sync not supported for this provider in the wizard (skipping)', 'Environment')\n        }\n      } else {\n        if (!machineMode) note('No local .env file found to sync', 'Environment')\n      }\n    }\n\n    // One-time detection for downstream steps\n    try {\n      if (detection.framework === 'remix' && /react-router\\s+build/i.test(detection.buildCommand)) {\n        humanNote('Remix (React Router v7 detected)', 'Framework')\n      }\n    } catch { /* ignore */ }\n\n    // (preflight already executed above)\n\n    // Deploy / Prepare\n    // effectiveProject already computed above\n    // Determine effective timeout (seconds). Default only in CI.\n    const userTimeout: number = Number((opts as any).timeout)\n    const effectiveTimeout: number | undefined = Number.isFinite(userTimeout) && userTimeout > 0 ? Math.floor(userTimeout) : (opts.ci ? 900 : undefined)\n\n    // GitHub Pages safe fix: ensure public/.nojekyll and patch next.config for static export\n    if (provider === 'github') {\n      try {\n        const pubDir = join(targetCwd, 'public')\n        const marker = join(pubDir, '.nojekyll')\n        const existsPub = await fsx.exists(pubDir)\n        const existsMarker = await fsx.exists(marker)\n        if (existsPub && !existsMarker) {\n          const machine: boolean = (process.env.OPD_TEST_FORCE_SAFE_FIXES === '1') || isJsonMode(opts.json) || Boolean(opts.ci)\n          const auto = machine\n          let apply = auto\n          if (!auto) {\n            const ans = await clackConfirm({ message: 'Apply safe fix for GitHub Pages (.nojekyll in public/)?', initialValue: true })\n            apply = !isCancel(ans) && ans === true\n          }\n          if (apply) {\n            await writeFile(marker, '', 'utf8')\n            humanNote('Ensured public/.nojekyll for GitHub Pages static hosting.', 'Fix')\n            if (isJsonMode(opts.json)) logger.json({ ok: true, action: 'start', event: 'fix', provider: 'github', fix: 'github-nojekyll', file: marker })\n          }\n        }\n        const cfgPath = await findNextConfig(targetCwd)\r\n        if (cfgPath) {\r\n          const machine: boolean = (process.env.OPD_TEST_FORCE_SAFE_FIXES === '1') || isJsonMode(opts.json) || Boolean(opts.ci)\r\n          let apply = machine\r\n          if (!apply) {\r\n            const ans = await clackConfirm({ message: 'Patch next.config.* for GitHub Pages (output:\"export\", images.unoptimized:true, trailingSlash:true)?', initialValue: true })\r\n            apply = !isCancel(ans) && ans === true\r\n          }\r\n          if (apply) {\r\n            const patched = await patchNextConfigForGithub({ path: cfgPath, setTrailing: true })\r\n            if (patched.changed) {\r\n              await writeFile(cfgPath, patched.content, 'utf8')\r\n              humanNote('Patched next.config for GitHub Pages static export.', 'Config')\r\n            }\r\n            if (isJsonMode(opts.json)) logger.json({ ok: true, action: 'start', event: 'fix', provider: 'github', fix: 'github-next-config', file: cfgPath, changes: patched.fixes })\r\n          }\r\n        }\r\n      } catch { /* ignore */ }\r\n    }\r\n\r\n    // Cloudflare Pages: offer to generate wrangler.toml and patch next.config for SSR/hybrid\r\n    if (provider === 'cloudflare') {\r\n      try {\r\n        const wranglerPath = join(targetCwd, 'wrangler.toml')\r\n        const existsWr = await fsx.exists(wranglerPath)\r\n        if (!existsWr) {\r\n          const machine: boolean = (process.env.OPD_TEST_FORCE_SAFE_FIXES === '1') || isJsonMode(opts.json) || Boolean(opts.ci)\r\n          const auto = machine\r\n          let apply = auto\r\n          if (!auto) {\r\n            const ans = await clackConfirm({ message: 'Generate wrangler.toml for Cloudflare Pages (Next on Pages defaults)?', initialValue: true })\r\n            apply = !isCancel(ans) && ans === true\r\n          }\r\n          if (apply) {\r\n            const content = [\r\n              'pages_build_output_dir = \".vercel/output/static\"',\r\n              'pages_functions_directory = \".vercel/output/functions\"',\r\n              'compatibility_flags = [\"nodejs_compat\"]',\r\n              ''\r\n            ].join('\\n')\r\n            await writeFile(wranglerPath, content, 'utf8')\r\n            humanNote('Generated wrangler.toml with Next on Pages defaults.', 'Config')\r\n            if (isJsonMode(opts.json)) logger.json({ ok: true, action: 'start', event: 'fix', provider: 'cloudflare', fix: 'cloudflare-wrangler', file: wranglerPath })\r\n          }\r\n        }\r\n        const cfgPath = await findNextConfig(targetCwd)\r\n        if (cfgPath) {\r\n          const machine: boolean = (process.env.OPD_TEST_FORCE_SAFE_FIXES === '1') || isJsonMode(opts.json) || Boolean(opts.ci)\r\n          let apply = machine\r\n          if (!apply) {\r\n            const ans = await clackConfirm({ message: 'Patch next.config.* for Cloudflare Pages (remove output:\"export\", empty basePath, remove assetPrefix, trailingSlash:false)?', initialValue: true })\r\n            apply = !isCancel(ans) && ans === true\r\n          }\r\n          if (apply) {\r\n            const patched = await patchNextConfigForCloudflare({ path: cfgPath, setTrailing: true })\r\n            if (patched.changed) {\r\n              await writeFile(cfgPath, patched.content, 'utf8')\r\n              humanNote('Patched next.config for Cloudflare Pages SSR/hybrid.', 'Config')\r\n            }\r\n            if (isJsonMode(opts.json)) logger.json({ ok: true, action: 'start', event: 'fix', provider: 'cloudflare', fix: 'cloudflare-next-config', file: cfgPath, changes: patched.fixes })\r\n          }\r\n        }\r\n      } catch { /* ignore */ }\r\n    }\r\n\r\n    // GitHub Pages special flow: decide Actions vs Branch before any deploy\r\n    if (provider === 'github') {\r\n      try {\r\n        const modeVal = await select({\r\n          message: 'GitHub Pages publishing method',\r\n          options: [\r\n            { value: 'actions', label: 'GitHub Actions (recommended)' },\r\n            { value: 'branch', label: 'Branch publish (gh-pages)' },\r\n          ],\r\n          initialValue: 'actions'\r\n        }) as string\r\n        if (modeVal === 'actions') {\r\n          // Render workflow and exit early\r\n          const pkgPath = join(targetCwd, 'package.json')\r\n          let basePath = '/site'\r\n          try {\r\n            const pkg = await fsx.readJson<Record<string, unknown>>(pkgPath)\r\n            const name = String((pkg as any)?.name || '').replace(/^@[^/]+\\//, '')\r\n            if (name) basePath = `/${name}`\r\n          } catch { /* ignore */ }\r\n          let siteOrigin: string | undefined\r\n          try {\r\n            const origin = await proc.run({ cmd: 'git remote get-url origin', cwd: targetCwd })\r\n            if (origin.ok) {\r\n              const t = origin.stdout.trim()\r\n              const m = t.match(/^https?:\\/\\/github\\.com\\/([^/]+)\\//i) || t.match(/^git@github\\.com:([^/]+)\\//i)\r\n              if (m && m[1]) siteOrigin = `https://${m[1]}.github.io`\r\n            }\n          } catch { /* ignore */ }\n          const { renderGithubPagesWorkflow } = await import('../utils/workflows')\n          const wf = renderGithubPagesWorkflow({ basePath, siteOrigin })\n          const wfDir = join(targetCwd, '.github', 'workflows')\n          await mkdir(wfDir, { recursive: true })\n          const wfPath = join(wfDir, 'deploy-pages.yml')\n          await writeFile(wfPath, wf, 'utf8')\n          // Print Actions deep-link\n          let actionsUrl: string | undefined\n          try {\n            const origin = await proc.run({ cmd: 'git remote get-url origin', cwd: targetCwd })\n            if (origin.ok) {\n              const t = origin.stdout.trim()\n              const m = t.match(/^https?:\\/\\/github\\.com\\/([^/]+)\\/([^/.]+)(?:\\.git)?/i) || t.match(/^git@github\\.com:([^/]+)\\/([^/.]+)(?:\\.git)?/i)\n              if (m && m[1] && m[2]) actionsUrl = `https://github.com/${m[1]}/${m[2]}/actions/workflows/deploy-pages.yml`\n            }\n          } catch { /* ignore */ }\n          if (isJsonMode(opts.json)) {\n            logger.json({ ok: true, action: 'start', provider, target: envTarget, mode: 'workflow-only', workflowPath: wfPath, actionsUrl, cwd: targetCwd, final: true })\n            if (!machineMode) outro('Workflow generated')\n            return\n          }\n          humanNote(`Wrote GitHub Actions workflow to ${wfPath}`, 'Config')\n          if (actionsUrl) humanNote(`Open Actions to view runs:\\n${actionsUrl}`, 'GitHub')\n          humanNote('Commit and push the workflow to trigger a deploy.', 'Next step')\n          if (!machineMode) outro('Workflow generated')\n          return\n        }\n      } catch { /* fall through to branch publish */ }\n    }\n\n    // Cloudflare Pages deploy path\n    if (provider === 'cloudflare') {\n      const idleSeconds = Number(opts.idleTimeout)\n      const effIdle: number | undefined = Number.isFinite(idleSeconds) && idleSeconds > 0 ? Math.floor(idleSeconds) : (opts.ci ? 45 : undefined)\n      const { url, logsUrl } = await runDeploy({ provider: provider!, env: envTarget, cwd: targetCwd, json: Boolean(opts.json), project: effectiveProject, printCmd: opts.printCmd === true, timeoutSeconds: effectiveTimeout, idleTimeoutSeconds: effIdle })\n      if (isJsonMode(opts.json)) {\n        logger.json({ ok: true, action: 'start', provider, target: envTarget, mode: 'deploy', url, logsUrl, cwd: targetCwd, final: true })\n        if (!machineMode) outro('Done')\n        return\n      }\n      if (url) logger.success(`${envTarget === 'prod' ? 'Production' : 'Preview'}: ${url}`)\n      if (logsUrl) logger.note(`Logs: ${logsUrl}`)\n      if (!machineMode) outro('Deployment complete')\n      return\n    }\n\n    // Ensure vercel.json for Vercel\n    if (provider === 'vercel') {\n      try { const p = await loadProvider('vercel'); await p.generateConfig({ detection, cwd: targetCwd, overwrite: false }); humanNote('Ensured vercel.json', 'Config') } catch { /* ignore if exists */ }\n    }\n\n    // Vercel deploy path\n    const idleSeconds = Number(opts.idleTimeout)\n    const effIdle: number | undefined = Number.isFinite(idleSeconds) && idleSeconds > 0 ? Math.floor(idleSeconds) : (opts.ci ? 45 : undefined)\n    const { url, logsUrl, alias } = await runDeploy({ provider: provider!, env: envTarget, cwd: targetCwd, json: Boolean(opts.json), project: effectiveProject, org: opts.org ?? savedOrg, printCmd: opts.printCmd === true, alias: opts.alias, showLogs: Boolean(opts.showLogs), timeoutSeconds: effectiveTimeout, idleTimeoutSeconds: effIdle, publishDir: publishSuggestion, noBuild: Boolean(opts.noBuild) })\n    let aliasAssigned: string | undefined = alias\n    let didPromote: boolean = false\n\n    // Non-interactive auto-promotion: if --promote and --alias are provided in machine mode (or JSON), set alias without prompting\n    if (provider === 'vercel' && envTarget === 'preview' && !didPromote && opts.promote === true && typeof opts.alias === 'string' && opts.alias.trim().length > 0) {\n      try {\n        let previewUrl: string | undefined = url\n        if (!previewUrl) {\n          const listRes = await proc.run({ cmd: 'vercel list --json -n 10', cwd: targetCwd })\n          if (listRes.ok) {\n            try {\n              const arr = JSON.parse(listRes.stdout) as Array<{ url?: string; readyState?: string; target?: string }>\n              const previews = arr.filter(d => (d.target ?? '').toLowerCase() !== 'production' && (d.readyState ?? '').toLowerCase() === 'ready')\n              previewUrl = previews[0]?.url ? (previews[0].url!.startsWith('http') ? previews[0].url! : `https://${previews[0].url!}`) : undefined\n            } catch { /* ignore parse */ }\n          }\n        }\n        if (previewUrl) {\n          const domain = opts.alias.replace(/^https?:\\/\\//i, '').trim()\n          const aliasCmd = `vercel alias set ${previewUrl} ${domain}`\n          if (opts.printCmd) logger.info(`$ ${aliasCmd}`)\n          const set = await runWithRetry({ cmd: aliasCmd, cwd: targetCwd })\n          if (set.ok) {\n            aliasAssigned = `https://${domain}`\n            didPromote = true\n          } else {\n            const msg = (set.stderr || set.stdout || 'Failed to set alias').trim()\n            logger.warn(`Promotion failed: ${msg}\\nHint: Ensure the domain is added to your Vercel project (Project Settings → Domains) and that your account/team has permission to manage domains.`)\n          }\n        } else {\n          logger.warn('Promotion skipped: could not resolve preview URL to promote. Provide --alias and optionally use --print-cmd to inspect provider commands.')\n        }\n      } catch { /* ignore, keep deploy result */ }\n    }\n    const cmd = buildNonInteractiveCmd({ provider: provider!, envTarget, path: targetPath, project: effectiveProject, org: opts.org ?? savedOrg, syncEnv: doSync })\n    // Build a small CI checklist for Vercel as well\n    const buildCommand: string = detection.buildCommand\n    let ciEnvFile: string | undefined\n    let envKeysExample: readonly string[] | undefined\n    try {\n      const candidates: readonly string[] = envTarget === 'prod' ? ['.env.production.local', '.env'] : ['.env', '.env.local']\n      for (const f of candidates) { if (await fsx.exists(join(targetCwd, f))) { ciEnvFile = f; break } }\n      if (ciEnvFile) {\n        const keys = await parseEnvKeys(join(targetCwd, ciEnvFile))\n        envKeysExample = keys.slice(0, 10)\n      }\n    } catch { /* ignore */ }\n    // Special handling: GitHub Actions workflow-only path (no local deploy performed)\n    if (provider === 'github' && !url && !logsUrl) {\n      // Attempt to derive the repo owner/name for deep links\n      let actionsUrl: string | undefined\n      try {\n        const origin = await proc.run({ cmd: 'git remote get-url origin', cwd: targetCwd })\n        if (origin.ok) {\n          const t = origin.stdout.trim()\n          const m = t.match(/^https?:\\/\\/github\\.com\\/([^/]+)\\/([^/.]+)(?:\\.git)?/i) || t.match(/^git@github\\.com:([^/]+)\\/([^/.]+)(?:\\.git)?/i)\n          if (m && m[1] && m[2]) actionsUrl = `https://github.com/${m[1]}/${m[2]}/actions/workflows/deploy-pages.yml`\n        }\n      } catch { /* ignore */ }\n      const wfPath = join(targetCwd, '.github', 'workflows', 'deploy-pages.yml')\n      if (isJsonMode(opts.json)) {\n        logger.json({ ok: true, action: 'start', provider, target: envTarget, mode: 'workflow-only', workflowPath: wfPath, actionsUrl, cwd: targetCwd, final: true })\n        if (!machineMode) outro('Workflow generated')\n        return\n      }\n      humanNote(`Wrote GitHub Actions workflow to ${wfPath}`, 'Config')\n      if (actionsUrl) humanNote(`Open Actions to view runs:\\n${actionsUrl}`, 'GitHub')\n      humanNote('Commit and push the workflow to trigger a deploy.', 'Next step')\n      if (!machineMode) outro('Workflow generated')\n      return\n    }\n\n    if (isJsonMode(opts.json)) {\n      logger.json({ ok: true, action: 'start', provider, target: envTarget, mode: 'deploy', url, logsUrl, alias: aliasAssigned, cmd, ciChecklist: { buildCommand, envFile: ciEnvFile, exampleKeys: envKeysExample }, cwd: targetCwd, final: true })\n      if (!machineMode) outro('Done');\n      return\n    }\n    if (url) logger.success(`${envTarget === 'prod' ? 'Production' : 'Preview'}: ${url}`)\n    if (logsUrl) logger.note(`Logs: ${logsUrl}`)\n    // Human CI checklist\n    {\n      const lines: string[] = []\n      lines.push(`Build command: ${buildCommand}`)\n      if (ciEnvFile) lines.push(`Env file:     ${ciEnvFile}`)\n      if (envKeysExample && envKeysExample.length > 0) lines.push(`Example keys: ${envKeysExample.join(', ')}${envKeysExample.length >= 10 ? '…' : ''}`)\n      if (lines.length > 0) humanNote(lines.join('\\n'), 'CI Checklist')\n    }\n    humanNote(`Rerun non-interactively:\\n${cmd}`, 'Command')\n    const wantCopy = await clackConfirm({ message: 'Copy command to clipboard?', initialValue: false })\n    if (isCancel(wantCopy)) return cancel('Cancelled')\n    if (wantCopy) { const ok = await tryCopyToClipboard(cmd); if (ok) humanNote('Copied command to clipboard', 'Command') }\n    if (logsUrl) {\n      const wantCopyLogs = await clackConfirm({ message: 'Copy logs URL to clipboard?', initialValue: false })\n      if (!isCancel(wantCopyLogs) && wantCopyLogs) { const ok = await tryCopyToClipboard(logsUrl); if (ok) humanNote('Copied logs URL to clipboard', 'Command') }\n    }\n    // Offer to open logs/dashboard (non-blocking with timeout)\n    const openMsg: string = logsUrl ? `Open provider dashboard/logs now?\\n${makeHyperlink(logsUrl, 'Open logs in browser')}` : 'Open provider dashboard/logs now?'\n    const openNow = await clackConfirm({ message: openMsg, initialValue: false })\n    if (!isCancel(openNow) && openNow) {\n      try {\n        if (logsUrl) {\n          const opener: string = process.platform === 'win32'\n            ? `powershell -NoProfile -NonInteractive -Command Start-Process \\\"${logsUrl}\\\"`\n            : process.platform === 'darwin'\n              ? `open \"${logsUrl}\"`\n              : `xdg-open \"${logsUrl}\"`\n          // Do not hang the wizard if the OS opener stalls; give it up to 5s and continue.\n          try { await runWithTimeout({ cmd: opener, cwd: targetCwd }, 5_000) } catch { /* swallow */ }\n        } else {\n          try {\n            const plugin = await loadProvider(provider)\n            await withTimeout(plugin.open({ projectId: effectiveProject, orgId: opts.org ?? savedOrg }), 5_000)\n          } catch { /* swallow */ }\n        }\n      } catch (e) {\n        logger.warn(`Open logs failed: ${(e as Error).message}`)\n      }\n    }\n    // Offer to save defaults\n    if (opts.saveDefaults !== false) {\n      const save = await clackConfirm({ message: 'Save these selections as defaults (opendeploy.config.json)?', initialValue: false })\n      if (!isCancel(save) && save) {\n        try {\n          const cfgPath = join(rootCwd, 'opendeploy.config.json')\n          let cfg: Record<string, unknown> = {}\n          try { const raw = await fsx.readJson<Record<string, unknown>>(cfgPath); cfg = (raw ?? {}) as Record<string, unknown> } catch { /* new file */ }\n          const startDefaults = {\n            framework,\n            provider,\n            env: envTarget,\n            path: targetPath,\n            syncEnv: doSync,\n            project: opts.project ?? saved.project,\n            org: opts.org ?? saved.org\n          }\n          const merged = { ...cfg, startDefaults }\n          await writeFile(cfgPath, JSON.stringify(merged, null, 2) + '\\n', 'utf8')\n          humanNote(`Wrote ${cfgPath}`, 'Config')\n        } catch (e) {\n          logger.warn(`Could not save defaults: ${(e as Error).message}`)\n        }\n      }\n    }\n    if (!machineMode) outro('Deployment complete')\n}\n\nfunction buildNonInteractiveCmd(args: { readonly provider: Provider; readonly envTarget: 'prod' | 'preview'; readonly path?: string; readonly project?: string; readonly org?: string; readonly syncEnv?: boolean }): string {\n  const parts: string[] = ['opd', 'up', args.provider, '--env', args.envTarget]\n  if (args.syncEnv) parts.push('--sync-env')\n  if (args.path) parts.push('--path', args.path)\n  if (args.project) parts.push('--project', args.project)\n  if (args.org) parts.push('--org', args.org)\n  return parts.join(' ')\n}\n\n/**\n * Try to copy text to clipboard in a way that works for packaged binaries.\n * - Windows: PowerShell Set-Clipboard\n * - macOS: pbcopy\n * - Linux: best-effort dynamic import of 'clipboardy' (may be unavailable)\n */\nasync function tryCopyToClipboard(text: string): Promise<boolean> {\n  try {\n    const value: string = text ?? ''\n    if (process.platform === 'win32') {\n      // Use PowerShell to avoid Node ESM issues in pkg snapshots\n      const ps: string = `powershell -NoProfile -Command \\\"Set-Clipboard -Value @'\\n${value}\\n'@\\\"`\n      const res = await proc.run({ cmd: ps })\n      return res.ok\n    }\n    if (process.platform === 'darwin') {\n      const res = await proc.run({ cmd: `printf %s ${JSON.stringify(value)} | pbcopy` })\n      return res.ok\n    }\n    // Linux/others: try dynamic import of clipboardy\n    try {\n      // eslint-disable-next-line @typescript-eslint/consistent-type-imports\n      const mod: any = await import('clipboardy').catch(() => null)\n      if (mod && typeof mod.write === 'function') { await mod.write(value); return true }\n    } catch { /* ignore */ }\n  } catch { /* ignore */ }\n  return false\n}\n\nfunction sleep(ms: number): Promise<void> {\n  return new Promise<void>(resolve => setTimeout(resolve, ms))\n}\n\nasync function openUrl(url: string): Promise<boolean> {\n  try {\n    const u: string = url\n    const cmd: string = process.platform === 'win32'\n      ? `powershell -NoProfile -NonInteractive -Command Start-Process \\\"${u}\\\"`\n      : process.platform === 'darwin'\n        ? `open \"${u}\"`\n        : `xdg-open \"${u}\"`\n    const res = await runWithTimeout({ cmd }, 5_000)\n    return res.ok\n  } catch { return false }\n}\n\n/** Register the guided start command. */\nexport function registerStartCommand(program: Command): void {\n  program\n    .command('start')\n    .description('Guided deploy wizard (select framework, provider, env, and deploy)')\n    .option('--framework <name>', 'Framework: next|astro|sveltekit|remix|expo')\n    .option('--provider <name>', 'Provider: vercel|cloudflare|github')\n    .option('--env <env>', 'Environment: prod|preview', 'preview')\n    .option('--path <dir>', 'Path to app directory (monorepo)')\n    .option('--project <id>', 'Provider project/site ID')\n    .option('--org <id>', 'Provider org/team ID (Vercel)')\n    .option('--sync-env', 'Sync environment before deploy')\n    .option('--promote', 'Vercel: after a preview deploy, promote it to production by setting an alias (use with --alias)')\n    .option('--json', 'JSON-only output')\n    .option('--print-cmd', 'Print underlying provider commands that will be executed')\n    .option('--ci', 'CI mode (non-interactive)')\n    .option('--skip-auth-check', 'Skip provider login checks (assume environment is already authenticated)')\n    .option('--assume-logged-in', 'Alias for --skip-auth-check; bypass auth prompts entirely')\n    .option('--dry-run', 'Plan only; skip deploy')\n    .option('--skip-preflight', 'Skip local build preflight validation')\n    .option('--soft-fail', 'Exit with code 0 on failure; emit ok:false JSON summary instead (CI-friendly)')\n    .option('--capture', 'Write JSON and NDJSON logs to ./.artifacts (defaults on in --ci)')\n    .option('--no-save-defaults', 'Do not prompt to save defaults')\n    .option('--deploy', 'Execute a real deploy inside the wizard')\n    .option('--alias <domain>', 'Vercel only: set an alias (domain) after deploy')\n    .option('--show-logs', 'Also echo provider stdout/stderr lines in human mode')\n    .option('--summary-only', 'JSON: print only objects with final:true (suppresses transient JSON)')\n    .option('--idle-timeout <seconds>', 'Abort if no new provider output arrives for N seconds (disabled by default)')\n    .option('--timeout <seconds>', 'Abort provider subprocess after N seconds (default 900 in --ci; unlimited otherwise)')\n    .option('--debug-detect', 'Emit detection JSON payload (path, framework, build/publish hints) for debugging')\n    .option('--generate-config-only', 'Write minimal provider config based on detection and exit')\n    .option('--minimal', 'Run with sensible defaults (non-interactive)')\n    .action(async (opts: StartOptions): Promise<void> => {\n      try { await runStartWizard(opts) } catch (err) {\n        const message: string = err instanceof Error ? err.message : String(err)\n        logger.error(message)\n        process.exitCode = 1\n      }\n    })\n}\n","import type { RunStreamArgs, StreamController } from './process'\r\nimport { proc } from './process'\r\nimport { goSpawnStream, type GoRunStreamArgs } from './process-go'\r\nimport { spawn } from 'node:child_process'\r\n\r\n/**\r\n * Prefer the Go sidecar runner when available (and not disabled),\r\n * otherwise fall back to the built-in Node runner.\r\n */\r\nexport function spawnStreamPreferred(args: RunStreamArgs & { readonly timeoutSeconds?: number; readonly idleTimeoutSeconds?: number }): StreamController {\r\n  const forceGo = process.env.OPD_GO_FORCE === '1'\r\n  const useGo = process.env.OPD_GO_DISABLE !== '1' && (forceGo || hasGoSidecar())\r\n  if (useGo) {\r\n    const goArgs: GoRunStreamArgs = {\r\n      ...args,\r\n      timeoutSeconds: args.timeoutSeconds,\r\n      idleTimeoutSeconds: args.idleTimeoutSeconds\r\n    }\r\n    return goSpawnStream(goArgs)\r\n  }\r\n  return proc.spawnStream(args)\r\n}\r\n\r\nlet goAvailableCached: boolean | undefined\r\nfunction hasGoSidecar(): boolean {\r\n  if (typeof goAvailableCached === 'boolean') return goAvailableCached\r\n  try {\r\n    const cp = spawn('opd-go', ['-v'], { stdio: 'ignore', windowsHide: true })\r\n    let decided = false\r\n    cp.once('error', (err) => {\r\n      if (!decided) { decided = true; goAvailableCached = (err as any)?.code !== 'ENOENT' }\r\n    })\r\n    cp.once('close', () => {\r\n      if (!decided) { decided = true; goAvailableCached = true }\r\n    })\r\n  } catch {\r\n    goAvailableCached = false\r\n  }\r\n  // Best effort: assume available; if not, spawn will fail and fallback will engage on next call\r\n  return goAvailableCached ?? false\r\n}\r\n","import { spawn } from 'node:child_process'\r\nimport type { ChildProcessWithoutNullStreams } from 'node:child_process'\r\nimport { existsSync } from 'node:fs'\r\nimport { join } from 'node:path'\r\nimport type { RunStreamArgs, StreamController } from './process'\r\n\r\nexport interface GoRunStreamArgs extends RunStreamArgs {\r\n  readonly timeoutSeconds?: number\r\n  readonly idleTimeoutSeconds?: number\r\n  readonly pty?: boolean\r\n  readonly cols?: number\r\n  readonly rows?: number\r\n}\r\n\r\n// -------- Generic request runner (non-streaming helpers) --------\r\n\r\ntype GoRequestPayload = Readonly<Record<string, unknown>>\r\n\r\ninterface GoDone {\r\n  readonly ok: boolean\r\n  readonly exitCode: number\r\n  readonly reason?: string\r\n  readonly extra?: Readonly<Record<string, unknown>>\r\n}\r\n\r\nasync function goRequest(payload: GoRequestPayload, opts?: { readonly cwd?: string }): Promise<GoDone> {\r\n  const bin = resolveGoBin()\r\n  const { file, argv } = getSpawnCommand(bin)\r\n  const cp: ChildProcessWithoutNullStreams = spawn(file, argv, { stdio: ['pipe', 'pipe', 'pipe'], cwd: opts?.cwd, windowsHide: true })\r\n  cp.stdin.setDefaultEncoding('utf8')\r\n  cp.stdin.write(JSON.stringify(payload) + '\\n')\r\n  cp.stdin.end()\r\n  let result: GoDone | undefined\r\n  let bufOut = ''\r\n  let bufErr = ''\r\n  cp.stdout.setEncoding('utf8')\r\n  cp.stderr.setEncoding('utf8')\r\n  const handleLine = (line: string): void => {\r\n    const t = line.trim()\r\n    if (t.length === 0) return\r\n    try {\r\n      const ev = JSON.parse(t) as GoEvent\r\n      if (ev.event === 'done' && ev.final === true) {\r\n        const ok: boolean = ev.ok === true\r\n        const exitCode: number = Number.isFinite(ev.exitCode) ? (ev.exitCode as number) : (ok ? 0 : 1)\r\n        result = { ok, exitCode, reason: ev.reason, extra: (ev.extra ?? {}) as Readonly<Record<string, unknown>> }\r\n      }\r\n    } catch {\r\n      // ignore non-JSON lines (or surface as debug via stderr aggregation)\r\n    }\r\n  }\r\n  cp.stdout.on('data', (d: string) => {\r\n    bufOut += d\r\n    let idx: number\r\n    while ((idx = bufOut.indexOf('\\n')) !== -1) {\r\n      const part = bufOut.slice(0, idx)\r\n      bufOut = bufOut.slice(idx + 1)\r\n      handleLine(part)\r\n    }\r\n  })\r\n  cp.stderr.on('data', (d: string) => { bufErr += d })\r\n  const code: number = await new Promise<number>((resolve) => {\r\n    cp.on('close', (c: number | null) => resolve(c ?? 1))\r\n  })\r\n  if (!result) return { ok: code === 0, exitCode: code }\r\n  return result\r\n}\r\n\r\nexport async function goZipDir(args: { readonly src: string; readonly dest: string; readonly prefix?: string; readonly cwd?: string }): Promise<{ readonly ok: boolean; readonly exitCode: number; readonly dest?: string; readonly reason?: string }> {\r\n  const res = await goRequest({ action: 'zip-dir', src: args.src, dest: args.dest, prefix: args.prefix ?? '' }, { cwd: args.cwd })\r\n  const dest = typeof res.extra?.dest === 'string' ? String(res.extra?.dest) : undefined\r\n  return { ok: res.ok, exitCode: res.exitCode, dest, reason: res.reason }\r\n}\r\n\r\nexport async function goTarDir(args: { readonly src: string; readonly dest: string; readonly prefix?: string; readonly gzip?: boolean; readonly cwd?: string }): Promise<{ readonly ok: boolean; readonly exitCode: number; readonly dest?: string; readonly reason?: string }> {\r\n  const res = await goRequest({ action: 'tar-dir', src: args.src, dest: args.dest, prefix: args.prefix ?? '', targz: args.gzip === true }, { cwd: args.cwd })\r\n  const dest = typeof res.extra?.dest === 'string' ? String(res.extra?.dest) : undefined\r\n  return { ok: res.ok, exitCode: res.exitCode, dest, reason: res.reason }\r\n}\r\n\r\nexport async function goChecksumFile(args: { readonly src: string; readonly algo?: 'sha256'; readonly cwd?: string }): Promise<{ readonly ok: boolean; readonly exitCode: number; readonly digest?: string; readonly reason?: string }> {\r\n  const res = await goRequest({ action: 'checksum-file', src: args.src, algo: args.algo ?? 'sha256' }, { cwd: args.cwd })\r\n  const digest = typeof res.extra?.digest === 'string' ? String(res.extra?.digest) : undefined\r\n  return { ok: res.ok, exitCode: res.exitCode, digest, reason: res.reason }\r\n}\r\n\r\ninterface GoEvent {\r\n  readonly action?: string\r\n  readonly event?: 'hello' | 'stdout' | 'stderr' | 'status' | 'error' | 'done'\r\n  readonly data?: string\r\n  readonly ok?: boolean\r\n  readonly exitCode?: number\r\n  readonly final?: boolean\r\n  readonly reason?: string\r\n  readonly extra?: Readonly<Record<string, unknown>>\r\n}\r\n\r\nfunction resolveGoBin(): string {\r\n  const override = process.env.OPD_GO_BIN\r\n  if (override && override.length > 0) return override\r\n  const exe = process.platform === 'win32' ? 'opd-go.exe' : 'opd-go'\r\n  const local = join(process.cwd(), '.bin', exe)\r\n  if (existsSync(local)) return local\r\n  return 'opd-go'\r\n}\r\n\r\nfunction defaultPty(): boolean {\r\n  if (process.env.OPD_PTY === '1') return true\r\n  if (process.env.OPD_PTY === '0') return false\r\n  const stdoutWs: NodeJS.WriteStream | undefined = (typeof process.stdout !== 'undefined' ? (process.stdout as NodeJS.WriteStream) : undefined)\r\n  const interactive: boolean = Boolean(stdoutWs && typeof stdoutWs.isTTY === 'boolean' && stdoutWs.isTTY)\r\n  const ci: boolean = process.env.CI === '1' || process.env.CI === 'true'\r\n  const jsonMode: boolean = process.env.OPD_JSON === '1' || process.env.OPD_NDJSON === '1'\r\n  return interactive && !ci && !jsonMode\r\n}\r\n\r\nfunction buildRequest(args: GoRunStreamArgs): string {\r\n  const wantPty: boolean = typeof args.pty === 'boolean' ? args.pty : defaultPty()\r\n  const req = {\r\n    action: 'run-stream',\r\n    cmd: args.cmd,\r\n    cwd: args.cwd ?? '',\r\n    timeoutSec: args.timeoutSeconds ?? 0,\r\n    idleTimeoutSec: args.idleTimeoutSeconds ?? 0,\r\n    env: args.env ?? {},\r\n    pty: wantPty,\r\n    cols: Number.isFinite(Number(args.cols)) ? Number(args.cols) : undefined,\r\n    rows: Number.isFinite(Number(args.rows)) ? Number(args.rows) : undefined\r\n  }\r\n  return JSON.stringify(req)\r\n}\r\n\r\nexport function goSpawnStream(args: GoRunStreamArgs): StreamController {\r\n  const bin = resolveGoBin()\r\n  const { file, argv } = getSpawnCommand(bin)\r\n  const cp: ChildProcessWithoutNullStreams = spawn(file, argv, { stdio: ['pipe', 'pipe', 'pipe'], cwd: args.cwd, windowsHide: true })\r\n  cp.stdin.setDefaultEncoding('utf8')\r\n  const req = buildRequest(args)\r\n  cp.stdin.write(req + '\\n')\r\n  cp.stdin.end()\r\n\r\n  let resolveFn: ((v: { readonly ok: boolean; readonly exitCode: number; readonly reason?: string }) => void) | undefined\r\n  const done = new Promise<{ readonly ok: boolean; readonly exitCode: number; readonly reason?: string }>((resolve) => { resolveFn = resolve })\r\n  let protocolVersion: string | undefined\r\n\r\n  const handleLine = (line: string): void => {\r\n    const trimmed = line.trim()\r\n    if (trimmed.length === 0) return\r\n    try {\r\n      const js = JSON.parse(trimmed) as GoEvent\r\n      if (js.event === 'hello') {\r\n        const pv = (typeof js.extra?.protocolVersion === 'string') ? String(js.extra?.protocolVersion) : undefined\r\n        protocolVersion = pv\r\n        return\r\n      }\r\n      if (js.event === 'stdout' && typeof js.data === 'string') args.onStdout?.(js.data + '\\n')\r\n      else if (js.event === 'stderr' && typeof js.data === 'string') args.onStderr?.(js.data + '\\n')\r\n      else if (js.event === 'done' && js.final === true) {\r\n        const ok: boolean = js.ok === true\r\n        const exitCode: number = Number.isFinite(js.exitCode) ? (js.exitCode as number) : (ok ? 0 : 1)\r\n        resolveFn?.({ ok, exitCode, reason: js.reason })\r\n      }\r\n    } catch {\r\n      // If parsing fails, surface as stderr text for visibility\r\n      args.onStderr?.(line + '\\n')\r\n    }\r\n  }\r\n\r\n  let bufOut = ''\r\n  let bufErr = ''\r\n  cp.stdout.setEncoding('utf8')\r\n  cp.stderr.setEncoding('utf8')\r\n  cp.stdout.on('data', (d: string) => {\r\n    bufOut += d\r\n    let idx: number\r\n    while ((idx = bufOut.indexOf('\\n')) !== -1) {\r\n      const part = bufOut.slice(0, idx)\r\n      bufOut = bufOut.slice(idx + 1)\r\n      handleLine(part)\r\n    }\r\n  })\r\n  cp.stderr.on('data', (d: string) => {\r\n    bufErr += d\r\n    let idx: number\r\n    while ((idx = bufErr.indexOf('\\n')) !== -1) {\r\n      const part = bufErr.slice(0, idx)\r\n      bufErr = bufErr.slice(idx + 1)\r\n      // Go binary should not emit application data to stderr, but surface it\r\n      args.onStderr?.(part + '\\n')\r\n    }\r\n  })\r\n  cp.on('close', (code: number | null) => {\r\n    // If we never received a 'done' event, resolve here\r\n    const ok = (code ?? 1) === 0\r\n    resolveFn?.({ ok, exitCode: code ?? 1 })\r\n  })\r\n\r\n  const stop = (): void => {\r\n    try { cp.kill() } catch {}\r\n  }\r\n\r\n  return { stop, done }\r\n}\r\n\r\nfunction getSpawnCommand(bin: string): { readonly file: string; readonly argv: string[] } {\r\n  const lower = bin.toLowerCase()\r\n  if (lower.endsWith('.js') || lower.endsWith('.mjs') || lower.endsWith('.cjs')) {\r\n    const nodeExe = process.execPath || 'node'\r\n    return { file: nodeExe, argv: [bin] }\r\n  }\r\n  return { file: bin, argv: [] }\r\n}\r\n","/**\r\n * JSON Schema for the final JSON object emitted by `up` command.\r\n * Keep broad to avoid breaking changes; rely on contract tests for stricter checks.\r\n */\r\nexport const upSummarySchema = {\r\n  $schema: \"http://json-schema.org/draft-07/schema#\",\r\n  type: \"object\",\r\n  additionalProperties: true,\r\n  required: [\"ok\", \"action\", \"provider\", \"target\", \"final\"],\r\n  properties: {\r\n    ok: { type: \"boolean\" },\r\n    action: { const: \"up\" },\r\n    provider: { type: \"string\", minLength: 1 },\r\n    target: { enum: [\"prod\", \"preview\"] },\r\n    final: { type: \"boolean\" },\r\n    url: { type: \"string\" },\r\n    logsUrl: { type: \"string\" },\r\n    durationMs: { type: \"integer\", minimum: 0 },\r\n    mode: { type: \"string\" },\r\n    cmdPlan: { type: \"array\", items: { type: \"string\" } },\r\n    schemaOk: { type: \"boolean\" },\r\n    schemaErrors: { type: \"array\", items: { type: \"string\" } }\r\n  }\r\n} as const\r\n","export const providerBuildResultSchema = {\r\n  $schema: \"http://json-schema.org/draft-07/schema#\",\r\n  type: \"object\",\r\n  additionalProperties: true,\r\n  required: [\"ok\"],\r\n  properties: {\r\n    ok: { type: \"boolean\" },\r\n    artifactDir: { type: \"string\" },\r\n    logsUrl: { type: \"string\" },\r\n    message: { type: \"string\" }\r\n  }\r\n} as const\r\n","export const providerDeployResultSchema = {\r\n  $schema: \"http://json-schema.org/draft-07/schema#\",\r\n  type: \"object\",\r\n  additionalProperties: true,\r\n  required: [\"ok\"],\r\n  properties: {\r\n    ok: { type: \"boolean\" },\r\n    url: { type: \"string\" },\r\n    logsUrl: { type: \"string\" },\r\n    message: { type: \"string\" }\r\n  }\r\n} as const\r\n","import { Command } from 'commander'\r\nimport { logger } from '../utils/logger'\r\nimport { proc } from '../utils/process'\r\n\r\ninterface MatrixOptions { readonly local?: boolean }\r\n\r\nfunction volArg(cwd: string): string { return `${cwd}:/workspace` }\r\n\r\nasync function runDockerNode(args: { readonly image: string; readonly cwd: string }): Promise<boolean> {\r\n  const vol = volArg(args.cwd)\r\n  const cmd = [\r\n    'docker run --rm',\r\n    `-e CI=1 -e FORCE_COLOR=0 -e TZ=UTC -e LC_ALL=C`,\r\n    `-v \"${vol}\" -w /workspace`,\r\n    args.image,\r\n    'bash -lc',\r\n    '\"corepack enable && corepack prepare pnpm@10.13.1 --activate && pnpm install --frozen-lockfile && pnpm test -- --reporter=dot\"'\r\n  ].join(' ')\r\n  logger.info(`$ ${cmd}`)\r\n  const res = await proc.run({ cmd })\r\n  if (!res.ok) logger.error(res.stderr || res.stdout || 'docker run failed')\r\n  return res.ok\r\n}\r\n\r\nexport function registerTestMatrixCommand(program: Command): void {\r\n  program\r\n    .command('test-matrix')\r\n    .description('Run the test matrix locally (Node 18/20/22 in Docker; experimental OS parity)')\r\n    .option('--local', 'Run locally using Docker if available')\r\n    .action(async (opts: MatrixOptions): Promise<void> => {\r\n      const cwd: string = process.cwd()\r\n      if (opts.local !== true) {\r\n        logger.info('Use --local to run matrix locally. Remote CI matrix is configured in GitHub Actions.')\r\n        return\r\n      }\r\n      // Check docker\r\n      const hasDocker = await proc.has('docker')\r\n      if (!hasDocker) {\r\n        logger.warn('Docker not found. Running tests once on host instead.')\r\n        const r = await proc.run({ cmd: 'pnpm test -- --reporter=dot', cwd })\r\n        if (!r.ok) process.exitCode = 1\r\n        return\r\n      }\r\n      const ok18 = await runDockerNode({ image: 'node:18', cwd })\r\n      const ok20 = await runDockerNode({ image: 'node:20', cwd })\r\n      const ok22 = await runDockerNode({ image: 'node:22', cwd })\r\n      // Optionally, users can try a Windows container if their Docker setup supports it (local-only)\r\n      // Example image: mcr.microsoft.com/windows/nanoserver:ltsc2022 (requires custom steps)\r\n      // We keep this commented to avoid failures on hosts without Windows container support.\r\n      if (!(ok18 && ok20 && ok22)) process.exitCode = 1\r\n    })\r\n}\r\n","import { Command } from 'commander'\nimport { logger } from '../utils/logger'\nimport { proc } from '../utils/process'\nimport { join } from 'node:path'\nimport { promises as fs } from 'node:fs'\n\ninterface CiLogsOptions {\n  readonly workflow?: string\n  readonly follow?: boolean\n  readonly json?: boolean\n  readonly pr?: string\n}\n\nfunction parseRepoFromGitUrl(url: string): string | undefined {\n  const https = url.match(/^https?:\\/\\/github\\.com\\/([^/]+)\\/([^/.]+)(?:\\.git)?$/i)\n  if (https) return `${https[1]}/${https[2]}`\n  const ssh = url.match(/^git@github\\.com:([^/]+)\\/([^/.]+)(?:\\.git)?$/i)\n  if (ssh) return `${ssh[1]}/${ssh[2]}`\n  return undefined\n}\n\nasync function resolveRepo(): Promise<string | undefined> {\n  if (process.env.GITHUB_REPOSITORY) return process.env.GITHUB_REPOSITORY\n  try {\n    const out = await proc.run({ cmd: 'git remote get-url origin', cwd: process.cwd() })\n    if (out.ok) return parseRepoFromGitUrl(out.stdout.trim())\n  } catch { /* ignore */ }\n  return undefined\n}\n\n/**\n * Resolve current branch from environment or Git.\n * @returns Branch name or 'main' if unknown\n */\nasync function resolveBranch(): Promise<string> {\n  const envRef: string | undefined = process.env.GITHUB_HEAD_REF || process.env.GITHUB_REF_NAME\n  if (envRef && envRef.trim().length > 0) return envRef.trim()\n  // Try normal branch name\n  const cur = await proc.run({ cmd: 'git rev-parse --abbrev-ref HEAD', cwd: process.cwd() })\n  const branch1: string | undefined = cur.ok ? cur.stdout.trim() : undefined\n  if (branch1 && branch1 !== 'HEAD') return branch1\n  // Detached HEAD: derive origin default branch\n  const head = await proc.run({ cmd: 'git symbolic-ref refs/remotes/origin/HEAD', cwd: process.cwd() })\n  if (head.ok) {\n    const m = head.stdout.trim().match(/origin\\/(.+)$/)\n    const b = m?.[1]\n    if (b && b.length > 0) return b\n  }\n  return 'main'\n}\n\n/**\n * Check if GitHub CLI (gh) is installed.\n * @returns true if installed, false otherwise\n */\nasync function ghExists(): Promise<boolean> {\n  const cmd = process.platform === 'win32' ? 'where gh' : 'command -v gh'\n  const out = await proc.run({ cmd })\n  return out.ok && out.stdout.trim().length > 0\n}\n\n/**\n * Get latest GitHub Actions run information.\n * @param args Repository, branch, and workflow\n * @returns Run information or undefined\n */\ntype GhRunInfo = { readonly id: number; readonly status?: string; readonly conclusion?: string; readonly branch?: string }\n\nasync function getLatestRun(args: { readonly repo: string; readonly branch?: string; readonly workflow?: string }): Promise<GhRunInfo | undefined> {\n  const cmd: string = `gh run list --repo ${args.repo} ${args.branch ? `-b ${args.branch}` : ''} ${args.workflow ? `--workflow ${args.workflow}` : ''} -L 1 --json databaseId,status,conclusion,headBranch`\n  const res = await proc.run({ cmd, cwd: process.cwd() })\n  if (!res.ok) return undefined\n  try {\n    const arr = JSON.parse(res.stdout) as Array<{ databaseId?: number; status?: string; conclusion?: string; headBranch?: string }>\n    const r = arr?.[0]\n    if (!r || typeof r.databaseId !== 'number') return undefined\n    return { id: r.databaseId, status: r.status, conclusion: r.conclusion, branch: r.headBranch }\n  } catch { return undefined }\n}\n\n/**\n * Get GitHub Actions run URL.\n * @param repo Repository name\n * @param id Run ID\n * @returns Run URL\n */\nfunction runUrl(repo: string, id: number): string { return `https://github.com/${repo}/actions/runs/${id}` }\n\n/**\n * Emit GitHub Actions annotation.\n * @param kind Annotation kind (error or warning)\n * @param msg Annotation message\n */\nfunction emitAnnotation(kind: 'error' | 'warning', msg: string): void {\n  // GitHub Actions annotation format; safe to print elsewhere (no-ops)\n  // eslint-disable-next-line no-console\n  console.log(`::${kind} ::${msg}`)\n}\n\n/**\n * Ensure a directory exists (mkdir -p).\n */\nasync function ensureDir(dir: string): Promise<void> {\n  await fs.mkdir(dir, { recursive: true })\n}\n\n/**\n * Sanitize a string for safe filenames.\n */\nfunction sanitizeFilename(name: string): string {\n  return name.replace(/[^a-zA-Z0-9._-]+/g, '-').replace(/^-+|-+$/g, '')\n}\n\n/**\n * Retrieve jobs for a run.\n */\nasync function getRunJobs(args: { readonly repo: string; readonly id: number }): Promise<Array<{ readonly id: number; readonly name: string }>> {\n  const res = await proc.run({ cmd: `gh run view ${args.id} --repo ${args.repo} --json jobs`, cwd: process.cwd() })\n  if (!res.ok) return []\n  try {\n    const js = JSON.parse(res.stdout) as { jobs?: Array<{ databaseId?: number; name?: string }> }\n    const jobs = js.jobs ?? []\n    return jobs.filter(j => typeof j.databaseId === 'number').map(j => ({ id: j.databaseId as number, name: sanitizeFilename(j.name ?? 'job') }))\n  } catch { return [] }\n}\n\n/**\n * Write a text file ensuring parent dir exists.\n */\nasync function writeTextFile(path: string, data: string): Promise<void> {\n  await ensureDir(path.substring(0, path.lastIndexOf('/')) || '.')\n  await fs.writeFile(path, data, 'utf8')\n}\n\nfunction platformOpen(url: string): Promise<{ ok: boolean }> {\n  const isWin: boolean = process.platform === 'win32'\n  const isMac: boolean = process.platform === 'darwin'\n  if (isWin) {\n    // Prefer PowerShell for cross-shell reliability (Git Bash, PowerShell, CMD)\n    return proc.run({ cmd: `powershell -NoProfile -Command Start-Process \\\"${url}\\\"` })\n      .then(r => r.ok ? { ok: true } : proc.run({ cmd: `cmd /c start \"\" \"${url}\"` }).then(r2 => ({ ok: r2.ok })))\n  }\n  const cmd: string = isMac ? `open \"${url}\"` : `xdg-open \"${url}\"`\n  return proc.run({ cmd }).then(r => ({ ok: r.ok }))\n}\n\n/**\n * Register CI log helpers (GitHub Actions).\n */\nexport function registerCiLogsCommand(program: Command): void {\n  const ci = program.command('ci').description('CI helpers')\n  ci\n    .command('logs')\n    .description('Show or follow GitHub Actions logs for the latest run on this branch (prints direct URLs)')\n    .option('--workflow <file>', 'Workflow file name (e.g., ci.yml, pages.yml)', 'ci.yml')\n    .option('--follow', 'Follow the latest run until completion')\n    .option('--json', 'Emit structured JSON summary')\n    .option('--pr <number>', 'Scope to a given PR number (resolves head branch)')\n    .action(async (opts: CiLogsOptions): Promise<void> => {\n      const repo = await resolveRepo()\n      if (!repo) {\n        const msg = 'Unable to resolve GitHub repo. Set GITHUB_REPOSITORY or add a git origin remote.'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-logs', message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      const hasGh = await ghExists()\n      if (!hasGh) {\n        const msg = 'GitHub CLI (gh) not found. Install via: winget install GitHub.cli'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-logs', repo, suggestion: 'install gh', final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      // Resolve branch from PR when provided; otherwise autodetect\n      let branch: string | undefined\n      if (opts.pr) {\n        const prRes = await proc.run({ cmd: `gh pr view ${opts.pr} --repo ${repo} --json headRefName`, cwd: process.cwd() })\n        if (prRes.ok) {\n          try { const js = JSON.parse(prRes.stdout) as { headRefName?: string }; if (js?.headRefName) branch = js.headRefName } catch { /* ignore */ }\n        }\n      }\n      if (!branch) branch = await resolveBranch()\n      const wf = String(opts.workflow || 'ci.yml')\n      const repoName: string = repo\n      if (opts.follow) {\n        const first = await getLatestRun({ repo: repoName, branch, workflow: wf })\n        if (first) logger.info(`Run: ${runUrl(repoName, first.id)}`)\n        await proc.run({ cmd: `gh run watch --repo ${repoName} --exit-status --interval 5`, cwd: process.cwd() })\n        const last = await getLatestRun({ repo: repoName, branch, workflow: wf })\n        if (last) {\n          const url: string = runUrl(repoName, last.id)\n          const ok: boolean = (last.conclusion ?? '').toLowerCase() === 'success'\n          if (opts.json) logger.jsonPrint({ ok, action: 'ci-logs', repo: repoName, branch, workflow: wf, id: last.id, url, status: last.status, conclusion: last.conclusion, follow: true, final: true })\n          else logger.info(`${ok ? 'Success' : 'Done'}: ${url}`)\n          if (!ok) emitAnnotation('error', `CI run failed: ${url}`)\n          if (!ok) process.exitCode = 1\n        } else {\n          if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-logs', repo: repoName, branch, workflow: wf, message: 'No runs found after watch', final: true })\n          else logger.warn('No runs found after watch')\n        }\n        return\n      }\n      const info = await getLatestRun({ repo: repoName, branch, workflow: wf })\n      if (!info) {\n        const msg = 'No runs found (trigger a workflow first).'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-logs', repo, branch, workflow: wf, message: msg, final: true })\n        else logger.warn(msg)\n        return\n      }\n      const url = runUrl(repoName, info.id)\n      const ok = (info.conclusion ?? '').toLowerCase() !== 'failure'\n      if (opts.json) logger.jsonPrint({ ok, action: 'ci-logs', repo, branch, workflow: wf, id: info.id, url, status: info.status, conclusion: info.conclusion, final: true })\n      else logger.info(`${info.status ?? 'status: unknown'} — ${url}`)\n      if (!ok) emitAnnotation('error', `CI run failed: ${url}`)\n      if (!ok) process.exitCode = 1\n    })\n\n  // ci reproduce — run local steps similar to CI using the environment snapshot\n  ci\n    .command('reproduce')\n    .description('Reproduce the CI build locally: applies Node/pnpm versions (Corepack), installs deps, builds, and runs tests')\n    .option('--snapshot <file>', 'Path to CI snapshot JSON (default ./.artifacts/ci.snapshot.json)', '.artifacts/ci.snapshot.json')\n    .option('--tests <pattern>', 'Optional test filter or extra args to pass to vitest (CLI package)')\n    .option('--json', 'Emit structured JSON summary')\n    .action(async (opts: { readonly snapshot?: string; readonly tests?: string; readonly json?: boolean }): Promise<void> => {\n      const snapPath = (opts.snapshot && opts.snapshot.length > 0) ? opts.snapshot : '.artifacts/ci.snapshot.json'\n      const abs = join(process.cwd(), snapPath)\n      let nodeVersion: string | undefined\n      let pnpmVersion: string | undefined\n      try {\n        const raw = await fs.readFile(abs, 'utf8')\n        const js = JSON.parse(raw) as Record<string, unknown>\n        // Try common shapes\n        // Example shapes we attempt: { node: { version: '20.x' }, tools: { pnpm: '10.x' }, env: {...} }\n        const nodeObj = (js as any)?.node\n        const tools = (js as any)?.tools\n        if (typeof nodeObj?.version === 'string' && nodeObj.version.length > 0) nodeVersion = String(nodeObj.version).replace(/^v/i, '')\n        if (typeof tools?.pnpm === 'string' && tools.pnpm.length > 0) pnpmVersion = String(tools.pnpm)\n      } catch {\n        // snapshot is optional; fall back to current versions\n      }\n      if (!nodeVersion) nodeVersion = process.version.replace(/^v/i, '')\n      if (!pnpmVersion) pnpmVersion = '10.16.1'\n\n      const steps: Array<{ readonly name: string; readonly cmd: string }> = [\n        { name: 'Node version', cmd: 'node -v' },\n        { name: 'Enable Corepack', cmd: 'corepack enable' },\n        { name: 'Prepare pnpm', cmd: `corepack prepare pnpm@${pnpmVersion} --activate` },\n        { name: 'pnpm version', cmd: 'pnpm -v' },\n        { name: 'Install', cmd: 'pnpm install -r --frozen-lockfile' },\n        { name: 'Build', cmd: 'pnpm build' },\n        { name: 'Test', cmd: `pnpm -C packages/cli test -- --reporter=dot${opts.tests ? ' ' + opts.tests : ''}` }\n      ]\n      const results: Array<{ readonly name: string; readonly ok: boolean; readonly code: number; readonly stdout?: string; readonly stderr?: string }> = []\n      for (const s of steps) {\n        const r = await proc.run({ cmd: s.cmd, cwd: process.cwd() })\n        const rc: number = ((): number => {\n          const maybe: unknown = (r as unknown as { code?: number }).code\n          return typeof maybe === 'number' ? maybe : (r.ok ? 0 : -1)\n        })()\n        results.push({ name: s.name, ok: r.ok, code: rc, stdout: r.stdout, stderr: r.stderr })\n        if (!r.ok) break\n      }\n      const okAll = results.every(r => r.ok)\n      if (opts.json) {\n        logger.jsonPrint({ ok: okAll, action: 'ci-reproduce', node: nodeVersion, pnpm: pnpmVersion, results, final: true })\n      } else {\n        for (const r of results) logger.info(`${r.ok ? '✓' : '✗'} ${r.name} (code ${r.code})`)\n        if (!okAll) process.exitCode = 1\n      }\n    })\n\n  // ci env apply — print export commands for environment variables from the snapshot\n  ci\n    .command('env')\n    .description('CI environment helpers')\n    .command('apply')\n    .description('Read CI snapshot and print shell commands to apply its environment locally')\n    .option('--snapshot <file>', 'Path to CI snapshot JSON (default ./.artifacts/ci.snapshot.json)', '.artifacts/ci.snapshot.json')\n    .option('--shell <kind>', 'Print export commands for: bash|pwsh (default bash)', 'bash')\n    .option('--json', 'Emit structured JSON summary')\n    .action(async (opts: { readonly snapshot?: string; readonly shell?: 'bash' | 'pwsh'; readonly json?: boolean }): Promise<void> => {\n      const snapPath = (opts.snapshot && opts.snapshot.length > 0) ? opts.snapshot : '.artifacts/ci.snapshot.json'\n      const abs = join(process.cwd(), snapPath)\n      let envObj: Record<string, string> | undefined\n      try {\n        const raw = await fs.readFile(abs, 'utf8')\n        const js = JSON.parse(raw) as Record<string, unknown>\n        // Try common shapes: { env: { KEY: 'VALUE' } } or flat object\n        if (js && typeof (js as any).env === 'object') envObj = (js as any).env as Record<string, string>\n        else if (js && typeof js === 'object') {\n          const candidate: Record<string, string> = {}\n          for (const [k, v] of Object.entries(js)) if (typeof v === 'string') candidate[k] = v\n          if (Object.keys(candidate).length > 0) envObj = candidate\n        }\n      } catch {\n        // ignore\n      }\n      envObj = envObj ?? {}\n      const lines: string[] = []\n      const sh = (opts.shell === 'pwsh' ? 'pwsh' : 'bash')\n      for (const [k, v] of Object.entries(envObj)) {\n        if (sh === 'bash') lines.push(`export ${k}=${JSON.stringify(v)}`)\n        else lines.push(`$Env:${k} = ${JSON.stringify(v)}`)\n      }\n      if (opts.json) {\n        logger.jsonPrint({ ok: true, action: 'ci-env-apply', shell: sh, count: lines.length, final: true })\n      } else {\n        if (lines.length === 0) logger.warn('No environment variables found in snapshot (env object missing).')\n        else {\n          logger.info(`# To apply in current shell (${sh}), run:`)\n          for (const l of lines) logger.info(l)\n        }\n      }\n    })\n  // ci sync — download latest run summary and per-job logs\n  ci\n    .command('sync')\n    .description('Download the latest run summary and job logs into a local directory for IDE debugging')\n    .option('--workflow <file>', 'Workflow file name (e.g., ci.yml, pages.yml)', 'ci.yml')\n    .option('--out <dir>', 'Output directory (default ./.artifacts/ci-logs)', '.artifacts/ci-logs')\n    .option('--pr <number>', 'Scope to a given PR number (resolves head branch)')\n    .option('--follow', 'Re-sync until run completes')\n    .option('--json', 'Emit structured JSON summary')\n    .action(async (opts: { readonly workflow?: string; readonly out?: string; readonly pr?: string; readonly follow?: boolean; readonly json?: boolean }): Promise<void> => {\n      const repo = await resolveRepo()\n      if (!repo) {\n        const msg = 'Unable to resolve GitHub repo. Set GITHUB_REPOSITORY or add a git origin remote.'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-sync', message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      const hasGh = await ghExists()\n      if (!hasGh) {\n        const msg = 'GitHub CLI (gh) not found. Install via: winget install GitHub.cli'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-sync', repo, suggestion: 'install gh', final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      // Resolve branch from PR when provided; otherwise autodetect\n      let branch: string | undefined\n      if (opts.pr) {\n        const prRes = await proc.run({ cmd: `gh pr view ${opts.pr} --repo ${repo} --json headRefName`, cwd: process.cwd() })\n        if (prRes.ok) {\n          try { const js = JSON.parse(prRes.stdout) as { headRefName?: string }; if (js?.headRefName) branch = js.headRefName } catch { /* ignore */ }\n        }\n      }\n      if (!branch) branch = await resolveBranch()\n      const wf = String(opts.workflow || 'ci.yml')\n      const repoName: string = repo\n      \n      async function syncOnce(): Promise<{ readonly ok: boolean; readonly id?: number; readonly status?: string; readonly conclusion?: string; readonly url?: string }> {\n        const info = await getLatestRun({ repo: repoName, branch, workflow: wf })\n        if (!info) return { ok: false }\n        const id = info.id\n        const url = runUrl(repoName, id)\n        const outRoot = opts.out && opts.out.length > 0 ? opts.out : '.artifacts/ci-logs'\n        const runDir = join(process.cwd(), outRoot, sanitizeFilename(wf.replace(/\\.yml$/i, '')), String(id))\n        await ensureDir(runDir)\n        const summary = await proc.run({ cmd: `gh run view ${id} --repo ${repoName} --json url,conclusion,createdAt,updatedAt,jobs`, cwd: process.cwd() })\n        if (summary.ok) await writeTextFile(join(runDir, 'summary.json').replace(/\\\\/g, '/'), summary.stdout)\n        const jobs = await getRunJobs({ repo: repoName, id })\n        for (const j of jobs) {\n          const logPath = join(runDir, `job-${j.id}-${j.name}.log`).replace(/\\\\/g, '/')\n          const res = await proc.run({ cmd: `gh run view ${id} --repo ${repoName} --job ${j.id} --log`, cwd: process.cwd() })\n          if (res.ok) await writeTextFile(logPath, res.stdout)\n        }\n        return { ok: true, id, status: info.status, conclusion: info.conclusion, url }\n      }\n\n      if (opts.follow) {\n        // Poll until completed; sleep between attempts\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const one = await syncOnce()\n          if (!one.ok) { if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-sync', repo, branch, workflow: wf, message: 'No runs found', final: true }); else logger.warn('No runs found'); return }\n          const st = (one.status ?? '').toLowerCase()\n          const done = st === 'completed'\n          if (done) { if (opts.json) logger.jsonPrint({ ok: true, action: 'ci-sync', repo, branch, workflow: wf, id: one.id, url: one.url, status: one.status, conclusion: one.conclusion, follow: true, final: true }); else logger.info(`Synced: ${one.url}`); if ((one.conclusion ?? '').toLowerCase() === 'failure') process.exitCode = 1; return }\n          await new Promise(r => setTimeout(r, 5000))\n        }\n      } else {\n        const res = await syncOnce()\n        if (!res.ok) { if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-sync', repo, branch, workflow: wf, message: 'No runs found', final: true }); else logger.warn('No runs found'); return }\n        if (opts.json) logger.jsonPrint({ ok: true, action: 'ci-sync', repo, branch, workflow: wf, id: res.id, url: res.url, status: res.status, conclusion: res.conclusion, final: true })\n        else logger.info(`Synced: ${res.url}`)\n        if ((res.conclusion ?? '').toLowerCase() === 'failure') process.exitCode = 1\n      }\n    })\n\n  // ci last — most recent run regardless of branch; optional --workflow and --pr\n  ci\n    .command('last')\n    .description('Show the most recent GitHub Actions run (any branch); optionally scope to a PR or workflow')\n    .option('--workflow <file>', 'Workflow file name (e.g., ci.yml, pages.yml)')\n    .option('--pr <number>', 'Scope to a given PR number (resolves head branch)')\n    .option('--json', 'Emit structured JSON summary')\n    .action(async (opts: { readonly workflow?: string; readonly pr?: string; readonly json?: boolean }): Promise<void> => {\n      const repo = await resolveRepo()\n      if (!repo) {\n        const msg = 'Unable to resolve GitHub repo. Set GITHUB_REPOSITORY or add a git origin remote.'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-last', message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      const hasGh = await ghExists()\n      if (!hasGh) {\n        const msg = 'GitHub CLI (gh) not found. Install via: winget install GitHub.cli'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-last', repo, suggestion: 'install gh', final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      // Optional PR scoping → resolve branch; otherwise no branch filter\n      let branch: string | undefined\n      if (opts.pr) {\n        const prRes = await proc.run({ cmd: `gh pr view ${opts.pr} --repo ${repo} --json headRefName`, cwd: process.cwd() })\n        if (prRes.ok) {\n          try { const js = JSON.parse(prRes.stdout) as { headRefName?: string }; if (js?.headRefName) branch = js.headRefName } catch { /* ignore */ }\n        }\n      }\n      const wf: string | undefined = opts.workflow\n      const info = await getLatestRun({ repo, branch, workflow: wf })\n      if (!info) {\n        const msg = 'No runs found (trigger a workflow first).'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-last', repo, branch, workflow: wf, message: msg, final: true })\n        else logger.warn(msg)\n        return\n      }\n      const url = runUrl(repo, info.id)\n      const ok = (info.conclusion ?? '').toLowerCase() !== 'failure'\n      if (opts.json) logger.jsonPrint({ ok, action: 'ci-last', repo, branch, workflow: wf, id: info.id, url, status: info.status, conclusion: info.conclusion, final: true })\n      else logger.info(`${info.status ?? 'status: unknown'} — ${url}`)\n      if (!ok) emitAnnotation('error', `CI run failed: ${url}`)\n      if (!ok) process.exitCode = 1\n    })\n\n  // ci open — open the latest run URL (optionally scope to workflow/pr)\n  ci\n    .command('open')\n    .description('Open the most recent GitHub Actions run in your browser (optionally scope to a workflow or PR)')\n    .option('--workflow <file>', 'Workflow file name (e.g., ci.yml, pages.yml)')\n    .option('--pr <number>', 'Scope to a given PR number (resolves head branch)')\n    .option('--json', 'Emit structured JSON summary')\n    .action(async (opts: { readonly workflow?: string; readonly pr?: string; readonly json?: boolean }): Promise<void> => {\n      const repo = await resolveRepo()\n      if (!repo) {\n        const msg = 'Unable to resolve GitHub repo. Set GITHUB_REPOSITORY or add a git origin remote.'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-open', message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      const hasGh = await ghExists()\n      if (!hasGh) {\n        const msg = 'GitHub CLI (gh) not found. Install via: winget install GitHub.cli'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-open', repo, suggestion: 'install gh', final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      let branch: string | undefined\n      if (opts.pr) {\n        const prRes = await proc.run({ cmd: `gh pr view ${opts.pr} --repo ${repo} --json headRefName`, cwd: process.cwd() })\n        if (prRes.ok) {\n          try { const js = JSON.parse(prRes.stdout) as { headRefName?: string }; if (js?.headRefName) branch = js.headRefName } catch { /* ignore */ }\n        }\n      }\n      const wf: string | undefined = opts.workflow\n      const info = await getLatestRun({ repo, branch, workflow: wf })\n      if (!info) {\n        const msg = 'No runs found (trigger a workflow first).'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-open', repo, branch, workflow: wf, message: msg, final: true })\n        else logger.warn(msg)\n        return\n      }\n      const url = runUrl(repo, info.id)\n      const opened = await platformOpen(url)\n      if (opts.json) logger.jsonPrint({ ok: opened.ok, action: 'ci-open', repo, branch, workflow: wf, id: info.id, url, status: info.status, conclusion: info.conclusion, final: true })\n      else logger.info(`Opened: ${url}`)\n      if (!opened.ok) process.exitCode = 1\n    })\n\n  // ci summarize — compact failure digest for the latest run; fetch logs if missing\n  ci\n    .command('summarize')\n    .description('Produce a compact summary of the latest run with failing jobs and error excerpts')\n    .option('--workflow <file>', 'Workflow file name (e.g., ci.yml, pages.yml)', 'ci.yml')\n    .option('--out <dir>', 'Logs directory (default ./.artifacts/ci-logs)', '.artifacts/ci-logs')\n    .option('--pr <number>', 'Scope to a given PR number (resolves head branch)')\n    .option('--json', 'Emit structured JSON summary')\n    .action(async (opts: { readonly workflow?: string; readonly out?: string; readonly pr?: string; readonly json?: boolean }): Promise<void> => {\n      const repo = await resolveRepo()\n      if (!repo) {\n        const msg = 'Unable to resolve GitHub repo. Set GITHUB_REPOSITORY or add a git origin remote.'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-summarize', message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      const hasGh = await ghExists()\n      if (!hasGh) {\n        const msg = 'GitHub CLI (gh) not found. Install via: winget install GitHub.cli'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-summarize', repo, suggestion: 'install gh', final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      // Resolve branch from PR when provided\n      let branch: string | undefined\n      if (opts.pr) {\n        const prRes = await proc.run({ cmd: `gh pr view ${opts.pr} --repo ${repo} --json headRefName`, cwd: process.cwd() })\n        if (prRes.ok) {\n          try { const js = JSON.parse(prRes.stdout) as { headRefName?: string }; if (js?.headRefName) branch = js.headRefName } catch { /* ignore */ }\n        }\n      }\n      if (!branch) branch = await resolveBranch()\n      const wf = String(opts.workflow || 'ci.yml')\n      const repoName: string = repo\n      const run = await getLatestRun({ repo: repoName, branch, workflow: wf })\n      if (!run) {\n        const msg = 'No runs found (trigger a workflow first).'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-summarize', repo: repoName, branch, workflow: wf, message: msg, final: true })\n        else logger.warn(msg)\n        return\n      }\n      const runId: number = run.id\n      const outRoot = opts.out && opts.out.length > 0 ? opts.out : '.artifacts/ci-logs'\n      const runDir = join(process.cwd(), outRoot, sanitizeFilename(wf.replace(/\\.yml$/i, '')), String(runId))\n      await ensureDir(runDir)\n      // Ensure summary.json and logs exist (fetch if missing)\n      async function ensureSynced(): Promise<void> {\n        const summaryPath = join(runDir, 'summary.json').replace(/\\\\/g, '/')\n        let haveSummary = false\n        try { await fs.access(summaryPath); haveSummary = true } catch { /* missing */ }\n        if (!haveSummary) {\n          const summary = await proc.run({ cmd: `gh run view ${runId} --repo ${repoName} --json url,conclusion,createdAt,updatedAt,jobs`, cwd: process.cwd() })\n          if (summary.ok) await writeTextFile(summaryPath, summary.stdout)\n        }\n        // Fetch per-job logs if missing\n        const jobs = await getRunJobs({ repo: repoName, id: runId })\n        for (const j of jobs) {\n          const logPath = join(runDir, `job-${j.id}-${j.name}.log`).replace(/\\\\/g, '/')\n          let haveLog = false\n          try { await fs.access(logPath); haveLog = true } catch { /* missing */ }\n          if (!haveLog) {\n            const res = await proc.run({ cmd: `gh run view ${runId} --repo ${repoName} --job ${j.id} --log`, cwd: process.cwd() })\n            if (res.ok) await writeTextFile(logPath, res.stdout)\n          }\n        }\n      }\n      await ensureSynced()\n      // Read summary\n      let summaryObj: { readonly url?: string; readonly conclusion?: string; readonly jobs?: Array<{ readonly databaseId?: number; readonly name?: string; readonly conclusion?: string }> } | undefined\n      try {\n        const raw = await fs.readFile(join(runDir, 'summary.json'), 'utf8')\n        summaryObj = JSON.parse(raw) as { readonly url?: string; readonly conclusion?: string; readonly jobs?: Array<{ readonly databaseId?: number; readonly name?: string; readonly conclusion?: string }> }\n      } catch { /* ignore */ }\n      const runUrlStr: string = summaryObj?.url ?? runUrl(repoName, runId)\n      // Collect failing jobs and error excerpts\n      type FailItem = { readonly id: number; readonly name: string; readonly conclusion?: string; readonly errors?: string[] }\n      const failures: FailItem[] = []\n      const jobs = summaryObj?.jobs ?? []\n      for (const j of jobs) {\n        const id = typeof j.databaseId === 'number' ? j.databaseId : undefined\n        const name = sanitizeFilename(j.name ?? 'job')\n        const concl = (j.conclusion ?? '').toLowerCase()\n        if (id && (concl === 'failure' || concl === 'cancelled' || concl === 'timed_out')) {\n          const logPath = join(runDir, `job-${id}-${name}.log`).replace(/\\\\/g, '/')\n          let errors: string[] = []\n          try {\n            const txt = await fs.readFile(logPath, 'utf8')\n            const lines = txt.split(/\\r?\\n/)\n            const errLines = lines.filter(l => /(::error|\\berror\\b|\\bERR!\\b|\\bFailed\\b)/i.test(l))\n            errors = errLines.slice(-10)\n            if (errors.length === 0) errors = lines.slice(-20) // fallback tail\n          } catch { /* ignore */ }\n          failures.push({ id, name, conclusion: j.conclusion, errors })\n        }\n      }\n      const ok: boolean = (run.conclusion ?? '').toLowerCase() === 'success'\n      if (opts.json) {\n        logger.jsonPrint({ ok, action: 'ci-summarize', repo: repoName, branch, workflow: wf, id: runId, url: runUrlStr, failures, final: true })\n      } else {\n        logger.info(`${ok ? 'Success' : 'Done'} — ${runUrlStr}`)\n        if (failures.length === 0) {\n          logger.note('No failing jobs found.')\n        } else {\n          for (const f of failures) {\n            logger.warn(`Job failed: ${f.name} (#${f.id})`)\n            for (const line of f.errors ?? []) logger.info(`  ${line}`)\n          }\n        }\n      }\n      if (!ok) process.exitCode = 1\n    })\n\n  // ci dispatch — trigger a workflow\n  ci\n    .command('dispatch')\n    .description('Dispatch a GitHub Actions workflow (safeguarded). Requires --yes to proceed.')\n    .option('--workflow <file>', 'Workflow file name (e.g., ci.yml, pages.yml)')\n    .option('--ref <ref>', 'Git ref to run on', 'main')\n    .option('--inputs <k=v,...>', 'Comma-separated inputs (use key=value pairs)')\n    .option('--yes', 'Confirm dispatch without prompting')\n    .option('--json', 'Emit structured JSON summary')\n    .action(async (opts: { readonly workflow?: string; readonly ref?: string; readonly inputs?: string; readonly yes?: boolean; readonly json?: boolean }): Promise<void> => {\n      const repo = await resolveRepo()\n      if (!repo) {\n        const msg = 'Unable to resolve GitHub repo. Set GITHUB_REPOSITORY or add a git origin remote.'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-dispatch', message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      const hasGh = await ghExists()\n      if (!hasGh) {\n        const msg = 'GitHub CLI (gh) not found. Install via: winget install GitHub.cli'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-dispatch', repo, suggestion: 'install gh', final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      const wf: string | undefined = opts.workflow\n      if (!wf) {\n        const msg = 'Missing --workflow <file>. Specify a workflow filename (e.g., ci.yml).'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-dispatch', repo, message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      if (!opts.yes) {\n        const msg = 'Refusing to dispatch without --yes. Re-run with --yes to proceed.'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-dispatch', repo, workflow: wf, message: msg, final: true })\n        else logger.warn(msg)\n        process.exitCode = 1\n        return\n      }\n      const ref: string = opts.ref || 'main'\n      const fields: string[] = []\n      if (opts.inputs) {\n        for (const kv of opts.inputs.split(',')) {\n          const [k, v] = kv.split('=')\n          if (k && v !== undefined) fields.push(`--raw-field ${k}=${v}`)\n        }\n      }\n      const cmd: string = `gh workflow run ${wf} --repo ${repo} --ref ${ref} ${fields.join(' ')}`.trim()\n      const runRes = await proc.run({ cmd, cwd: process.cwd() })\n      const ok: boolean = runRes.ok\n      if (opts.json) logger.jsonPrint({ ok, action: 'ci-dispatch', repo, workflow: wf, ref, final: true })\n      else logger.info(ok ? 'Workflow dispatch requested.' : (runRes.stderr.trim() || 'Workflow dispatch failed.'))\n      if (!ok) process.exitCode = 1\n    })\n\n  // ci artifacts — list or download artifacts from the latest run\n  ci\n    .command('artifacts')\n    .description('List or download artifacts from the latest GitHub Actions run')\n    .option('--workflow <file>', 'Workflow file name (e.g., ci.yml, pages.yml)')\n    .option('--pr <number>', 'Scope to a given PR number (resolves head branch)')\n    .option('--download', 'Download artifacts instead of listing')\n    .option('--name <pattern>', 'Only download artifacts matching name (exact match)')\n    .option('--out <dir>', 'Directory to download artifacts into (default ./.artifacts)', '.artifacts')\n    .option('--json', 'Emit structured JSON summary')\n    .action(async (opts: { readonly workflow?: string; readonly pr?: string; readonly download?: boolean; readonly name?: string; readonly out?: string; readonly json?: boolean }): Promise<void> => {\n      const repo = await resolveRepo()\n      if (!repo) {\n        const msg = 'Unable to resolve GitHub repo. Set GITHUB_REPOSITORY or add a git origin remote.'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-artifacts', message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      const hasGh = await ghExists()\n      if (!hasGh) {\n        const msg = 'GitHub CLI (gh) not found. Install via: winget install GitHub.cli'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-artifacts', repo, suggestion: 'install gh', final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      // Resolve branch from PR when provided; otherwise autodetect\n      let branch: string | undefined\n      if (opts.pr) {\n        const prRes = await proc.run({ cmd: `gh pr view ${opts.pr} --repo ${repo} --json headRefName`, cwd: process.cwd() })\n        if (prRes.ok) {\n          try { const js = JSON.parse(prRes.stdout) as { headRefName?: string }; if (js?.headRefName) branch = js.headRefName } catch { /* ignore */ }\n        }\n      }\n      if (!branch) branch = await resolveBranch()\n      const wf: string | undefined = opts.workflow\n      const info = await getLatestRun({ repo, branch, workflow: wf })\n      if (!info) {\n        const msg = 'No runs found (trigger a workflow first).'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-artifacts', repo, branch, workflow: wf, message: msg, final: true })\n        else logger.warn(msg)\n        return\n      }\n      const id = info.id\n      // List artifacts as JSON for reliability\n      const view = await proc.run({ cmd: `gh run view ${id} --repo ${repo} --json artifacts`, cwd: process.cwd() })\n      if (!view.ok) {\n        const msg = view.stderr.trim() || view.stdout.trim() || 'Failed to query artifacts'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-artifacts', repo, branch, workflow: wf, id, message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      let artifacts: Array<{ readonly name?: string; readonly sizeInBytes?: number }> = []\n      try { const js = JSON.parse(view.stdout) as { artifacts?: Array<{ name?: string; sizeInBytes?: number }> }; artifacts = js.artifacts ?? [] } catch { /* ignore */ }\n      if (!opts.download) {\n        if (opts.json) logger.jsonPrint({ ok: true, action: 'ci-artifacts', repo, branch, workflow: wf, id, artifacts, final: true })\n        else {\n          if (artifacts.length === 0) logger.info('No artifacts')\n          else for (const a of artifacts) logger.info(`• ${a.name ?? 'artifact'}${typeof a.sizeInBytes === 'number' ? ` (${Math.round(a.sizeInBytes/1024)} KiB)` : ''}`)\n        }\n        return\n      }\n      // Download\n      const outDir: string = opts.out && opts.out.length > 0 ? opts.out : '.artifacts'\n      const nameArg = opts.name ? ` --name \"${opts.name}\"` : ''\n      const cmd = `gh run download ${id} --repo ${repo} --dir \"${join(process.cwd(), outDir)}\"${nameArg}`\n      const dl = await proc.run({ cmd, cwd: process.cwd() })\n      const ok = dl.ok\n      if (opts.json) logger.jsonPrint({ ok, action: 'ci-artifacts', repo, branch, workflow: wf, id, outDir, name: opts.name, final: true })\n      else logger.info(ok ? `Downloaded to ${outDir}` : (dl.stderr.trim() || 'Download failed'))\n      if (!ok) process.exitCode = 1\n    })\n\n  // ci rerun — re-run the most recent run (optionally scoped)\n  ci\n    .command('rerun')\n    .description('Re-run the most recent GitHub Actions run (optionally scope to a workflow or PR)')\n    .option('--workflow <file>', 'Workflow file name (e.g., ci.yml, pages.yml)')\n    .option('--pr <number>', 'Scope to a given PR number (resolves head branch)')\n    .option('--json', 'Emit structured JSON summary')\n    .action(async (opts: { readonly workflow?: string; readonly pr?: string; readonly json?: boolean }): Promise<void> => {\n      const repo = await resolveRepo()\n      if (!repo) {\n        const msg = 'Unable to resolve GitHub repo. Set GITHUB_REPOSITORY or add a git origin remote.'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-rerun', message: msg, final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      const hasGh = await ghExists()\n      if (!hasGh) {\n        const msg = 'GitHub CLI (gh) not found. Install via: winget install GitHub.cli'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-rerun', repo, suggestion: 'install gh', final: true })\n        else logger.error(msg)\n        process.exitCode = 1\n        return\n      }\n      let branch: string | undefined\n      if (opts.pr) {\n        const prRes = await proc.run({ cmd: `gh pr view ${opts.pr} --repo ${repo} --json headRefName`, cwd: process.cwd() })\n        if (prRes.ok) {\n          try { const js = JSON.parse(prRes.stdout) as { headRefName?: string }; if (js?.headRefName) branch = js.headRefName } catch { /* ignore */ }\n        }\n      }\n      if (!branch) branch = await resolveBranch()\n      const wf: string | undefined = opts.workflow\n      const info = await getLatestRun({ repo, branch, workflow: wf })\n      if (!info) {\n        const msg = 'No runs found (trigger a workflow first).'\n        if (opts.json) logger.jsonPrint({ ok: false, action: 'ci-rerun', repo, branch, workflow: wf, message: msg, final: true })\n        else logger.warn(msg)\n        return\n      }\n      const cmd = `gh run rerun ${info.id} --repo ${repo}`\n      const rr = await proc.run({ cmd, cwd: process.cwd() })\n      const ok = rr.ok\n      if (opts.json) logger.jsonPrint({ ok, action: 'ci-rerun', repo, branch, workflow: wf, id: info.id, final: true })\n      else logger.info(ok ? 'Rerun requested.' : (rr.stderr.trim() || 'Rerun failed.'))\n      if (!ok) process.exitCode = 1\n    })\n}\n"],"mappings":"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","names":["import_node_path","import_node_path","import_node_path","import_node_path","import_node_path","import_node_path","import_node_path","readJson","detectMonorepo","import_promises","import_node_path","import_node_path","import_node_path","import_node_path","import_promises","done","stop","import_node_path","import_promises","import_node_path","exists","import_node_path","import_promises","logsUrl","config","import_node_path","import_promises","candidates","exists","import_node_path","import_promises","import_node_path","import_commander","Ajv","import_commander","import_node_path","import_promises","import_promises","import_promises","import_ajv","import_promises","import_node_path","import_promises","exists","readFileFs","Ajv","fsStat","r","import_commander","import_promises","import_node_path","exists","file","body","import_commander","import_node_path","import_promises","tick","timer","import_commander","import_node_path","import_promises","import_node_path","import_promises","normalize","import_node_path","import_ajv","Ajv","mask","import_promises","import_node_path","escapeRegExp","wantSync","envTarget","stepTimeoutV","ls","import_commander","import_promises","import_node_path","maskUrl","maskUrl","import_commander","import_node_path","import_ajv","Ajv","mode","import_commander","import_node_path","import_promises","import_commander","import_commander","import_node_path","import_ajv","Ajv","import_commander","import_node_path","import_commander","import_node_path","import_ajv","Ajv","import_commander","import_node_path","import_promises","import_commander","import_node_path","import_commander","import_node_path","import_promises","import_commander","import_node_path","import_node_child_process","import_node_path","import_node_child_process","import_promises","clackConfirm","sleep","detectPackageManager","clackConfirm","detectPackageManager","renderGithubPagesWorkflow","res","section","envTarget","idleSeconds","effIdle","url","logsUrl","sleep","import_ajv","providerLoginUrl","openUrl","Ajv","preflight","readFileFs","hasNextConfig","targetShort","wantSync","exists","import_commander","import_commander","import_node_path","import_node_fs","ensureDir","fs","url","ok","run","jobs","mode"]}